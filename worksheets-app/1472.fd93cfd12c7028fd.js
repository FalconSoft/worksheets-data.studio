"use strict";(self.webpackChunkworksheets_app_runtime=self.webpackChunkworksheets_app_runtime||[]).push([[1472],{81472:(V,h,r)=>{r.r(h),r.d(h,{RunTimeModule:()=>X});var c=r(96814),p=r(72500),w=r(48081),R=r(20362),q=r(52667),u=r(15861),J=r(10708),t=r(65879),f=r(75263),l=r(75187),g=r(69569);let v=(()=>{var e;class i{constructor(n,a,s){this.dataService=n,this.router=a,this.not=s}resolve(n){var a=this;return(0,u.Z)(function*(){const{appOwner:s,appName:m}=n.params;try{return(0,J.n)(a.dataService.getAppDefinition(s,m))}catch(d){return a.router.navigate([]),a.not.error(d),null}})()}}return(e=i).\u0275fac=function(n){return new(n||e)(t.LFG(f.UW),t.LFG(l.F0),t.LFG(g.g))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac}),i})();var _=r(21473);let C=(()=>{var e;class i{constructor(n,a,s){this.dataService=n,this.router=a,this.not=s}resolve(n){var a=this;return(0,u.Z)(function*(){const{appOwner:s,appName:m}=n.params,d=(n.firstChild?.url.map(y=>y.path)??[]).join("/");try{return yield a.dataService.loadAppFileContent(s,m,(0,_.x2)(d),!0)}catch(y){return a.router.navigate([]),a.not.error(y),null}})()}}return(e=i).\u0275fac=function(n){return new(n||e)(t.LFG(f.UW),t.LFG(l.F0),t.LFG(g.g))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac}),i})();var Q=r(55629),I=r(16321),x=r(18942),N=r(2048);function O(e,i){1&e&&(t.TgZ(0,"div",2)(1,"div",3)(2,"span",4),t._uU(3,"..."),t.qZA()()())}let S=(()=>{var e;class i{constructor(n){this.evaluationService=n}ngOnInit(){var n=this;return(0,u.Z)(function*(){yield n.evaluationService.run({method:n.parameters?.method,script:n.contentInfo?.content,entryModule:n.contentInfo?.name}),n.evaluationContext=n.evaluationService.context,I.z.schedule(()=>n.resultsPanel?.activateLastTab(),350)})()}}return(e=i).\u0275fac=function(n){return new(n||e)(t.Y36(N.N))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-jspy-results"]],viewQuery:function(n,a){if(1&n&&t.Gf(x.W,5),2&n){let s;t.iGM(s=t.CRH())&&(a.resultsPanel=s.first)}},inputs:{contentInfo:"contentInfo",parameters:"parameters"},decls:3,vars:4,consts:[[3,"evaluationContext"],["class","d-flex justify-content-center position-absolute align-items-center w-100 h-100 spinner flex-column",4,"ngIf"],[1,"d-flex","justify-content-center","position-absolute","align-items-center","w-100","h-100","spinner","flex-column"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(n,a){1&n&&(t._UZ(0,"app-jspy-results-panel",0),t.YNc(1,O,4,0,"div",1),t.ALo(2,"async")),2&n&&(t.Q6J("evaluationContext",a.evaluationService.context),t.xp6(1),t.Q6J("ngIf",t.lcZ(2,2,a.evaluationService.loading$)))},dependencies:[c.O5,x.W,c.Ov],encapsulation:2}),i})(),b=(()=>{var e;class i{constructor(n){this.route=n,this.layoutConfig={icon:"worksheets_logo",smIcon:"worksheets_logo",toggle:!1}}ngOnInit(){this.contentInfo=this.route.parent?.snapshot.data.contentInfo,this.appDefinition=this.route.parent?.snapshot.data.appDefinition,this.parameters=this.route.snapshot.queryParams,this.fileName=`${this.contentInfo?.name}.${this.contentInfo?.contentType}`}}return(e=i).\u0275fac=function(n){return new(n||e)(t.Y36(l.gz))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-jspy-container"]],decls:9,vars:4,consts:[[3,"config"],["title","",1,"mb-0","ml-0","top-sub-header","w-md-down-50","d-none","d-md-block"],[1,"text-primary"],[1,"file-name","ml-2"],["content","",1,"h-100","position-relative",3,"parameters","contentInfo"]],template:function(n,a){1&n&&(t._UZ(0,"router-outlet"),t.TgZ(1,"app-layout",0)(2,"h2",1),t._uU(3,"WORKSHEETS "),t.TgZ(4,"span",2),t._uU(5,"DATA STUDIO"),t.qZA(),t.TgZ(6,"span",3),t._uU(7),t.qZA()(),t._UZ(8,"app-jspy-results",4),t.qZA()),2&n&&(t.xp6(1),t.Q6J("config",a.layoutConfig),t.xp6(6),t.Oqu(a.fileName),t.xp6(1),t.Q6J("parameters",a.parameters)("contentInfo",a.contentInfo))},dependencies:[Q.$,l.lC,S],styles:["[_nghost-%COMP%]{display:block;background:var(--body-bg)}.file-name[_ngcontent-%COMP%]{font-weight:500;color:var(--color)}.fa.fa-ellipsis-v[_ngcontent-%COMP%]{color:var(--color)}"]}),i})();var T=r(88093);function F(e,i){if(1&e&&t._UZ(0,"app-data-query",2),2&e){const o=t.oxw();t.Q6J("hidden",!!o.loading)("queryInfo",o.queryInfo)}}function M(e,i){1&e&&(t.TgZ(0,"div",3)(1,"div",4)(2,"span",5),t._uU(3,"Loading..."),t.qZA()()())}let A=(()=>{var e;class i{constructor(){this.loading=!1}ngOnInit(){var n=this;return(0,u.Z)(function*(){if(n.contentInfo)try{n.queryInfo=JSON.parse(n.contentInfo.content??"")}catch(a){console.error(a)}})()}}return(e=i).\u0275fac=function(n){return new(n||e)},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-query-data-results"]],viewQuery:function(n,a){if(1&n&&t.Gf(T.n,5),2&n){let s;t.iGM(s=t.CRH())&&(a.dataQuery=s.first)}},inputs:{contentInfo:"contentInfo",parameters:"parameters"},decls:2,vars:2,consts:[["class","h-100",3,"hidden","queryInfo",4,"ngIf"],["class","d-flex justify-content-center position-absolute align-items-center w-100 h-100 spinner flex-column",4,"ngIf"],[1,"h-100",3,"hidden","queryInfo"],[1,"d-flex","justify-content-center","position-absolute","align-items-center","w-100","h-100","spinner","flex-column"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(n,a){1&n&&(t.YNc(0,F,1,2,"app-data-query",0),t.YNc(1,M,4,0,"div",1)),2&n&&(t.Q6J("ngIf",null==a.queryInfo?null:a.queryInfo.sqlQuery),t.xp6(1),t.Q6J("ngIf",a.loading))},dependencies:[c.O5,T.n],encapsulation:2}),i})();var Z=r(94782),U=r(93613);function P(e,i){if(1&e){const o=t.EpF();t.TgZ(0,"app-data-filters",5,6),t.NdJ("filtersBarChanged",function(a){t.CHM(o);const s=t.oxw();return t.KtG(null==s.dataQuery?null:s.dataQuery.onFiltersBarChanged(a))}),t.qZA()}if(2&e){const o=t.oxw();t.Q6J("filtersBar",null==o.queryInfo?null:o.queryInfo.filtersBar)("dataSource",o.dataSource)}}function G(e,i){if(1&e){const o=t.EpF();t.TgZ(0,"button",7),t.NdJ("click",function(){t.CHM(o);const a=t.oxw();return t.KtG(null==a.dataQuery?null:a.dataQuery.openQueryManager())}),t._UZ(1,"i",8),t.qZA()}if(2&e){const o=t.oxw();t.s9C("title",null==o.queryInfo||null==o.queryInfo.sqlQuery?null:o.queryInfo.sqlQuery.tableName)}}function Y(e,i){if(1&e){const o=t.EpF();t.TgZ(0,"button",9),t.NdJ("click",function(){t.CHM(o);const a=t.oxw();return t.KtG(a.save())}),t._uU(1,"Save"),t.qZA()}}let j=(()=>{var e;class i{get dataSource(){return this.dataQuery?.dataSource}constructor(n,a){this.dataService=n,this.commandsService=a,this.changed=!1}ngOnInit(){if(this.appContent&&this.appDefinition&&this.dataQuery){this.appPermissions=this.dataService.getAppPermissions(this.appDefinition),this.appPermissions.canUpdateData&&this.dataQuery.gridDataModified.subscribe(()=>this.changed=!0),this.appPermissions.canUpdateCode&&this.dataQuery.queryInfoChange.subscribe(()=>this.changed=!0);try{this.queryInfo=JSON.parse(this.appContent.content??"")}catch(n){console.error(n)}}}save(){if(!this.appDefinition||!this.appContent||!this.dataQuery?.queryInfo)return;const n=this.dataQuery.queryInfo;if(this.appPermissions?.canUpdateCode&&this.dataService.saveAppContent({appName:this.appDefinition?.appName,ownerName:this.appDefinition?.appOwner,content:JSON.stringify(n),fileName:(0,_.nV)(this.appContent)}),this.appPermissions?.canUpdateData){const{connectionName:a,tableName:s}=n.sqlQuery;this.commandsService.saveGridData(a,s,this.dataQuery.dataGrid?.gridContext)}this.changed=!1}}return(e=i).\u0275fac=function(n){return new(n||e)(t.Y36(f.UW),t.Y36(Z.q))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-data-query-actions"]],inputs:{dataQuery:"dataQuery",appContent:"appContent",appDefinition:"appDefinition"},decls:5,vars:3,consts:[[1,"d-flex","flex-row","mx-0","align-items-center"],[1,"mr-2","ml-auto"],[3,"filtersBar","dataSource","filtersBarChanged",4,"ngIf"],["class","btn px-2",3,"title","click",4,"ngIf"],["type","button","class","btn btn-primary btn-sm align-self-center ml-2 px-3",3,"click",4,"ngIf"],[3,"filtersBar","dataSource","filtersBarChanged"],["filtersBar",""],[1,"btn","px-2",3,"title","click"],[1,"fa","fa-cog"],["type","button",1,"btn","btn-primary","btn-sm","align-self-center","ml-2","px-3",3,"click"]],template:function(n,a){1&n&&(t.TgZ(0,"div",0),t._UZ(1,"div",1),t.YNc(2,P,2,2,"app-data-filters",2),t.YNc(3,G,2,1,"button",3),t.YNc(4,Y,2,0,"button",4),t.qZA()),2&n&&(t.xp6(2),t.Q6J("ngIf",a.dataSource),t.xp6(1),t.Q6J("ngIf",null==a.appPermissions?null:a.appPermissions.canUpdateCode),t.xp6(1),t.Q6J("ngIf",a.changed))},dependencies:[c.O5,U.K],styles:[".fa.fa-cog[_ngcontent-%COMP%], .fa.fa-refresh[_ngcontent-%COMP%], .fa.fa-search[_ngcontent-%COMP%]{color:var(--color)}"]}),i})();function B(e,i){if(1&e&&t._UZ(0,"app-data-query-actions",7),2&e){const o=t.oxw();t.Q6J("dataQuery",null==o.dataQueryResults?null:o.dataQueryResults.dataQuery)("appContent",o.contentInfo)("appDefinition",o.appDefinition)}}function $(e,i){if(1&e){const o=t.EpF();t.TgZ(0,"li",17)(1,"a",18),t.NdJ("click",function(){t.CHM(o);const a=t.oxw().$implicit;return t.KtG(a.click(a))}),t._UZ(2,"i"),t._uU(3),t.qZA()()}if(2&e){const o=t.oxw().$implicit;t.xp6(2),t.Gre("fa ",o.icon||"fa-circle-thin"," mr-2"),t.xp6(1),t.Oqu(o.label)}}function k(e,i){1&e&&t._UZ(0,"li",19)}function z(e,i){if(1&e&&(t.ynx(0),t.YNc(1,$,4,4,"li",15),t.YNc(2,k,1,0,"li",16),t.BQk()),2&e){const o=i.$implicit;t.xp6(1),t.Q6J("ngIf",!o.isDivider),t.xp6(1),t.Q6J("ngIf",o.isDivider)}}function H(e,i){if(1&e&&(t.TgZ(0,"ul",13),t.YNc(1,z,3,2,"ng-container",14),t.qZA()),2&e){const o=t.oxw(2);t.xp6(1),t.Q6J("ngForOf",o.menuItems)}}function E(e,i){1&e&&(t.TgZ(0,"div",8)(1,"span",9)(2,"button",10),t._UZ(3,"i",11),t.qZA(),t.YNc(4,H,2,1,"ul",12),t.qZA()())}let L=(()=>{var e;class i{get grid(){return this.dataQueryResults?.dataQuery?.dataGrid?.grid}constructor(n,a){this.route=n,this.commandsService=a,this.layoutConfig={icon:"worksheets_logo",smIcon:"worksheets_logo",toggle:!1},this.menuItems=[],this.showActionBar=!1}ngOnInit(){this.contentInfo=this.route.parent?.snapshot.data.contentInfo,this.appDefinition=this.route.parent?.snapshot.data.appDefinition,this.parameters=this.route.snapshot.queryParams,this.fileName=`${this.contentInfo?.name}.${this.contentInfo?.contentType}`,this.setMenuItems(),I.z.schedule(()=>this.showActionBar=!0)}setMenuItems(){this.menuItems=[this.commandsService.exportToCsvMenuItem(()=>this.grid?.rowData??[],()=>this.fileName),this.commandsService.exportToExcelMenuItem(()=>this.grid,()=>this.fileName),this.commandsService.saveToDatabaseMenuItem(()=>this.grid?.rowData||[])]}}return(e=i).\u0275fac=function(n){return new(n||e)(t.Y36(l.gz),t.Y36(Z.q))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-query-container"]],viewQuery:function(n,a){if(1&n&&t.Gf(A,7),2&n){let s;t.iGM(s=t.CRH())&&(a.dataQueryResults=s.first)}},decls:10,vars:6,consts:[[3,"config"],["title","",1,"mb-0","ml-0","top-sub-header","w-md-down-50","d-none","d-md-block"],[1,"text-primary"],[1,"file-name","ml-2"],["header","","class","h-100 d-flex align-self-center flex-fill justify-content-end",3,"dataQuery","appContent","appDefinition",4,"ngIf"],["settings","","class","d-flex",4,"ngIf"],["content","",1,"h-100","position-relative",3,"parameters","contentInfo"],["header","",1,"h-100","d-flex","align-self-center","flex-fill","justify-content-end",3,"dataQuery","appContent","appDefinition"],["settings","",1,"d-flex"],["dropdown","","placement","top left",1,"d-flex","position-relative","px-2"],["dropdownToggle","","type","button",1,"px-0","btn","btn-primary-outline","py-0"],[1,"fa","fa-ellipsis-v"],["class","dropdown-menu left-menu","role","menu",4,"dropdownMenu"],["role","menu",1,"dropdown-menu","left-menu"],[4,"ngFor","ngForOf"],["role","menuitem",4,"ngIf"],["class","divider dropdown-divider",4,"ngIf"],["role","menuitem"],[1,"dropdown-item","cursor-pointer",3,"click"],[1,"divider","dropdown-divider"]],template:function(n,a){1&n&&(t.TgZ(0,"app-layout",0)(1,"h2",1),t._uU(2,"WORKSHEETS "),t.TgZ(3,"span",2),t._uU(4,"DATA STUDIO"),t.qZA(),t.TgZ(5,"span",3),t._uU(6),t.qZA()(),t.YNc(7,B,1,3,"app-data-query-actions",4),t.YNc(8,E,5,0,"div",5),t._UZ(9,"app-query-data-results",6),t.qZA()),2&n&&(t.Q6J("config",a.layoutConfig),t.xp6(6),t.Oqu(a.fileName),t.xp6(1),t.Q6J("ngIf",a.showActionBar),t.xp6(1),t.Q6J("ngIf",null==a.menuItems?null:a.menuItems.length),t.xp6(1),t.Q6J("parameters",a.parameters)("contentInfo",a.contentInfo))},dependencies:[c.sg,c.O5,Q.$,p.Hz,p.Mq,p.TO,A,j],styles:["[_nghost-%COMP%]{display:block;background:var(--body-bg)}.file-name[_ngcontent-%COMP%]{font-weight:500;color:var(--color)}.fa.fa-ellipsis-v[_ngcontent-%COMP%]{color:var(--color)}"]}),i})();const K=[{path:":appOwner/:appName",component:(()=>{var e;class i{}return(e=i).\u0275fac=function(n){return new(n||e)},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-file-placeholder"]],decls:1,vars:0,template:function(n,a){1&n&&t._UZ(0,"router-outlet")},dependencies:[l.lC],styles:["[_nghost-%COMP%] > router-outlet[_ngcontent-%COMP%] +   *{height:100%}"]}),i})(),resolve:{appDefinition:v,contentInfo:C},children:[{matcher:D(/.jspy$/),component:b},{matcher:D(/.query$/),component:L}]}];let W=(()=>{var e;class i{}return(e=i).\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[l.Bz.forChild(K),l.Bz]}),i})();function D(e){return i=>{if(!i.length)return null;const o=i.map(n=>n.path).join("/");return o.match(e)?{consumed:i,posParams:{fileName:new l.bq(o,{})}}:null}}let X=(()=>{var e;class i{}return(e=i).\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({providers:[C,v],imports:[c.ez,w.I,R.T,q.c,W,p.mr.forRoot()]}),i})()}}]);