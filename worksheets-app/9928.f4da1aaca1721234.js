"use strict";(self.webpackChunkworksheets_app_runtime=self.webpackChunkworksheets_app_runtime||[]).push([[9928],{28169:(_e,le,d)=>{d.d(le,{b:()=>u});var r=d(65879);let u=(()=>{var W;class e{constructor(){this.message=""}}return(W=e).\u0275fac=function(v){return new(v||W)},W.\u0275cmp=r.Xpm({type:W,selectors:[["app-loading-dialog"]],inputs:{message:"message"},decls:5,vars:1,consts:[[1,"modal-body","py-8","d-flex","flex-column"],[1,"d-flex","justify-content-center","align-items-center","w-100","spinner","flex-column"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(v,oe){1&v&&(r.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),r._uU(4),r.qZA()()()()),2&v&&(r.xp6(4),r.Oqu(oe.message||"Loading..."))}}),e})()},93613:(_e,le,d)=>{d.d(le,{K:()=>R});var r=d(65879),u=d(65619),W=d(32013),e=d(37398),O=d(59773),v=d(93997),oe=d(69384),K=d(32181),B=d(94664),I=d(33374),z=d(72500),c=d(96814);function F(N,J){if(1&N){const ne=r.EpF();r.TgZ(0,"li",14),r._uU(1),r._UZ(2,"i",15),r.TgZ(3,"i",16),r.NdJ("click",function(){const ee=r.CHM(ne).index,Q=r.oxw();return r.KtG(Q.removeFilter(ee))}),r.qZA()()}if(2&N){const ne=J.$implicit;r.xp6(1),r.hij(" ",ne.columnName," ")}}function V(N,J){if(1&N){const ne=r.EpF();r.TgZ(0,"li",19)(1,"a",20),r.NdJ("click",function(){const ee=r.CHM(ne).$implicit,Q=r.oxw(2);return r.KtG(Q.addFilter(ee))}),r._uU(2),r.qZA()()}if(2&N){const ne=J.$implicit;r.xp6(2),r.Oqu(ne.name)}}function ae(N,J){if(1&N&&(r.TgZ(0,"ul",17),r.YNc(1,V,3,1,"li",18),r.qZA()),2&N){const ne=r.oxw();r.xp6(1),r.Q6J("ngForOf",ne.fields)}}let U=(()=>{var N;class J{constructor(X){this.dialogRef=X,this.config={},this.filters=[],this.fields=[]}ngOnInit(){this.filters=[...this.config.filters],this.setFields()}onApply(){this.dialogRef.close(this.filters)}onClose(){this.dialogRef.close()}addFilter(X){this.filters.push({columnName:X.name}),this.setFields()}removeFilter(X){this.filters.splice(X,1)}setFields(){const X=this.filters.map(re=>re.columnName);this.fields=this.config.fields.filter(re=>!X.includes(re.name))}}return(N=J).\u0275fac=function(X){return new(X||N)(r.Y36(I.z))},N.\u0275cmp=r.Xpm({type:N,selectors:[["app-manage-filters"]],inputs:{config:"config"},decls:19,vars:2,consts:[[1,"modal-header"],[1,"modal-title","pull-left"],["type","button","aria-label","Close",1,"close","pull-right",3,"click"],["aria-hidden","true"],[1,"modal-body","px-4","d-flex","flex-column","h-100"],["dragula","filters",1,"container"],["class","row py-1 my-1 pl-2 border rounded align-items-baseline",4,"ngFor","ngForOf"],["dropdown","",1,"btn-group","mr-2","mb-2","align-self-baseline"],["id","button-basic","dropdownToggle","","type","button","aria-controls","dropdown-basic",1,"btn","btn-primary","dropdown-toggle","align-self-baseline","btn-sm",3,"disabled"],["id","dropdown-basic","class","dropdown-menu overflow-auto","role","menu","aria-labelledby","button-basic",4,"dropdownMenu"],[1,"modal-footer","flex-column"],[1,"row","w-100","mx-0","px-0"],["type","button",1,"btn","btn-primary","ml-auto","mr-2",3,"click"],["type","button",1,"btn","btn-light",3,"click"],[1,"row","py-1","my-1","pl-2","border","rounded","align-items-baseline"],[1,"fa","fa-arrows","ml-auto","handle"],[1,"fa","fa-remove","mx-2","cursor-pointer",3,"click"],["id","dropdown-basic","role","menu","aria-labelledby","button-basic",1,"dropdown-menu","overflow-auto"],["role","menuitem",4,"ngFor","ngForOf"],["role","menuitem"],[1,"dropdown-item","cursor-pointer",3,"click"]],template:function(X,re){1&X&&(r.TgZ(0,"div",0)(1,"h4",1),r._uU(2,"Manage Filters"),r.qZA(),r.TgZ(3,"button",2),r.NdJ("click",function(){return re.onClose()}),r.TgZ(4,"span",3),r._uU(5,"\xd7"),r.qZA()()(),r.TgZ(6,"div",4)(7,"ul",5),r.YNc(8,F,4,1,"li",6),r.qZA(),r.TgZ(9,"div",7)(10,"button",8),r._uU(11,"Add filter "),r.qZA(),r.YNc(12,ae,2,1,"ul",9),r.qZA()(),r.TgZ(13,"div",10)(14,"div",11)(15,"button",12),r.NdJ("click",function(){return re.onApply()}),r._uU(16,"Apply"),r.qZA(),r.TgZ(17,"button",13),r.NdJ("click",function(){return re.onClose()}),r._uU(18,"Cancel"),r.qZA()()()),2&X&&(r.xp6(8),r.Q6J("ngForOf",re.filters),r.xp6(2),r.Q6J("disabled",!re.fields.length))},dependencies:[z.Hz,z.Mq,z.TO,c.sg],styles:[".fa-arrows[_ngcontent-%COMP%]{cursor:grab}"]}),J})();var H=d(28252),L=d(43829),M=d(68171);function S(N,J){if(1&N&&(r.TgZ(0,"div",6),r._UZ(1,"app-data-grid-filter",7),r.qZA()),2&N){const ne=J.$implicit,X=r.oxw();r.xp6(1),r.Q6J("columnName",ne.name)("dataSource",X.dataSource)}}function m(N,J){if(1&N){const ne=r.EpF();r.TgZ(0,"li",15),r.NdJ("click",function(re){return re.stopImmediatePropagation()}),r.TgZ(1,"div",16)(2,"app-search",17),r.NdJ("search",function(re){r.CHM(ne);const ee=r.oxw(2);return r.KtG(ee.onSearch(re))}),r.qZA()()()}}function y(N,J){if(1&N){const ne=r.EpF();r.TgZ(0,"li",9)(1,"a",10),r.NdJ("click",function(){const ee=r.CHM(ne).$implicit,Q=r.oxw(2);return r.KtG(Q.addFilter(ee))}),r._uU(2),r.qZA()()}if(2&N){const ne=J.$implicit;r.xp6(2),r.Oqu(ne.name)}}function w(N,J){if(1&N){const ne=r.EpF();r.TgZ(0,"ul",8)(1,"li",9)(2,"a",10),r.NdJ("click",function(){r.CHM(ne);const re=r.oxw();return r.KtG(re.manageFilter())}),r._UZ(3,"i",11),r._uU(4," Manage Filter"),r.qZA()(),r.YNc(5,m,3,0,"li",12),r._UZ(6,"li",13),r.YNc(7,y,3,1,"li",14),r.ALo(8,"async"),r.qZA()}if(2&N){const ne=r.oxw();r.xp6(5),r.Q6J("ngIf",ne.fields.length>5||ne.search$.value),r.xp6(2),r.Q6J("ngForOf",r.lcZ(8,2,ne.filteredFields$))}}let R=(()=>{var N;class J{constructor(X){this.dialogService=X,this.filtersBarChanged=new r.vpe,this.search$=new u.X(""),this.fields=[],this.selectedFilters$=new u.X([]),this.destroy$=new W.x}ngOnInit(){this.filtersBar&&this.selectedFilters$.next(this.filtersBar),this.selectedFields$=this.selectedFilters$.pipe((0,e.U)(re=>re?re.map(ee=>this.fields.find(Q=>Q.name===ee.columnName)).filter(ee=>!!ee).map(ee=>ee):[])),this.selectedFilters$.pipe((0,O.R)(this.destroy$),(0,v.x)((re,ee)=>JSON.stringify(re)===JSON.stringify(ee)),(0,oe.G)()).subscribe(([re,ee])=>{this.filtersBarChanged.emit(ee)}),this.subscribeOnDataSource()}ngOnChanges({dataSource:X,filtersBar:re}){X?.firstChange||this.subscribeOnDataSource(),re&&!re.firstChange&&this.setFiltersBar(re.currentValue)}onSearch(X){this.search$.next(X)}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete()}addFilter(X){this.selectedFilters$.value.map(ee=>ee.columnName).includes(X.name)||this.selectedFilters$.next([...this.selectedFilters$.value,{columnName:X.name}])}manageFilter(){this.dialogService.open(U,{initialState:{config:{filters:this.selectedFilters$.value,fields:this.fields}}}).onClose$.pipe((0,K.h)(X=>!!X)).subscribe(X=>this.selectedFilters$.next(X??[]))}setFiltersBar(X){this.selectedFilters$.next(X??[])}subscribeOnDataSource(){(0,H.m)(this.dataSource),this.dataSource.fields$.pipe((0,O.R)(this.destroy$)).subscribe(X=>{this.fields=X??[],this.setFiltersBar(this.filtersBar??[])}),this.filteredFields$=this.dataSource.fields$.pipe((0,O.R)(this.destroy$),(0,B.w)(X=>this.search$.pipe((0,e.U)(re=>X.filter(ee=>ee.name.toLowerCase().includes(re.toLowerCase()))))))}}return(N=J).\u0275fac=function(X){return new(X||N)(r.Y36(I.x))},N.\u0275cmp=r.Xpm({type:N,selectors:[["app-data-filters"]],inputs:{dataSource:"dataSource",filtersBar:"filtersBar"},outputs:{filtersBarChanged:"filtersBarChanged"},features:[r.TTD],decls:7,vars:3,consts:[[1,"row","m-0"],["class","pr-2",4,"ngFor","ngForOf"],["dropdown","","placement","bottom right",1,"btn-group","mr-2"],["id","panel-filters-button-basic","dropdownToggle","","type","button","aria-controls","panel-filters-dropdown-basic","triggers","mouseenter:mouseleave","containerClass","applied-popover",1,"btn","btn-sm","btn-outline-secondary","dropdown-toggle","align-self-baseline"],[1,"fa","fa-filter"],["id","panel-filters-dropdown-basic","class","dropdown-menu overflow-auto dropdown-menu-right","role","menu","aria-labelledby","panel-filters-button-basic",4,"dropdownMenu"],[1,"pr-2"],[3,"columnName","dataSource"],["id","panel-filters-dropdown-basic","role","menu","aria-labelledby","panel-filters-button-basic",1,"dropdown-menu","overflow-auto","dropdown-menu-right"],["role","menuitem"],[1,"dropdown-item","cursor-pointer",3,"click"],[1,"fa","fa-cogs"],["role","menuitem",3,"click",4,"ngIf"],[1,"divider","dropdown-divider"],["role","menuitem",4,"ngFor","ngForOf"],["role","menuitem",3,"click"],[1,"dropdown-item","input-group","py-0"],[3,"search"]],template:function(X,re){1&X&&(r.TgZ(0,"div",0),r.YNc(1,S,2,2,"div",1),r.ALo(2,"async"),r.TgZ(3,"div",2)(4,"button",3),r._UZ(5,"i",4),r.qZA(),r.YNc(6,w,9,4,"ul",5),r.qZA()()),2&X&&(r.xp6(1),r.Q6J("ngForOf",r.lcZ(2,1,re.selectedFields$)))},dependencies:[z.Hz,z.Mq,z.TO,c.sg,c.O5,L.g,M.E,c.Ov],styles:['[_ngcontent-%COMP%]:root{--bg: #fff;--body-bg: #e4e5e6;--header-bg: #ebedef;--color: #4f5d73;--border-color: #c4c9d0;--ws-alt: #f7f7f7;--form-input-bg: #fff;--form-input-color: #768192;--nav-link-color: #8a93a2;--secondary-color: #c4c9d0;--opacity: .05;--hover: "#f0f3f5"}.border[dropdown][_ngcontent-%COMP%]{border-color:transparent}.dropdown-menu[_ngcontent-%COMP%]{max-height:500px}.fa.fa-cogs[_ngcontent-%COMP%]{color:#636f83}  .applied-popover{min-width:100px}#panel-filters-dropdown-basic[_ngcontent-%COMP%]{min-width:250px}div.dropdown-item[_ngcontent-%COMP%]:hover{background:inherit}']}),J})()},81196:(_e,le,d)=>{d.d(le,{R:()=>O});var r=d(3202),u=d(65879);function W(v){return v instanceof Date?`dt(${(0,r.dateToString)(v)})`:Array.isArray(v)?v.map(oe=>W(oe)):v}function e(v){return"string"==typeof v&&v.startsWith("dt(")&&v.endsWith(")")?(0,r.parseDatetimeOrNull)(v.substring(3,v.length-1)):Array.isArray(v)?v.map(oe=>e(oe)):v}let O=(()=>{var v;class oe{getQueryParam(B){if(!B?.length)return;const I=JSON.stringify(B.map(c=>[c.columnName,c.operation,W(c.filterValue)])),z=1===B.length?2:1;return I.substring(z,I.length-z)}getFilterItems(B){if(!B)return[];try{let I=JSON.parse(`[${B}]`);return Array.isArray(I[0])||(I=[I]),I.map(z=>({columnName:z[0],operation:z[1],filterValue:e(z[2])}))}catch(I){return console.error("parsing url error",I),[]}}}return(v=oe).\u0275fac=function(B){return new(B||v)},v.\u0275prov=u.Yz7({token:v,factory:v.\u0275fac,providedIn:"root"}),oe})()},88093:(_e,le,d)=>{d.d(le,{n:()=>re});var r=d(15861),u=d(65879),W=d(32013),e=d(59773),O=d(32181),v=d(13231),oe=d(81872),K=d(63411),B=d(61862),I=d(3202);class z{constructor(){this.SEPARATOR="!",this.KEY_VALUE_SEPARATOR=":"}set initQueryInfo(Q){this._initQueryInfo=(0,I.deepClone)(Q)}serialize(Q){if(!Q)return{};const D={fields:void 0,top:void 0,orderBy:void 0,joins:void 0,filtersBar:void 0};Q.dataGrid&&(D.columns=this.serializeDataGridInfo(Q.dataGrid)),Q.dataChart&&(D.chart=this.serializeDataChartInfo(Q.dataChart)),Q.dataChart?.series&&(D.chartSeries=this.serializeDataChartSeries(Q.dataChart.series)),Q.viewType&&(D.viewType=Q.viewType),Q.filtersBar?.length&&(D.filtersBar=Q.filtersBar.map(A=>A.columnName).join());const b=Q.sqlQuery;return b&&(b.limitRowsCount!==this._initQueryInfo?.sqlQuery?.limitRowsCount&&(D.top=b.limitRowsCount),b.orderBy?.length&&(D.orderBy=b.orderBy.map(({fieldName:A,direction:_})=>`${A}${this.SEPARATOR}${_}`).join(",")),this.isFieldsChanged(b)&&(D.fields=b?.fields?.map(A=>[A.name,A.sqlExpression,A.groupBy].filter(_=>_).join(this.SEPARATOR)).join(",")),b.tablesJoin?.length&&(D.joins=b.tablesJoin.map(A=>[A.joinType,A.tableName,A.tableAlias,A.joinCondition,A.joinCondition2||""].join(this.SEPARATOR)).join())),D}deserialize(Q){const D={sqlQuery:{}};return Q.viewType&&(D.viewType=Q.viewType),D.sqlQuery&&(Q.columns&&(D.dataGrid=this.deserializeDataGridInfo(Q.columns)),Q.top&&(D.sqlQuery.limitRowsCount=Q.top),Q.orderBy&&(D.sqlQuery.orderBy=(0,B.split)(Q.orderBy,",").map(b=>{const[A,_]=b.split(this.SEPARATOR);return{fieldName:A,direction:_}})),Q.fields&&(D.sqlQuery.fields=(0,B.split)(Q.fields,",",["()"]).map(b=>{const[A,_,p]=b.split(this.SEPARATOR);return{name:A,sqlExpression:_,groupBy:"true"===p}})),Q.joins&&(D.sqlQuery.tablesJoin=(0,B.split)(Q.joins,",",["()"]).map(b=>{const[A,_,p,x,j]=b.split(this.SEPARATOR);return{joinType:A,tableName:_,tableAlias:p,joinCondition:x,joinCondition2:j}})),Q.chart&&(D.dataChart=this.deserializeDataChartInfo(Q.chart)),Q.chartSeries&&(D.dataChart=D.dataChart??{},D.dataChart.series=this.deserializeDataChartSeries(Q.chartSeries)),Q.filtersBar&&(D.filtersBar=(0,B.split)(Q.filtersBar,",",["()"]).map(b=>({columnName:b})))),D}isFieldsChanged(Q){return JSON.stringify(this._initQueryInfo?.sqlQuery?.fields)!==JSON.stringify(Q.fields)}serializeDataGridInfo(Q){const D=[];return Object.entries(Q.columnsMap).forEach(([b,A])=>{Object.values(A).some(([_,p])=>"name"!==_&&p)&&D.push(A)}),D.map(b=>{const A=[b.name];return Object.entries(b).filter(([_,p])=>!["dataMap","valuesData","name"].includes(_)&&p&&"function"!=typeof p).forEach(([_,p])=>{Array.isArray(p)&&(p=p.join("/")),A.push(`${_}${this.KEY_VALUE_SEPARATOR}${p}`)}),A.join(this.SEPARATOR)}).join(",")}serializeDataChartInfo(Q){return["bindingX","chartType","legendPosition","hasRangeSelector"].filter(D=>Q.hasOwnProperty(D)).map(D=>`${D}-${Q[D]}`).join(this.SEPARATOR)}serializeDataChartSeries(Q){return Q.map(D=>Object.entries(D).filter(([b,A])=>!!A).map(([b,A])=>"binding"===b?`${b}-(${A})`:`${b}-${A}`).join(this.SEPARATOR)).join(",")}deserializeDataChartInfo(Q){return(0,B.split)(Q,this.SEPARATOR).reduce((D,b)=>{const[A,_]=(0,B.split)(b,this.KEY_VALUE_SEPARATOR);return _&&(D[A]=_),D},{})}deserializeDataChartSeries(Q){return(0,B.split)(Q,",",["()"]).map(D=>(0,B.split)(D,this.SEPARATOR).reduce((A,_)=>{const[p,x]=(0,B.split)(_,this.KEY_VALUE_SEPARATOR);return A[p]=x.replace(/\(|\)/g,""),A},{}))}deserializeDataGridInfo(Q){return{columnsMap:(0,B.split)(Q,",").reduce((b,A)=>{const _=(0,B.split)(A,this.SEPARATOR),p=_.shift();return b[p]=_.reduce((x,j)=>{const[Y,te]=(0,B.split)(j,this.KEY_VALUE_SEPARATOR);return["width","dataType"].includes(Y)?x[Y]=+te:"valuesSource"===Y?x[Y]=te.split("/"):"function"!=typeof te&&(x[Y]=te),x},{name:p,field:p}),b},{})}}}var c=d(612),F=d(6015),V=d(33374),ae=d(75187),U=d(81196),H=d(60364),L=d(69569),M=d(72500),S=d(96814),m=d(56223),y=d(30641);const w=["pop"];function R(ee,Q){if(1&ee){const D=u.EpF();u.TgZ(0,"li",21)(1,"a",22),u.NdJ("click",function(){const _=u.CHM(D).$implicit,p=u.oxw(3);return u.KtG(p.addField(_))}),u._uU(2),u.qZA()()}if(2&ee){const D=Q.$implicit;u.xp6(2),u.Oqu(D.name)}}function N(ee,Q){if(1&ee&&(u.TgZ(0,"ul",19),u.YNc(1,R,3,1,"li",20),u.qZA()),2&ee){const D=u.oxw(2);u.xp6(1),u.Q6J("ngForOf",D.fields)}}function J(ee,Q){if(1&ee){const D=u.EpF();u.TgZ(0,"li",23),u._uU(1),u.TgZ(2,"select",24),u.NdJ("ngModelChange",function(A){const p=u.CHM(D).$implicit;return u.KtG(p.direction=A)}),u.TgZ(3,"option",25),u._uU(4,"DESC"),u.qZA(),u.TgZ(5,"option",26),u._uU(6,"ASC"),u.qZA()(),u._UZ(7,"i",27),u.TgZ(8,"i",28),u.NdJ("click",function(A){const p=u.CHM(D).index,x=u.oxw(2);return u.KtG(x.removeField(A,p))}),u.qZA()()}if(2&ee){const D=Q.$implicit;u.xp6(1),u.hij(" ",D.fieldName," "),u.xp6(1),u.Q6J("ngModel",D.direction)}}function ne(ee,Q){if(1&ee){const D=u.EpF();u.TgZ(0,"div",5)(1,"div",6)(2,"span",7),u._uU(3,"Limit rows "),u.qZA(),u.TgZ(4,"input",8),u.NdJ("ngModelChange",function(A){u.CHM(D);const _=u.oxw();return u.KtG(_.limitRowsCountText=A)}),u.qZA()(),u.TgZ(5,"div",9)(6,"span",7),u._uU(7,"Sort By "),u.qZA(),u.TgZ(8,"div",10)(9,"button",11),u._uU(10,"Add Field "),u.qZA(),u.YNc(11,N,2,1,"ul",12),u.qZA()(),u.TgZ(12,"div",13)(13,"ul",14),u.YNc(14,J,9,2,"li",15),u.qZA()(),u.TgZ(15,"div",16)(16,"button",17),u.NdJ("click",function(){u.CHM(D);const A=u.oxw();return u.KtG(A.onApply())}),u._uU(17,"Apply"),u.qZA(),u.TgZ(18,"button",18),u.NdJ("click",function(){u.CHM(D);const A=u.oxw();return u.KtG(A.onCancel())}),u._uU(19,"Cancel"),u.qZA()()()}if(2&ee){const D=u.oxw();u.xp6(4),u.Q6J("ngModel",D.limitRowsCountText),u.xp6(4),u.Q6J("dropup",!0),u.xp6(1),u.Q6J("disabled",!D.fields.length),u.xp6(5),u.Q6J("ngForOf",D.sortBy)}}let X=(()=>{var ee;class Q{get totalRowsCountText(){return this.realRowsCount!==this.rowsCount?` of ${this.rowsCount.toLocaleString()}`:""}constructor(b){this.notificationService=b,this.sqlQueryChange=new u.vpe,this.pop={},this.rowsCount=0,this.timestamp=0,this.sortBy=[],this.appliedSortBy=[],this.sortByList="",this.limitRowsCountText="",this.destroy$=new W.x}get fields(){return this.sqlQueryInfo?.fields||[]}ngOnInit(){this.timestamp=(new Date).getTime(),this.sqlQueryInfo?.tableName&&this.loadTotalRowsCount()}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete()}onQueryDetailsPopoverShown(b){this.limitRowsCountText=(this.sqlQueryInfo?.limitRowsCount||0).toLocaleString(),this.sqlQueryInfo?.orderBy?.length&&(this.sortBy=this.sqlQueryInfo.orderBy,this.appliedSortBy=[...this.sortBy],this.sortByList=this.getSortList())}loadTotalRowsCount(){if(!this.sqlQueryInfo?.connectionName)throw new Error("ConnectionName is not defined");const[b,A]=this.sqlQueryInfo?.tableName?.split(".")||[];(0,H.sqlDataApi)(this.sqlQueryInfo?.connectionName).query(`${b}.${A}`,"count(*) count").then(_=>this.rowsCount=_.length?_[0].count:0,_=>this.notificationService.error(_))}addField(b){this.sortBy.push({fieldName:b.name,direction:"ASC"})}onApply(){if(!this.sqlQueryInfo)throw new Error("sqlQueryInfo is null");this.appliedSortBy=[...this.sortBy],this.sqlQueryInfo.orderBy=this.appliedSortBy,this.sqlQueryInfo.limitRowsCount=(0,I.parseNumberOrNull)(this.limitRowsCountText)||0,this.sqlQueryChange.emit({sqlQuery:this.sqlQueryInfo,property:"orderBy"}),this.sqlQueryChange.emit({sqlQuery:this.sqlQueryInfo,property:"limitRowsCount"}),this.pop.hide(),this.sortByList=this.getSortList()}onCancel(){this.pop.hide()}removeField(b,A){b.stopImmediatePropagation(),this.sortBy.splice(A,1)}getKey(){return`${this.sqlQueryInfo?.connectionName}${this.sqlQueryInfo?.tableName}${this.timestamp.toString()}`}getSortList(){return this.appliedSortBy.map(b=>`${b.fieldName} ${b.direction}`).join(", ")}}return(ee=Q).\u0275fac=function(b){return new(b||ee)(u.Y36(L.g))},ee.\u0275cmp=u.Xpm({type:ee,selectors:[["app-data-query-footer"]],viewQuery:function(b,A){if(1&b&&u.Gf(w,7),2&b){let _;u.iGM(_=u.CRH())&&(A.pop=_.first)}},inputs:{realRowsCount:"realRowsCount",sqlQueryInfo:"sqlQueryInfo"},outputs:{sqlQueryChange:"sqlQueryChange"},decls:8,vars:6,consts:[[1,"grid-footer"],["containerClass","query-info-popover","placement","top","container","body",1,"cursor-pointer",3,"popover","outsideClick","onShown"],["pop","bs-popover"],[1,"fa","fa-caret-square-o-up","ml-2"],["popQueryDetailsTemplate",""],[1,"d-flex","flex-column"],[1,"d-flex","align-items-center"],[1,"popup-label"],["type","text",1,"form-control","form-control-sm","ml-auto","show-max-input","mr-0",3,"ngModel","ngModelChange"],[1,"d-flex","flex-row","mt-2","align-items-center"],["dropdown","",1,"btn-group","ml-auto","mb-2","align-self-baseline",3,"dropup"],["id","button-basic","dropdownToggle","","type","button","aria-controls","sort-fields-popover",1,"btn","btn-light","dropdown-toggle","align-self-baseline","btn-sm",3,"disabled"],["id","sort-fields-popover","class","dropdown-menu overflow-auto","role","menu","aria-labelledby","button-basic",4,"dropdownMenu"],[1,"d-flex","flex-column","h-100"],[1,"container"],["class","row py-1 my-1 pl-2 border rounded align-items-baseline",4,"ngFor","ngForOf"],[1,"row","w-100","mx-0","px-0"],["type","button",1,"btn","btn-primary","btn-sm","ml-auto","mr-2",3,"click"],["type","button",1,"btn","btn-secondary","btn-sm",3,"click"],["id","sort-fields-popover","role","menu","aria-labelledby","button-basic",1,"dropdown-menu","overflow-auto"],["role","menuitem",4,"ngFor","ngForOf"],["role","menuitem"],[1,"dropdown-item","cursor-pointer",3,"click"],[1,"row","py-1","my-1","pl-2","border","rounded","align-items-baseline"],[1,"form-control","form-control-sm","mr-3","ml-auto","select-direction",3,"ngModel","ngModelChange"],["value","DESC"],["value","ASC","selected",""],[1,"fa","fa-arrows","handle"],[1,"fa","fa-remove","mx-2","cursor-pointer",3,"click"]],template:function(b,A){if(1&b&&(u.TgZ(0,"div",0)(1,"a",1,2),u.NdJ("onShown",function(p){return A.onQueryDetailsPopoverShown(p)}),u._uU(3),u.ALo(4,"number"),u._UZ(5,"i",3),u.qZA()(),u.YNc(6,ne,20,4,"ng-template",null,4,u.W1O)),2&b){const _=u.MAs(7);u.xp6(1),u.Q6J("popover",_)("outsideClick",!0),u.xp6(2),u.AsE(" ",u.lcZ(4,4,A.realRowsCount),"",A.totalRowsCountText,"")}},dependencies:[M.Hz,M.Mq,M.TO,S.sg,m.YN,m.Kr,m.Fj,m.EJ,m.JJ,m.On,y.k5,S.JJ],styles:["[_nghost-%COMP%]{display:flex}.grid-footer[_ngcontent-%COMP%]{display:inline-block;width:auto;z-index:11}.grid-footer[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{display:inline-block;height:1.5rem;width:auto}.select-direction[_ngcontent-%COMP%]{width:70px}.popup-label[_ngcontent-%COMP%]{font-size:120%;font-weight:600;white-space:nowrap}.show-max-input[_ngcontent-%COMP%]{width:85px}  .query-info-popover{min-width:400px}#sort-fields-popover[_ngcontent-%COMP%]{right:0!important;left:auto!important}@media (max-width: 767.98px){  .query-info-popover{min-width:300px}.rows-count[_ngcontent-%COMP%]{position:initial}}"]}),Q})(),re=(()=>{var ee;class Q{constructor(b,A,_,p){this.dialogService=b,this.router=A,this.route=_,this.filtersSerializers=p,this.destroy$=new W.x,this.reflectUrl=!1,this.gridDataModified=new u.vpe,this.queryInfoChange=new u.vpe,this.additionalFiltersChange=new u.vpe,this.dblClick=new u.vpe,this.dataSource=new oe.n,this.additionalFilters=[],this.ViewType=v.bW}ngOnInit(){var b=this;return(0,r.Z)(function*(){if(!b.dataGrid)throw new Error("this.dataGrid is not initilized");if(!b.queryInfo)throw new Error("this.queryInfo is not initilized");if(b.dataGrid.dataGridInfo=b.queryInfo.dataGrid,b.reflectUrl&&(b.queryInfoSerializer=new z),!b.queryInfo?.sqlQuery)throw new Error("this.queryInfo.sqlQuery is not defined");b.dataSource.data$.pipe((0,e.R)(b.destroy$),(0,O.h)(A=>!!A?.fields&&!b.queryInfo?.sqlQuery?.fields?.length)).subscribe(A=>{b.queryInfo?.sqlQuery&&(b.queryInfo.sqlQuery.fields=A?.fields?.map(_=>({name:_.name,sqlExpression:b.queryInfo?.sqlQuery?.tableAlias?`${b.queryInfo.sqlQuery.tableAlias}.${_.name}`:_.name,groupBy:!1})),b.reflectUrl&&b.queryInfoSerializer&&(b.queryInfoSerializer.initQueryInfo=b.queryInfo))}),b.initAdditionalFilters(),b.initUrlQueryInfo(),b.queryInfo.sqlQuery.connectionName&&(yield b.dataSource.reload(b.queryInfo.sqlQuery))})()}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete()}onDblClick(b){this.dblClick.next(b)}onDataGridColumnMoved(b){const A=this.queryInfo?.sqlQuery?.fields||[];let _=b.from<b.to?1:0;A.splice(b.to+_,0,A[b.from]),_=b.from>b.to?1:0,A.splice(b.from+_,1),this.reflectChangesToUrl(),this.queryInfoChange.emit(this.queryInfo)}reload(){var b=this;return(0,r.Z)(function*(){if(!b.dataGrid)throw new Error("this.dataGrid is not initilized");if(!b.queryInfo)throw new Error("this.queryInfo is not initilized");yield b.dataSource.reload(b.queryInfo.sqlQuery)})()}sqlFieldChanged(b){var A=this;return(0,r.Z)(function*(){if(!A.queryInfo)throw new Error("this.queryInfo is not initilized");const _=A.queryInfo.sqlQuery?.fields?.find(p=>p.name===b.name);_&&(_.sqlExpression=b.sqlExpression,A.reflectChangesToUrl(),yield A.dataSource.reload(A.queryInfo.sqlQuery))})()}onDataGridInfoChanged(b){var A=this;return(0,r.Z)(function*(){if(!A.queryInfo)throw new Error("this.queryInfo is not initilized");A.queryInfo.dataGrid=b,A.reflectChangesToUrl(),A.queryInfoChange.emit(A.queryInfo)})()}onDataChartInfoChanged(b){if(!this.queryInfo)throw new Error("this.queryInfo is not initilized");this.queryInfo.dataChart=b,this.reflectChangesToUrl(),this.queryInfoChange.emit(this.queryInfo)}onViewTypeChanged(b){if(!this.queryInfo)throw new Error("this.queryInfo is not initilized");this.queryInfo.viewType=b,this.reflectChangesToUrl(),this.queryInfoChange.emit(this.queryInfo)}onFiltersBarChanged(b){if(!this.queryInfo)throw new Error("this.dataGrid is not initilized");this.queryInfo.filtersBar=b,this.queryInfoChange.emit(this.queryInfo),this.reflectChangesToUrl()}onSqlQueryChange(b){this.reflectChangesToUrl(),this.dataSource.reload(b.sqlQuery)}openQueryManager(){var b=this;return(0,r.Z)(function*(){return new Promise(A=>{var _;b.dialogService.open(K._,{class:"modal-xl full-height",keyboard:!1,initialState:{config:b.queryInfo?.sqlQuery,configQueryInfo:b.queryInfo}}).onClose$.pipe((0,O.h)(p=>!!p)).subscribe(function(p){return(_=_||(0,r.Z)(function*(x){b.queryInfo&&(b.queryInfo.sqlQuery=x,b.queryInfoChange.emit(b.queryInfo),yield b.dataSource.reload(b.queryInfo.sqlQuery),b.reflectChangesToUrl(),A())})).apply(this,arguments)})})})()}initAdditionalFilters(){this.filtersSerializers.getFilterItems(this.route.snapshot.queryParams.filter).forEach(_=>this.dataSource.addAdditionalFilter(_)),this.dataSource.additionalFilters$.pipe((0,e.R)(this.destroy$)).subscribe(_=>{this.additionalFilters=_,this.additionalFiltersChange.emit(_),this.syncQueryFilterParam({filter:this.filtersSerializers.getQueryParam(this.additionalFilters)})})}initUrlQueryInfo(){if(this.reflectUrl&&this.queryInfoSerializer){const b=this.queryInfoSerializer.deserialize(this.route.snapshot.queryParams);this.queryInfo&&(this.queryInfo.dataGrid=b.dataGrid,this.queryInfo.dataChart=b.dataChart,this.queryInfo.viewType=b.viewType??v.bW.DataGrid,this.queryInfo.filtersBar=b.filtersBar,Object.assign(this.queryInfo.sqlQuery,b.sqlQuery),this.tabsComponent&&b.viewType===v.bW.Chart&&(this.tabsComponent.tabs[1].active=!0))}}reflectChangesToUrl(){if(this.reflectUrl&&this.queryInfoSerializer){const b=this.queryInfoSerializer.serialize(this.queryInfo);this.syncQueryFilterParam(b)}}setViewType(b){this.queryInfo&&(this.queryInfo.viewType=b,this.reflectChangesToUrl(),this.queryInfoChange.emit(this.queryInfo))}syncQueryFilterParam(b){this.router.navigate([],{relativeTo:this.route,queryParams:b,queryParamsHandling:"merge"})}}return(ee=Q).\u0275fac=function(b){return new(b||ee)(u.Y36(V.x),u.Y36(ae.F0),u.Y36(ae.gz),u.Y36(U.R))},ee.\u0275cmp=u.Xpm({type:ee,selectors:[["app-data-query"]],viewQuery:function(b,A){if(1&b&&(u.Gf(F.Z,7),u.Gf(c.AH,7)),2&b){let _;u.iGM(_=u.CRH())&&(A.dataGrid=_.first),u.iGM(_=u.CRH())&&(A.tabsComponent=_.first)}},inputs:{dataFilters:"dataFilters",reflectUrl:"reflectUrl",queryInfo:"queryInfo"},outputs:{gridDataModified:"gridDataModified",queryInfoChange:"queryInfoChange",additionalFiltersChange:"additionalFiltersChange",dblClick:"dblClick"},decls:5,vars:7,consts:[[1,"d-flex","flex-column","h-100"],[1,"d-flex","h-100","flex-column","overflow-hidden","mb-0"],[3,"dataSource","dataGridInfo","showEmptyGrid","dataChartInfo","viewType","dblClick","dataGridInfoChanged","sqlFieldChanged","dataGridColumnMoved","gridDataModified","dataChartInfoChanged","viewTypeChanged"],["dataGrid",""],["footer-right","",3,"realRowsCount","sqlQueryInfo","sqlQueryChange"]],template:function(b,A){1&b&&(u.TgZ(0,"div",0)(1,"div",1)(2,"app-ag-data-grid",2,3),u.NdJ("dblClick",function(p){return A.onDblClick(p)})("dataGridInfoChanged",function(p){return A.onDataGridInfoChanged(p)})("sqlFieldChanged",function(p){return A.sqlFieldChanged(p)})("dataGridColumnMoved",function(p){return A.onDataGridColumnMoved(p)})("gridDataModified",function(p){return A.gridDataModified.emit(p)})("dataChartInfoChanged",function(p){return A.onDataChartInfoChanged(p)})("viewTypeChanged",function(p){return A.onViewTypeChanged(p)}),u.TgZ(4,"app-data-query-footer",4),u.NdJ("sqlQueryChange",function(p){return A.onSqlQueryChange(p)}),u.qZA()()()()),2&b&&(u.xp6(2),u.Q6J("dataSource",A.dataSource)("dataGridInfo",null==A.queryInfo?null:A.queryInfo.dataGrid)("showEmptyGrid",!0)("dataChartInfo",null==A.queryInfo?null:A.queryInfo.dataChart)("viewType",null==A.queryInfo?null:A.queryInfo.viewType),u.xp6(2),u.Q6J("realRowsCount",A.dataSource.loadedRowsCount)("sqlQueryInfo",null==A.queryInfo?null:A.queryInfo.sqlQuery))},dependencies:[F.Z,X],styles:[".fa.fa-cog[_ngcontent-%COMP%], .fa.fa-refresh[_ngcontent-%COMP%]{color:var(--color)}"]}),Q})()},89250:(_e,le,d)=>{d.d(le,{U:()=>U});var r=d(15861),u=d(3202),W=d(21473),e=d(49568),O=d(13509),v=d(65879),oe=d(69569),K=d(8050),B=d(71997),I=d(33374),z=d(96814),c=d(56223);function F(H,L){if(1&H&&(v.TgZ(0,"span",18),v._uU(1),v.qZA()),2&H){const M=v.oxw();v.xp6(1),v.hij("",M.progressPct," ")}}function V(H,L){1&H&&v._UZ(0,"span",19)}function ae(H,L){1&H&&(v.ynx(0),v._uU(1,"Open File"),v.BQk())}let U=(()=>{var H;class L{constructor(S,m,y,w){this.notificationService=S,this.tabsService=m,this.studioService=y,this.dialogRef=w,this.fileService=new O.j5,this.take="1000",this.skip="",this.containsText="",this.distinct="",this.progressPct=""}ngOnInit(){this.take=this.options?.take?String(this.options?.take):"",this.skip=this.options?.skip?String(this.options?.skip):"",this.containsText=this.options?.containsText?String(this.options?.containsText):"",this.distinct=this.options?.distinct?String(this.options?.distinct):""}onFileChange(S){var m=this;return(0,r.Z)(function*(){const y=S?.files[0];if(!y)return void m.notificationService.error("No file selected");let w={take:(0,u.parseNumberOrNull)(m.take)||void 0,skip:(0,u.parseNumberOrNull)(m.skip)||void 0,containsText:m.containsText||void 0,distinct:m.distinct||void 0};w={...m.options||{},...w};const R={parser:new e.cB,fileName:y.name,count:0,finished:!1,data:[],chunkItems:[]};m.progressPct="Reading ...";try{var N;yield m.fileService.openTextFilePartially(y,function(J,ne){return(N=N||(0,r.Z)(function*(X,re){return m.progressPct=`Reading ${re} %`,yield m.fileService.processJsonChunk(X,R,w)})).apply(this,arguments)},m.options?.chunkSize),m.dialogRef.close({fileName:y.name,fileSize:y.size,data:R.data})}catch(J){m.dialogRef.close({fileName:y.name,fileSize:y.size,errorMessage:(0,W.e$)(J)})}})()}onGenerateJspy(){this.tabsService.addNewAppTab(this.studioService.currentApp,"jspy","",`# press run button and select JSON/JSV file\nreturn openFileAsArray({\n  #filter: r => r.id == 1, # filter predicate\n  #map: r => # add transformation logic here\n  take: ${this.take}\n  #skip: 3\n}).data\n    `),this.dialogRef.close(null)}onCancel(){this.dialogRef.close(null)}}return(H=L).\u0275fac=function(S){return new(S||H)(v.Y36(oe.g),v.Y36(K.x),v.Y36(B.F),v.Y36(I.z))},H.\u0275cmp=v.Xpm({type:H,selectors:[["app-open-file-settings-dialog"]],inputs:{options:"options"},decls:43,vars:12,consts:[[1,"modal-header"],[1,"pull-left"],[1,"modal-title"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body","px-4","d-flex","flex-column","h-100","overflow-hidden"],[1,"row","mr-0","mb-2","flex-fill"],["for","folder",1,"col-4","col-form-label"],[1,"form-control","col",3,"ngModel","disabled","ngModelChange"],[1,"row","mr-0","mt-3","flex-fill"],[1,"modal-footer","d-flex","flex-row"],["type","button",1,"btn","btn-sm","btn-outline-secondary","mr-auto",3,"click"],["class","align-middle badge badge-info p-2",4,"ngIf"],["for","my-file-selector",1,"btn","btn-sm","btn-primary","ml-auto","mr-2"],["id","my-file-selector","type","file",1,"d-none",3,"disabled","change"],["class","spinner-border",4,"ngIf"],[4,"ngIf"],["type","button",1,"btn","btn-sm","btn-light",3,"click"],[1,"align-middle","badge","badge-info","p-2"],[1,"spinner-border"]],template:function(S,m){1&S&&(v.TgZ(0,"div",0)(1,"div",1)(2,"h4",2),v._uU(3," Open file partially "),v.qZA()(),v.TgZ(4,"button",3),v.NdJ("click",function(){return m.onCancel()}),v.TgZ(5,"span",4),v._uU(6,"\xd7"),v.qZA()()(),v.TgZ(7,"div",5)(8,"div",6)(9,"label",7),v._uU(10,"Take:"),v.qZA(),v.TgZ(11,"input",8),v.NdJ("ngModelChange",function(w){return m.take=w}),v.qZA()(),v.TgZ(12,"div",6)(13,"label",7),v._uU(14,"Skip:"),v.qZA(),v.TgZ(15,"input",8),v.NdJ("ngModelChange",function(w){return m.skip=w}),v.qZA()(),v.TgZ(16,"div",6)(17,"label",7),v._uU(18,"Contains:"),v.qZA(),v.TgZ(19,"input",8),v.NdJ("ngModelChange",function(w){return m.containsText=w}),v.qZA()(),v.TgZ(20,"div",6)(21,"label",7),v._uU(22,"Distinct:"),v.qZA(),v.TgZ(23,"input",8),v.NdJ("ngModelChange",function(w){return m.distinct=w}),v.qZA()(),v.TgZ(24,"div",9)(25,"span"),v._uU(26,"* Specify how many rows to "),v.TgZ(27,"b"),v._uU(28,"take"),v.qZA(),v._uU(29," or to "),v.TgZ(30,"b"),v._uU(31,"skip"),v.qZA(),v._uU(32,". Works well with very big files"),v.qZA()()(),v.TgZ(33,"div",10)(34,"label",11),v.NdJ("click",function(){return m.onGenerateJspy()}),v._uU(35,"Generate JSPY"),v.qZA(),v.YNc(36,F,2,1,"span",12),v.TgZ(37,"label",13)(38,"input",14),v.NdJ("change",function(w){return m.onFileChange(w.target)}),v.qZA(),v.YNc(39,V,1,0,"span",15),v.YNc(40,ae,2,0,"ng-container",16),v.qZA(),v.TgZ(41,"label",17),v.NdJ("click",function(){return m.onCancel()}),v._uU(42,"Cancel"),v.qZA()()),2&S&&(v.xp6(11),v.Q6J("ngModel",m.take)("disabled",!!m.progressPct),v.xp6(4),v.Q6J("ngModel",m.skip)("disabled",!!m.progressPct),v.xp6(4),v.Q6J("ngModel",m.containsText)("disabled",!!m.progressPct),v.xp6(4),v.Q6J("ngModel",m.distinct)("disabled",!!m.progressPct),v.xp6(13),v.Q6J("ngIf",m.progressPct),v.xp6(2),v.Q6J("disabled",!!m.progressPct),v.xp6(1),v.Q6J("ngIf",m.progressPct),v.xp6(1),v.Q6J("ngIf",!m.progressPct))},dependencies:[z.O5,c.Fj,c.JJ,c.On],encapsulation:2}),L})()},80014:(_e,le,d)=>{d.d(le,{a:()=>U});var r=d(15861),u=d(46681),W=d(91334),e=d(65879),O=d(69569),v=d(75263),oe=d(33374),K=d(96814),B=d(56223),I=d(54807);function z(H,L){if(1&H&&(e.TgZ(0,"option",22),e._uU(1),e.qZA()),2&H){const M=L.$implicit;e.Q6J("ngValue",M),e.xp6(1),e.Oqu(M)}}function c(H,L){if(1&H&&(e.TgZ(0,"option",22),e._uU(1),e.qZA()),2&H){const M=L.$implicit;e.Q6J("ngValue",M),e.xp6(1),e.Oqu(M)}}function F(H,L){1&H&&(e.TgZ(0,"label",29),e._uU(1,"Subscribe Field"),e.qZA())}function V(H,L){1&H&&(e.TgZ(0,"label",29),e._uU(1,"Publish Field"),e.qZA())}function ae(H,L){if(1&H){const M=e.EpF();e.TgZ(0,"div",23)(1,"div",24),e.YNc(2,F,2,0,"label",25),e.TgZ(3,"div",26)(4,"ng-select",27),e.NdJ("ngModelChange",function(m){const w=e.CHM(M).$implicit;return e.KtG(w.subscribeField=m)})("change",function(){const y=e.CHM(M).$implicit,w=e.oxw();return e.KtG(w.onSubscribeFieldChanged(y))}),e.qZA()()(),e.TgZ(5,"div",24),e.YNc(6,V,2,0,"label",25),e.TgZ(7,"div",26)(8,"input",28),e.NdJ("ngModelChange",function(m){const w=e.CHM(M).$implicit;return e.KtG(w.publishField=m)}),e.qZA()()()()}if(2&H){const M=L.$implicit,S=L.index,m=e.oxw();e.xp6(2),e.Q6J("ngIf",0===S),e.xp6(2),e.MGl("name","left-field-name-",S,""),e.Q6J("ngModel",M.subscribeField)("items",m.subscribeFields),e.xp6(2),e.Q6J("ngIf",0===S),e.xp6(2),e.MGl("name","right-field-name-",S,""),e.Q6J("ngModel",M.publishField)}}let U=(()=>{var H;class L{constructor(S,m,y){this.notificationService=S,this.sqlMetaDataService=m,this.dialogRef=y,this.configPubSub={},this.configQueryInfo={},this.pubTopic="",this.pubMessage="selectedRow",this.pubMessages=[],this.pubEnabled=!1,this.subAction="applyFilter",this.subActions=[],this.subIsEnabled=!1,this.subTopic="",this.subscribeFields=[],this.configsInfo=[],this.formatLabel=W.N4}ngOnInit(){var S=this;return(0,r.Z)(function*(){if(S.pubMessages.push(S.configPubSub?.publish?.message||"selectedRow"),S.pubTopic=S.configPubSub?.publish?.topic||"table_dbl_click",S.pubEnabled=!!S.configPubSub?.publish?.isEnabled,S.subActions.push(S.configPubSub?.subscribe?.action||"applyFilter"),S.configQueryInfo.sqlQuery?.fields&&(S.subscribeFields=S.configQueryInfo.sqlQuery.fields.map(m=>m.name)),S.subIsEnabled=!!S.configPubSub?.subscribe?.isEnabled,S.subTopic=S.configPubSub?.subscribe?.topic||"table_dbl_click",S.configPubSub?.subscribe?.actionParams)for(const[m,y]of Object.entries(S.configPubSub.subscribe.actionParams))S.configsInfo.push({publishField:m,subscribeField:y}),S.subscribeFields.push(y);else{const m=(0,u.first)(S.configQueryInfo.sqlQuery?.fields||[])?.name||"";S.configsInfo.push({publishField:m,subscribeField:m})}})()}onSave(){const S={publish:{isEnabled:!!this.pubEnabled,topic:this.pubTopic,message:this.pubMessage},subscribe:{isEnabled:!!this.subIsEnabled,topic:this.subTopic,action:this.subAction,actionParams:this.configsInfo.reduce((m,y)=>({...m,[y.publishField]:y.subscribeField}),{})}};this.dialogRef.close(S)}onCancel(){this.dialogRef.close()}onAddParams(){this.configQueryInfo.sqlQuery?.fields&&(this.subscribeFields=this.configQueryInfo.sqlQuery.fields.map(S=>S.name),this.configsInfo.push({publishField:"publishField_Name",subscribeField:this.subscribeFields[0]}))}onSubscribeFieldChanged(S){S.publishField=S.subscribeField,this.subIsEnabled=!0}}return(H=L).\u0275fac=function(S){return new(S||H)(e.Y36(O.g),e.Y36(v.hp),e.Y36(oe.z))},H.\u0275cmp=e.Xpm({type:H,selectors:[["app-publish-subscribe-dialog"]],inputs:{configPubSub:"configPubSub",configQueryInfo:"configQueryInfo"},decls:45,vars:9,consts:[[1,"modal-header"],[1,"modal-title","pull-left"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body","px-4","d-flex","flex-column","h-100","overflow-hidden"],[1,"form-group","row","mr-0","mb-2","align-items-center"],["type","checkbox",1,"col-1",3,"ngModel","ngModelChange"],[1,"my-2"],[1,"row","mr-0","mb-2","flex-fill"],["for","folder",1,"col-4","col-form-label"],[1,"form-control","col",3,"ngModel","ngModelChange"],[1,"row","mr-0","mb-2","flex-nowrap"],[1,"form-control","form-control-sm",3,"ngModel","ngModelChange"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"form-group","row","mr-0","mb-1","align-items-center"],[1,"ml-2"],["type","button",1,"ml-auto","btn","btn-light","btn-sm",3,"click"],["class","form-row mx-0 fx-100 ",4,"ngFor","ngForOf"],[1,"modal-footer","flex-column"],[1,"row","w-100","mx-0","px-0"],["type","button",1,"btn","btn-primary","ml-auto","mr-2","fx-100",3,"click"],["type","button",1,"btn","btn-light","fx-80",3,"click"],[3,"ngValue"],[1,"form-row","mx-0","fx-100"],[1,"px-1","p-1","col-sm-6","col-md-6"],["class","col-form-label px-0",4,"ngIf"],[1,"p-0","m-0"],["placeholder","Enter Field Name","required","","appendTo","body",1,"auto-grow",3,"ngModel","name","items","ngModelChange","change"],[1,"form-control","col",3,"ngModel","name","ngModelChange"],[1,"col-form-label","px-0"]],template:function(S,m){1&S&&(e.TgZ(0,"div",0)(1,"h4",1),e._uU(2," Publish / Subscribe "),e.qZA(),e.TgZ(3,"button",2),e.NdJ("click",function(){return m.onCancel()}),e.TgZ(4,"span",3),e._uU(5,"\xd7"),e.qZA()()(),e.TgZ(6,"div",4)(7,"div",5)(8,"input",6),e.NdJ("ngModelChange",function(w){return m.pubEnabled=w}),e.qZA(),e.TgZ(9,"h4",7),e._uU(10,"Publish"),e.qZA()(),e.TgZ(11,"div",8)(12,"label",9),e._uU(13,"Topic:"),e.qZA(),e.TgZ(14,"input",10),e.NdJ("ngModelChange",function(w){return m.pubTopic=w}),e.qZA()(),e.TgZ(15,"div",11)(16,"label",9),e._uU(17,"Message:"),e.qZA(),e.TgZ(18,"select",12),e.NdJ("ngModelChange",function(w){return m.pubMessage=w}),e.YNc(19,z,2,2,"option",13),e.qZA()(),e.TgZ(20,"div",5)(21,"input",6),e.NdJ("ngModelChange",function(w){return m.subIsEnabled=w}),e.qZA(),e.TgZ(22,"h4",7),e._uU(23,"Subscribe"),e.qZA()(),e.TgZ(24,"div",8)(25,"label",9),e._uU(26,"Topic:"),e.qZA(),e.TgZ(27,"input",10),e.NdJ("ngModelChange",function(w){return m.subTopic=w}),e.qZA()(),e.TgZ(28,"div",11)(29,"label",9),e._uU(30,"Action:"),e.qZA(),e.TgZ(31,"select",12),e.NdJ("ngModelChange",function(w){return m.subAction=w}),e.YNc(32,c,2,2,"option",13),e.qZA()(),e.TgZ(33,"div",14)(34,"h4",15),e._uU(35,"Action Params:"),e.qZA(),e.TgZ(36,"button",16),e.NdJ("click",function(){return m.onAddParams()}),e._uU(37,"Add Params"),e.qZA()(),e.YNc(38,ae,9,7,"div",17),e.qZA(),e.TgZ(39,"div",18)(40,"div",19)(41,"button",20),e.NdJ("click",function(){return m.onSave()}),e._uU(42,"Save"),e.qZA(),e.TgZ(43,"button",21),e.NdJ("click",function(){return m.onCancel()}),e._uU(44,"Cancel"),e.qZA()()()),2&S&&(e.xp6(8),e.Q6J("ngModel",m.pubEnabled),e.xp6(6),e.Q6J("ngModel",m.pubTopic),e.xp6(4),e.Q6J("ngModel",m.pubMessage),e.xp6(1),e.Q6J("ngForOf",m.pubMessages),e.xp6(2),e.Q6J("ngModel",m.subIsEnabled),e.xp6(6),e.Q6J("ngModel",m.subTopic),e.xp6(4),e.Q6J("ngModel",m.subAction),e.xp6(1),e.Q6J("ngForOf",m.subActions),e.xp6(6),e.Q6J("ngForOf",m.configsInfo))},dependencies:[K.sg,K.O5,B.YN,B.Kr,B.Fj,B.Wl,B.EJ,B.JJ,B.Q7,B.On,I.w9],encapsulation:2}),L})()},63411:(_e,le,d)=>{d.d(le,{_:()=>p});var r=d(15861),u=d(3202),W=d(32013),e=d(65619),O=d(32181),v=d(46681),oe=d(60364),K=d(99796),B=d(4786),I=d(21473),z=d(91334),c=d(65879),F=d(69569),V=d(75263),ae=d(33374),U=d(96814),H=d(56223),L=d(54807);function M($,se){if(1&$&&(c.TgZ(0,"option",23),c._uU(1),c.qZA()),2&$){const G=se.$implicit,h=c.oxw();c.Q6J("value",G),c.xp6(1),c.Oqu(h.formatLabel(G))}}function S($,se){if(1&$&&(c.TgZ(0,"label",28),c._uU(1,"Primary Key Field"),c.qZA()),2&$){const G=c.oxw().index;c.MGl("for","left-field-name-",G,"")}}function m($,se){if(1&$&&(c.TgZ(0,"label",28),c._uU(1,"Foreign Key Field"),c.qZA()),2&$){const G=c.oxw().index;c.MGl("for","right-field-name-",G,"")}}function y($,se){if(1&$){const G=c.EpF();c.TgZ(0,"div",6)(1,"div",24),c.YNc(2,S,2,1,"label",25),c.TgZ(3,"div",16)(4,"ng-select",26),c.NdJ("ngModelChange",function(g){const Z=c.CHM(G).$implicit;return c.KtG(Z.primaryFieldName=g)})("open",function(){c.CHM(G);const g=c.oxw();return c.KtG(g.onPrimaryFieldOpen(g.joinInfo))}),c.qZA()()(),c.TgZ(5,"div",24),c.YNc(6,m,2,1,"label",25),c.TgZ(7,"div",16)(8,"ng-select",27),c.NdJ("ngModelChange",function(g){const Z=c.CHM(G).$implicit;return c.KtG(Z.foreignFieldName=g)})("close",function(){const T=c.CHM(G).$implicit,Z=c.oxw();return c.KtG(Z.onForeignFieldClose(T))})("open",function(){c.CHM(G);const g=c.oxw();return c.KtG(g.onForeignFieldOpen(g.joinInfo))}),c.qZA()()()()}if(2&$){const G=se.$implicit,h=se.index,g=c.oxw();c.xp6(2),c.Q6J("ngIf",0===h),c.xp6(2),c.MGl("name","left-field-name-",h,""),c.Q6J("ngModel",G.primaryFieldName)("items",g.joinInfo.primaryFieldNames),c.xp6(2),c.Q6J("ngIf",0===h),c.xp6(2),c.MGl("name","right-field-name-",h,""),c.Q6J("ngModel",G.foreignFieldName)("items",g.joinInfo.foreignFieldNames)}}let w=(()=>{var $;class se{constructor(h,g,T){this.notificationService=h,this.sqlMetaDataService=g,this.dialogRef=T,this.joinInfo={},this.tablesInfo=[],this.joinTypes=["InnerJoin","LeftJoin","RightJoin","FullJoin"],this.formatLabel=z.N4,this.foreingKeyTables=[],this.selectedForeignKeyTable="",this.mainTableFieldNames=[],this.leftFieldNames=[],this.leftFieldName="",this.mainTableAlias="",this.connectionName="",this.tableAlias=""}ngOnInit(){var h=this;return(0,r.Z)(function*(){function g(T,Z){return`${T} ${Z||""}`.trim()}if(!h.config)throw new Error("Input is not supplied");if(h.joinInfo.joinType=oe.JoinType.LeftJoin,h.joinInfo.fieldsInfo=[],h.mainTableAlias=h.config.mainTableAlias||"",h.connectionName=h.config.connectionName,h.joinInfo.foreignKeyTables=[g(h.config.mainTableName,h.mainTableAlias)],h.joinInfo.primaryKeyTables=h.config.allTableNames,h.config.selectedJoin){const T=h.config.selectedJoin;h.joinInfo.joinType=T.joinType,h.joinInfo.primaryKeyTable=T.tableName,h.joinInfo.tableAlias=T.tableAlias||"",h.joinInfo.joinCondition2=T.joinCondition2||"";const Z=T.joinCondition.split("AND"),he=Z[0][0][0];for(let ge of Z){const pe=ge.split("=").map(Le=>Le.trim().split("."));h.joinInfo.fieldsInfo.push({primaryFieldName:pe[0][1],foreignFieldName:pe[1][1]})}for(let ge=0;ge<h.config.joins.length;ge++){const pe=h.config.joins[ge];if(pe.tableName===T.tableName&&(pe.tableAlias||"")===(T.tableAlias||""))break;h.joinInfo.foreignKeyTables.push(g(pe.tableName,pe.tableAlias))}h.joinInfo.foreignKeyTable=h.joinInfo.foreignKeyTables.find(ge=>ge.endsWith(` ${he}`))}else{h.joinInfo.foreignKeyTable=g(h.config.mainTableName,h.mainTableAlias);for(let T of h.config.joins||[])h.joinInfo.foreignKeyTables.push(g(T.tableName,T.tableAlias))}h.config.selectedJoin||(yield h.onAddJoinTable())})()}onPrimaryTableSelect(h){var g=this;return(0,r.Z)(function*(){let T=[];g.config?.joins&&(T=g.config.joins.filter(he=>he.tableAlias!==h.tableAlias&&he.tableAlias).map(he=>he.tableAlias||"")),h.tableAlias=(0,I.Tg)(h.primaryKeyTable,3,T);const Z=h.primaryKeyTable.split(".");h.tableAlias===Z[0].slice(0,1)&&(h.tableAlias=Z[1].slice(0,1)),g.joinInfo.fieldsInfo=[],g.joinInfo.fieldsInfo.push({foreignFieldName:g.mainTableFieldNames[0]})})()}onForeignTableSelect(h){return(0,r.Z)(function*(){const g=h.foreignKeyTable?.split(" ")||[];h.foreignTableAlias=g[1]})()}onPrimaryFieldOpen(h){var g=this;return(0,r.Z)(function*(){const T=h.primaryKeyTable;if(!T&&T.indexOf(".")>0)throw new Error("joinModel.tableName can't be empty and have schemaName e.g. dbo.tableName");const Z=(yield g.sqlMetaDataService.getMetaDataObject(g.connectionName,T.split(".")[0],T.split(".")[1])).fields.map(he=>he.fieldName);g.joinInfo.primaryFieldNames=Z,g.joinInfo.primaryFieldNames.unshift("<None>")})()}onForeignFieldClose(h){var g=this;return(0,r.Z)(function*(){"<None>"===h.foreignFieldName&&"<None>"===h.primaryFieldName&&0!==g.joinInfo.fieldsInfo.length&&(g.joinInfo.fieldsInfo=g.joinInfo.fieldsInfo.filter(T=>"<None>"!==T.foreignFieldName&&"<None>"!==T.primaryFieldName))})()}onForeignFieldOpen(h){var g=this;return(0,r.Z)(function*(){const T=h.foreignKeyTable?.split(" ")||"";if(!T[0]&&T.indexOf(".")>0)throw new Error("joinModel.tableName can't be empty and have schemaName e.g. dbo.tableName");const Z=(yield g.sqlMetaDataService.getMetaDataObject(g.connectionName,T[0].split(".")[0],T[0].split(".")[1])).fields.map(he=>he.fieldName);g.joinInfo.foreignFieldNames=Z,g.joinInfo.foreignFieldNames.unshift("<None>")})()}onJoinDialogSave(){var h=this;return(0,r.Z)(function*(){const g=h.isValidJoins();if(!0===g){const T=h.fromModelToDto(h.joinInfo);h.dialogRef.close(T)}else h.notificationService.error(g)})()}onAddJoinTable(){var h=this;return(0,r.Z)(function*(){h.joinInfo.fieldsInfo.push({foreignFieldName:h.mainTableFieldNames[0]})})()}removeItem(h){}fromModelToDto(h){const g=h.foreignKeyTable?.split(" ")||"",T=g[g.length-1],Z=h.fieldsInfo.map(ge=>`${T}.${ge.foreignFieldName} = ${h.tableAlias}.${ge.primaryFieldName}`).join(" AND ");return{joinType:h.joinType,tableName:h.primaryKeyTable,tableAlias:h.tableAlias,joinCondition:Z,joinCondition2:h.joinCondition2}}isValidJoins(){const h=this.joinInfo.tableAlias;return this.joinInfo.primaryKeyTable?0===this.joinInfo.fieldsInfo.length?"Field name is empty in the row ":this.joinInfo.tableAlias?!this.config?.selectedJoin&&this.config?.joins&&1===this.config.joins.map(T=>T.tableAlias||"").concat([this.mainTableAlias]).filter(T=>T===h).length?`Dublicated table1 alias ${this.joinInfo.tableAlias}.`:this.mainTableAlias!==h||`Dublicated table2 alias ${this.joinInfo.tableAlias}.`:"Table alias is empty in the row ":"Table name is empty in the row "}onJoinCancel(){this.dialogRef.close()}}return($=se).\u0275fac=function(h){return new(h||$)(c.Y36(F.g),c.Y36(V.hp),c.Y36(ae.z))},$.\u0275cmp=c.Xpm({type:$,selectors:[["app-join-table-dialog"]],inputs:{config:"config"},decls:36,vars:9,consts:[[1,"modal-header"],[1,"modal-title","pull-left"],[1,"col-auto","col-form-label","ml-auto"],["type","text",1,"col-sm-2","px-0","auto-grow","form-control",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"modal-body","px-4","d-flex","flex-column","h-100","overflow-hidden"],[1,"form-row","mx-0","col","fx-100"],[1,"px-1","p-0","col-sm-6","col-md-5"],[1,"align-items-center"],["placeholder","Select table","appendTo","body",1,"auto-grow",3,"items","ngModel","ngModelChange","change"],[1,"px-1","p-0","col-sm-6","col-md-1"],["type","text","name","join-table-alias","required","",1,"form-control",3,"ngModel","ngModelChange"],[1,"px-1","p-0","col-sm-6","col-md-6"],["class","form-row mx-0 col fx-100 ",4,"ngFor","ngForOf"],[1,"px-1","p-1","col-12"],["for","custom-sql-condition",1,"col-form-label","px-0"],[1,"p-0","m-0"],["type","text","name","custom-sql","required","",1,"form-control",3,"ngModel","ngModelChange"],[1,"modal-footer","flex-column"],[1,"row","w-100","mx-0","px-0"],["type","button",1,"btn","btn-light",3,"click"],["type","button",1,"btn","btn-primary","ml-auto","mr-2","fx-100",3,"click"],["type","button",1,"btn","btn-light","fx-80",3,"click"],[3,"value"],[1,"px-1","p-1","col-sm-6","col-md-6"],["class","col-form-label px-0",3,"for",4,"ngIf"],["placeholder","Enter Field Name","required","","appendTo","body",1,"auto-grow",3,"ngModel","name","items","ngModelChange","open"],["placeholder","Enter Field Name","required","","appendTo","body",1,"auto-grow",3,"ngModel","name","items","ngModelChange","close","open"],[1,"col-form-label","px-0",3,"for"]],template:function(h,g){1&h&&(c.TgZ(0,"div",0)(1,"h4",1),c._uU(2," Tables and Columns "),c.qZA(),c.TgZ(3,"label",2),c._uU(4,"Join Type"),c.qZA(),c.TgZ(5,"select",3),c.NdJ("ngModelChange",function(Z){return g.joinInfo.joinType=Z}),c.YNc(6,M,2,2,"option",4),c.qZA()(),c.TgZ(7,"div",5)(8,"div",6)(9,"div",7)(10,"span",8),c._uU(11,"Primary Key Table"),c.qZA(),c.TgZ(12,"ng-select",9),c.NdJ("ngModelChange",function(Z){return g.joinInfo.primaryKeyTable=Z})("change",function(){return g.onPrimaryTableSelect(g.joinInfo)}),c.qZA()(),c.TgZ(13,"div",10)(14,"span",8),c._uU(15,"Alias"),c.qZA(),c.TgZ(16,"input",11),c.NdJ("ngModelChange",function(Z){return g.joinInfo.tableAlias=Z}),c.qZA()(),c.TgZ(17,"div",12)(18,"span",8),c._uU(19,"Foreign Key Table"),c.qZA(),c.TgZ(20,"ng-select",9),c.NdJ("ngModelChange",function(Z){return g.joinInfo.foreignKeyTable=Z})("change",function(){return g.onForeignTableSelect(g.joinInfo)}),c.qZA()()(),c.YNc(21,y,9,8,"div",13),c.TgZ(22,"div",6)(23,"div",14)(24,"label",15),c._uU(25,"Extra Conditions Sql"),c.qZA(),c.TgZ(26,"div",16)(27,"input",17),c.NdJ("ngModelChange",function(Z){return g.joinInfo.joinCondition2=Z}),c.qZA()()()()(),c.TgZ(28,"div",18)(29,"div",19)(30,"button",20),c.NdJ("click",function(){return g.onAddJoinTable()}),c._uU(31,"Add Field Key"),c.qZA(),c.TgZ(32,"button",21),c.NdJ("click",function(){return g.onJoinDialogSave()}),c._uU(33,"Save"),c.qZA(),c.TgZ(34,"button",22),c.NdJ("click",function(){return g.onJoinCancel()}),c._uU(35,"Cancel"),c.qZA()()()),2&h&&(c.xp6(5),c.Q6J("ngModel",g.joinInfo.joinType),c.xp6(1),c.Q6J("ngForOf",g.joinTypes),c.xp6(6),c.Q6J("items",g.joinInfo.primaryKeyTables)("ngModel",g.joinInfo.primaryKeyTable),c.xp6(4),c.Q6J("ngModel",g.joinInfo.tableAlias),c.xp6(4),c.Q6J("items",g.joinInfo.foreignKeyTables)("ngModel",g.joinInfo.foreignKeyTable),c.xp6(1),c.Q6J("ngForOf",g.joinInfo.fieldsInfo),c.xp6(6),c.Q6J("ngModel",g.joinInfo.joinCondition2))},dependencies:[U.sg,U.O5,H.YN,H.Kr,H.Fj,H.EJ,H.JJ,H.Q7,H.On,L.w9],encapsulation:2}),se})();var R=d(38325),N=d(80014),J=d(40092),ne=d(55314),X=d(28946),re=d(53546),ee=d(72500),Q=d(43829);const D=["selectTable"];function b($,se){if(1&$){const G=c.EpF();c.TgZ(0,"ul",66)(1,"li",67)(2,"a",68),c.NdJ("click",function(){c.CHM(G);const g=c.oxw();return c.KtG(g.onGeneratJoins())}),c._uU(3,"Generate"),c.qZA()()()}}function A($,se){if(1&$){const G=c.EpF();c.TgZ(0,"div",69)(1,"i",70),c.NdJ("click",function(){const T=c.CHM(G).$implicit,Z=c.oxw();return c.KtG(Z.delJoin(T))}),c.qZA(),c.TgZ(2,"a",71),c.NdJ("click",function(){const g=c.CHM(G),T=g.$implicit,Z=g.index,he=c.oxw();return c.KtG(he.editJoin(T,Z))}),c._uU(3),c.qZA()()}if(2&$){const G=se.$implicit,h=c.oxw();c.xp6(3),c.xDo("",h.formatLabel(G.joinType).toUpperCase()," ",G.tableName," ",G.tableAlias," ON ",G.joinCondition," ",G.joinCondition2?" AND "+G.joinCondition2:""," ")}}function _($,se){1&$&&(c.TgZ(0,"div",72)(1,"div",73)(2,"span",74),c._uU(3,"Loading..."),c.qZA()()())}let p=(()=>{var $;class se{onAvailableFieldsGridReady(h){this.avFieldsGridApi=h.api,h.api.setHeaderHeight(0)}onSelectedFieldsGridReady(h){this.selectedFieldsGridApi=h.api,h.api.setHeaderHeight(0)}constructor(h,g,T,Z,he){this.dbConnectionsService=h,this.sqlMetaDataService=g,this.notificationService=T,this.dialogService=Z,this.dialogRef=he,this.destroy$=new W.x,this.config={},this.configQueryInfo={},this.selectTable={},this.mainTableFields=[],this.selectedField={},this.selectedSortItems=[],this.loading=!1,this.dbConnectionNames=[],this.allTables=[],this.allAvailableFields=[],this.defaultColDef={editable:!1,sortable:!1,suppressFiltersToolPanel:!0,suppressMovable:!0,suppressColumnsToolPanel:!0,suppressMenu:!0},this.availableColumnDefs=[{field:"tableNameWithAlias",hide:!0,width:0,rowGroup:!0,rowGroupIndex:0},{field:"fieldName",flex:1}],this.selectedColumnDefs=[{field:"fieldName",flex:1}],this.removeSelected$=new e.X(!0),this.sortByList=[],this.options={},this.aliasesMap={},this.query={},this.queryInfo={},this.formatLabel=z.N4}loadTables(){var h=this;return(0,r.Z)(function*(){h.query.connectionName&&(h.allTables=(yield h.sqlMetaDataService.getObjects(h.query.connectionName)).filter(g=>g.objectType===B.HA.Table||g.objectType===B.HA.View).map(g=>`${g.schemaName}.${g.objectName}`))})()}loadAvailableFields(){var h=this;return(0,r.Z)(function*(){var g;if(!h.query.tableName)return h.avFieldsGridApi.setRowData([]),h.selectedFieldsGridApi.setRowData([]),void(h.selectedField={fieldName:"",tableNameWithAlias:""});const T=h;if(!T)return;function Z(pe,Ze,Ae){return(g=g||(0,r.Z)(function*(Le,Be,Ne){(yield T.sqlMetaDataService.getMetaDataObject(T.query.connectionName||"",Be.split(".")[0],Be.split(".")[1])).fields.forEach(Re=>Le.push({fieldName:Re.fieldName,dataType:(0,oe.dbTypeConverter)().fromDbType(Re.dataType,"SqlServer"),fieldExpressionText:Ne?`${Ne}.${Re.fieldName}`:Re.fieldName,sqlExpression:Ne?`${Ne}.${Re.fieldName}`:Re.fieldName,tableName:Be,tableAlias:Ne,tableNameWithAlias:`${Be} ${Ne||""}`.trim()}))})).apply(this,arguments)}const ge=[];h.aliasesMap={[h.query.tableAlias||""]:h.query.tableName},yield Z(ge,h.query.tableName,h.query.tableAlias||""),h.mainTableFields=ge.map(pe=>pe.fieldName||"");for(const pe of h.query.tablesJoin||[])yield Z(ge,pe.tableName||"",pe.tableAlias||""),h.aliasesMap[pe.tableAlias||""]=pe.tableName||"";h.allAvailableFields=ge,h.avFieldsGridApi.setRowData(ge.filter(pe=>function he(pe){return!T.removeSelected$.value||!(0,v.first)(T.query.fields||[],Ae=>`${pe.tableAlias?pe.tableAlias+".":""}${pe.fieldName}`.toLowerCase()===(Ae.sqlExpression||Ae.name).toLowerCase())}(pe)))})()}ngOnInit(){var h=this;return(0,r.Z)(function*(){h.loading=!0,h.dbConnectionNames=(yield h.dbConnectionsService.loadMyDbConnections()).map(g=>g.connectionName),h.config=h.config||{},h.config.connectionName||(h.config.connectionName=(0,v.first)(h.dbConnectionNames)||"",h.config.limitRowsCount=1e3),h.query=(0,u.deepClone)(h.config),h.selectedSortItems=(h.query.orderBy||[]).map(g=>({...g,displayName:`${g.fieldName}.${g.direction}`}));try{if(yield h.loadTables(),yield h.loadAvailableFields(),h.query.fields?.length){const g=h.query.fields.map(T=>{const Z={fieldName:T.name,sqlExpression:T.sqlExpression||T.name,groupBy:T.groupBy,tableNameWithAlias:""};return Z.tableAlias=T.sqlExpression?.substring(0,T.sqlExpression.indexOf(".")),Z.tableName=h.aliasesMap[Z.tableAlias||""],Z.tableNameWithAlias=`${Z.tableName} ${Z.tableAlias||""}`.trim(),Z.tableName||(Z.tableAlias=""),Z.fieldExpressionText=function j($){return $.tableAlias?.length?$.sqlExpression===`${$.tableAlias}.${$.fieldName}`?$.sqlExpression:`${$.sqlExpression} ${$.fieldName}`:$.sqlExpression===$.fieldName?$.fieldName||"":`${$.sqlExpression} ${$.fieldName}`}(Z),Z});h.selectedFieldsGridApi.setRowData(g)}}catch(g){h.notificationService.error(g)}finally{h.loading=!1}})()}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete()}onGroupBy(h){for(const g of(0,J.VB)(this.selectedFieldsGridApi)){const T=this.allAvailableFields.find(Z=>Z.tableName===g.tableName&&Z.fieldName===g.fieldName);g===this.selectedField||!T||(T.dataType===R.DataTypeName.FloatNumber||T.dataType===R.DataTypeName.WholeNumber?(g.fieldExpressionText=`sum(${g.tableAlias}.${g.fieldName}) ${g.fieldName}`,g.sqlExpression=`sum(${g.tableAlias}.${g.fieldName})`):g.groupBy=!0)}}onTableNameChanged(h){var g=this;return(0,r.Z)(function*(){g.query.fields=[],g.query.tablesJoin=[],g.query.tableAlias=(0,K.Tg)(g.query?.tableName||""),g.selectedField={tableNameWithAlias:"",fieldName:"",fieldExpressionText:"",groupBy:!1},g.selectedFieldsGridApi.setRowData([]),yield g.loadAvailableFields()})()}onDbConnectionChanged(h){var g=this;return(0,r.Z)(function*(){g.query.tableName="",g.query.tableAlias="",yield g.loadTables(),yield g.loadAvailableFields()})()}onSelectedFieldsSearch(h){this.onGridSearch(this.selectedFieldsGridApi,h)}onAvailableFieldsSearch(h){this.onGridSearch(this.avFieldsGridApi,h)}onGridSearch(h,g){h.deselectAll(),h.clearRangeSelection(),h.setQuickFilter(g)}onRemoveSelectedChange(h){this.removeSelected$.next(h)}onFieldExpressionChanged(){(function x($,se){const G=$.lastIndexOf(" ");G>0&&(se.fieldName=$.substring(G+1),se.sqlExpression=$.substring(0,G))})(this.selectedField?.fieldExpressionText?.trim()||"",this.selectedField),this.selectedFieldsGridApi.refreshCells()}onJoinTable(){var h=this;return(0,r.Z)(function*(){var g;h.dialogService.open(w,{class:"modal-lg",initialState:{config:{joins:h.query.tablesJoin||[],allTableNames:h.allTables,mainTableName:h.query.tableName,mainTableAlias:h.query.tableAlias,mainTableFields:h.mainTableFields,connectionName:h.query.connectionName}}}).onClose$.pipe((0,O.h)(Z=>!!Z)).subscribe(function(Z){return(g=g||(0,r.Z)(function*(he){h.query.tablesJoin||(h.query.tablesJoin=[]),h.query.tablesJoin.push(he),yield h.loadAvailableFields()})).apply(this,arguments)})})()}moveNext(){te(this.selectedFieldsGridApi,1)}movePrev(){te(this.selectedFieldsGridApi,-1)}onFieldSelect(){this.selectedField=(0,J.Ym)(this.selectedFieldsGridApi)[0]||{}}addCustomField(){const h={fieldName:"",groupBy:!1,fieldExpressionText:"[alias].[FieldExpression] [fieldName]",tableNameWithAlias:`${this.query.tableName} ${this.query.tableAlias||""}`.trim()},g=this.selectedFieldsGridApi.getSelectedNodes()[0]?.rowIndex||0,T=(0,J.VB)(this.selectedFieldsGridApi);g>=0?T.splice(g+1,0,h):T.push(h),this.selectedFieldsGridApi.setRowData(T),(0,J.JE)(this.selectedFieldsGridApi,Z=>Z==h)}addFields(){Y(this.avFieldsGridApi,this.selectedFieldsGridApi,this.removeSelected$.value)}removeFields(){Y(this.selectedFieldsGridApi,this.avFieldsGridApi)}onSave(){this.query.fields=(0,J.VB)(this.selectedFieldsGridApi).map(g=>({name:g.fieldName,sqlExpression:g.sqlExpression,groupBy:!!g.groupBy})),this.query.orderBy=this.selectedSortItems.map(g=>({fieldName:g.fieldName,direction:g.direction}));const h=this.isValidQuery();!0===h?this.dialogRef.close(this.query):this.notificationService.error(h)}onCancel(){this.dialogRef.close()}onSortByOpen(){const h=(0,J.VB)(this.selectedFieldsGridApi),g=[];for(const T of h)g.push({fieldName:T.fieldName||"",direction:"ASC",displayName:`${T.fieldName}.ASC`}),g.push({fieldName:T.fieldName||"",direction:"DESC",displayName:`${T.fieldName}.DESC`});this.sortByList=g}isValidQuery(){if(!this.query.connectionName)return"Connection field must be defined";if(!this.query.tableName)return"Table/View field must be defined";if(!this.query.fields?.length)return"At least one field should be selected";const h=new Set,g=[];for(const T of this.query.fields)h.has(T.name)?g.push(T?.name||""):h.add(T.name);if(g.length)return"Fields should be unique. Check: "+g.join(", ")+".";for(const T of this.query.orderBy||[])if(!h.has(T.fieldName))return`Incorrect Sort Field [${T.fieldName}]`;return!0}delJoin(h){var g=this;return(0,r.Z)(function*(){g.query.tablesJoin=g.query.tablesJoin?.filter(T=>T.tableAlias!==h.tableAlias),yield g.loadAvailableFields()})()}editJoin(h,g){var T=this;return(0,r.Z)(function*(){var Z;T.dialogService.open(w,{class:"modal-lg",initialState:{config:{joins:T.query.tablesJoin||[],selectedJoin:h,allTableNames:T.allTables,mainTableName:T.query.tableName,mainTableFields:T.mainTableFields,mainTableAlias:T.query.tableAlias,connectionName:T.query.connectionName}}}).onClose$.pipe((0,O.h)(ge=>!!ge)).subscribe(function(ge){return(Z=Z||(0,r.Z)(function*(pe){T.query.tablesJoin?.splice(g,1,pe),yield T.loadAvailableFields()})).apply(this,arguments)})})()}onGeneratJoins(){var h=this;return(0,r.Z)(function*(){let g=h.query.tableName,T=[];const Z=yield h.sqlMetaDataService.getMetaDataObject(h.query.connectionName||"",g.split(".")[0],g.split(".")[1]);if(Z.foreignKeys){h.query.tablesJoin=[];for(let he of Z.foreignKeys){T=h.query.tablesJoin?.filter(Ae=>!!Ae.tableAlias).map(Ae=>Ae.tableAlias||"");const ge=h.query.tableAlias,pe=(0,K.Tg)(he.primaryTableName,3,T);h.query.tablesJoin.push({joinType:oe.JoinType.LeftJoin,tableName:he.primaryTableName,tableAlias:pe,joinCondition:`${ge}.${he.fieldName} = ${pe}.${he.primaryFieldName}`}),h.loadAvailableFields()}}})()}onPublishSubscribe(){if(!this.configQueryInfo)throw new Error("configQueryInfo is not defined");this.dialogService.open(N.a,{class:"modal-md",initialState:{configPubSub:this.configQueryInfo.pubSub,configQueryInfo:this.configQueryInfo}}).onClose$.pipe((0,O.h)(g=>!!g)).subscribe(g=>this.configQueryInfo.pubSub=g)}}return($=se).\u0275fac=function(h){return new(h||$)(c.Y36(ne.F),c.Y36(X.h),c.Y36(F.g),c.Y36(ae.x),c.Y36(ae.z))},$.\u0275cmp=c.Xpm({type:$,selectors:[["app-query-dialog"]],viewQuery:function(h,g){if(1&h&&c.Gf(D,7),2&h){let T;c.iGM(T=c.CRH())&&(g.selectTable=T.first)}},inputs:{config:"config",configQueryInfo:"configQueryInfo"},decls:98,vars:25,consts:[[1,"modal-header"],[1,"modal-title","pull-left"],[1,"col-auto","col-form-label","ml-auto"],["placeholder","Select connection",1,"px-0","col-sm-3",3,"ngModel","items","ngModelChange","change"],["type","button","aria-label","Close",1,"close","pull-right","ml-2",3,"click"],["aria-hidden","true"],[1,"modal-body","px-4","d-flex","flex-column","h-100","overflow-hidden"],[1,"mr-0","d-flex","flex-wrap"],[1,"d-flex","flex-row","my-2"],["for","object-name",1,"col-form-label","mr-2"],["placeholder","Select table",1,"px-0","auto-grow",3,"items","ngModel","ngModelChange","change"],["selectTable",""],[1,"fx-120","pl-0","d-flex","flex-row","mr-2","my-2"],["for","main-table-alias",1,"col-form-label","px-2"],["type","text","placeholder","Enter alias","readonly","true","name","main-table-alias","id","main-table-alias","required","",1,"form-control",3,"ngModel","ngModelChange"],["dropdown","",1,"btn-group","my-2"],["type","button",1,"btn","btn-light",3,"click"],["id","button-split","type","button","dropdownToggle","","aria-controls","dropdown-split",1,"btn","btn-light","dropdown-toggle","dropdown-toggle-split"],[1,"caret"],[1,"sr-only","visually-hidden"],["id","dropdown-split","class","dropdown-menu","placement","top right","role","menu","aria-labelledby","button-split",4,"dropdownMenu"],["for","order-by",1,"col-form-label","px-2"],["bindLabel","displayName",1,"col","px-0","auto-grow",2,"min-width","90px","max-width","120px",3,"multiple","ngModel","items","ngModelChange","open"],["for","limit-rows-count",1,"col-form-label","px-2"],["type","text","name","limit-rows-count","id","limit-rows-count",1,"form-control",2,"width","60px",3,"ngModel","ngModelChange"],[1,"py-2"],["class","d-flex border-gray align-items-center",4,"ngFor","ngForOf"],[1,"row","h-100","overflow-hidden","position-relative"],[1,"col","py-2","d-flex","flex-column","h-100","pr-0"],[1,"row","align-items-center"],[1,"col-auto"],[1,"col","max-w-260","ml-auto","mb-2",3,"search"],["rowSelection","multiple","groupDisplayType","groupRows",1,"ag-theme-balham","h-100","w-100",3,"columnDefs","defaultColDef","enableRangeSelection","groupDefaultExpanded","gridReady"],[1,"row"],[1,"form-check","form-check-inline","mr-1","ml-auto"],["id","available-remove-selected","type","radio","name","inline-radios",1,"form-check-input",3,"value","checked","change"],["for","available-remove-selected",1,"form-check-label"],[1,"form-check","form-check-inline","mr-1"],["id","available-show-all","type","radio","name","inline-radios",1,"form-check-input",3,"value","checked","change"],["for","available-show-all",1,"form-check-label"],[1,"col-auto","d-flex","flex-column","align-self-center"],[1,"btn","btn-light","mb-2",3,"click"],["aria-hidden","true",1,"fa","fa-plus","fa-lg"],["title","Add field",1,"btn","btn-light","mb-2",3,"click"],["aria-hidden","true",1,"fa","fa-angle-double-right","fa-lg"],[1,"btn","btn-light","mb-4",3,"click"],["aria-hidden","true",1,"fa","fa-angle-double-left","fa-lg"],[1,"col","py-2","px-0","d-flex","flex-column","h-100"],["rowSelection","multiple",1,"ag-theme-balham","h-100","w-100",3,"columnDefs","defaultColDef","enableRangeSelection","selectionChanged","gridReady"],[1,"row","pt-2"],[1,"col-12"],[1,"form-check-label","col-auto","h5","mb-0"],[1,"form-check","form-check-inline","ml-auto","col-auto"],["type","checkbox","id","groupby-selection",1,"form-check-input","mr-2",3,"ngModel","change","ngModelChange"],["for","groupby-selection",1,"form-check-label"],["type","text","placeholder","Sql field expression",1,"form-control",3,"ngModel","input","ngModelChange"],["aria-hidden","true",1,"fa","fa-angle-up","fa-lg"],["aria-hidden","true",1,"fa","fa-angle-down","fa-lg"],["class","d-flex justify-content-center position-absolute align-items-center w-100 h-100 spinner",4,"ngIf"],[1,"col-form-label","col-auto","h5","mb-0","py-0"],["type","text",1,"form-control",3,"ngModel","ngModelChange"],[1,"modal-footer","flex-column"],[1,"row","w-100","mx-0","px-0"],["type","button",1,"col-auto","btn","btn-link","px-0",3,"click"],["type","button",1,"btn","btn-primary","ml-auto","mr-2","fx-80",3,"click"],["type","button",1,"btn","btn-light","fx-80",3,"click"],["id","dropdown-split","placement","top right","role","menu","aria-labelledby","button-split",1,"dropdown-menu"],["role","menuitem"],[1,"dropdown-item",3,"click"],[1,"d-flex","border-gray","align-items-center"],[1,"fa","fa-times","cursor-pointer","mr-2",2,"color","red",3,"click"],[1,"cursor-pointer",3,"click"],[1,"d-flex","justify-content-center","position-absolute","align-items-center","w-100","h-100","spinner"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(h,g){1&h&&(c.TgZ(0,"div",0)(1,"h4",1),c._uU(2,"Query Manager"),c.qZA(),c.TgZ(3,"label",2),c._uU(4,"Connection"),c.qZA(),c.TgZ(5,"ng-select",3),c.NdJ("ngModelChange",function(Z){return g.query.connectionName=Z})("change",function(Z){return g.onDbConnectionChanged(Z)}),c.qZA(),c.TgZ(6,"button",4),c.NdJ("click",function(){return g.onCancel()}),c.TgZ(7,"span",5),c._uU(8,"\xd7"),c.qZA()()(),c.TgZ(9,"div",6)(10,"div",7)(11,"div",8)(12,"label",9),c._uU(13,"Table/View"),c.qZA(),c.TgZ(14,"ng-select",10,11),c.NdJ("ngModelChange",function(Z){return g.query.tableName=Z})("change",function(Z){return g.onTableNameChanged(Z)}),c.qZA()(),c.TgZ(16,"div",12)(17,"label",13),c._uU(18,"Alias"),c.qZA(),c.TgZ(19,"input",14),c.NdJ("ngModelChange",function(Z){return g.query.tableAlias=Z}),c.qZA()(),c.TgZ(20,"div",15)(21,"button",16),c.NdJ("click",function(){return g.onJoinTable()}),c._uU(22,"Join Tables"),c.qZA(),c.TgZ(23,"button",17),c._UZ(24,"span",18),c.TgZ(25,"span",19),c._uU(26,"Split button!"),c.qZA()(),c.YNc(27,b,4,0,"ul",20),c.qZA(),c.TgZ(28,"div",8)(29,"label",21),c._uU(30,"Sort By"),c.qZA(),c.TgZ(31,"ng-select",22),c.NdJ("ngModelChange",function(Z){return g.selectedSortItems=Z})("open",function(){return g.onSortByOpen()}),c.qZA()(),c.TgZ(32,"div",8)(33,"label",23),c._uU(34,"Limit"),c.qZA(),c.TgZ(35,"input",24),c.NdJ("ngModelChange",function(Z){return g.query.limitRowsCount=Z}),c.qZA()()(),c.TgZ(36,"div",25),c.YNc(37,A,4,5,"div",26),c.qZA(),c.TgZ(38,"div",27)(39,"div",28)(40,"div",29)(41,"h5",30),c._uU(42,"Available"),c.qZA(),c.TgZ(43,"app-search",31),c.NdJ("search",function(Z){return g.onAvailableFieldsSearch(Z)}),c.qZA()(),c.TgZ(44,"ag-grid-angular",32),c.NdJ("gridReady",function(Z){return g.onAvailableFieldsGridReady(Z)}),c.qZA(),c.TgZ(45,"div",33)(46,"div",2)(47,"div",34)(48,"input",35),c.NdJ("change",function(){return g.onRemoveSelectedChange(!0)}),c.qZA(),c.TgZ(49,"label",36),c._uU(50,"Remove Selected"),c.qZA()(),c.TgZ(51,"div",37)(52,"input",38),c.NdJ("change",function(){return g.onRemoveSelectedChange(!1)}),c.qZA(),c.TgZ(53,"label",39),c._uU(54,"Show All"),c.qZA()()()()(),c.TgZ(55,"div",40)(56,"button",41),c.NdJ("click",function(){return g.addCustomField()}),c._UZ(57,"i",42),c.qZA(),c.TgZ(58,"button",43),c.NdJ("click",function(){return g.addFields()}),c._UZ(59,"i",44),c.qZA(),c.TgZ(60,"button",45),c.NdJ("click",function(){return g.removeFields()}),c._UZ(61,"i",46),c.qZA()(),c.TgZ(62,"div",47)(63,"div",29)(64,"h5",30),c._uU(65,"Selected"),c.qZA(),c.TgZ(66,"app-search",31),c.NdJ("search",function(Z){return g.onSelectedFieldsSearch(Z)}),c.qZA()(),c.TgZ(67,"ag-grid-angular",48),c.NdJ("selectionChanged",function(){return g.onFieldSelect()})("gridReady",function(Z){return g.onSelectedFieldsGridReady(Z)}),c.qZA(),c.TgZ(68,"div",49)(69,"div",50)(70,"div",33)(71,"label",51),c._uU(72,"Field Expression"),c.qZA(),c.TgZ(73,"div",52)(74,"input",53),c.NdJ("change",function(Z){return g.onGroupBy(Z.target)})("ngModelChange",function(Z){return g.selectedField.groupBy=Z}),c.qZA(),c.TgZ(75,"label",54),c._uU(76,"group by"),c.qZA()()()(),c.TgZ(77,"div",50)(78,"input",55),c.NdJ("input",function(){return g.onFieldExpressionChanged()})("ngModelChange",function(Z){return g.selectedField.fieldExpressionText=Z}),c.qZA()()()(),c.TgZ(79,"div",40)(80,"button",41),c.NdJ("click",function(){return g.movePrev()}),c._UZ(81,"i",56),c.qZA(),c.TgZ(82,"button",45),c.NdJ("click",function(){return g.moveNext()}),c._UZ(83,"i",57),c.qZA()(),c.YNc(84,_,4,0,"div",58),c.qZA(),c.TgZ(85,"div",33)(86,"label",59),c._uU(87,"Filters"),c.qZA(),c.TgZ(88,"div",50)(89,"input",60),c.NdJ("ngModelChange",function(Z){return g.query.filterString=Z}),c.qZA()()()(),c.TgZ(90,"div",61)(91,"div",62)(92,"button",63),c.NdJ("click",function(){return g.onPublishSubscribe()}),c._uU(93,"Publish / Subscribe"),c.qZA(),c.TgZ(94,"button",64),c.NdJ("click",function(){return g.onSave()}),c._uU(95,"OK"),c.qZA(),c.TgZ(96,"button",65),c.NdJ("click",function(){return g.onCancel()}),c._uU(97,"Cancel"),c.qZA()()()),2&h&&(c.xp6(5),c.Q6J("ngModel",g.query.connectionName)("items",g.dbConnectionNames),c.xp6(9),c.Q6J("items",g.allTables)("ngModel",g.query.tableName),c.xp6(5),c.Q6J("ngModel",g.query.tableAlias),c.xp6(12),c.Q6J("multiple",!0)("ngModel",g.selectedSortItems)("items",g.sortByList),c.xp6(4),c.Q6J("ngModel",g.query.limitRowsCount),c.xp6(2),c.Q6J("ngForOf",g.query.tablesJoin),c.xp6(7),c.Q6J("columnDefs",g.availableColumnDefs)("defaultColDef",g.defaultColDef)("enableRangeSelection",!0)("groupDefaultExpanded",-1),c.xp6(4),c.Q6J("value",!0)("checked",g.removeSelected$.value),c.xp6(4),c.Q6J("value",!1)("checked",!g.removeSelected$.value),c.xp6(15),c.Q6J("columnDefs",g.selectedColumnDefs)("defaultColDef",g.defaultColDef)("enableRangeSelection",!0),c.xp6(7),c.Q6J("ngModel",g.selectedField.groupBy),c.xp6(4),c.Q6J("ngModel",g.selectedField.fieldExpressionText),c.xp6(6),c.Q6J("ngIf",g.loading),c.xp6(5),c.Q6J("ngModel",g.query.filterString))},dependencies:[re.N8,ee.Hz,ee.Mq,ee.TO,U.sg,U.O5,Q.g,H.Fj,H.Wl,H.JJ,H.Q7,H.On,L.w9],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column}.fx-120[_ngcontent-%COMP%]{flex:0 0 120px}.fx-100[_ngcontent-%COMP%]{flex:0 0 100px}.fx-80[_ngcontent-%COMP%]{flex:0 0 80px}"]}),se})();function Y($,se,G=!0){const h=(0,J.VB)($),g=(0,J.VB)(se),T=(0,J.Ym)($),Z=(0,J.Ym)(se),he=Math.max(g.indexOf(Z[0]),0);let ge=0;for(const pe of T)g.splice(he+ ++ge,0,pe);if(se.setRowData(g),G){let pe=0;for(;pe<h.length;)T.indexOf(h[pe])>=0?h.splice(pe,1):pe++;$.setRowData(h)}(0,J.JE)(se,pe=>T.indexOf(pe)>=0),$.deselectAll(),$.clearRangeSelection()}function te($,se){let G=(0,J.VB)($);const h=(0,J.Ym)($);if(!h?.length)return;const g=h[0],T=G.indexOf(g);G=G.filter(Z=>Z!==g),G.splice(T+se,0,g),$.setRowData(G),(0,J.JE)($,Z=>Z===g)}},50834:(_e,le,d)=>{d.d(le,{N:()=>D});var r=d(15861),u=d(65879),W=d(82668),e=d(65619),O=d(32013),v=d(16321),oe=d(21473),K=d(4786);const B="$test_";function I(b){return b?b.split("\n").map(_=>{const p=_.match(/(def\s)(.*)(\(.*\)):/);return p?p[2].replace(/ /g,""):""}).filter(_=>!!_):[]}function z(b){return b.split("\n").map((_,p)=>(_.startsWith("def "+B)||_.startsWith("async def "+B))&&_.trimEnd().endsWith(":")?{line:p+1,state:"none",funcName:_.substring(_.indexOf(B)+6,_.indexOf("("))}:{}).filter(_=>_.funcName)}var V=d(24530),ae=d(12044),U=d(18942),H=d(2048),L=d(96814),M=d(90690);const S=["data = [",'\t{color: "blue", value: 10},','\t{color: "yellow", value: 20},','\t{color: "red", value: 15},','\t{color: "black", value: 25}',"]"],y=[{group:"JSPY IDE Basics",snippets:[{title:"Print to console",script:'print("Hello World!") # Print to output console'},{title:"Asserts",script:['assert("My Test 1", 5 == 10, "Testing falsy assertion")','assert("My Test 2", 5 == 5, "Testing success assertion")'].join("\n")},{title:"Session usage",script:['# Save and restore data between "Runs" in a session object',"if session.someData == null:",'\tsession.someData = "some value" # or heavy load operation',"print(session.someData)"].join("\n")}]},{group:"Show Results As",snippets:[{title:"Show results in object explorer",script:[...S,'showInObjectExplorer(data, "Tab title")'].join("\n")},{title:"Show results in JSON",script:[...S,'showInJSON(data, "JSON")'].join("\n")},{title:"Create chart tab",script:"\ncountries = \"US,Canada,Mexico,Germany,UK,France,Italy,Japan,Korea,China\".split(\",\")\ndata = []\nfor country in countries:\n    item = {}\n    item.country = country\n    item.sales = Math.random() * 100 + 10\n    item.expenses = Math.random() * 200 + 10\n    item.downloads = Math.round(Math.random() * 100)\n    data.push(item)\n\n# https://www.grapecity.com/wijmo/demos/Chart/Overview/purejs\noptions = {\n    itemsSource: data,\n    bindingX: 'country',\n    legend: {\n        position: 'Bottom'\n    },\n    chartType: \"Line\",\n    legendToggle: true,\n    series: [\n        { binding: 'sales', name: 'sales' },\n        { binding: 'expenses', name: 'expenses' }\n    ]\n}\n\ncreateFlexChartTab(\"Countries Chart\", options)\n        "},{title:"Create grid tab",script:'\n  \ncountries = "US,Canada,Mexico,Germany,UK,France,Italy,Japan,Korea,China".split(",")\ndata = []\nfor country in countries:\n    item = {}\n    item.country = country\n    item.sales = Math.random() * 10000 + 1000\n    item.expenses = Math.random() * 5000 + 1000\n    item.downloads = Math.round(Math.random() * 100000)\n    data.push(item)\n    \n\n  createGridTab("Countries table").show(data)\n  '}]},{group:"IDE Notifications",snippets:[{title:"notify",script:'notify("Notification message")'},{title:"warning",script:'notify("Warning message", "Warning")'},{title:"alert",script:'alert("Alert message")'}]},{group:"Rest (HTTP) Calls",snippets:[{title:"httpGet request",script:['return httpGet("https://restcountries.com/v3.1/region/eu")'].join("\n")},{title:"httpPost request",script:['sendData = {name: "John"}','httpPost("url/to/post/data", sendData)'].join("\n")},{title:"httpDelete request",script:['httpDelete("url/to/delete/data")'].join("\n")},{title:"httpPut request",script:['updateData = {id: 1, name: "John"}','httpPut("url/to/update/data", updateData)'].join("\n")},{title:"fetch",script:["return {",'  objectValue: fetch("https://restcountries.eu/rest/v2/regionalbloc/eu").json(),','  text: fetch("https://raw.githubusercontent.com/FalconSoft/sample-data/master/CSV/sample-testing-data-100.csv").text()',"}"].join("\n")},{title:"httpRequest from sqlDataApi",script:['from "sql-data-api" import httpRequest',"","# use ","return {",'  object: httpRequest("GET", "https://restcountries.eu/rest/v2/regionalbloc/eu"),','  text: httpRequest("GET", "https://raw.githubusercontent.com/FalconSoft/sample-data/master/CSV/sample-testing-data-100.csv", null, {"Content-Type": "text/plain"})',"}"].join("\n")}]},{group:"sql Data Api",snippets:[{title:"query Sql Data",script:['from "sql-data-api" import sqlDataApi',"",'return sqlDataApi("northwind-db-connection")','\t.filter("title = @title", {title: "Sales Representative"})','\t.query("northwind.NorthwindEmployees", "Title, FirstName, LastName")'].join("\n")},{title:"Execute Stored Procedure",script:['from "sql-data-api" import sqlDataApi',"",'return sqlDataApi("northwind-db-connection")','\t.sqlExecute("northwind.NorthwindTop10CustomersList", {startDate: "2017-10-10"})'].join("\n")}]}];function w(b,A){if(1&b){const _=u.EpF();u.TgZ(0,"li")(1,"a",5),u.NdJ("click",function(){const j=u.CHM(_).$implicit,Y=u.oxw(2);return u.KtG(Y.onSnippetClick(j.script))}),u._uU(2),u.qZA()()}if(2&b){const _=A.$implicit;u.xp6(2),u.Oqu(_.title)}}function R(b,A){if(1&b&&(u.TgZ(0,"div")(1,"h5"),u._uU(2),u.qZA(),u.TgZ(3,"ul"),u.YNc(4,w,3,1,"li",4),u.qZA()()),2&b){const _=A.$implicit;u.xp6(2),u.Oqu(_.group),u.xp6(2),u.Q6J("ngForOf",_.snippets)}}let N=(()=>{var b;class A{constructor(){this.snippetClick=new u.vpe,this.closeClick=new u.vpe,this.snippets=y}onSnippetClick(p){this.snippetClick.next(p)}close(){this.closeClick.next(null)}}return(b=A).\u0275fac=function(p){return new(p||b)},b.\u0275cmp=u.Xpm({type:b,selectors:[["app-jspy-help-panel"]],outputs:{snippetClick:"snippetClick",closeClick:"closeClick"},decls:9,vars:1,consts:[[1,"content","m-2"],[1,"d-flex","flex-row","w-100"],["type","button","title","Close Panel",1,"btn","btn-sm","ml-auto",3,"click"],[1,"fa","fa-times"],[4,"ngFor","ngForOf"],[1,"cursor-pointer",3,"click"]],template:function(p,x){1&p&&(u.TgZ(0,"div",0)(1,"div",1)(2,"h3"),u._uU(3,"Code snippets"),u.qZA(),u.TgZ(4,"button",2),u.NdJ("click",function(){return x.close()}),u._UZ(5,"i",3),u.qZA()(),u.TgZ(6,"p"),u._uU(7," JSPython is a python-like scripting language to facilitate running multi-requests, data transformations, and testing tasks."),u.qZA(),u.YNc(8,R,5,2,"div",4),u.qZA()),2&p&&(u.xp6(8),u.Q6J("ngForOf",x.snippets))},dependencies:[L.sg],styles:['[_ngcontent-%COMP%]:root{--bg: #fff;--body-bg: #e4e5e6;--header-bg: #ebedef;--color: #4f5d73;--border-color: #c4c9d0;--ws-alt: #f7f7f7;--form-input-bg: #fff;--form-input-color: #768192;--nav-link-color: #8a93a2;--secondary-color: #c4c9d0;--opacity: .05;--hover: "#f0f3f5"}.content[_ngcontent-%COMP%]{margin:1em;overflow-y:scroll}ul[_ngcontent-%COMP%]{padding-inline-start:.8em}ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{list-style:none}ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#20a8d8}']}),A})();function J(b,A){if(1&b&&(u.TgZ(0,"div",9),u._uU(1),u.qZA()),2&b){const _=u.oxw();u.xp6(1),u.hij(" ",null==_.runParams?null:_.runParams.status," ")}}function ne(b,A){if(1&b&&(u.TgZ(0,"span",15),u._uU(1),u.qZA()),2&b){const _=u.oxw().$implicit;u.xp6(1),u.Oqu(_.errorMessage||"")}}function X(b,A){if(1&b){const _=u.EpF();u.TgZ(0,"div",10)(1,"div"),u._UZ(2,"i"),u.qZA(),u.TgZ(3,"div",11)(4,"span",12),u.NdJ("click",function(){const j=u.CHM(_).$implicit,Y=u.oxw();return u.KtG(Y.gotoLine(j))}),u._uU(5),u.qZA(),u.YNc(6,ne,2,1,"span",13),u.qZA(),u.TgZ(7,"button",14),u.NdJ("click",function(){const j=u.CHM(_).$implicit,Y=u.oxw();return u.KtG(Y.runSelected(j))}),u._uU(8,"Run"),u.qZA()()}if(2&b){const _=A.$implicit,p=u.oxw();u.xp6(2),u.Gre("mr-2 fa fa-lg ",p.funcState(_),""),u.xp6(3),u.hij(" ",_.funcName," "),u.xp6(1),u.Q6J("ngIf","failed"===(null==_?null:_.state))}}let re=(()=>{var b;class A{constructor(){this.runAllClick=new u.vpe,this.runSelectedClick=new u.vpe,this.gotoLineClick=new u.vpe,this.runParallel=!1}funcName(p){return"failed"===p.state?`${p.funcName}: ${p.errorMessage}`:p.funcName}funcState(p){return"running"===p.state?"fa-spinner fa-spin":"completed"===p.state?"fa-check-square-o":"failed"===p.state?"fa-minus-square-o":"fa-square-o"}onRunParallelChange(){this.runParams&&(this.runParams.runParallel=!this.runParams.runParallel)}runAll(){this.runAllClick.next(null)}runSelected(p){this.runSelectedClick.next(p)}gotoLine(p){this.gotoLineClick.next(p)}}return(b=A).\u0275fac=function(p){return new(p||b)},b.\u0275cmp=u.Xpm({type:b,selectors:[["app-jspy-test-functions"]],inputs:{testFunctions:"testFunctions",runParams:"runParams"},outputs:{runAllClick:"runAllClick",runSelectedClick:"runSelectedClick",gotoLineClick:"gotoLineClick"},decls:11,vars:3,consts:[[1,"d-flex","flex-column","mx-2","h-100","overflow-hidden"],[1,"d-flex","flex-row","w-100"],["type","button","title","Run All",1,"btn","btn-sm","btn-success","m-1","mr-2",3,"click"],[1,"form-check","form-check-inline","mr-auto"],["type","checkbox","id","create-tabel",1,"form-check-input","mr-1",3,"checked","change"],["for","create-tabel",1,"form-check-label"],["class","d-flex flex-row w-100 my-2",4,"ngIf"],[1,"d-flex","flex-column","h-100","overflow-auto","mb-2"],["class","d-flex flex-row border-bottom border-gray align-items-center pb-1 mb-1",4,"ngFor","ngForOf"],[1,"d-flex","flex-row","w-100","my-2"],[1,"d-flex","flex-row","border-bottom","border-gray","align-items-center","pb-1","mb-1"],[1,"mr-1","w-100",2,"overflow-x","auto"],[1,"mr-2","mb-0","link-text","cursor-pointer",3,"click"],["class","text-danger",4,"ngIf"],[1,"btn","btn-run","btn-outline-success","ml-auto","mr-1",3,"click"],[1,"text-danger"]],template:function(p,x){1&p&&(u.TgZ(0,"div",0)(1,"div",1)(2,"button",2),u.NdJ("click",function(){return x.runAll()}),u._uU(3," Run All "),u.qZA(),u.TgZ(4,"div",3)(5,"input",4),u.NdJ("change",function(){return x.onRunParallelChange()}),u.qZA(),u.TgZ(6,"label",5),u._uU(7,"Parallel"),u.qZA()()(),u.YNc(8,J,2,1,"div",6),u.TgZ(9,"div",7),u.YNc(10,X,9,5,"div",8),u.qZA()()),2&p&&(u.xp6(5),u.Q6J("checked",null==x.runParams?null:x.runParams.runParallel),u.xp6(3),u.Q6J("ngIf",null==x.runParams?null:x.runParams.status),u.xp6(2),u.Q6J("ngForOf",x.testFunctions))},dependencies:[L.sg,L.O5],styles:['[_ngcontent-%COMP%]:root{--bg: #fff;--body-bg: #e4e5e6;--header-bg: #ebedef;--color: #4f5d73;--border-color: #c4c9d0;--ws-alt: #f7f7f7;--form-input-bg: #fff;--form-input-color: #768192;--nav-link-color: #8a93a2;--secondary-color: #c4c9d0;--opacity: .05;--hover: "#f0f3f5"}.btn-run[_ngcontent-%COMP%]{height:22px;padding-top:0}.link-text[_ngcontent-%COMP%]:hover{text-decoration:underline}']}),A})();const ee=["editorEl"];function Q(b,A){if(1&b){const _=u.EpF();u.TgZ(0,"app-jspy-test-functions",15),u.NdJ("runAllClick",function(){u.CHM(_);const x=u.oxw();return u.KtG(x.onRunAllTests())})("gotoLineClick",function(x){u.CHM(_);const j=u.oxw();return u.KtG(j.onGotoLine(x))})("runSelectedClick",function(x){u.CHM(_);const j=u.oxw();return u.KtG(j.onRunSelectedTest(x))}),u.qZA()}if(2&b){const _=u.oxw();u.Q6J("runParams",_.testRunsParams)("testFunctions",_.testFunctions)}}let D=(()=>{var b;class A{get jspyFunctions(){return this.jspyFunctionsListSubj$.value}constructor(p,x){this.resizeSvc=p,this.evaluationService=x,this.textChanged=new u.vpe,this.jspyFunctionsListSubj$=new e.X([]),this.evaluationResultSubj$=new O.x,this._evaluating=!1,this.cancelling=!1,this.testRunsParams={runParallel:!1,status:""},this.currentFileLinks=[],this.testFunctions=[],this.isHelpCollapsed=!1,this.jspyFunctionsList$=this.jspyFunctionsListSubj$.asObservable(),this.evaluationResult$=this.evaluationResultSubj$.asObservable(),this.direction=K.Ar.vertical,this.ShowInTypes=V.r,this.scriptSize=100,this.scriptHelpSize=30,this.minSize=20,this.selectedFunction=null,this.text=""}get evaluating(){return this._evaluating}set evaluating(p){this._evaluating=p,this.runtimeContext.evaluating=p}ngOnInit(){var p=this;return(0,r.Z)(function*(){p.resizeSvc.onResize$.subscribe(x=>{p.size=x,p.size<=ae.y.MD&&(p.scriptHelpSize=0,p.isHelpCollapsed=!0)}),p.evaluationService.loading$.subscribe(x=>p.evaluating=x),p.runtimeContext=p.evaluationService.runtimeContext,p.interpreter=p.evaluationService.interpreter,p.evaluationContext=p.evaluationService.context,p.loadSettings(),p.initializeEditor(p.editorEl.nativeElement)})()}reload(p){this.editor?.setValue(p),this.mergeTestFunctions(z(this.text)),this.jspyFunctionsListSubj$.next(I(this.text))}setSettings(p){this.settings=p,this.settings.settingsKey&&this.loadSettings(),this.settings.moduleLoader&&this.interpreter?.registerModuleLoader(this.settings.moduleLoader)}initializeEditor(p){this.editor=W.editor.create(p,{tabSize:2,scrollBeyondLastLine:!1,value:this.text,language:"python"}),this.editor.onDidChangeModelContent(()=>{this.text=this.editor?.getValue()||"",this.textChanged.emit(this.text),this.jspyFunctionsListSubj$.next(I(this.text)),this.mergeTestFunctions(z(this.text))}),this.resize()}handleKeyboardEvent(p){("F5"===p.key||p.ctrlKey&&"Enter"===p.key)&&(p.preventDefault(),p.stopImmediatePropagation(),this.run(this.selectedFunction||""))}appendLogMessage(p,x,j){if(j){const Y=this.runtimeContext.logs.find(te=>te.logKey===j);if(Y)return void("error"!==Y.level&&(Y.level=p,Y.message=x,"function"==typeof this.runtimeContext.onChanged&&this.runtimeContext.onChanged(this.runtimeContext.logs)))}this.runtimeContext.logs.push({level:p,logKey:j,message:x,time:new Date}),"function"==typeof this.runtimeContext.onChanged&&this.runtimeContext.onChanged(this.runtimeContext.logs)}cancelRun(){this.evaluationService.cancel()&&(this.cancelling=!0)}run(p){var x=this;return(0,r.Z)(function*(){yield x.evaluationService.run({script:x.text,method:p,entryModule:x.settings?.entryModule}),x.scriptSize=60,x.cancelling=!1,setTimeout(()=>{x.resultsPanel?.activateLastTab()},350)})()}startRuntimeOutputPanel(){this.scriptSize=60,this.runtimeContext.logs.splice(0,this.runtimeContext.logs.length),"function"==typeof this.runtimeContext.onChanged&&this.runtimeContext.onChanged(this.runtimeContext.logs),this.evaluationContext&&(this.evaluationContext.reset(),this.evaluationContext.showInItems=[{type:V.r.RunningLog,title:"Runtime Output",data:this.runtimeContext}],this.evaluationResultSubj$.next(null)),this.appendLogMessage("info","start")}onRunAllTests(){var p=this;return(0,r.Z)(function*(){yield p.runTest()})()}runTest(p){var x=this;return(0,r.Z)(function*(){var j;const Y=function(G){return(j=j||(0,r.Z)(function*(h){try{h.state="running",yield x.evaluationService.jspyEvaluate({script:x.text,entryModule:x.settings?.entryModule,method:B+h.funcName}),h.state="completed"}catch(g){h.state="failed";let T=(0,oe.e$)(g);T.startsWith("JspyEvalError:")&&(T=T.substring(T.indexOf("("))),h.errorMessage=T}})).apply(this,arguments)},te=x.testFunctions;x.startRuntimeOutputPanel(),p||te.forEach(se=>se.state="none");const $=te.find(se=>"init"===se.funcName.toLowerCase());if(!$||(x.testRunsParams.status="Running INIT test ...",yield Y($),"failed"!==$.state))if(p)yield Y(p);else{const se=te.filter(G=>G!=$);if(x.testRunsParams.runParallel)x.testRunsParams.status=`Running ${se.length} tests parallel ...`,yield Promise.all(se.map(G=>Y(G))),x.testRunsParams.status="";else{let G=1;for(const h of se)x.testRunsParams.status=`Running test [${G++}:${se.length}] ...'${h.funcName}' ...`,yield Y(h);x.testRunsParams.status=""}}})()}onRunSelectedTest(p){var x=this;return(0,r.Z)(function*(){x.runTest(p)})()}onGotoLine(p){this.editor?.setPosition({lineNumber:p.line,column:1}),this.editor?.revealLineNearTop(p.line)}resize(){v.z.schedule(()=>{this.editor?.layout(),this.resultsPanel?.resize()})}toggleHelp(){this.isHelpCollapsed=!this.isHelpCollapsed,this.scriptHelpSize=this.isHelpCollapsed?0:30,this.saveSettings(),v.z.schedule(()=>this.resize())}toggleDirection(){this.direction=this.direction===K.Ar.horizontal?K.Ar.vertical:K.Ar.horizontal,this.saveSettings(),v.z.schedule(()=>this.resize())}onSnippetClick(p){if(!this.editor)throw new Error("editor is not initialized");const x=this.editor.getPosition();this.editor.executeEdits("",[{range:new W.Range(x?.lineNumber,x?.column,x?.lineNumber,x?.column),text:`\n${p.trim()}\n`}])}saveSettings(){this.settings?.settingsKey&&localStorage.setItem(this.settings.settingsKey,JSON.stringify({scriptHelpSize:this.scriptHelpSize,direction:this.direction,isHelpCollapsed:this.isHelpCollapsed}))}loadSettings(){if(!this.settings?.settingsKey)return;const p=JSON.parse(localStorage.getItem(this.settings.settingsKey)||"{}");this.scriptHelpSize=void 0!==p.scriptHelpSize?p.scriptHelpSize:30,this.direction=p.direction||K.Ar.vertical,this.isHelpCollapsed=!!p.isHelpCollapsed}mergeTestFunctions(p){this.testFunctions.splice(0,this.testFunctions.length),p.forEach(x=>this.testFunctions.push(x))}}return(b=A).\u0275fac=function(p){return new(p||b)(u.Y36(ae._),u.Y36(H.N))},b.\u0275cmp=u.Xpm({type:b,selectors:[["app-jspy-content-editor"]],viewQuery:function(p,x){if(1&p&&(u.Gf(U.W,5),u.Gf(ee,7)),2&p){let j;u.iGM(j=u.CRH())&&(x.resultsPanel=j.first),u.iGM(j=u.CRH())&&(x.editorEl=j.first)}},hostBindings:function(p,x){1&p&&u.NdJ("keydown",function(Y){return x.handleKeyboardEvent(Y)},!1,u.evT)},outputs:{textChanged:"textChanged"},features:[u._Bn([H.N])],decls:18,vars:13,consts:[[1,"h-100",3,"direction","useTransition","transitionEnd","dragEnd"],["split","asSplit"],[1,"d-flex",3,"size","minSize"],["area1","asSplitArea"],["unit","percent","direction","horizontal",3,"useTransition","gutterSize","dragEnd","transitionEnd"],[1,"d-flex","position-relative","h-100",3,"size","minSize"],["type","button","title","Show/hide help panel",1,"btn","btn-secondary","btn-sm","px-1","py-0","position-absolute","help-toggle",3,"click"],[1,"fa","fa-question","fa-lg"],[1,"flex-fill","overflow-hidden"],["editorEl",""],["class","h-100 overflow-hidden","style","width:300px;min-width:300px",3,"runParams","testFunctions","runAllClick","gotoLineClick","runSelectedClick",4,"ngIf"],[1,"d-flex",3,"size"],[3,"snippetClick","closeClick"],[1,"position-relative",3,"size","minSize"],[3,"evaluationContext"],[1,"h-100","overflow-hidden",2,"width","300px","min-width","300px",3,"runParams","testFunctions","runAllClick","gotoLineClick","runSelectedClick"]],template:function(p,x){1&p&&(u.TgZ(0,"as-split",0,1),u.NdJ("transitionEnd",function(){return x.resize()})("dragEnd",function(){return x.resize()}),u.TgZ(2,"as-split-area",2,3)(4,"as-split",4,1),u.NdJ("dragEnd",function(){return x.resize()})("transitionEnd",function(){return x.resize()}),u.TgZ(6,"as-split-area",5,3)(8,"button",6),u.NdJ("click",function(){return x.toggleHelp()}),u._UZ(9,"i",7),u.qZA(),u._UZ(10,"div",8,9),u.YNc(12,Q,1,2,"app-jspy-test-functions",10),u.qZA(),u.TgZ(13,"as-split-area",11,3)(15,"app-jspy-help-panel",12),u.NdJ("snippetClick",function(Y){return x.onSnippetClick(Y)})("closeClick",function(){return x.toggleHelp()}),u.qZA()()()(),u.TgZ(16,"as-split-area",13),u._UZ(17,"app-jspy-results-panel",14),u.qZA()()),2&p&&(u.Q6J("direction",x.direction)("useTransition",!0),u.xp6(2),u.Q6J("size",x.scriptSize)("minSize",x.minSize),u.xp6(2),u.Q6J("useTransition",!0)("gutterSize",x.isHelpCollapsed?0:11),u.xp6(2),u.Q6J("size",100-x.scriptHelpSize)("minSize",x.minSize),u.xp6(6),u.Q6J("ngIf",null==x.testFunctions?null:x.testFunctions.length),u.xp6(1),u.Q6J("size",x.scriptHelpSize),u.xp6(3),u.Q6J("size",100-x.scriptSize)("minSize",x.minSize),u.xp6(1),u.Q6J("evaluationContext",x.evaluationContext))},dependencies:[L.O5,M.Mq,M.zE,N,re,U.W],styles:[".help-toggle[_ngcontent-%COMP%]{top:5px;right:13px;z-index:1}"]}),A})()},18942:(_e,le,d)=>{d.d(le,{W:()=>m});var r=d(612),u=d(16321),W=d(76662),e=d(24530),O=d(65879),v=d(96814),oe=d(72237),K=d(32013),B=d(3202),I=d(53546);function z(y,w){1&y&&(O.TgZ(0,"div",3)(1,"div",4)(2,"span",5),O._uU(3,"Evaluating..."),O.qZA()()())}let c=(()=>{var y;class w{constructor(){this.defaultColDef={editable:!1,sortable:!1,suppressFiltersToolPanel:!0,suppressMovable:!0,suppressColumnsToolPanel:!0,suppressMenu:!0},this.gridOptions={},this.columnDefs=[{field:"level",width:70},{field:"time",width:80,valueFormatter:N=>(0,B.dateToString)(N.value).slice(11,19)},{field:"message",flex:1}],this.destroy$=new K.x}onGridReady(N){this.gridApi=N.api}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete()}}return(y=w).\u0275fac=function(N){return new(N||y)},y.\u0275cmp=O.Xpm({type:y,selectors:[["app-run-logs"]],inputs:{dataContext:"dataContext"},decls:3,vars:6,consts:[[1,"d-flex","flex-column","h-100"],["class","d-flex justify-content-center align-items-center w-100 spinner flex-column mb-2",4,"ngIf"],["rowSelection","multiple",1,"ag-theme-balham","h-100","flex-fill","w-100",3,"columnDefs","defaultColDef","enableRangeSelection","rowData","gridOptions","gridReady"],[1,"d-flex","justify-content-center","align-items-center","w-100","spinner","flex-column","mb-2"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(N,J){1&N&&(O.TgZ(0,"div",0),O.YNc(1,z,4,0,"div",1),O.TgZ(2,"ag-grid-angular",2),O.NdJ("gridReady",function(X){return J.onGridReady(X)}),O.qZA()()),2&N&&(O.xp6(1),O.Q6J("ngIf",null==J.dataContext?null:J.dataContext.evaluating),O.xp6(1),O.Q6J("columnDefs",J.columnDefs)("defaultColDef",J.defaultColDef)("enableRangeSelection",!0)("rowData",null==J.dataContext?null:J.dataContext.logs)("gridOptions",J.gridOptions))},dependencies:[v.O5,I.N8],encapsulation:2}),w})();function F(y,w){if(1&y&&(O.TgZ(0,"p",8),O._uU(1),O.qZA()),2&y){const R=w.$implicit;O.xp6(1),O.Oqu(R)}}function V(y,w){if(1&y&&(O.TgZ(0,"alert",6)(1,"strong"),O._uU(2,"Runtime Error:"),O.qZA(),O.YNc(3,F,2,1,"p",7),O.qZA()),2&y){const R=O.oxw().ngIf;O.xp6(3),O.Q6J("ngForOf",R.errors)}}function ae(y,w){if(1&y&&O._UZ(0,"app-content-explorer",15),2&y){const R=O.oxw(2).$implicit;O.Q6J("formatter",!1)("data",R.data)}}function U(y,w){if(1&y&&O._UZ(0,"app-run-logs",16),2&y){const R=O.oxw(2).$implicit;O.Q6J("dataContext",R.data)}}function H(y,w){if(1&y&&(O.ynx(0,12),O.YNc(1,ae,1,2,"app-content-explorer",13),O.YNc(2,U,1,1,"app-run-logs",14),O.BQk()),2&y){const R=O.oxw().$implicit,N=O.oxw(2);O.Q6J("ngSwitch",R.type),O.xp6(1),O.Q6J("ngSwitchCase",N.ShowInTypes.ObjectExplorer),O.xp6(1),O.Q6J("ngSwitchCase",N.ShowInTypes.RunningLog)}}function L(y,w){1&y&&(O.TgZ(0,"div",17),O._uU(1,"[No data]"),O.qZA())}function M(y,w){if(1&y){const R=O.EpF();O.TgZ(0,"tab",9),O.NdJ("selectTab",function(){O.CHM(R);const J=O.oxw(2);return O.KtG(J.resize())}),O.YNc(1,H,3,3,"ng-container",10),O.YNc(2,L,2,0,"div",11),O.qZA()}if(2&y){const R=w.$implicit;O.Q6J("heading",R.title||"Tab "+w.index),O.xp6(1),O.Q6J("ngIf",void 0!==R.data),O.xp6(1),O.Q6J("ngIf",!R.data)}}function S(y,w){if(1&y&&(O.ynx(0),O.YNc(1,V,4,1,"alert",2),O.TgZ(2,"tabset",3,4),O.YNc(4,M,3,3,"tab",5),O.qZA(),O.BQk()),2&y){const R=w.ngIf;O.xp6(1),O.Q6J("ngIf",R.errors&&R.errors.length),O.xp6(3),O.Q6J("ngForOf",R.showInItems)}}let m=(()=>{var y;class w{constructor(){this.ShowInTypes=e.r}resize(){u.z.schedule(()=>{this.contentExplorers?.toArray()?.forEach(N=>N.resize())})}activateLastTab(){this.tabset&&(this.tabset.tabs[this.tabset.tabs.length-1].active=!0),this.resize()}}return(y=w).\u0275fac=function(N){return new(N||y)},y.\u0275cmp=O.Xpm({type:y,selectors:[["app-jspy-results-panel"]],viewQuery:function(N,J){if(1&N&&(O.Gf(r.AH,5),O.Gf(W.S,5)),2&N){let ne;O.iGM(ne=O.CRH())&&(J.tabset=ne.first),O.iGM(ne=O.CRH())&&(J.contentExplorers=ne)}},inputs:{evaluationContext:"evaluationContext"},decls:2,vars:1,consts:[[1,"card","overflow-hidden","mb-0","w-100","h-100","p-2"],[4,"ngIf"],["type","danger",4,"ngIf"],[1,"tabset-fx","nav-tabs-boxed"],["resultTabs",""],[3,"heading","selectTab",4,"ngFor","ngForOf"],["type","danger"],["class","mb-0",4,"ngFor","ngForOf"],[1,"mb-0"],[3,"heading","selectTab"],[3,"ngSwitch",4,"ngIf"],["class","m-4",4,"ngIf"],[3,"ngSwitch"],["class","d-block h-100",3,"formatter","data",4,"ngSwitchCase"],["class","w-100 h-100",3,"dataContext",4,"ngSwitchCase"],[1,"d-block","h-100",3,"formatter","data"],[1,"w-100","h-100",3,"dataContext"],[1,"m-4"]],template:function(N,J){1&N&&(O.TgZ(0,"div",0),O.YNc(1,S,5,2,"ng-container",1),O.qZA()),2&N&&(O.xp6(1),O.Q6J("ngIf",J.evaluationContext))},dependencies:[v.sg,v.O5,v.RF,v.n9,oe.wx,r.wW,r.AH,W.S,c],encapsulation:2}),w})()},52667:(_e,le,d)=>{d.d(le,{c:()=>I});var r=d(96814),u=d(53546),W=d(90690),e=d(72237),O=d(30641),v=d(612),oe=d(20362),K=d(2048),B=d(65879);let I=(()=>{var z;class c{}return(z=c).\u0275fac=function(V){return new(V||z)},z.\u0275mod=B.oAB({type:z}),z.\u0275inj=B.cJS({providers:[K.N],imports:[r.ez,W.fX,e.nM,v.P4,O.UU,oe.T,u.sF]}),c})()},24530:(_e,le,d)=>{d.d(le,{c:()=>r,r:()=>u});var r=function(W){return W.Assert="assert",W.TryAssert="tryAssert",W.Print="print",W.Error="error",W.ShowInObjectExplorer="showInObjectExplorer",W.ShowInJSON="showInJSON",W.ShowAsserts="showAsserts",W.InputDialog="inputDialog",W.RenderPage="renderPage",W.OpenFileAsArray="openFileAsArray",W}(r||{}),u=function(W){return W.ObjectExplorer="object-explorer",W.JSON="JSON",W.RunningLog="running-log",W}(u||{})},2048:(_e,le,d)=>{d.d(le,{N:()=>H});var r=d(15861),u=d(32013),W=d(16321),e=d(24530),O=d(58051),v=d(89250),oe=d(85926),K=d(18916),B=d(42793),I=new WeakMap,z=new WeakMap;class c{constructor(M,S,m){(0,oe.Z)(this,I,{writable:!0,value:void 0}),(0,oe.Z)(this,z,{writable:!0,value:void 0}),this.assert=M,this.dataContext=S,(0,B.Z)(this,I,1),this.status=!0,(0,B.Z)(this,z,m)}equal(M,S){return this.assertFunction(M,S,(m,y)=>m&&"object"==typeof m&&y&&"object"==typeof y?JSON.stringify(m)!==JSON.stringify(y):m===y,(m,y)=>`Expected '${m}', received '${y}'`)}notEqual(M,S){return this.assertFunction(M,S,(m,y)=>"object"==typeof m?JSON.stringify(m)!==JSON.stringify(y):m!==y,(m,y)=>`Expected '${m}' is the same as received '${y}'`)}isTruthy(M){return this.assertFunction(M,null,(S,m)=>!!S,(S,m)=>`Value '${S}' is not Truthy - https://developer.mozilla.org/en-US/docs/Glossary/Truthy`)}isFalsy(M){return this.assertFunction(M,null,(S,m)=>!S,(S,m)=>`Value '${S}' is not Falsy - https://developer.mozilla.org/en-US/docs/Glossary/Falsy`)}isTrue(M){return this.assertFunction(M,null,(S,m)=>!0===S,(S,m)=>`Value '${S}' is not true`)}isFalse(M){return this.assertFunction(M,null,(S,m)=>!1===S,(S,m)=>`Value '${S}' is not false`)}greaterThan(M,S){return this.assertFunction(M,S,(m,y)=>m>y,(m,y)=>`${m}' is not greater than ${y}`)}greaterOrEqualThan(M,S){return this.assertFunction(M,S,(m,y)=>m>=y,(m,y)=>`${m}' is not greater (or equal) than ${y}`)}inRange(M,S,m){return this.between(M,S,m)}between(M,S,m){return this.assertFunction(M,{min:S,max:m},(y,w)=>y>=w.min&&y<=w.max,(y,w)=>`${y}' is NOT in range of ${w.min} and ${w.max}`)}lessThan(M,S){return this.assertFunction(M,S,(m,y)=>m<y,(m,y)=>`${m}' is not lesser than ${y}`)}lessOrEqualThan(M,S){return this.assertFunction(M,S,(m,y)=>m<=y,(m,y)=>`${m}' is not lesser (or equal) than ${y}`)}assertFunction(M,S,m,y){var w;if("function"==typeof M&&(M=M(this.dataContext)),"function"==typeof S&&(S=S(this.dataContext)),!m(M,S))throw this.status=!1,this.message=`[${(0,K.Z)(this,I)}] - ${y(M,S)}`,(0,K.Z)(this,z).call(this,!1,this.message),new Error(`'${this.assert}' failed: ${this.message}`);return(0,K.Z)(this,z).call(this,!0,""),(0,B.Z)(this,I,(w=(0,K.Z)(this,I),++w)),this}}var V=d(21473),ae=d(65879),U=d(33374);let H=(()=>{var L;class M{get editorInterpreter(){return this._editorInterpreter}get context(){return this.editorInterpreter?.context}get interpreter(){return this.editorInterpreter.interpreter}get runtimeContext(){return this._runtimeContext}constructor(m){var y;this.dialogService=m,this.loadingSubj$=new u.x,this._runtimeContext={logs:[],evaluating:!1},this.loading$=this.loadingSubj$.asObservable(),this._editorInterpreter=function F(L,M,S){const m=(0,O.Pi)(L),y=function w(){return{asserts:[],errors:[],showInItems:[],reset(){this.asserts=[],this.errors=[],this.showInItems=[]}}}();return m.addFunction(e.c.ShowInObjectExplorer,(J,ne)=>{!function R(J){y.showInItems=[...y.showInItems,J]}({type:e.r.ObjectExplorer,data:J,title:ne})}),m.addFunction(e.c.Print,(...J)=>{console.log(...J);const ne=J.map(X=>"object"==typeof X?JSON.stringify(X):String(X)).join(", ");return S({level:"info",message:ne,time:new Date}),J.length>0?J[0]:null}),m.addFunction(e.c.Assert,function N(J,ne){if("boolean"==typeof ne){if(S({level:ne?"success":"fail",message:J||"",time:new Date}),y.asserts.push({success:!!ne,name:J}),!ne)throw Error(`Assert '${J}' failed`);return{status:!0,message:""}}return new c(J,ne,function X(re,ee){S({logId:J,level:re?"success":"fail",message:`${J}${ee?":":""} ${ee||""}`.trim(),time:new Date});const Q=y.asserts?.find(D=>D.name===J);Q?Q.success&&(Q.success=!!re,Q.description=ee):y.asserts.push({success:!!re,name:J,description:ee})})}),m.addFunction(e.c.OpenFileAsArray,J=>M.open(v.U,{initialState:{options:J}}).onCloseAsync().then(ne=>ne?.errorMessage?Promise.reject(ne.errorMessage):ne)),{interpreter:m,context:y}}(function(w){return(y=y||(0,r.Z)(function*(R){return console.error(new Error(`Cannot import ${R}. JSPY module loader is not provided`)),R})).apply(this,arguments)},this.dialogService,w=>this.appendLogMessage(w.level,w.message?.substring(0,2500)||"",w.logId))}appendLogMessage(m,y,w){if(w){const R=this.runtimeContext.logs.find(N=>N.logKey===w);if(R)return void("error"!==R.level&&(R.level=m,R.message=y,"function"==typeof this.runtimeContext.onChanged&&this.runtimeContext.onChanged(this.runtimeContext.logs)))}this.runtimeContext.logs.push({level:m,logKey:w,message:y,time:new Date}),"function"==typeof this.runtimeContext.onChanged&&this.runtimeContext.onChanged(this.runtimeContext.logs)}run(m){var y=this;return(0,r.Z)(function*(){if(!y.context)throw new Error("Evaluation Context is not initialized");if(!y.interpreter)throw new Error("Interpreter is not initialized");y.startRuntimeOutputPanel(),y.loadingSubj$.next(!0);try{const w=yield y.jspyEvaluate(m);y.appendLogMessage("info","completed"),w&&y.context.showInItems.push({type:e.r.ObjectExplorer,title:"Return Value",data:w})}catch(w){y.appendLogMessage("error","JSPython evaluation failed: "+(0,V.e$)(w)),y.context.errors=[...y.context?.errors,(0,V.e$)(w)]}finally{W.z.schedule(()=>y.loadingSubj$.next(!1),100)}})()}cancel(){return this._evaluationContext&&(this._evaluationContext.cancellationToken.cancel=!0),!!this._editorInterpreter}startRuntimeOutputPanel(){this.runtimeContext.logs.splice(0,this.runtimeContext.logs.length),"function"==typeof this.runtimeContext.onChanged&&this.runtimeContext.onChanged(this.runtimeContext.logs),this.context&&(this.context.reset(),this.context.showInItems=[{type:e.r.RunningLog,title:"Runtime Output",data:this.runtimeContext}]),this.appendLogMessage("info","start")}jspyEvaluate({script:m,method:y,entryModule:w}){var R=this;return(0,r.Z)(function*(){if(!R.context)throw new Error("Evaluation Context is not initialized");if(!R.interpreter)throw new Error("Interpreter is not initialized");return yield R.interpreter.evaluate(m,{__env:{args:{},entryModule:w,entryFunction:y||"",runsAt:"WORKSHEETS Data Studio"}},y,w,N=>R._evaluationContext=N)})()}}return(L=M).\u0275fac=function(m){return new(m||L)(ae.LFG(U.x))},L.\u0275prov=ae.Yz7({token:L,factory:L.\u0275fac}),M})()},18937:(_e,le,d)=>{d.d(le,{Y:()=>ae});var r=d(65879),u=d(96814),W=d(56223),e=d(90690),O=d(37282);function v(U,H){1&U&&r.GkF(0)}function oe(U,H){if(1&U&&(r.TgZ(0,"div",10),r.YNc(1,v,1,0,"ng-container",11),r.Hsn(2,2),r.qZA()),2&U){r.oxw();const L=r.MAs(12);r.xp6(1),r.Q6J("ngTemplateOutlet",L)}}function K(U,H){1&U&&r.GkF(0)}function B(U,H){if(1&U&&(r.ynx(0),r.YNc(1,K,1,0,"ng-container",11),r.BQk()),2&U){r.oxw();const L=r.MAs(12);r.xp6(1),r.Q6J("ngTemplateOutlet",L)}}const I=function(U){return{"ml-3":U}},z=function(U){return{"btn-sm":U}};function c(U,H){if(1&U){const L=r.EpF();r.TgZ(0,"div",12)(1,"label",13),r.NdJ("ngModelChange",function(S){r.CHM(L);const m=r.oxw();return r.KtG(m.modeState.left=S)})("click",function(){r.CHM(L);const S=r.oxw();return r.KtG(S.onModeState("left"))}),r.Hsn(2,3),r.qZA(),r.TgZ(3,"label",14),r.NdJ("ngModelChange",function(S){r.CHM(L);const m=r.oxw();return r.KtG(m.modeState.right=S)})("click",function(){r.CHM(L);const S=r.oxw();return r.KtG(S.onModeState("right"))}),r.Hsn(4,4),r.qZA()()}if(2&U){const L=r.oxw();r.Q6J("ngClass",r.VKq(9,I,L.toggleTop)),r.xp6(1),r.ekj("active",L.modeState.left),r.Q6J("ngClass",r.VKq(11,z,!L.toggleTop))("ngModel",L.modeState.left),r.xp6(2),r.ekj("active",L.modeState.right),r.Q6J("ngClass",r.VKq(13,z,!L.toggleTop))("ngModel",L.modeState.right)}}const F=[[["","left",""]],[["","right",""]],[["","actions",""]],[["","left-label",""]],[["","right-label",""]]],V=["[left]","[right]","[actions]","[left-label]","[right-label]"];let ae=(()=>{var U;class H{constructor(){this.toggleTop=!1,this.direction="horizontal",this.resized=new r.vpe,this.leftContentSize=50,this.modeState={left:!0,right:!0}}ngOnInit(){"number"==typeof this.initLeftSize&&(this.leftContentSize=this.initLeftSize,100===this.initLeftSize?this.modeState.right=!1:0===this.initLeftSize&&(this.modeState.left=!1))}onModeState(M){this.modeState[M]=!this.modeState[M],this.leftContentSize=this.modeState.left&&!this.modeState.right?100:this.modeState.left&&this.modeState.right?50:0}resize(){this.resized.emit(this.modeState)}}return(U=H).\u0275fac=function(M){return new(M||U)},U.\u0275cmp=r.Xpm({type:U,selectors:[["app-split-content"]],inputs:{initLeftSize:"initLeftSize",direction:"direction"},outputs:{resized:"resized"},ngContentSelectors:V,decls:13,vars:7,consts:[[1,"card","overflow-hidden","mb-0","w-100","h-100"],["class","card-header d-flex pl-0 py-2 pr-2",4,"ngIf"],[1,"card-body","d-flex","p-0","flex-column","h-100"],[3,"useTransition","gutterSize","direction","dragEnd","transitionEnd"],[1,"d-flex","mb-0","position-relative",3,"size"],["area0","asSplitArea"],[1,"d-flex","overflow-auto","flex-column","explorer-section","position-relative",3,"size"],["area1","asSplitArea"],[4,"ngIf"],["toggles",""],[1,"card-header","d-flex","pl-0","py-2","pr-2"],[4,"ngTemplateOutlet"],[1,"btn-group","d-block",3,"ngClass"],["ngDefaultControl","","btnCheckbox","","tabindex","0","role","button","name","mode-left",1,"btn","btn-secondary","cursor-pointer","mb-0",3,"ngClass","ngModel","ngModelChange","click"],["ngDefaultControl","","btnCheckbox","","tabindex","0","role","button","name","mode-right",1,"btn","btn-secondary","cursor-pointer","mb-0",3,"ngClass","ngModel","ngModelChange","click"]],template:function(M,S){1&M&&(r.F$t(F),r.TgZ(0,"div",0),r.YNc(1,oe,3,1,"div",1),r.TgZ(2,"div",2)(3,"as-split",3),r.NdJ("dragEnd",function(){return S.resize()})("transitionEnd",function(){return S.resize()}),r.TgZ(4,"as-split-area",4,5),r.Hsn(6),r.qZA(),r.TgZ(7,"as-split-area",6,7),r.Hsn(9,1),r.qZA()()()(),r.YNc(10,B,2,1,"ng-container",8),r.YNc(11,c,5,15,"ng-template",null,9,r.W1O)),2&M&&(r.xp6(1),r.Q6J("ngIf",S.toggleTop),r.xp6(2),r.Q6J("useTransition",!0)("gutterSize",50===S.leftContentSize?11:0)("direction",S.direction),r.xp6(1),r.Q6J("size",S.leftContentSize),r.xp6(3),r.Q6J("size",100-S.leftContentSize),r.xp6(3),r.Q6J("ngIf",!S.toggleTop))},dependencies:[u.mk,u.O5,u.tP,W.Fj,W.JJ,W.On,e.Mq,e.zE,O.DF],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}"]}),H})()},61240:(_e,le,d)=>{d.d(le,{k:()=>K});var r=d(65879),u=d(76690),W=d(89250),e=d(32181),O=d(3202),v=d(13509),oe=d(33374);let K=(()=>{var B;class I{constructor(c,F){this.fileManagerService=c,this.dialogService=F,this.changedContent=new r.vpe}openFile(){this.fileManagerService.importTextFile().then(c=>{"{"!==c[0]&&"["!==c[0]?c=(0,O.parseCsv)(c):c.indexOf('":')<0&&(c=JSON.stringify(u.R.parse(c))),this.setContent(c)})}openFileSettings(){this.dialogService.open(W.U,{initialState:{options:{take:1e3}}}).onClose$.pipe((0,e.h)(c=>!!c)).subscribe(c=>this.setContent(c.errorMessage?c:c.data))}setContent(c){this.currentTab?.content?.setJsonText(c),this.changedContent.emit(c)}}return(B=I).\u0275fac=function(c){return new(c||B)(r.Y36(v.j5),r.Y36(oe.x))},B.\u0275cmp=r.Xpm({type:B,selectors:[["app-tab-json-content-actions"]],inputs:{currentTab:"currentTab"},outputs:{changedContent:"changedContent"},decls:5,vars:0,consts:[["data-toggle","buttons",1,"btn-group"],["type","button",1,"btn","btn-sm","btn-outline-secondary","button",3,"click"],["type","button","title","Open file partially. Works with large files",1,"btn","btn-sm","btn-outline-secondary","button",3,"click"],["aria-hidden","true",1,"fa","fa","fa-bars"]],template:function(c,F){1&c&&(r.TgZ(0,"div",0)(1,"button",1),r.NdJ("click",function(){return F.openFile()}),r._uU(2,"Open File"),r.qZA(),r.TgZ(3,"button",2),r.NdJ("click",function(){return F.openFileSettings()}),r._UZ(4,"i",3),r.qZA()())},styles:["ng-select[_ngcontent-%COMP%]{flex:0 1 150px}.button[_ngcontent-%COMP%]{color:var(--color)}"]}),I})()},92604:(_e,le,d)=>{d.d(le,{A:()=>S});var r=d(65879),u=d(96814),W=d(56223),e=d(30641);const O=function(m,y){return{"badge-success":m,"badge-danger":y}};function v(m,y){if(1&m&&(r.TgZ(0,"li",4)(1,"div",5)(2,"span",6),r._uU(3),r.qZA()(),r.TgZ(4,"div",7)(5,"div",8)(6,"b"),r._uU(7),r.qZA()(),r.TgZ(8,"div",9),r._uU(9),r.qZA()()()),2&m){const w=y.$implicit;r.xp6(2),r.Q6J("ngClass",r.WLB(4,O,w.success,!w.success)),r.xp6(1),r.hij(" ",w.success?"Success":"Failed",""),r.xp6(4),r.Oqu(w.name),r.xp6(2),r.Oqu(w.description)}}function oe(m,y){if(1&m&&(r.TgZ(0,"ul",2),r.YNc(1,v,10,7,"li",3),r.qZA()),2&m){const w=r.oxw();r.xp6(1),r.Q6J("ngForOf",w.assertions)}}function K(m,y){if(1&m&&(r.TgZ(0,"span",10),r._uU(1),r.qZA()),2&m){const w=r.oxw(),R=r.MAs(1);r.Q6J("ngClass",r.WLB(5,O,w.success,!w.success))("adaptivePosition",!1)("popover",R)("outsideClick",!0),r.xp6(1),r.hij(" ",w.stepsCount,"\n")}}let B=(()=>{var m;class y{constructor(){}ngOnInit(){this.setState()}ngOnChanges(){this.setState()}setState(){this.assertions?(this.success=this.assertions.every(R=>R.success),this.stepsCount=this.assertions.length):this.stepsCount=0}}return(m=y).\u0275fac=function(R){return new(R||m)},m.\u0275cmp=r.Xpm({type:m,selectors:[["app-assertion-logs"]],inputs:{assertions:"assertions"},features:[r.TTD],decls:3,vars:1,consts:[["logsTemplate",""],["class","badge align-self-stretch cursor-pointer px-2","placement","left","container","body","containerClass","assertion-logs-container","popoverTitle","Assertion logs",3,"ngClass","adaptivePosition","popover","outsideClick",4,"ngIf"],[1,"list-group","mb-2"],["class","list-group-item d-flex py-1 px-0",4,"ngFor","ngForOf"],[1,"list-group-item","d-flex","py-1","px-0"],[1,"px-1","status"],[1,"badge","p-1","w-100",3,"ngClass"],[1,"d-flex","flex-column"],[1,"px-1","my-auto"],[1,"px-1"],["placement","left","container","body","containerClass","assertion-logs-container","popoverTitle","Assertion logs",1,"badge","align-self-stretch","cursor-pointer","px-2",3,"ngClass","adaptivePosition","popover","outsideClick"]],template:function(R,N){1&R&&(r.YNc(0,oe,2,1,"ng-template",null,0,r.W1O),r.YNc(2,K,2,8,"span",1)),2&R&&(r.xp6(2),r.Q6J("ngIf",N.stepsCount))},dependencies:[u.mk,u.sg,u.O5,e.k5],styles:[".status[_ngcontent-%COMP%]{flex:0 0 50px}  .assertion-logs-container.popover{max-width:400px;width:400px}.badge[_ngcontent-%COMP%]{line-height:1.5rem}"]}),y})();var I=d(54807);function z(m,y){1&m&&r._UZ(0,"app-assertion-logs",9),2&m&&r.Q6J("assertions",y.ngIf)}function c(m,y){if(1&m&&(r.TgZ(0,"span",10),r._uU(1),r.qZA()),2&m){const w=y.ngIf;r.xp6(1),r.hij("",w/1e3," s")}}function F(m,y){if(1&m){const w=r.EpF();r.TgZ(0,"ng-select",11),r.NdJ("ngModelChange",function(N){r.CHM(w);const J=r.oxw();return r.KtG(J.selectedFunction=N)}),r.qZA()}if(2&m){const w=r.oxw();r.Q6J("items",w.jspyFunctions)("ngModel",w.selectedFunction)("placeholder","Select function")}}function V(m,y){1&m&&r._UZ(0,"span",12)}function ae(m,y){1&m&&(r.ynx(0),r._uU(1,"Run"),r.BQk())}function U(m,y){if(1&m){const w=r.EpF();r.TgZ(0,"button",13),r.NdJ("click",function(){r.CHM(w);const N=r.oxw();return r.KtG(N.onScheduleRun())}),r._UZ(1,"i",14),r.qZA()}if(2&m){const w=r.oxw();r.Q6J("disabled",null==w.tabContent?null:w.tabContent.evaluating)}}function H(m,y){1&m&&(r.ynx(0),r._uU(1,"Cancelling"),r.BQk())}function L(m,y){1&m&&(r.ynx(0),r._uU(1,"Cancel"),r.BQk())}function M(m,y){if(1&m){const w=r.EpF();r.TgZ(0,"button",15),r.NdJ("click",function(){r.CHM(w);const N=r.oxw();return r.KtG(null==N.tabContent?null:N.tabContent.cancelRun())}),r.YNc(1,H,2,0,"ng-container",6),r.YNc(2,L,2,0,"ng-container",6),r.qZA()}if(2&m){const w=r.oxw();r.Q6J("disabled",null==w.tabContent?null:w.tabContent.cancelling),r.xp6(1),r.Q6J("ngIf",null==w.tabContent?null:w.tabContent.cancelling),r.xp6(1),r.Q6J("ngIf",!(null!=w.tabContent&&w.tabContent.cancelling))}}let S=(()=>{var m;class y{constructor(){this.jspyFunctions=[],this.evaluationResult=null,this.subs=[]}get schedule(){return!!this.currentTab}ngOnInit(){this.subscribeOnTab()}ngOnChanges({currentTab:R}){R?.firstChange||this.subscribeOnTab()}ngOnDestroy(){this.clearSubscriptions()}get selectedFunction(){return this.tabContent?.selectedFunction||null}get tabContent(){return this.currentTab?.content?.contentEditor??this.jspyContentEditor}set selectedFunction(R){this.currentTab?.content&&this.tabContent&&(this.tabContent.selectedFunction=R)}onScheduleRun(){this.currentTab?.content?.scheduleRun(this.selectedFunction)}subscribeOnTab(){this.clearSubscriptions();const R=this.tabContent?.jspyFunctionsList$?.subscribe(J=>this.jspyFunctions=J);R&&this.subs.push(R);const N=this.tabContent?.evaluationResult$.subscribe(J=>{this.evaluationResult=J});N&&this.subs.push(N)}clearSubscriptions(){this.subs.forEach(R=>R?.unsubscribe()),this.subs=[]}}return(m=y).\u0275fac=function(R){return new(R||m)},m.\u0275cmp=r.Xpm({type:m,selectors:[["app-jspy-actions"]],inputs:{currentTab:"currentTab",jspyContentEditor:"jspyContentEditor"},features:[r.TTD],decls:9,vars:8,consts:[["class","d-flex",3,"assertions",4,"ngIf"],["class","align-self-stretch badge badge-info",4,"ngIf"],["class","auto-grow px-0 ng-select-sm",3,"items","ngModel","placeholder","ngModelChange",4,"ngIf"],["data-toggle","buttons",1,"btn-group"],["type","button",1,"btn","btn-sm","run","btn-success",3,"disabled","click"],["class","spinner-border",4,"ngIf"],[4,"ngIf"],["type","button","class","btn btn-sm btn-success",3,"disabled","click",4,"ngIf"],["type","button","class","btn btn-sm btn-light","title","Cancel operation requested. Waiting for the current operation to be completed ...",3,"disabled","click",4,"ngIf"],[1,"d-flex",3,"assertions"],[1,"align-self-stretch","badge","badge-info"],[1,"auto-grow","px-0","ng-select-sm",3,"items","ngModel","placeholder","ngModelChange"],[1,"spinner-border"],["type","button",1,"btn","btn-sm","btn-success",3,"disabled","click"],["aria-hidden","true",1,"fa","fa","fa-clock-o"],["type","button","title","Cancel operation requested. Waiting for the current operation to be completed ...",1,"btn","btn-sm","btn-light",3,"disabled","click"]],template:function(R,N){1&R&&(r.YNc(0,z,1,1,"app-assertion-logs",0),r.YNc(1,c,2,1,"span",1),r.YNc(2,F,1,3,"ng-select",2),r.TgZ(3,"div",3)(4,"button",4),r.NdJ("click",function(){return null==N.tabContent?null:N.tabContent.run(N.selectedFunction||void 0)}),r.YNc(5,V,1,0,"span",5),r.YNc(6,ae,2,0,"ng-container",6),r.qZA(),r.YNc(7,U,2,1,"button",7),r.qZA(),r.YNc(8,M,3,3,"button",8)),2&R&&(r.Q6J("ngIf",null==N.evaluationResult?null:N.evaluationResult.asserts),r.xp6(1),r.Q6J("ngIf",null==N.evaluationResult?null:N.evaluationResult.evaluationTime),r.xp6(1),r.Q6J("ngIf",null==N.jspyFunctions?null:N.jspyFunctions.length),r.xp6(2),r.Q6J("disabled",null==N.tabContent?null:N.tabContent.evaluating),r.xp6(1),r.Q6J("ngIf",null==N.tabContent?null:N.tabContent.evaluating),r.xp6(1),r.Q6J("ngIf",!(null!=N.tabContent&&N.tabContent.evaluating)),r.xp6(1),r.Q6J("ngIf",N.schedule),r.xp6(1),r.Q6J("ngIf",null==N.tabContent?null:N.tabContent.evaluating))},dependencies:[u.O5,W.JJ,W.On,B,I.w9],styles:["ng-select[_ngcontent-%COMP%]{min-width:150px}.badge[_ngcontent-%COMP%]{line-height:1.5rem}.btn.run[_ngcontent-%COMP%]{width:4rem;margin-right:1px}.btn.run[_ngcontent-%COMP%] + .btn[_ngcontent-%COMP%]{margin-left:0}[_nghost-%COMP%] > *[_ngcontent-%COMP%]:not(:last-child){margin-right:.5rem}"]}),y})()},59928:(_e,le,d)=>{d.r(le),d.d(le,{DataStudioModule:()=>aa});var r=d(96814),u=d(56223),W=d(69862),e=d(65879),O=d(16672),v=d(42495),oe=d(62831),K=d(32181),B=d(48180),I=d(59773),z=d(49388);class L{attach(i){return this._attachedHost=i,i.attach(this)}detach(){let i=this._attachedHost;null!=i&&(this._attachedHost=null,i.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(i){this._attachedHost=i}}class M extends L{constructor(i,s,t,n,a){super(),this.component=i,this.viewContainerRef=s,this.injector=t,this.componentFactoryResolver=n,this.projectableNodes=a}}class S extends L{constructor(i,s,t,n){super(),this.templateRef=i,this.viewContainerRef=s,this.context=t,this.injector=n}get origin(){return this.templateRef.elementRef}attach(i,s=this.context){return this.context=s,super.attach(i)}detach(){return this.context=void 0,super.detach()}}class m extends L{constructor(i){super(),this.element=i instanceof e.SBq?i.nativeElement:i}}class y{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(i){return i instanceof M?(this._attachedPortal=i,this.attachComponentPortal(i)):i instanceof S?(this._attachedPortal=i,this.attachTemplatePortal(i)):this.attachDomPortal&&i instanceof m?(this._attachedPortal=i,this.attachDomPortal(i)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(i){this._disposeFn=i}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class R extends y{constructor(i,s,t,n,a){super(),this.outletElement=i,this._componentFactoryResolver=s,this._appRef=t,this._defaultInjector=n,this.attachDomPortal=l=>{const f=l.element,C=this._document.createComment("dom-portal");f.parentNode.insertBefore(C,f),this.outletElement.appendChild(f),this._attachedPortal=l,super.setDisposeFn(()=>{C.parentNode&&C.parentNode.replaceChild(f,C)})},this._document=a}attachComponentPortal(i){const t=(i.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(i.component);let n;return i.viewContainerRef?(n=i.viewContainerRef.createComponent(t,i.viewContainerRef.length,i.injector||i.viewContainerRef.injector,i.projectableNodes||void 0),this.setDisposeFn(()=>n.destroy())):(n=t.create(i.injector||this._defaultInjector||e.zs3.NULL),this._appRef.attachView(n.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(n.hostView),n.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(n)),this._attachedPortal=i,n}attachTemplatePortal(i){let s=i.viewContainerRef,t=s.createEmbeddedView(i.templateRef,i.context,{injector:i.injector});return t.rootNodes.forEach(n=>this.outletElement.appendChild(n)),t.detectChanges(),this.setDisposeFn(()=>{let n=s.indexOf(t);-1!==n&&s.remove(n)}),this._attachedPortal=i,t}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(i){return i.hostView.rootNodes[0]}}let ee=(()=>{var o;class i{}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({}),i})();var D=d(32013),b=d(55113),A=d(63019);const _=(0,oe.Mq)();class p{constructor(i,s){this._viewportRuler=i,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=s}attach(){}enable(){if(this._canBeEnabled()){const i=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=i.style.left||"",this._previousHTMLStyles.top=i.style.top||"",i.style.left=(0,v.HM)(-this._previousScrollPosition.left),i.style.top=(0,v.HM)(-this._previousScrollPosition.top),i.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const i=this._document.documentElement,t=i.style,n=this._document.body.style,a=t.scrollBehavior||"",l=n.scrollBehavior||"";this._isEnabled=!1,t.left=this._previousHTMLStyles.left,t.top=this._previousHTMLStyles.top,i.classList.remove("cdk-global-scrollblock"),_&&(t.scrollBehavior=n.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),_&&(t.scrollBehavior=a,n.scrollBehavior=l)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const s=this._document.body,t=this._viewportRuler.getViewportSize();return s.scrollHeight>t.height||s.scrollWidth>t.width}}class j{constructor(i,s,t,n){this._scrollDispatcher=i,this._ngZone=s,this._viewportRuler=t,this._config=n,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(i){this._overlayRef=i}enable(){if(this._scrollSubscription)return;const i=this._scrollDispatcher.scrolled(0).pipe((0,K.h)(s=>!s||!this._overlayRef.overlayElement.contains(s.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=i.subscribe(()=>{const s=this._viewportRuler.getViewportScrollPosition().top;Math.abs(s-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=i.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class Y{enable(){}disable(){}attach(){}}function te(o,i){return i.some(s=>o.bottom<s.top||o.top>s.bottom||o.right<s.left||o.left>s.right)}function $(o,i){return i.some(s=>o.top<s.top||o.bottom>s.bottom||o.left<s.left||o.right>s.right)}class se{constructor(i,s,t,n){this._scrollDispatcher=i,this._viewportRuler=s,this._ngZone=t,this._config=n,this._scrollSubscription=null}attach(i){this._overlayRef=i}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const s=this._overlayRef.overlayElement.getBoundingClientRect(),{width:t,height:n}=this._viewportRuler.getViewportSize();te(s,[{width:t,height:n,bottom:n,right:t,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let G=(()=>{var o;class i{constructor(t,n,a,l){this._scrollDispatcher=t,this._viewportRuler=n,this._ngZone=a,this.noop=()=>new Y,this.close=f=>new j(this._scrollDispatcher,this._ngZone,this._viewportRuler,f),this.block=()=>new p(this._viewportRuler,this._document),this.reposition=f=>new se(this._scrollDispatcher,this._viewportRuler,this._ngZone,f),this._document=l}}return(o=i).\u0275fac=function(t){return new(t||o)(e.LFG(O.mF),e.LFG(O.rL),e.LFG(e.R0b),e.LFG(r.K0))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),i})();class h{constructor(i){if(this.scrollStrategy=new Y,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,i){const s=Object.keys(i);for(const t of s)void 0!==i[t]&&(this[t]=i[t])}}}class Z{constructor(i,s){this.connectionPair=i,this.scrollableViewProperties=s}}let pe=(()=>{var o;class i{constructor(t){this._attachedOverlays=[],this._document=t}ngOnDestroy(){this.detach()}add(t){this.remove(t),this._attachedOverlays.push(t)}remove(t){const n=this._attachedOverlays.indexOf(t);n>-1&&this._attachedOverlays.splice(n,1),0===this._attachedOverlays.length&&this.detach()}}return(o=i).\u0275fac=function(t){return new(t||o)(e.LFG(r.K0))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),i})(),Ze=(()=>{var o;class i extends pe{constructor(t,n){super(t),this._ngZone=n,this._keydownListener=a=>{const l=this._attachedOverlays;for(let f=l.length-1;f>-1;f--)if(l[f]._keydownEvents.observers.length>0){const C=l[f]._keydownEvents;this._ngZone?this._ngZone.run(()=>C.next(a)):C.next(a);break}}}add(t){super.add(t),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}}return(o=i).\u0275fac=function(t){return new(t||o)(e.LFG(r.K0),e.LFG(e.R0b,8))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),i})(),Ae=(()=>{var o;class i extends pe{constructor(t,n,a){super(t),this._platform=n,this._ngZone=a,this._cursorStyleIsSet=!1,this._pointerDownListener=l=>{this._pointerDownEventTarget=(0,oe.sA)(l)},this._clickListener=l=>{const f=(0,oe.sA)(l),C="click"===l.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:f;this._pointerDownEventTarget=null;const E=this._attachedOverlays.slice();for(let k=E.length-1;k>-1;k--){const P=E[k];if(P._outsidePointerEvents.observers.length<1||!P.hasAttached())continue;if(P.overlayElement.contains(f)||P.overlayElement.contains(C))break;const ie=P._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>ie.next(l)):ie.next(l)}}}add(t){if(super.add(t),!this._isAttached){const n=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(n)):this._addEventListeners(n),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=n.style.cursor,n.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const t=this._document.body;t.removeEventListener("pointerdown",this._pointerDownListener,!0),t.removeEventListener("click",this._clickListener,!0),t.removeEventListener("auxclick",this._clickListener,!0),t.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(t.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(t){t.addEventListener("pointerdown",this._pointerDownListener,!0),t.addEventListener("click",this._clickListener,!0),t.addEventListener("auxclick",this._clickListener,!0),t.addEventListener("contextmenu",this._clickListener,!0)}}return(o=i).\u0275fac=function(t){return new(t||o)(e.LFG(r.K0),e.LFG(oe.t4),e.LFG(e.R0b,8))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),i})(),Le=(()=>{var o;class i{constructor(t,n){this._platform=n,this._document=t}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const t="cdk-overlay-container";if(this._platform.isBrowser||(0,oe.Oy)()){const a=this._document.querySelectorAll(`.${t}[platform="server"], .${t}[platform="test"]`);for(let l=0;l<a.length;l++)a[l].remove()}const n=this._document.createElement("div");n.classList.add(t),(0,oe.Oy)()?n.setAttribute("platform","test"):this._platform.isBrowser||n.setAttribute("platform","server"),this._document.body.appendChild(n),this._containerElement=n}}return(o=i).\u0275fac=function(t){return new(t||o)(e.LFG(r.K0),e.LFG(oe.t4))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),i})();class Be{constructor(i,s,t,n,a,l,f,C,E,k=!1){this._portalOutlet=i,this._host=s,this._pane=t,this._config=n,this._ngZone=a,this._keyboardDispatcher=l,this._document=f,this._location=C,this._outsideClickDispatcher=E,this._animationsDisabled=k,this._backdropElement=null,this._backdropClick=new D.x,this._attachments=new D.x,this._detachments=new D.x,this._locationChanges=b.w0.EMPTY,this._backdropClickHandler=P=>this._backdropClick.next(P),this._backdropTransitionendHandler=P=>{this._disposeBackdrop(P.target)},this._keydownEvents=new D.x,this._outsidePointerEvents=new D.x,n.scrollStrategy&&(this._scrollStrategy=n.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=n.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(i){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const s=this._portalOutlet.attach(i);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe((0,B.q)(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),"function"==typeof s?.onDestroy&&s.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),s}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const i=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),i}dispose(){const i=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,i&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(i){i!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=i,this.hasAttached()&&(i.attach(this),this.updatePosition()))}updateSize(i){this._config={...this._config,...i},this._updateElementSize()}setDirection(i){this._config={...this._config,direction:i},this._updateElementDirection()}addPanelClass(i){this._pane&&this._toggleClasses(this._pane,i,!0)}removePanelClass(i){this._pane&&this._toggleClasses(this._pane,i,!1)}getDirection(){const i=this._config.direction;return i?"string"==typeof i?i:i.value:"ltr"}updateScrollStrategy(i){i!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=i,this.hasAttached()&&(i.attach(this),i.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const i=this._pane.style;i.width=(0,v.HM)(this._config.width),i.height=(0,v.HM)(this._config.height),i.minWidth=(0,v.HM)(this._config.minWidth),i.minHeight=(0,v.HM)(this._config.minHeight),i.maxWidth=(0,v.HM)(this._config.maxWidth),i.maxHeight=(0,v.HM)(this._config.maxHeight)}_togglePointerEvents(i){this._pane.style.pointerEvents=i?"":"none"}_attachBackdrop(){const i="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(i)})}):this._backdropElement.classList.add(i)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const i=this._backdropElement;if(i){if(this._animationsDisabled)return void this._disposeBackdrop(i);i.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{i.addEventListener("transitionend",this._backdropTransitionendHandler)}),i.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(i)},500))}}_toggleClasses(i,s,t){const n=(0,v.Eq)(s||[]).filter(a=>!!a);n.length&&(t?i.classList.add(...n):i.classList.remove(...n))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const i=this._ngZone.onStable.pipe((0,I.R)((0,A.T)(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),i.unsubscribe())})})}_disposeScrollStrategy(){const i=this._scrollStrategy;i&&(i.disable(),i.detach&&i.detach())}_disposeBackdrop(i){i&&(i.removeEventListener("click",this._backdropClickHandler),i.removeEventListener("transitionend",this._backdropTransitionendHandler),i.remove(),this._backdropElement===i&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}const Ne="cdk-overlay-connected-position-bounding-box",Re=/([A-Za-z%]+)$/;class Tn{get positions(){return this._preferredPositions}constructor(i,s,t,n,a){this._viewportRuler=s,this._document=t,this._platform=n,this._overlayContainer=a,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new D.x,this._resizeSubscription=b.w0.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(i)}attach(i){this._validatePositions(),i.hostElement.classList.add(Ne),this._overlayRef=i,this._boundingBox=i.hostElement,this._pane=i.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const i=this._originRect,s=this._overlayRect,t=this._viewportRect,n=this._containerRect,a=[];let l;for(let f of this._preferredPositions){let C=this._getOriginPoint(i,n,f),E=this._getOverlayPoint(C,s,f),k=this._getOverlayFit(E,s,t,f);if(k.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(f,C);this._canFitWithFlexibleDimensions(k,E,t)?a.push({position:f,origin:C,overlayRect:s,boundingBoxRect:this._calculateBoundingBoxRect(C,f)}):(!l||l.overlayFit.visibleArea<k.visibleArea)&&(l={overlayFit:k,overlayPoint:E,originPoint:C,position:f,overlayRect:s})}if(a.length){let f=null,C=-1;for(const E of a){const k=E.boundingBoxRect.width*E.boundingBoxRect.height*(E.position.weight||1);k>C&&(C=k,f=E)}return this._isPushed=!1,void this._applyPosition(f.position,f.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(l.position,l.originPoint);this._applyPosition(l.position,l.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&je(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(Ne),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const i=this._lastPosition;if(i){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const s=this._getOriginPoint(this._originRect,this._containerRect,i);this._applyPosition(i,s)}else this.apply()}withScrollableContainers(i){return this._scrollables=i,this}withPositions(i){return this._preferredPositions=i,-1===i.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(i){return this._viewportMargin=i,this}withFlexibleDimensions(i=!0){return this._hasFlexibleDimensions=i,this}withGrowAfterOpen(i=!0){return this._growAfterOpen=i,this}withPush(i=!0){return this._canPush=i,this}withLockedPosition(i=!0){return this._positionLocked=i,this}setOrigin(i){return this._origin=i,this}withDefaultOffsetX(i){return this._offsetX=i,this}withDefaultOffsetY(i){return this._offsetY=i,this}withTransformOriginOn(i){return this._transformOriginSelector=i,this}_getOriginPoint(i,s,t){let n,a;if("center"==t.originX)n=i.left+i.width/2;else{const l=this._isRtl()?i.right:i.left,f=this._isRtl()?i.left:i.right;n="start"==t.originX?l:f}return s.left<0&&(n-=s.left),a="center"==t.originY?i.top+i.height/2:"top"==t.originY?i.top:i.bottom,s.top<0&&(a-=s.top),{x:n,y:a}}_getOverlayPoint(i,s,t){let n,a;return n="center"==t.overlayX?-s.width/2:"start"===t.overlayX?this._isRtl()?-s.width:0:this._isRtl()?0:-s.width,a="center"==t.overlayY?-s.height/2:"top"==t.overlayY?0:-s.height,{x:i.x+n,y:i.y+a}}_getOverlayFit(i,s,t,n){const a=Zt(s);let{x:l,y:f}=i,C=this._getOffset(n,"x"),E=this._getOffset(n,"y");C&&(l+=C),E&&(f+=E);let ie=0-f,ue=f+a.height-t.height,fe=this._subtractOverflows(a.width,0-l,l+a.width-t.width),we=this._subtractOverflows(a.height,ie,ue),bt=fe*we;return{visibleArea:bt,isCompletelyWithinViewport:a.width*a.height===bt,fitsInViewportVertically:we===a.height,fitsInViewportHorizontally:fe==a.width}}_canFitWithFlexibleDimensions(i,s,t){if(this._hasFlexibleDimensions){const n=t.bottom-s.y,a=t.right-s.x,l=kt(this._overlayRef.getConfig().minHeight),f=kt(this._overlayRef.getConfig().minWidth);return(i.fitsInViewportVertically||null!=l&&l<=n)&&(i.fitsInViewportHorizontally||null!=f&&f<=a)}return!1}_pushOverlayOnScreen(i,s,t){if(this._previousPushAmount&&this._positionLocked)return{x:i.x+this._previousPushAmount.x,y:i.y+this._previousPushAmount.y};const n=Zt(s),a=this._viewportRect,l=Math.max(i.x+n.width-a.width,0),f=Math.max(i.y+n.height-a.height,0),C=Math.max(a.top-t.top-i.y,0),E=Math.max(a.left-t.left-i.x,0);let k=0,P=0;return k=n.width<=a.width?E||-l:i.x<this._viewportMargin?a.left-t.left-i.x:0,P=n.height<=a.height?C||-f:i.y<this._viewportMargin?a.top-t.top-i.y:0,this._previousPushAmount={x:k,y:P},{x:i.x+k,y:i.y+P}}_applyPosition(i,s){if(this._setTransformOrigin(i),this._setOverlayElementStyles(s,i),this._setBoundingBoxStyles(s,i),i.panelClass&&this._addPanelClasses(i.panelClass),this._lastPosition=i,this._positionChanges.observers.length){const t=this._getScrollVisibility(),n=new Z(i,t);this._positionChanges.next(n)}this._isInitialRender=!1}_setTransformOrigin(i){if(!this._transformOriginSelector)return;const s=this._boundingBox.querySelectorAll(this._transformOriginSelector);let t,n=i.overlayY;t="center"===i.overlayX?"center":this._isRtl()?"start"===i.overlayX?"right":"left":"start"===i.overlayX?"left":"right";for(let a=0;a<s.length;a++)s[a].style.transformOrigin=`${t} ${n}`}_calculateBoundingBoxRect(i,s){const t=this._viewportRect,n=this._isRtl();let a,l,f,k,P,ie;if("top"===s.overlayY)l=i.y,a=t.height-l+this._viewportMargin;else if("bottom"===s.overlayY)f=t.height-i.y+2*this._viewportMargin,a=t.height-f+this._viewportMargin;else{const ue=Math.min(t.bottom-i.y+t.top,i.y),fe=this._lastBoundingBoxSize.height;a=2*ue,l=i.y-ue,a>fe&&!this._isInitialRender&&!this._growAfterOpen&&(l=i.y-fe/2)}if("end"===s.overlayX&&!n||"start"===s.overlayX&&n)ie=t.width-i.x+this._viewportMargin,k=i.x-this._viewportMargin;else if("start"===s.overlayX&&!n||"end"===s.overlayX&&n)P=i.x,k=t.right-i.x;else{const ue=Math.min(t.right-i.x+t.left,i.x),fe=this._lastBoundingBoxSize.width;k=2*ue,P=i.x-ue,k>fe&&!this._isInitialRender&&!this._growAfterOpen&&(P=i.x-fe/2)}return{top:l,left:P,bottom:f,right:ie,width:k,height:a}}_setBoundingBoxStyles(i,s){const t=this._calculateBoundingBoxRect(i,s);!this._isInitialRender&&!this._growAfterOpen&&(t.height=Math.min(t.height,this._lastBoundingBoxSize.height),t.width=Math.min(t.width,this._lastBoundingBoxSize.width));const n={};if(this._hasExactPosition())n.top=n.left="0",n.bottom=n.right=n.maxHeight=n.maxWidth="",n.width=n.height="100%";else{const a=this._overlayRef.getConfig().maxHeight,l=this._overlayRef.getConfig().maxWidth;n.height=(0,v.HM)(t.height),n.top=(0,v.HM)(t.top),n.bottom=(0,v.HM)(t.bottom),n.width=(0,v.HM)(t.width),n.left=(0,v.HM)(t.left),n.right=(0,v.HM)(t.right),n.alignItems="center"===s.overlayX?"center":"end"===s.overlayX?"flex-end":"flex-start",n.justifyContent="center"===s.overlayY?"center":"bottom"===s.overlayY?"flex-end":"flex-start",a&&(n.maxHeight=(0,v.HM)(a)),l&&(n.maxWidth=(0,v.HM)(l))}this._lastBoundingBoxSize=t,je(this._boundingBox.style,n)}_resetBoundingBoxStyles(){je(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){je(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(i,s){const t={},n=this._hasExactPosition(),a=this._hasFlexibleDimensions,l=this._overlayRef.getConfig();if(n){const k=this._viewportRuler.getViewportScrollPosition();je(t,this._getExactOverlayY(s,i,k)),je(t,this._getExactOverlayX(s,i,k))}else t.position="static";let f="",C=this._getOffset(s,"x"),E=this._getOffset(s,"y");C&&(f+=`translateX(${C}px) `),E&&(f+=`translateY(${E}px)`),t.transform=f.trim(),l.maxHeight&&(n?t.maxHeight=(0,v.HM)(l.maxHeight):a&&(t.maxHeight="")),l.maxWidth&&(n?t.maxWidth=(0,v.HM)(l.maxWidth):a&&(t.maxWidth="")),je(this._pane.style,t)}_getExactOverlayY(i,s,t){let n={top:"",bottom:""},a=this._getOverlayPoint(s,this._overlayRect,i);return this._isPushed&&(a=this._pushOverlayOnScreen(a,this._overlayRect,t)),"bottom"===i.overlayY?n.bottom=this._document.documentElement.clientHeight-(a.y+this._overlayRect.height)+"px":n.top=(0,v.HM)(a.y),n}_getExactOverlayX(i,s,t){let l,n={left:"",right:""},a=this._getOverlayPoint(s,this._overlayRect,i);return this._isPushed&&(a=this._pushOverlayOnScreen(a,this._overlayRect,t)),l=this._isRtl()?"end"===i.overlayX?"left":"right":"end"===i.overlayX?"right":"left","right"===l?n.right=this._document.documentElement.clientWidth-(a.x+this._overlayRect.width)+"px":n.left=(0,v.HM)(a.x),n}_getScrollVisibility(){const i=this._getOriginRect(),s=this._pane.getBoundingClientRect(),t=this._scrollables.map(n=>n.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:$(i,t),isOriginOutsideView:te(i,t),isOverlayClipped:$(s,t),isOverlayOutsideView:te(s,t)}}_subtractOverflows(i,...s){return s.reduce((t,n)=>t-Math.max(n,0),i)}_getNarrowedViewportRect(){const i=this._document.documentElement.clientWidth,s=this._document.documentElement.clientHeight,t=this._viewportRuler.getViewportScrollPosition();return{top:t.top+this._viewportMargin,left:t.left+this._viewportMargin,right:t.left+i-this._viewportMargin,bottom:t.top+s-this._viewportMargin,width:i-2*this._viewportMargin,height:s-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(i,s){return"x"===s?null==i.offsetX?this._offsetX:i.offsetX:null==i.offsetY?this._offsetY:i.offsetY}_validatePositions(){}_addPanelClasses(i){this._pane&&(0,v.Eq)(i).forEach(s=>{""!==s&&-1===this._appliedPanelClasses.indexOf(s)&&(this._appliedPanelClasses.push(s),this._pane.classList.add(s))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(i=>{this._pane.classList.remove(i)}),this._appliedPanelClasses=[])}_getOriginRect(){const i=this._origin;if(i instanceof e.SBq)return i.nativeElement.getBoundingClientRect();if(i instanceof Element)return i.getBoundingClientRect();const s=i.width||0,t=i.height||0;return{top:i.y,bottom:i.y+t,left:i.x,right:i.x+s,height:t,width:s}}}function je(o,i){for(let s in i)i.hasOwnProperty(s)&&(o[s]=i[s]);return o}function kt(o){if("number"!=typeof o&&null!=o){const[i,s]=o.split(Re);return s&&"px"!==s?null:parseFloat(i)}return o||null}function Zt(o){return{top:Math.floor(o.top),right:Math.floor(o.right),bottom:Math.floor(o.bottom),left:Math.floor(o.left),width:Math.floor(o.width),height:Math.floor(o.height)}}const Rt=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom"}],Sn=[{originX:"end",originY:"top",overlayX:"start",overlayY:"top"},{originX:"end",originY:"bottom",overlayX:"start",overlayY:"bottom"},{originX:"start",originY:"top",overlayX:"end",overlayY:"top"},{originX:"start",originY:"bottom",overlayX:"end",overlayY:"bottom"}],qt="cdk-global-overlay-wrapper";class xn{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(i){const s=i.getConfig();this._overlayRef=i,this._width&&!s.width&&i.updateSize({width:this._width}),this._height&&!s.height&&i.updateSize({height:this._height}),i.hostElement.classList.add(qt),this._isDisposed=!1}top(i=""){return this._bottomOffset="",this._topOffset=i,this._alignItems="flex-start",this}left(i=""){return this._xOffset=i,this._xPosition="left",this}bottom(i=""){return this._topOffset="",this._bottomOffset=i,this._alignItems="flex-end",this}right(i=""){return this._xOffset=i,this._xPosition="right",this}start(i=""){return this._xOffset=i,this._xPosition="start",this}end(i=""){return this._xOffset=i,this._xPosition="end",this}width(i=""){return this._overlayRef?this._overlayRef.updateSize({width:i}):this._width=i,this}height(i=""){return this._overlayRef?this._overlayRef.updateSize({height:i}):this._height=i,this}centerHorizontally(i=""){return this.left(i),this._xPosition="center",this}centerVertically(i=""){return this.top(i),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const i=this._overlayRef.overlayElement.style,s=this._overlayRef.hostElement.style,t=this._overlayRef.getConfig(),{width:n,height:a,maxWidth:l,maxHeight:f}=t,C=!("100%"!==n&&"100vw"!==n||l&&"100%"!==l&&"100vw"!==l),E=!("100%"!==a&&"100vh"!==a||f&&"100%"!==f&&"100vh"!==f),k=this._xPosition,P=this._xOffset,ie="rtl"===this._overlayRef.getConfig().direction;let ue="",fe="",we="";C?we="flex-start":"center"===k?(we="center",ie?fe=P:ue=P):ie?"left"===k||"end"===k?(we="flex-end",ue=P):("right"===k||"start"===k)&&(we="flex-start",fe=P):"left"===k||"start"===k?(we="flex-start",ue=P):("right"===k||"end"===k)&&(we="flex-end",fe=P),i.position=this._cssPosition,i.marginLeft=C?"0":ue,i.marginTop=E?"0":this._topOffset,i.marginBottom=this._bottomOffset,i.marginRight=C?"0":fe,s.justifyContent=we,s.alignItems=E?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const i=this._overlayRef.overlayElement.style,s=this._overlayRef.hostElement,t=s.style;s.classList.remove(qt),t.justifyContent=t.alignItems=i.marginTop=i.marginBottom=i.marginLeft=i.marginRight=i.position="",this._overlayRef=null,this._isDisposed=!0}}let wn=(()=>{var o;class i{constructor(t,n,a,l){this._viewportRuler=t,this._document=n,this._platform=a,this._overlayContainer=l}global(){return new xn}flexibleConnectedTo(t){return new Tn(t,this._viewportRuler,this._document,this._platform,this._overlayContainer)}}return(o=i).\u0275fac=function(t){return new(t||o)(e.LFG(O.rL),e.LFG(r.K0),e.LFG(oe.t4),e.LFG(Le))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),i})(),An=0,st=(()=>{var o;class i{constructor(t,n,a,l,f,C,E,k,P,ie,ue,fe){this.scrollStrategies=t,this._overlayContainer=n,this._componentFactoryResolver=a,this._positionBuilder=l,this._keyboardDispatcher=f,this._injector=C,this._ngZone=E,this._document=k,this._directionality=P,this._location=ie,this._outsideClickDispatcher=ue,this._animationsModuleType=fe}create(t){const n=this._createHostElement(),a=this._createPaneElement(n),l=this._createPortalOutlet(a),f=new h(t);return f.direction=f.direction||this._directionality.value,new Be(l,n,a,f,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType)}position(){return this._positionBuilder}_createPaneElement(t){const n=this._document.createElement("div");return n.id="cdk-overlay-"+An++,n.classList.add("cdk-overlay-pane"),t.appendChild(n),n}_createHostElement(){const t=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(t),t}_createPortalOutlet(t){return this._appRef||(this._appRef=this._injector.get(e.z2F)),new R(t,this._componentFactoryResolver,this._appRef,this._injector,this._document)}}return(o=i).\u0275fac=function(t){return new(t||o)(e.LFG(G),e.LFG(Le),e.LFG(e._Vd),e.LFG(wn),e.LFG(Ze),e.LFG(e.zs3),e.LFG(e.R0b),e.LFG(r.K0),e.LFG(z.Is),e.LFG(r.Ye),e.LFG(Ae),e.LFG(e.QbO,8))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),i})();const Dn={provide:new e.OlP("cdk-connected-overlay-scroll-strategy"),deps:[st],useFactory:function On(o){return()=>o.scrollStrategies.reposition()}};let In=(()=>{var o;class i{}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({providers:[st,Dn],imports:[z.vT,ee,O.Cl,O.Cl]}),i})();var de=d(36028),at=d(27921),Ue=d(83620),Jt=d(93997),yt=d(9769),vt=d(21441),Ct=d(57537),jt=d(94664),Fn=d(836);let Tt=(()=>{var o;class i{constructor(){this._listeners=[]}notify(t,n){for(let a of this._listeners)a(t,n)}listen(t){return this._listeners.push(t),()=>{this._listeners=this._listeners.filter(n=>t!==n)}}ngOnDestroy(){this._listeners=[]}}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),i})();var nt=d(92438),$t=d(74911),En=d(23889),St=d(4300);let rt=(()=>{var o;class i{}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275dir=e.lG2({type:o,selectors:[["","cdkMenuGroup",""]],hostAttrs:["role","group",1,"cdk-menu-group"],exportAs:["cdkMenuGroup"],standalone:!0,features:[e._Bn([{provide:Tt,useClass:Tt}])]}),i})();const lt=new e.OlP("cdk-menu"),De=new e.OlP("cdk-menu-stack"),Nn={provide:De,deps:[[new e.FiY,new e.tp0,new e.tBr(De)]],useFactory:o=>o||new ct},Pn=o=>({provide:De,deps:[[new e.FiY,new e.tp0,new e.tBr(De)]],useFactory:i=>i||ct.inline(o)});let kn=0,ct=(()=>{var o;class i{constructor(){this.id=""+kn++,this._elements=[],this._close=new D.x,this._empty=new D.x,this._hasFocus=new D.x,this.closed=this._close,this.hasFocus=this._hasFocus.pipe((0,at.O)(!1),(0,Ue.b)(0),(0,Jt.x)()),this.emptied=this._empty,this._inlineMenuOrientation=null}static inline(t){const n=new i;return n._inlineMenuOrientation=t,n}push(t){this._elements.push(t)}close(t,n){const{focusNextOnEmpty:a,focusParentTrigger:l}={...n};if(this._elements.indexOf(t)>=0){let f;do{f=this._elements.pop(),this._close.next({item:f,focusParentTrigger:l})}while(f!==t);this.isEmpty()&&this._empty.next(a)}}closeSubMenuOf(t){let n=!1;if(this._elements.indexOf(t)>=0)for(n=this.peek()!==t;this.peek()!==t;)this._close.next({item:this._elements.pop()});return n}closeAll(t){const{focusNextOnEmpty:n,focusParentTrigger:a}={...t};if(!this.isEmpty()){for(;!this.isEmpty();){const l=this._elements.pop();l&&this._close.next({item:l,focusParentTrigger:a})}this._empty.next(n)}}isEmpty(){return!this._elements.length}length(){return this._elements.length}peek(){return this._elements[this._elements.length-1]}hasInlineMenu(){return null!=this._inlineMenuOrientation}inlineMenuOrientation(){return this._inlineMenuOrientation}setHasFocus(t){this._hasFocus.next(t)}}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac}),i})();const ut=new e.OlP("cdk-menu-trigger");let Qt=(()=>{var o;class i{constructor(){this.injector=(0,e.f3M)(e.zs3),this.viewContainerRef=(0,e.f3M)(e.s_b),this.menuStack=(0,e.f3M)(De),this.opened=new e.vpe,this.closed=new e.vpe,this.overlayRef=null,this.destroyed=new D.x,this.stopOutsideClicksListener=(0,A.T)(this.closed,this.destroyed)}ngOnDestroy(){this._destroyOverlay(),this.destroyed.next(),this.destroyed.complete()}isOpen(){return!!this.overlayRef?.hasAttached()}registerChildMenu(t){this.childMenu=t}getMenuContentPortal(){return this.menuTemplateRef&&(!this._menuPortal||this.menuTemplateRef!==this._menuPortal?.templateRef)&&(this._menuPortal=new S(this.menuTemplateRef,this.viewContainerRef,this.menuData,this._getChildMenuInjector())),this._menuPortal}isElementInsideMenuStack(t){for(let n=t;n;n=n?.parentElement??null)if(n.getAttribute("data-cdk-menu-stack-id")===this.menuStack.id)return!0;return!1}_destroyOverlay(){this.overlayRef&&(this.overlayRef.dispose(),this.overlayRef=null)}_getChildMenuInjector(){return this._childMenuInjector=this._childMenuInjector||e.zs3.create({providers:[{provide:ut,useValue:this},{provide:De,useValue:this.menuStack}],parent:this.injector}),this._childMenuInjector}}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275dir=e.lG2({type:o,hostVars:2,hostBindings:function(t,n){2&t&&e.uIk("aria-controls",null==n.childMenu?null:n.childMenu.id)("data-cdk-menu-stack-id",n.menuStack.id)}}),i})();const dt=new e.OlP("cdk-menu-aim");function Bt(o,i){if(!i.isTrusted)return!1;const s=o.nativeElement,t=i.keyCode;return"BUTTON"!==s.nodeName||s.disabled?"A"===s.nodeName&&t===de.K5:t===de.K5||t===de.L_}let Ut=(()=>{var o;class i extends Qt{constructor(){super(),this._elementRef=(0,e.f3M)(e.SBq),this._overlay=(0,e.f3M)(st),this._ngZone=(0,e.f3M)(e.R0b),this._changeDetectorRef=(0,e.f3M)(e.sBO),this._inputModalityDetector=(0,e.f3M)(St.QL),this._directionality=(0,e.f3M)(z.Is,{optional:!0}),this._parentMenu=(0,e.f3M)(lt,{optional:!0}),this._menuAim=(0,e.f3M)(dt,{optional:!0}),this._setRole(),this._registerCloseHandler(),this._subscribeToMenuStackClosed(),this._subscribeToMouseEnter(),this._subscribeToMenuStackHasFocus(),this._setType()}toggle(){this.isOpen()?this.close():this.open()}open(){!this.isOpen()&&null!=this.menuTemplateRef&&(this.opened.next(),this.overlayRef=this.overlayRef||this._overlay.create(this._getOverlayConfig()),this.overlayRef.attach(this.getMenuContentPortal()),this._changeDetectorRef.markForCheck(),this._subscribeToOutsideClicks())}close(){this.isOpen()&&(this.closed.next(),this.overlayRef.detach(),this._changeDetectorRef.markForCheck()),this._closeSiblingTriggers()}getMenu(){return this.childMenu}_toggleOnKeydown(t){const n="vertical"===this._parentMenu?.orientation;switch(t.keyCode){case de.L_:case de.K5:!(0,de.Vb)(t)&&!Bt(this._elementRef,t)&&(this.toggle(),this.childMenu?.focusFirstItem("keyboard"));break;case de.SV:(0,de.Vb)(t)||this._parentMenu&&n&&"rtl"!==this._directionality?.value&&(t.preventDefault(),this.open(),this.childMenu?.focusFirstItem("keyboard"));break;case de.oh:(0,de.Vb)(t)||this._parentMenu&&n&&"rtl"===this._directionality?.value&&(t.preventDefault(),this.open(),this.childMenu?.focusFirstItem("keyboard"));break;case de.JH:case de.LH:(0,de.Vb)(t)||n||(t.preventDefault(),this.open(),t.keyCode===de.JH?this.childMenu?.focusFirstItem("keyboard"):this.childMenu?.focusLastItem("keyboard"))}}_handleClick(){this.toggle(),this.childMenu?.focusFirstItem("mouse")}_setHasFocus(t){this._parentMenu||this.menuStack.setHasFocus(t)}_subscribeToMouseEnter(){this._ngZone.runOutsideAngular(()=>{(0,nt.R)(this._elementRef.nativeElement,"mouseenter").pipe((0,K.h)(()=>"touch"!==this._inputModalityDetector.mostRecentModality&&!this.menuStack.isEmpty()&&!this.isOpen()),(0,I.R)(this.destroyed)).subscribe(()=>{const t=()=>this._ngZone.run(()=>{this._closeSiblingTriggers(),this.open()});this._menuAim?this._menuAim.toggle(t):t()})})}_closeSiblingTriggers(){this._parentMenu?!this.menuStack.closeSubMenuOf(this._parentMenu)&&this.menuStack.peek()!==this._parentMenu&&this.menuStack.closeAll():this.menuStack.closeAll()}_getOverlayConfig(){return new h({positionStrategy:this._getOverlayPositionStrategy(),scrollStrategy:this._overlay.scrollStrategies.reposition(),direction:this._directionality||void 0})}_getOverlayPositionStrategy(){return this._overlay.position().flexibleConnectedTo(this._elementRef).withLockedPosition().withGrowAfterOpen().withPositions(this._getOverlayPositions())}_getOverlayPositions(){return this.menuPosition??(this._parentMenu&&"horizontal"!==this._parentMenu.orientation?Sn:Rt)}_registerCloseHandler(){this._parentMenu||this.menuStack.closed.pipe((0,I.R)(this.destroyed)).subscribe(({item:t})=>{t===this.childMenu&&this.close()})}_subscribeToOutsideClicks(){this.overlayRef&&this.overlayRef.outsidePointerEvents().pipe((0,I.R)(this.stopOutsideClicksListener)).subscribe(t=>{const n=(0,oe.sA)(t),a=this._elementRef.nativeElement;n!==a&&!a.contains(n)&&(this.isElementInsideMenuStack(n)?this._closeSiblingTriggers():this.menuStack.closeAll())})}_subscribeToMenuStackHasFocus(){this._parentMenu||this.menuStack.hasFocus.pipe((0,I.R)(this.destroyed)).subscribe(t=>{t||this.menuStack.closeAll()})}_subscribeToMenuStackClosed(){this._parentMenu||this.menuStack.closed.subscribe(({focusParentTrigger:t})=>{t&&!this.menuStack.length()&&this._elementRef.nativeElement.focus()})}_setRole(){this._parentMenu||this._elementRef.nativeElement.setAttribute("role","button")}_setType(){const t=this._elementRef.nativeElement;"BUTTON"===t.nodeName&&!t.getAttribute("type")&&t.setAttribute("type","button")}}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275dir=e.lG2({type:o,selectors:[["","cdkMenuTriggerFor",""]],hostAttrs:[1,"cdk-menu-trigger"],hostVars:2,hostBindings:function(t,n){1&t&&e.NdJ("focusin",function(){return n._setHasFocus(!0)})("focusout",function(){return n._setHasFocus(!1)})("keydown",function(l){return n._toggleOnKeydown(l)})("click",function(){return n._handleClick()}),2&t&&e.uIk("aria-haspopup",n.menuTemplateRef?"menu":null)("aria-expanded",null==n.menuTemplateRef?null:n.isOpen())},inputs:{menuTemplateRef:["cdkMenuTriggerFor","menuTemplateRef"],menuPosition:["cdkMenuPosition","menuPosition"],menuData:["cdkMenuTriggerData","menuData"]},outputs:{opened:"cdkMenuOpened",closed:"cdkMenuClosed"},exportAs:["cdkMenuTriggerFor"],standalone:!0,features:[e._Bn([{provide:ut,useExisting:o},Nn]),e.qOj]}),i})(),ze=(()=>{var o;class i{get disabled(){return this._disabled}set disabled(t){this._disabled=(0,v.Ig)(t)}get hasMenu(){return null!=this._menuTrigger?.menuTemplateRef}constructor(){this._dir=(0,e.f3M)(z.Is,{optional:!0}),this._elementRef=(0,e.f3M)(e.SBq),this._ngZone=(0,e.f3M)(e.R0b),this._inputModalityDetector=(0,e.f3M)(St.QL),this._menuAim=(0,e.f3M)(dt,{optional:!0}),this._menuStack=(0,e.f3M)(De),this._parentMenu=(0,e.f3M)(lt,{optional:!0}),this._menuTrigger=(0,e.f3M)(Ut,{optional:!0,self:!0}),this._disabled=!1,this.triggered=new e.vpe,this._tabindex=-1,this.closeOnSpacebarTrigger=!0,this.destroyed=new D.x,this._setupMouseEnter(),this._setType(),this._isStandaloneItem()&&(this._tabindex=0)}ngOnDestroy(){this.destroyed.next(),this.destroyed.complete()}focus(){this._elementRef.nativeElement.focus()}trigger(t){const{keepOpen:n}={...t};!this.disabled&&!this.hasMenu&&(this.triggered.next(),n||this._menuStack.closeAll({focusParentTrigger:!0}))}isMenuOpen(){return!!this._menuTrigger?.isOpen()}getMenu(){return this._menuTrigger?.getMenu()}getMenuTrigger(){return this._menuTrigger}getLabel(){return this.typeaheadLabel||this._elementRef.nativeElement.textContent?.trim()||""}_resetTabIndex(){this._isStandaloneItem()||(this._tabindex=-1)}_setTabIndex(t){this.disabled||(!t||!this._menuStack.isEmpty())&&(this._tabindex=0)}_onKeydown(t){switch(t.keyCode){case de.L_:case de.K5:!(0,de.Vb)(t)&&!Bt(this._elementRef,t)&&this.trigger({keepOpen:t.keyCode===de.L_&&!this.closeOnSpacebarTrigger});break;case de.SV:(0,de.Vb)(t)||this._parentMenu&&this._isParentVertical()&&("rtl"!==this._dir?.value?this._forwardArrowPressed(t):this._backArrowPressed(t));break;case de.oh:(0,de.Vb)(t)||this._parentMenu&&this._isParentVertical()&&("rtl"!==this._dir?.value?this._backArrowPressed(t):this._forwardArrowPressed(t))}}_isStandaloneItem(){return!this._parentMenu}_backArrowPressed(t){const n=this._parentMenu;(this._menuStack.hasInlineMenu()||this._menuStack.length()>1)&&(t.preventDefault(),this._menuStack.close(n,{focusNextOnEmpty:"horizontal"===this._menuStack.inlineMenuOrientation()?1:2,focusParentTrigger:!0}))}_forwardArrowPressed(t){!this.hasMenu&&"horizontal"===this._menuStack.inlineMenuOrientation()&&(t.preventDefault(),this._menuStack.closeAll({focusNextOnEmpty:0,focusParentTrigger:!0}))}_setupMouseEnter(){if(!this._isStandaloneItem()){const t=()=>this._ngZone.run(()=>this._menuStack.closeSubMenuOf(this._parentMenu));this._ngZone.runOutsideAngular(()=>(0,nt.R)(this._elementRef.nativeElement,"mouseenter").pipe((0,K.h)(()=>"touch"!==this._inputModalityDetector.mostRecentModality&&!this._menuStack.isEmpty()&&!this.hasMenu),(0,I.R)(this.destroyed)).subscribe(()=>{this._menuAim?this._menuAim.toggle(t):t()}))}}_isParentVertical(){return"vertical"===this._parentMenu?.orientation}_setType(){const t=this._elementRef.nativeElement;"BUTTON"===t.nodeName&&!t.getAttribute("type")&&t.setAttribute("type","button")}}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275dir=e.lG2({type:o,selectors:[["","cdkMenuItem",""]],hostAttrs:["role","menuitem",1,"cdk-menu-item"],hostVars:2,hostBindings:function(t,n){1&t&&e.NdJ("blur",function(){return n._resetTabIndex()})("focus",function(){return n._setTabIndex()})("click",function(){return n.trigger()})("keydown",function(l){return n._onKeydown(l)}),2&t&&(e.Ikx("tabindex",n._tabindex),e.uIk("aria-disabled",n.disabled||null))},inputs:{disabled:["cdkMenuItemDisabled","disabled"],typeaheadLabel:["cdkMenuitemTypeaheadLabel","typeaheadLabel"]},outputs:{triggered:"cdkMenuItemTriggered"},exportAs:["cdkMenuItem"],standalone:!0}),i})();class Ln{constructor(i){this._items=i,this.entered=this._getItemPointerEntries(),this.exited=this._getItemPointerExits(),this._destroyed=new D.x,this.entered.subscribe(s=>this.activeElement=s),this.exited.subscribe(()=>{this.previousElement=this.activeElement,this.activeElement=void 0})}destroy(){this._destroyed.next(),this._destroyed.complete()}_getItemPointerEntries(){return(0,$t.P)(()=>this._items.changes.pipe((0,at.O)(this._items),(0,yt.z)(i=>i.map(s=>(0,nt.R)(s._elementRef.nativeElement,"mouseenter").pipe((0,vt.h)(s),(0,I.R)(this._items.changes)))),(0,Ct.J)()))}_getItemPointerExits(){return(0,$t.P)(()=>this._items.changes.pipe((0,at.O)(this._items),(0,yt.z)(i=>i.map(s=>(0,nt.R)(s._elementRef.nativeElement,"mouseout").pipe((0,vt.h)(s),(0,I.R)(this._items.changes)))),(0,Ct.J)()))}}let Bn=0,zt=(()=>{var o;class i extends rt{constructor(){super(...arguments),this.nativeElement=(0,e.f3M)(e.SBq).nativeElement,this.ngZone=(0,e.f3M)(e.R0b),this.menuStack=(0,e.f3M)(De),this.menuAim=(0,e.f3M)(dt,{optional:!0,self:!0}),this.dir=(0,e.f3M)(z.Is,{optional:!0}),this.id="cdk-menu-"+Bn++,this.orientation="vertical",this.isInline=!1,this.destroyed=new D.x,this._menuStackHasFocus=!1}ngAfterContentInit(){this.isInline||this.menuStack.push(this),this._setKeyManager(),this._subscribeToMenuStackHasFocus(),this._subscribeToMenuOpen(),this._subscribeToMenuStackClosed(),this._setUpPointerTracker()}ngOnDestroy(){this.keyManager?.destroy(),this.destroyed.next(),this.destroyed.complete(),this.pointerTracker?.destroy()}focusFirstItem(t="program"){this.keyManager.setFocusOrigin(t),this.keyManager.setFirstItemActive()}focusLastItem(t="program"){this.keyManager.setFocusOrigin(t),this.keyManager.setLastItemActive()}_getTabIndex(){return this.isInline?this._menuStackHasFocus?-1:0:null}closeOpenMenu(t,n){const{focusParentTrigger:a}={...n},l=this.keyManager,f=this.triggerItem;t===f?.getMenuTrigger()?.getMenu()&&(f?.getMenuTrigger()?.close(),a&&(f?l.setActiveItem(f):l.setFirstItemActive()))}_setKeyManager(){this.keyManager=new St.Em(this.items).withWrap().withTypeAhead().withHomeAndEnd(),"horizontal"===this.orientation?this.keyManager.withHorizontalOrientation(this.dir?.value||"ltr"):this.keyManager.withVerticalOrientation()}_subscribeToMenuOpen(){const t=(0,A.T)(this.items.changes,this.destroyed);this.items.changes.pipe((0,at.O)(this.items),(0,yt.z)(n=>n.filter(a=>a.hasMenu).map(a=>a.getMenuTrigger().opened.pipe((0,vt.h)(a),(0,I.R)(t)))),(0,Ct.J)(),(0,jt.w)(n=>(this.triggerItem=n,n.getMenuTrigger().closed)),(0,I.R)(this.destroyed)).subscribe(()=>this.triggerItem=void 0)}_subscribeToMenuStackClosed(){this.menuStack.closed.pipe((0,I.R)(this.destroyed)).subscribe(({item:t,focusParentTrigger:n})=>this.closeOpenMenu(t,{focusParentTrigger:n}))}_subscribeToMenuStackHasFocus(){this.isInline&&this.menuStack.hasFocus.pipe((0,I.R)(this.destroyed)).subscribe(t=>{this._menuStackHasFocus=t})}_setUpPointerTracker(){this.menuAim&&(this.ngZone.runOutsideAngular(()=>{this.pointerTracker=new Ln(this.items)}),this.menuAim.initialize(this,this.pointerTracker))}}return(o=i).\u0275fac=function(){let s;return function(n){return(s||(s=e.n5z(o)))(n||o)}}(),o.\u0275dir=e.lG2({type:o,contentQueries:function(t,n,a){if(1&t&&e.Suo(a,ze,5),2&t){let l;e.iGM(l=e.CRH())&&(n.items=l)}},hostAttrs:["role","menu"],hostVars:4,hostBindings:function(t,n){1&t&&e.NdJ("focus",function(){return n.focusFirstItem()})("focusin",function(){return n.menuStack.setHasFocus(!0)})("focusout",function(){return n.menuStack.setHasFocus(!1)}),2&t&&(e.Ikx("tabindex",n._getTabIndex())("id",n.id),e.uIk("aria-orientation",n.orientation)("data-cdk-menu-stack-id",n.menuStack.id))},inputs:{id:"id"},features:[e.qOj]}),i})(),Ht=(()=>{var o;class i extends zt{constructor(){super(),this._parentTrigger=(0,e.f3M)(ut,{optional:!0}),this.closed=new e.vpe,this.orientation="vertical",this.isInline=!this._parentTrigger,this.destroyed.subscribe(this.closed),this._parentTrigger?.registerChildMenu(this)}ngAfterContentInit(){super.ngAfterContentInit(),this._subscribeToMenuStackEmptied()}ngOnDestroy(){super.ngOnDestroy(),this.closed.complete()}_handleKeyEvent(t){const n=this.keyManager;switch(t.keyCode){case de.oh:case de.SV:(0,de.Vb)(t)||(t.preventDefault(),n.setFocusOrigin("keyboard"),n.onKeydown(t));break;case de.hY:(0,de.Vb)(t)||(t.preventDefault(),this.menuStack.close(this,{focusNextOnEmpty:2,focusParentTrigger:!0}));break;case de.Mf:(0,de.Vb)(t,"altKey","metaKey","ctrlKey")||this.menuStack.closeAll({focusParentTrigger:!0});break;default:n.onKeydown(t)}}_toggleMenuFocus(t){const n=this.keyManager;switch(t){case 0:n.setFocusOrigin("keyboard"),n.setNextItemActive();break;case 1:n.setFocusOrigin("keyboard"),n.setPreviousItemActive();break;case 2:n.activeItem&&(n.setFocusOrigin("keyboard"),n.setActiveItem(n.activeItem))}}_subscribeToMenuStackEmptied(){this.menuStack.emptied.pipe((0,I.R)(this.destroyed)).subscribe(t=>this._toggleMenuFocus(t))}}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275dir=e.lG2({type:o,selectors:[["","cdkMenu",""]],hostAttrs:["role","menu",1,"cdk-menu"],hostVars:2,hostBindings:function(t,n){1&t&&e.NdJ("keydown",function(l){return n._handleKeyEvent(l)}),2&t&&e.ekj("cdk-menu-inline",n.isInline)},outputs:{closed:"closed"},exportAs:["cdkMenu"],standalone:!0,features:[e._Bn([{provide:rt,useExisting:o},{provide:lt,useExisting:o},Pn("vertical")]),e.qOj]}),i})();const Gn=Rt.map(o=>{const i="start"===o.overlayX?2:-2,s="top"===o.overlayY?2:-2;return{...o,offsetX:i,offsetY:s}});let Kn=(()=>{var o;class i{update(t){i._openContextMenuTrigger!==t&&(i._openContextMenuTrigger?.close(),i._openContextMenuTrigger=t)}}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),i})(),Yt=(()=>{var o;class i extends Qt{get disabled(){return this._disabled}set disabled(t){this._disabled=(0,v.Ig)(t)}constructor(){super(),this._overlay=(0,e.f3M)(st),this._directionality=(0,e.f3M)(z.Is,{optional:!0}),this._contextMenuTracker=(0,e.f3M)(Kn),this._disabled=!1,this._setMenuStackCloseListener()}open(t){this._open(t,!1)}close(){this.menuStack.closeAll()}_openOnContextMenu(t){this.disabled||(t.preventDefault(),t.stopPropagation(),this._contextMenuTracker.update(this),this._open({x:t.clientX,y:t.clientY},!0),this.childMenu?.focusFirstItem(2===t.button?"mouse":0===t.button?"keyboard":"program"))}_getOverlayConfig(t){return new h({positionStrategy:this._getOverlayPositionStrategy(t),scrollStrategy:this._overlay.scrollStrategies.reposition(),direction:this._directionality||void 0})}_getOverlayPositionStrategy(t){return this._overlay.position().flexibleConnectedTo(t).withLockedPosition().withGrowAfterOpen().withPositions(this.menuPosition??Gn)}_setMenuStackCloseListener(){this.menuStack.closed.pipe((0,I.R)(this.destroyed)).subscribe(({item:t})=>{t===this.childMenu&&this.isOpen()&&(this.closed.next(),this.overlayRef.detach())})}_subscribeToOutsideClicks(t){if(this.overlayRef){let n=this.overlayRef.outsidePointerEvents();if(t){const[a,l]=(0,En.u)(n,({type:f})=>"auxclick"===f);n=(0,A.T)(l,a.pipe((0,Fn.T)(1)))}n.pipe((0,I.R)(this.stopOutsideClicksListener)).subscribe(a=>{this.isElementInsideMenuStack((0,oe.sA)(a))||this.menuStack.closeAll()})}}_open(t,n){this.disabled||(this.isOpen()?(this.menuStack.closeSubMenuOf(this.childMenu),this.overlayRef.getConfig().positionStrategy.setOrigin(t),this.overlayRef.updatePosition()):(this.opened.next(),this.overlayRef?(this.overlayRef.getConfig().positionStrategy.setOrigin(t),this.overlayRef.updatePosition()):this.overlayRef=this._overlay.create(this._getOverlayConfig(t)),this.overlayRef.attach(this.getMenuContentPortal()),this._subscribeToOutsideClicks(n)))}}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275dir=e.lG2({type:o,selectors:[["","cdkContextMenuTriggerFor",""]],hostVars:1,hostBindings:function(t,n){1&t&&e.NdJ("contextmenu",function(l){return n._openOnContextMenu(l)}),2&t&&e.uIk("data-cdk-menu-stack-id",null)},inputs:{menuTemplateRef:["cdkContextMenuTriggerFor","menuTemplateRef"],menuPosition:["cdkContextMenuPosition","menuPosition"],menuData:["cdkContextMenuTriggerData","menuData"],disabled:["cdkContextMenuDisabled","disabled"]},outputs:{opened:"cdkContextMenuOpened",closed:"cdkContextMenuClosed"},exportAs:["cdkContextMenuTriggerFor"],standalone:!0,features:[e._Bn([{provide:ut,useExisting:o},{provide:De,useClass:ct}]),e.qOj]}),i})(),Vn=(()=>{var o;class i{}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[In]}),i})();var xt=d(72237),Gt=d(6966),ye=d(72500),$e=d(90690),pt=d(54807),Ye=d(53546),Wn=d(48081),ve=d(71997),Kt=d(28946),be=d(75187),wt=d(85027),q=d(15861),Ie=d(82668),Ce=d(4786),Vt=d(12044),Pe=d(30046),Qe=d(61862),Xn=d(61794),Wt=d(58051);class ii{constructor(i,s=(()=>[])){this.executionContext=i,this.modulesList=s,this.interpreter=(0,Xn.R)()}provideCompletionItems(i,s,t,n){const a=this.executionContext(),l=i.getLineContent(s.lineNumber),f=i.getWordUntilPosition(s).word,C=this;function E(){const P={};return C.modulesList().concat((0,Wt.P0)()).forEach(ie=>P[ie]=ie),P}function k(P,ie){if(!P)return{suggestions:[]};let ue={};if(l.startsWith("import"))ue=E();else if(l.startsWith("from")){const fe=l.split(" ");ue=fe.length>2?(0,Wt.oz)((0,Qe.trim)(fe[1],"\"'")):E()}else ue=Array.isArray(P)?Array.prototype:"string"==typeof P?String.prototype:P;return{suggestions:Object.getOwnPropertyNames(ue||{}).filter(fe=>!ie||fe.indexOf(ie)>=0).map(fe=>({label:fe,kind:"function"==typeof P[fe]?Ie.languages.CompletionItemKind.Function:Ie.languages.CompletionItemKind.Field,insertText:fe}))}}if(l.endsWith(".")){const P=l.split(".");let ie=a;for(let ue=0;ue<P.length-1&&(ie=ie[P[ue]],ie);ue++);return k(ie,P[P.length-1])}return k(a,f)}resolveCompletionItem(i,s){return null}}var Xt=d(46681);function ht(o,i,s){return o?.length>i?o[i]:s}const en=["select","from","where","on","left","inner","full","cross","insert","update","delete","top","go"];class ri{constructor(i,s,t){this.getConnectionName=i,this.getDbObjects=s,this.getFields=t}getFromTables(i){let s=-1;const t={};let n="",a="";for(;++s<i.length;){const f=i[s];("from"===f.toLowerCase()||"join"===f.toLowerCase())&&(n=i[++s],"as"===i[s+1]?.toLowerCase()?(s+=2,a=i[s]):en.indexOf(i[s+1]?.toLowerCase())<0&&(a=ht(i,++s,"")),t[a]=n)}return t}workoutFields(i,s){const t=this.getFromTables(s)[i];return this.getFields(this.getConnectionName(),t).then(n=>({suggestions:n.map(l=>({label:l,insertText:l,kind:Ie.languages.CompletionItemKind.Field}))}))}provideCompletionItems(i,s,t,n){const a=i.getValue(),l=function ai(o,i,s){let t=-1;for(;++t<o.length;)if("\n"===o[t]&&i--,1===i)return t+s;return-1}(a,s.lineNumber,s.column),f=function oi(o,i){let s=i-1;const t=[];let n="";for(;++s<o.length;){const a=o[s];!a||"\r"===a||("\n"===a||" "===a||"\t"==a?(n&&t.push(n),n=""):n+=a)}return n&&t.push(n),t}(a,l),C=function si(o,i){let s=i;const t=[];let n="";for(;--s>=0;){const a=o[s];!a||"\r"===a||("\n"===a||" "===a||"\t"==a?(n&&t.push(n),n=""):n=a+n)}return n&&t.push(n),t}(a,l);if(!this.getConnectionName())return{suggestions:[{label:"ERROR! Please select Connection",documentation:"CONNECTION IS NOT DEFINED. Please select Connection",kind:Ie.languages.CompletionItemKind.Class,insertText:""}]};if(["from","join","into","update"].indexOf(ht(C,0,"").toLowerCase())>=0)return this.getDbObjects(this.getConnectionName()).then(ie=>({suggestions:ie.map(fe=>({label:fe,insertText:fe,kind:Ie.languages.CompletionItemKind.Struct}))}));if(f.findIndex(ie=>"from"===ie.toLowerCase())>=0){const ie=ht(C,0,""),ue=ie.endsWith(".")?(0,Qe.trim)(ie,"."):"";return this.workoutFields(ue,f)}const P=(0,Xt.first)(C,ie=>en.includes(ie.toLowerCase()))?.toLowerCase();if("on"===P||"where"===P){const ie=ht(C,0,""),ue=ie.endsWith(".")?(0,Qe.trim)(ie,"."):"";return this.workoutFields(ue,C.map(fe=>fe).reverse())}return{suggestions:[]}}resolveCompletionItem(i,s){return null}}var Fe=d(52929),tn=d(15575),me=d(75263),Te=d(33374),Se=d(69569);function li(o,i){if(1&o&&(e.TgZ(0,"option",25),e._uU(1),e.qZA()),2&o){const s=i.$implicit;e.Q6J("value",s),e.xp6(1),e.Oqu(s)}}function ci(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"div",20)(1,"label",21),e._uU(2,"Function:"),e.qZA(),e.TgZ(3,"select",22),e.NdJ("change",function(n){e.CHM(s);const a=e.oxw();return e.KtG(a.onQueryParamSelect(n))}),e.TgZ(4,"option",23),e._uU(5,"Select method"),e.qZA(),e.YNc(6,li,2,2,"option",24),e.qZA()()}if(2&o){const s=e.oxw();e.xp6(6),e.Q6J("ngForOf",s.queryParamOptions)}}function ui(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"app-project-access",26),e.NdJ("permissionChanged",function(){e.CHM(s);const n=e.oxw();return e.KtG(n.changed=!0)}),e.qZA()}if(2&o){const s=e.oxw();e.Q6J("config",s.config.app)}}function di(o,i){1&o&&(e.TgZ(0,"div",27)(1,"div",28)(2,"span",29),e._uU(3,"Loading..."),e.qZA()()())}let pi=(()=>{var o;class i{constructor(t,n,a){this.dataService=t,this.dialogRef=n,this.notoficationService=a,this.loading=!1,this.invalid=!1,this.publicCodeAccessLevels=Object.keys(Fe.qB).map(l=>l),this.publicAppAccessLevels=Object.keys(Fe.PF).map(l=>l),this.appInfo={appId:0,appName:"",appOwner:"",description:"",logo:"",title:""},this.changed=!1,this.queryParamsStr=""}ngOnInit(){if(!this.config?.app)throw new Error("config is not initialized");this.contenType=this.config?.tab.tabType,this.appTitle=this.config?.app.title??this.config.app.appName,this.filePath=this.config.tab.queryParams.file,this.url=this.getContentLink(),this.queryParamOptions=this.getQueryParamOptions()}onClose(){this.dialogRef.close()}onCopy(){this.url&&navigator.clipboard.writeText(this.url)}onOpen(){this.url&&window.open(this.url,"_blank")}saveAppProject(){var t=this;return(0,q.Z)(function*(){if(!t.config)throw new Error("config is not initialized");t.loading=!0;try{const n=t.config.app;if(n.appName){const a={appName:n.appName,title:n.title,description:n.description,appOwner:n.appOwner,logo:n.logo,publicAccess:n.publicAccess,publicCodeAccess:n.publicCodeAccess};yield t.dataService.saveApp(n.appOwner,n.appName,a),t.changed=!1,yield t.dataService.loadMyAppsLinks(!0),t.notoficationService.success(`App '${n.appName}' updated.`)}else t.notoficationService.error("App Name cannot be empty")}catch(n){t.notoficationService.error(n)}finally{t.loading=!1}})()}onQueryParamSelect(t){if("jspy"===this.contenType){const n=t.target.value;this.queryParamsStr=n?`?method=${n}`:"",this.url=this.getContentLink()}}getContentLink(){if(!this.config?.tab)return"No tab";const{tabParams:t,queryParams:n}=this.config?.tab;return`${location.origin}/content/${t.owner}/${t.name}/${n.file}${this.queryParamsStr}`}getQueryParamOptions(){if("jspy"===this.contenType)return(this.config?.tab.content).contentEditor?.jspyFunctions}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(me.UW),e.Y36(Te.z),e.Y36(Se.g))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-project-share"]],viewQuery:function(t,n){if(1&t&&e.Gf(tn.m,5),2&t){let a;e.iGM(a=e.CRH())&&(n.accessComponent=a.first)}},inputs:{config:"config"},decls:28,vars:7,consts:[["autocomplete","off",1,"d-flex","flex-column","h-200"],[1,"modal-header","d-flex","flex-row"],[1,"modal-title","flex-fill"],[1,"file-path"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body","px-4","d-flex","flex-column","h-100","overflow-hidden"],[1,"row","mr-0","mb-2","mt-2"],["for","link",1,"col-1","col-form-label","py-1"],["disabled","disabled",1,"form-control","col","form-control-sm",3,"value"],["type","button",1,"btn","btn-outline-primary","btn-sm","align-self-baseline","ml-2",3,"click"],[1,"fa","fa-copy","my-0"],[1,"fa","fa-share","my-0"],["class","row mr-0 mb-2",4,"ngIf"],["class","pt-3 mt-3",3,"config","permissionChanged",4,"ngIf"],[1,"modal-footer","flex-column"],[1,"row","w-100","mx-0","px-0"],["type","button",1,"btn","btn-light",3,"click"],["type","submit",1,"btn","btn-primary","ml-auto",3,"disabled","click"],["class","d-flex justify-content-center position-absolute align-items-center w-100 h-100 spinner flex-column",4,"ngIf"],[1,"row","mr-0","mb-2"],[1,"col-2","col-form-label","py-1"],[1,"form-control","form-control-sm","col",3,"change"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"pt-3","mt-3",3,"config","permissionChanged"],[1,"d-flex","justify-content-center","position-absolute","align-items-center","w-100","h-100","spinner","flex-column"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(t,n){1&t&&(e.TgZ(0,"div")(1,"div",0)(2,"div",1)(3,"h4",2),e._uU(4),e.TgZ(5,"span",3),e._uU(6),e.qZA()(),e.TgZ(7,"button",4),e.NdJ("click",function(){return n.onClose()}),e.TgZ(8,"span",5),e._uU(9,"\xd7"),e.qZA()()(),e.TgZ(10,"div",6)(11,"div",7)(12,"label",8),e._uU(13,"Link:"),e.qZA(),e._UZ(14,"input",9),e.TgZ(15,"button",10),e.NdJ("click",function(){return n.onCopy()}),e._UZ(16,"i",11),e.qZA(),e.TgZ(17,"button",10),e.NdJ("click",function(){return n.onOpen()}),e._UZ(18,"i",12),e.qZA()(),e.YNc(19,ci,7,1,"div",13),e.YNc(20,ui,1,1,"app-project-access",14),e.qZA(),e.TgZ(21,"div",15)(22,"div",16)(23,"button",17),e.NdJ("click",function(){return n.onClose()}),e._uU(24,"Cancel"),e.qZA(),e.TgZ(25,"button",18),e.NdJ("click",function(){return n.saveAppProject()}),e._uU(26,"Save"),e.qZA()()()()(),e.YNc(27,di,4,0,"div",19)),2&t&&(e.xp6(4),e.hij("App / Project: ",n.appTitle," "),e.xp6(2),e.hij("File: ",n.filePath,""),e.xp6(8),e.Q6J("value",n.url),e.xp6(5),e.Q6J("ngIf","jspy"===n.contenType&&(null==n.queryParamOptions?null:n.queryParamOptions.length)),e.xp6(1),e.Q6J("ngIf",n.config),e.xp6(5),e.Q6J("disabled",!n.changed),e.xp6(2),e.Q6J("ngIf",n.loading))},dependencies:[r.sg,r.O5,u.YN,u.Kr,tn.m],styles:[".file-path[_ngcontent-%COMP%]{font-size:medium}app-project-access[_ngcontent-%COMP%]{border-top:1px solid}"]}),i})();var ce=d(21473),xe=d(8050),hi=d(55629),At=d(99397),qe=d(612),Mt=d(65619),nn=d(52572),ke=d(16321),Ee=d(22263);const fi=["jspy","js","json","table","procedure","query","dcml"];function on(o){return{jspy:"fa-file-text-o",dcml:"fa-file-code-o",query:"fa-code",js:"fa-code",json:"fa-code",sql:"fa-table"}[o]||"fa-question"}class mi{init(i){const s=document.createElement("div"),t=i.value,n=i.data?on(i.data?.contentPath.contentType):"fa-folder-o";s.innerHTML=`<span><i class="fa ${n} mr-1"></i>\n            <span class="filename"></span>${t}</span>`,this.eGui=s.firstChild}getGui(){return this.eGui}refresh(){return!1}}function gi(o){const i=o.folder?o.folder.replaceAll("/","\\").replaceAll("!","\\").split("\\"):[];return i.push(`${o.name}.${o.contentType}`),i}function sn(o){if(o.data)return o.data.filePath;const i=[o.key];let s=o?.parent;for(;s?.key;)i.unshift(s.key),s=s.parent;return i}function ft(o){const i=o.allLeafChildren.filter(s=>s!==o);return i?.length?(0,Xt.flatten)(i.map(s=>ft(s))):o.data?[o.data]:[]}function an(o){return{fileKey:(0,ce.nV)(o),filePath:gi(o),fileName:`${o.name}.${o.contentType}`,contentPath:o}}d(66166);const yi=["folder"];let Ot=(()=>{var o;class i{constructor(t,n,a,l){this.dialogRef=t,this.dataService=n,this.dialogService=a,this.notificationService=l,this.config={},this.contentTypes=fi,this.saveAppLink={name:"",folder:"",contentType:""},this.title="",this.app={},this.apps=[],this.appNames=[],this.appName="",this.loading=!1}ngOnInit(){var t=this;return(0,q.Z)(function*(){if(t.apps=yield t.dataService.loadMyAppsLinks(),t.appNames=t.apps.map(n=>n.appOwner+"."+n.appName),t.appNames.push("-- Create New App --"),t.saveAppLink={...t.config.link},t.config.app&&(t.app={...t.config.app}),t.config.link){const{folder:n,name:a,contentType:l}=t.config.link;t.title=`Rename file: ${n||""}/${a}.${l}`}t.appName=t.config.app.appOwner+"."+t.config.app.appName,t.initFoldersAutocomplete()})()}onSave(){var t=this;return(0,q.Z)(function*(){t.autoCorrectNames();const n={...t.saveAppLink};if(!n.folder||n.folder.split("/").every(a=>(0,Pe.r1)(a)))if((0,Pe.r1)(n.name)){if("-- Create New App --"===t.app?.appName)throw Error("Creating new app here is not implemented yet");t.isValid()&&t.dialogRef.close(n)}else t.notificationService.error("Incorrect name");else t.notificationService.error("Incorrect folder")})()}autoCorrectNames(){this.saveAppLink.folder=this.saveAppLink.folder?.includes("\\")||this.saveAppLink.folder?.includes("!")?this.saveAppLink.folder.replaceAll("\\","/").replaceAll("!","/"):this.saveAppLink.folder,this.saveAppLink.folder=this.saveAppLink.folder?(0,Qe.trim)(this.saveAppLink.folder,"/"):this.saveAppLink.folder,this.saveAppLink.name=this.saveAppLink.name?.trim()||"",this.saveAppLink.name.toLowerCase().endsWith(`.${this.saveAppLink.contentType}`)&&(this.saveAppLink.name=this.saveAppLink.name.substring(0,this.saveAppLink.name.length-this.saveAppLink.contentType.length-1))}onClose(){this.dialogRef.close()}onAppSeclect(t){this.app=this.app?this.app:{};const n=t.split(".");"-- Create New App --"!==t?t?(this.app.appOwner=n[0],this.app.appName=n[1]):(this.app.appOwner="",this.app.appName=""):this.app.appName="-- Create New App --"}initFoldersAutocomplete(){if(!this.folderInput?.nativeElement)throw new Error("folderInput?.nativeElement is not initialized ");const t=this.folderInput.nativeElement;t.setAttribute("autocomplete","on");const n=document.createElement("DATALIST");n.id="list-of-folders",t.setAttribute("list",n.id),t.parentNode?.insertBefore(n,t),n.innerHTML=this.config.folders?.map(a=>`<option value="${a}">`).join("")}isValid(){return!(!this.saveAppLink.name||!this.app.appName)}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(Te.z),e.Y36(me.UW),e.Y36(Te.x),e.Y36(Se.g))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-file-dialog"]],viewQuery:function(t,n){if(1&t&&e.Gf(yi,7),2&t){let a;e.iGM(a=e.CRH())&&(n.folderInput=a.first)}},inputs:{config:"config"},decls:29,vars:8,consts:[[3,"ngSubmit"],["form","ngForm"],[1,"modal-header"],[1,"modal-title","pull-left"],[1,"modal-body","px-4","d-flex","flex-column","h-100","overflow-hidden"],[1,"row","mr-0","mb-2"],["for","type",1,"col-3","col-form-label"],["appendTo","body","name","app","required","","placeholder","Select content type",1,"col","px-0","auto-grow",3,"ngModel","items","change"],["for","folder",1,"col-3","col-form-label"],["name","folder",1,"form-control","col",3,"ngModel","ngModelChange"],["folder",""],["for","name",1,"col-3","col-form-label"],["name","name","required","",1,"form-control","col",3,"ngModel","ngModelChange"],[1,"row","mr-0","mb-4"],["appendTo","body","name","type","required","","placeholder","Select content type",1,"col","px-0","auto-grow",3,"items","ngModel","ngModelChange"],[1,"modal-footer"],[1,"row","w-100","mx-0","px-0"],["type","submit",1,"btn","btn-primary","ml-auto","mr-2","fx-80",3,"disabled"],["type","button",1,"btn","btn-light","fx-80",3,"click"]],template:function(t,n){if(1&t&&(e.TgZ(0,"form",0,1),e.NdJ("ngSubmit",function(){return n.onSave()}),e.TgZ(2,"div",2)(3,"h4",3),e._uU(4),e.qZA()(),e.TgZ(5,"div",4)(6,"div",5)(7,"label",6),e._uU(8,"Application"),e.qZA(),e.TgZ(9,"ng-select",7),e.NdJ("change",function(l){return n.onAppSeclect(l)}),e.qZA()(),e.TgZ(10,"div",5)(11,"label",8),e._uU(12,"Folder"),e.qZA(),e.TgZ(13,"input",9,10),e.NdJ("ngModelChange",function(l){return n.saveAppLink.folder=l}),e.qZA()(),e.TgZ(15,"div",5)(16,"label",11),e._uU(17,"Name"),e.qZA(),e.TgZ(18,"input",12),e.NdJ("ngModelChange",function(l){return n.saveAppLink.name=l}),e.qZA()(),e.TgZ(19,"div",13)(20,"label",6),e._uU(21,"File Type"),e.qZA(),e.TgZ(22,"ng-select",14),e.NdJ("ngModelChange",function(l){return n.saveAppLink.contentType=l}),e.qZA()()(),e.TgZ(23,"div",15)(24,"div",16)(25,"button",17),e._uU(26,"Save"),e.qZA(),e.TgZ(27,"button",18),e.NdJ("click",function(){return n.onClose()}),e._uU(28,"Cancel"),e.qZA()()()()),2&t){const a=e.MAs(1);e.xp6(4),e.Oqu(n.title),e.xp6(5),e.Q6J("ngModel",n.appName)("items",n.appNames),e.xp6(4),e.Q6J("ngModel",n.saveAppLink.folder),e.xp6(5),e.Q6J("ngModel",n.saveAppLink.name),e.xp6(4),e.Q6J("items",n.contentTypes)("ngModel",n.saveAppLink.contentType),e.xp6(3),e.Q6J("disabled",!a.valid||!n.app.appName)}},dependencies:[u._Y,u.Fj,u.JJ,u.JL,u.Q7,u.On,u.F,pt.w9]}),i})(),rn=(()=>{var o;class i{constructor(t,n,a){this.dialogRef=t,this.dataService=n,this.notificationService=a,this.config={},this.loading=!1}onSave(){var t=this;return(0,q.Z)(function*(){t.autoCorrectNames();const n=t.config.folder;!n||n.split("/").every(a=>(0,Pe.r1)(a))?t.dialogRef.close(n):t.notificationService.error("Incorrect folder")})()}autoCorrectNames(){this.config.folder=this.config.folder?.includes("\\")||this.config.folder?.includes("!")?this.config.folder.replaceAll("\\","/").replaceAll("!","/"):this.config.folder,this.config.folder=this.config.folder?(0,Qe.trim)(this.config.folder,"/"):this.config.folder}onClose(){this.dialogRef.close()}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(Te.z),e.Y36(me.UW),e.Y36(Se.g))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-folder-dialog"]],inputs:{config:"config"},decls:16,vars:2,consts:[[3,"ngSubmit"],["form","ngForm"],[1,"modal-header"],[1,"modal-title","pull-left"],[1,"modal-body","px-4","d-flex","flex-column","h-100","overflow-hidden"],[1,"row","mr-0","mb-2"],["for","folder",1,"col-3","col-form-label"],["name","folder",1,"form-control","col",3,"ngModel","ngModelChange"],[1,"modal-footer"],[1,"row","w-100","mx-0","px-0"],["type","submit",1,"btn","btn-primary","ml-auto","mr-2","fx-80"],["type","button",1,"btn","btn-light","fx-80",3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"form",0,1),e.NdJ("ngSubmit",function(){return n.onSave()}),e.TgZ(2,"div",2)(3,"h4",3),e._uU(4),e.qZA()(),e.TgZ(5,"div",4)(6,"div",5)(7,"label",6),e._uU(8,"Folder"),e.qZA(),e.TgZ(9,"input",7),e.NdJ("ngModelChange",function(l){return n.config.folder=l}),e.qZA()()(),e.TgZ(10,"div",8)(11,"div",9)(12,"button",10),e._uU(13,"Save"),e.qZA(),e.TgZ(14,"button",11),e.NdJ("click",function(){return n.onClose()}),e._uU(15,"Cancel"),e.qZA()()()()),2&t&&(e.xp6(4),e.Oqu(n.config.title||"Folder"),e.xp6(5),e.Q6J("ngModel",n.config.folder))},dependencies:[u._Y,u.Fj,u.JJ,u.JL,u.On,u.F],encapsulation:2}),i})(),ln=(()=>{var o;class i{constructor(t,n,a,l,f){this.notificationService=t,this.dataStudioService=n,this.dataService=a,this.tabsService=l,this.dialogService=f,this.saving$=new D.x}init(t){this.gridApi=t}deleteNode(t){var n=this;return(0,q.Z)(function*(){if(!t)return;const a=function _i(o){const i=o.data;return`Delete ${o.group?"folder":"file"} ${i?.fileKey??o.key}`}(t),l=ft(t);if(yield n.notificationService.confirmation(a))try{n.saving$.next(!0),yield Promise.all(l.map(E=>n.dataService.deleteAppContent(n.dataStudioService.currentApp.appOwner,n.dataStudioService.currentApp.appName,(0,ce.nV)(E.contentPath)))),n.notificationService.success(`Deleted: ${l.map(E=>(0,ce.nV)(E.contentPath)).join(", ")}`);const C=t.group?t.allLeafChildren:[t];n.gridApi?.applyTransaction({remove:C.map(E=>E.data).filter(E=>!!E)}),n.tabsService.removeAppTabs(n.dataStudioService.currentApp,l.map(E=>E.contentPath))}catch(C){n.notificationService.error(C)}finally{n.saving$.next(!1)}})()}renameNode(t){var n=this;return(0,q.Z)(function*(){const a=t.data;if(!a)return n.renameFolderNode(t);const l={link:a.contentPath,folders:n.getFoldersList(t),app:n.dataStudioService.currentApp},f=yield n.dialogService.open(Ot,{initialState:{config:l}}).onCloseAsync();if(f){n.saving$.next(!0);try{return yield n.dataService.renameFile(l.app.appOwner,l.app.appName,(0,ce.nV)(a.contentPath),(0,ce.nV)(f)),t.data=an(f),n.gridApi?.applyTransaction({update:[t.data]}),t}catch(C){return void n.notificationService.error(C)}finally{n.saving$.next(!1)}}})()}copyFileTo(t){var n=this;return(0,q.Z)(function*(){const a=t.data;if(!a)throw new Error("No file data");const l={link:a.contentPath,folders:n.getFoldersList(t),app:n.dataStudioService.currentApp},f=yield n.dialogService.open(Ot,{initialState:{config:l}}).onCloseAsync();if(f){n.saving$.next(!0);try{const C=l.app.appOwner,E=l.app.appName,k=yield n.dataService.getFileContent(C,E,(0,ce.nV)(a.contentPath));yield n.dataService.saveAppContent({ownerName:C,appName:E,content:k,fileName:(0,ce.nV)(f)})}catch(C){return void n.notificationService.error(C)}finally{n.saving$.next(!1)}}})()}copyFolderTo(t){var n=this;return(0,q.Z)(function*(){const a=sn(t).join("/"),l={title:"Copy Folder To",folder:a};let f=yield n.dialogService.open(rn,{initialState:{config:l}}).onCloseAsync();if(null==f)return;f=f.replaceAll("/","!");const C=ft(t),E=n.dataStudioService.currentApp;n.saving$.next(!0);try{for(let k of C){const P=(0,ce.nV)(k.contentPath),ie=(0,Qe.trim)(`${f}!${P.substring(a.length+1)}`,"!"),ue=yield n.dataService.getFileContent(E.appOwner,E.appName,P);yield n.dataService.saveAppContent({ownerName:E.appOwner,appName:E.appName,content:ue,fileName:ie})}}catch(k){return void n.notificationService.error(k)}finally{n.saving$.next(!1)}})()}renameFolderNode(t){var n=this;return(0,q.Z)(function*(){const a=sn(t).join("/"),l={title:"Rename Folder",folder:a};let f=yield n.dialogService.open(rn,{initialState:{config:l}}).onCloseAsync();if(null==f)return;f=f.replaceAll("/","!");const C=ft(t),E=n.dataStudioService.currentApp;n.saving$.next(!0);try{for(let k of C){const P=(0,ce.nV)(k.contentPath),ie=(0,Qe.trim)(`${f}!${P.substring(a.length+1)}`,"!");yield n.dataService.renameFile(E.appOwner,E.appName,P,ie)}return t}catch(k){return void n.notificationService.error(k)}finally{n.saving$.next(!1)}})()}getFoldersList(t){const n=t.allLeafChildren;return Array.from(new Set(n?.map(a=>a.data?.filePath).filter(a=>!!a)))}}return(o=i).\u0275fac=function(t){return new(t||o)(e.LFG(Se.g),e.LFG(ve.F),e.LFG(me.UW),e.LFG(xe.x),e.LFG(Te.x))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac}),i})();var cn=d(40092),Dt=d(26671);function vi(o,i){1&o&&(e.TgZ(0,"div",2)(1,"div",3)(2,"span",4),e._uU(3,"Loading..."),e.qZA()()())}let un=(()=>{var o;class i{constructor(t,n,a,l,f,C){this.route=t,this.router=n,this.dataStudioService=a,this.dataService=l,this.tabsService=f,this.appTreeService=C,this.isReadOnly=!1,this.loading$=new D.x,this.saving$=this.appTreeService.saving$,this.destroy$=new D.x,this.rowData$=new Mt.X([]),this.gridConfig={suppressContextMenu:!1,rowSelection:"single",getContextMenuItems:this.getContextMenuItems.bind(this)},this.groupDefaultExpanded=-1,this.getDataPath=E=>E.filePath,this.defaultColDef={flex:1},this.autoGroupColumnDef={minWidth:330,cellRendererParams:{suppressCount:!0,innerRenderer:mi}}}onGridReady(t){this.gridApi=t.api,this.gridApi.setHeaderHeight(0),this.gridApi.setGroupHeaderHeight(0),this.appTreeService.init(this.gridApi)}ngOnInit(){this.dataStudioService.currentApp$.pipe((0,I.R)(this.destroy$)).subscribe(t=>this.onAppChanged(t)),this.dataStudioService.appContentAdded$.pipe((0,I.R)(this.destroy$)).subscribe(t=>{this.onAppChanged(this.dataStudioService.currentApp)}),(0,nn.a)([this.tabsService.activeTab$,this.loading$.pipe((0,Ue.b)(100))]).pipe((0,I.R)(this.destroy$),(0,K.h)(([t,n])=>!1===n)).subscribe(([t])=>{if(this.gridApi&&"app"===t?.tabParams.appOrSql){const n=(0,ce.x2)(t.queryParams.file);(0,cn.JE)(this.gridApi,a=>a.fileKey===(0,ce.nV)(n))}else this.gridApi?.deselectAll()})}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete()}refreshAppFiles(t){var n=this;return(0,q.Z)(function*(){yield n.onAppChanged(t)})()}onAppChanged(t){var n=this;return(0,q.Z)(function*(){if(!t)return;n.loading$.next(!0);const a=(yield n.dataService.loadAppFileLinks(t.appOwner,t.appName,!0)).map(an);n.rowData$.next(a),n.loading$.next(!1)})()}onCellClicked(t){var n=this;return(0,q.Z)(function*(){const a=t.data;a&&n.selectTreeItem(a)})()}selectTreeItem(t){if(!t)return;const{appOwner:n,appName:a}=this.dataStudioService.currentApp,l=(0,ce.nV)(t.contentPath);this.router.navigate(["data-studio/app",n||Ee.m5,a||Ee.b5],{queryParams:{file:l,tab:this.route.snapshot.queryParams.tab}})}getContextMenuItems(t){var a,l,n=this;if(!t.node)return[];const f=t.node;return[{name:"Rename",action:function(){return(a=a||(0,q.Z)(function*(){return yield n.renameFile(f)})).apply(this,arguments)}},{name:"Delete",action:()=>this.appTreeService.deleteNode(f)},"separator",{name:"Copy to",action:function(){return(l=l||(0,q.Z)(function*(){return yield n.copyTo(f)})).apply(this,arguments)}}]}copyTo(t){var n=this;return(0,q.Z)(function*(){if(!t.data)return yield n.appTreeService.copyFolderTo(t),void(yield n.refreshAppFiles(n.dataStudioService.currentApp));yield n.appTreeService.copyFileTo(t),yield n.refreshAppFiles(n.dataStudioService.currentApp)})()}renameFile(t){var n=this;return(0,q.Z)(function*(){if(!t.data)return yield n.appTreeService.renameFolderNode(t),void(yield n.refreshAppFiles(n.dataStudioService.currentApp));const a=t.isSelected(),l=n.rowData$.getValue(),f=t.data,C=l.indexOf(f),E=t.rowIndex,P=(yield n.appTreeService.renameNode(t))?.data;P&&(l[C]=P,n.rowData$.next([...l]),ke.z.schedule(()=>{n.gridApi?.ensureIndexVisible(E,"middle"),a&&(n.selectTreeItem(P),n.tabsService.removeAppTabs(n.dataStudioService.currentApp,[f.contentPath]))}))})()}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(be.gz),e.Y36(be.F0),e.Y36(ve.F),e.Y36(Dt.U),e.Y36(xe.x),e.Y36(ln))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tree"]],inputs:{isReadOnly:"isReadOnly"},features:[e._Bn([ln])],decls:5,vars:15,consts:[[1,"w-100","h-100","p-2","ag-theme-balham","ws-ag-tree",3,"gridOptions","defaultColDef","autoGroupColumnDef","rowData","treeData","animateRows","groupDefaultExpanded","getDataPath","cellClicked","gridReady"],["class","d-flex justify-content-center position-absolute align-items-center w-100 h-100 spinner",4,"ngIf"],[1,"d-flex","justify-content-center","position-absolute","align-items-center","w-100","h-100","spinner"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(t,n){1&t&&(e.TgZ(0,"ag-grid-angular",0),e.NdJ("cellClicked",function(l){return n.onCellClicked(l)})("gridReady",function(l){return n.onGridReady(l)}),e.ALo(1,"async"),e.qZA(),e.YNc(2,vi,4,0,"div",1),e.ALo(3,"async"),e.ALo(4,"async")),2&t&&(e.Q6J("gridOptions",n.gridConfig)("defaultColDef",n.defaultColDef)("autoGroupColumnDef",n.autoGroupColumnDef)("rowData",e.lcZ(1,9,n.rowData$))("treeData",!0)("animateRows",!0)("groupDefaultExpanded",n.groupDefaultExpanded)("getDataPath",n.getDataPath),e.xp6(2),e.Q6J("ngIf",e.lcZ(3,11,n.loading$)||e.lcZ(4,13,n.saving$)))},dependencies:[r.O5,Ye.N8,r.Ov],styles:['[_ngcontent-%COMP%]:root{--bg: #fff;--body-bg: #e4e5e6;--header-bg: #ebedef;--color: #4f5d73;--border-color: #c4c9d0;--ws-alt: #f7f7f7;--form-input-bg: #fff;--form-input-color: #768192;--nav-link-color: #8a93a2;--secondary-color: #c4c9d0;--opacity: .05;--hover: "#f0f3f5"}[_nghost-%COMP%]{display:block;position:relative}']}),i})();var Ci=d(85965),Ti=d(10217),Ge=d(1238),Ke=d(38582),Ve=d(13509),Si=d(41490);let It=(()=>{var o;class i{constructor(t,n,a,l){this.notificationService=t,this.fileManagerService=n,this.dataService=a,this.accountService=l}toLinksTree(t){t=t.sort();const n=[];function a(l){if(!l)return n;const f=l.split("!");let C=n;for(const E of f){let k=C.find(P=>P.label===E&&!P.fullFileName);k||(k={label:E,children:[]},C.push(k)),C=k.children}return C}for(let l of t){const{folder:f,fileName:C}=(0,ce.Dl)(l);a(f).push({label:C,fullFileName:l})}return n}downloadLinks(t,n,a,l,f){var C=this;return(0,q.Z)(function*(){const E=yield C.dataService.getAppFiles(t.appOwner,t.appName),k=C.toLinksTree(E),P=(new Ci).folder(t.appName);try{if(n){var ie=Ee.Ie;ie=(ie=(ie=ie.replace("@appName",t.appName)).replace("@appDescription",t.description)).replace("@appOwner",t.appOwner),P.file("package.json",ie)}if(a){var ue=Ee.xM;ue=(ue=ue.replace("@appName",t.appName)).replace("@appDescription",t.description),P.file("readme.md",ue)}if(l){let ot=Ee.n8;ot=ot.replace("@baseUrl",Ge.Z.worksheetsApi),ot=ot.replace("@apiAccessToken",(yield C.accountService.showAccessToken()).accessToken),P.file("app.js",ot)}const fe=f?P.folder("src"):P;fe.file(Ke.fP,JSON.stringify(t,null,"\t")),fe.file(Ke.KH,JSON.stringify({files:E},null,"\t")),yield C.generateZipFile(t,fe,k);const we=yield P.generateAsync({type:"blob"});(0,Ti.saveAs)(we,`${t.appOwner}-${t.appName}.zip`)}catch(fe){C.notificationService.error(fe)}})()}uploadApp(t){var n=this;return(0,q.Z)(function*(){var a=(yield n.fileManagerService.importAppContents()).map(P=>({...P,fileName:P.fileName?.replaceAll("\\","!")?.replaceAll("/","!")}));const l=yield n.dataService.getAppFiles(t.appOwner,t.appName),f=a.find(P=>P.fileName?.toLowerCase()?.endsWith(Ke.fP))?.fileName;if(!f)throw new Error(`'${Ke.fP}' file not found in a zip`);const C=(0,ce.Dl)(f).folder;C&&(a=a.filter(P=>P.fileName?.startsWith(C)).map(P=>({...P,fileName:P.fileName?.substring(C.length+1)})));const E=(a=a.filter(P=>P.fileName!==Ke.fP&&P.fileName!==Ke.KH)).map(P=>P.fileName),k=l.filter(P=>!E.includes(P));try{for(const P of a)yield n.dataService.saveAppContent({ownerName:t.appOwner,appName:t.appName,fileName:P.fileName,content:P.content});for(const P of k)yield n.dataService.deleteAppContent(t.appOwner,t.appName,P);n.notificationService.success(`${a.length} saved and '${k.length}' deleted.`)}catch(P){n.notificationService.error(P)}})()}generateZipFile(t,n,a){var l=this;return(0,q.Z)(function*(){for(const f of a)if(f.children){const C=n.folder(f.label);yield l.generateZipFile(t,C,f.children)}else{const C=yield l.dataService.getFileContent(t.appOwner,t.appName,f.fullFileName);n.file(f.label,C)}})()}}return(o=i).\u0275fac=function(t){return new(t||o)(e.LFG(Se.g),e.LFG(Ve.j5),e.LFG(me.UW),e.LFG(Si.B))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),i})();function xi(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"div")(1,"div",2)(2,"h4",3),e._uU(3,"Download App/Project"),e.qZA()(),e.TgZ(4,"div",4)(5,"div",5)(6,"label",6),e._uU(7,"Place code in 'src' folder"),e.qZA(),e.TgZ(8,"input",7),e.NdJ("ngModelChange",function(n){e.CHM(s);const a=e.oxw();return e.KtG(a.checkSrc=n)}),e.qZA()(),e.TgZ(9,"div",5)(10,"label",6),e._uU(11,"Include 'package.json'"),e.qZA(),e.TgZ(12,"input",7),e.NdJ("ngModelChange",function(n){e.CHM(s);const a=e.oxw();return e.KtG(a.checkPackageJson=n)}),e.qZA()(),e.TgZ(13,"div",5)(14,"label",6),e._uU(15,"Include 'readme.md'"),e.qZA(),e.TgZ(16,"input",7),e.NdJ("ngModelChange",function(n){e.CHM(s);const a=e.oxw();return e.KtG(a.checkReadmeMd=n)}),e.qZA()(),e.TgZ(17,"div",5)(18,"label",6),e._uU(19),e.qZA(),e.TgZ(20,"input",8),e.NdJ("ngModelChange",function(n){e.CHM(s);const a=e.oxw();return e.KtG(a.checkAppJs=n)}),e.qZA()()(),e.TgZ(21,"div",9)(22,"button",10),e.NdJ("click",function(){e.CHM(s);const n=e.oxw();return e.KtG(n.downloadApp())}),e._uU(23,"Download App"),e.qZA(),e.TgZ(24,"button",11),e.NdJ("click",function(){e.CHM(s);const n=e.oxw();return e.KtG(n.onClose())}),e._uU(25,"Cancel"),e.qZA()()()}if(2&o){const s=e.oxw();e.xp6(8),e.Q6J("ngModel",s.checkSrc),e.xp6(4),e.Q6J("ngModel",s.checkPackageJson),e.xp6(4),e.Q6J("ngModel",s.checkReadmeMd),e.xp6(3),e.hij(" ",s.hasAppJs?"Override with ":"Include"," default 'app.js'"),e.xp6(1),e.Q6J("ngModel",s.checkAppJs)}}function wi(o,i){1&o&&(e.TgZ(0,"div",12)(1,"div",13)(2,"span",14),e._uU(3,"..."),e.qZA()()())}let Ai=(()=>{var o;class i{constructor(t,n,a){this.dialogRef=t,this.appUploaderService=n,this.notoficationService=a,this.app={},this.checkSrc=!0,this.checkPackageJson=!0,this.checkReadmeMd=!0,this.checkAppJs=!1,this.hasAppJs=!1,this.loading=!1}ngOnInit(){this.checkAppJs=!this.hasAppJs}downloadApp(){var t=this;return(0,q.Z)(function*(){t.loading=!0;try{yield t.appUploaderService.downloadLinks(t.app,t.checkPackageJson,t.checkReadmeMd,t.checkAppJs,t.checkSrc),t.dialogRef.close()}catch(n){t.notoficationService.error(n)}finally{t.loading=!1}})()}onClose(){this.dialogRef.close()}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(Te.z),e.Y36(It),e.Y36(Se.g))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-download-app-dialog"]],inputs:{app:"app"},decls:2,vars:2,consts:[[4,"ngIf"],["class","d-flex justify-content-center position-absolute align-items-center w-100 h-100 spinner flex-column",4,"ngIf"],[1,"modal-header"],[1,"modal-title","pull-left"],[1,"modal-body","px-4","d-flex","flex-column"],[1,"row","mr-0","mb-2","form-check","justify-content-center"],["for","flexCheckChecked",1,"col","form-check-label"],["type","checkbox","checked","",1,"form-check-input",3,"ngModel","ngModelChange"],["type","checkbox",1,"form-check-input",3,"ngModel","ngModelChange"],[1,"modal-footer"],[1,"btn","btn-primary","ml-auto","mr-2","fx-80",3,"click"],["type","button",1,"btn","btn-light","fx-80",3,"click"],[1,"d-flex","justify-content-center","position-absolute","align-items-center","w-100","h-100","spinner","flex-column"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(t,n){1&t&&(e.YNc(0,xi,26,5,"div",0),e.YNc(1,wi,4,0,"div",1)),2&t&&(e.Q6J("ngIf",!n.loading),e.xp6(1),e.Q6J("ngIf",n.loading))},dependencies:[r.O5,u.Wl,u.JJ,u.On]}),i})();var Mi=d(28169),We=d(55314);const Oi=function(o,i){return["/data-studio/app",o,i]};function Di(o,i){if(1&o&&(e.TgZ(0,"li")(1,"a",7),e._uU(2),e.qZA()()),2&o){const s=i.$implicit;e.xp6(1),e.Q6J("routerLink",e.WLB(3,Oi,s.appOwner,s.appName)),e.xp6(1),e.AsE("",s.appName," (",s.appOwner,")")}}function Ii(o,i){if(1&o&&(e.TgZ(0,"ul",5),e.YNc(1,Di,3,6,"li",6),e.qZA()),2&o){const s=e.oxw();e.xp6(1),e.Q6J("ngForOf",s.apps)}}let Fi=(()=>{var o;class i{constructor(t,n){this.appsState=t,this.dataService=n,this.destroy$=new D.x,n.appsList$.pipe((0,I.R)(this.destroy$)).subscribe(a=>this.apps=a)}ngOnInit(){var t=this;return(0,q.Z)(function*(){yield t.dataService.loadMyAppsLinks()})()}appName(t){return t&&(t.indexOf("!")>0?t.substring(t.lastIndexOf("!")+1):t)}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete()}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(ve.F),e.Y36(me.UW))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-selection"]],decls:7,vars:3,consts:[["dropdown","","container","body"],["id","basic-link","dropdownToggle","","aria-controls","basic-link-dropdown",1,"btn","btn-link","dropdown-toggle","btn-sm","pl-0","cursor-pointer","border-0",3,"click"],[1,"d-inline-block","m-0"],[1,"caret"],["id","basic-link-dropdown","class","dropdown-menu","role","menu","aria-labelledby","basic-link",4,"dropdownMenu"],["id","basic-link-dropdown","role","menu","aria-labelledby","basic-link",1,"dropdown-menu"],[4,"ngFor","ngForOf"],[1,"dropdown-item",3,"routerLink"]],template:function(t,n){if(1&t&&(e.TgZ(0,"span",0)(1,"a",1),e.NdJ("click",function(l){return l.stopImmediatePropagation()}),e.TgZ(2,"h5",2),e._uU(3),e.ALo(4,"async"),e._UZ(5,"span",3),e.qZA()(),e.YNc(6,Ii,2,1,"ul",4),e.qZA()),2&t){let a;e.xp6(3),e.hij(" ",n.appName(null==(a=e.lcZ(4,1,n.appsState.currentApp$))?null:a.appName)||"Select application","")}},dependencies:[r.sg,be.rH,ye.Hz,ye.Mq,ye.TO,r.Ov]}),i})();class Ei{init(i){const s=document.createElement("div"),t=`${i.data?.schemaName}.${i.data?.objectName}`,n=function Pi(o){return o?.objectType?Ni[o.objectType]??"fa-question":"fa-question"}(i.data);s.innerHTML=`<span><i class="fa ${n} mx-1"></i>\n            <span class="filename"></span>${t}</span>`,this.eGui=s.firstChild}getGui(){return this.eGui}refresh(){return!1}}const Ni={[Ce.HA.Table]:"fa-table",[Ce.HA.View]:"fa-file-text-o",[Ce.HA.Procedure]:"fa-code",[Ce.HA.Function]:"fa-code"};var Je=d(94782);function ki(o,i){if(1&o&&(e.TgZ(0,"option",8),e._uU(1),e.qZA()),2&o){const s=i.$implicit;e.Q6J("value",s.connectionName),e.xp6(1),e.hij("",s.connectionName," ")}}function Zi(o,i){if(1&o&&(e.TgZ(0,"alert",9)(1,"strong"),e._uU(2,"Error:"),e.qZA(),e._uU(3),e.qZA()),2&o){const s=e.oxw();e.xp6(3),e.hij("",s.error," ")}}function Ri(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"div",10)(1,"div",11)(2,"span",12),e._uU(3,"Loading..."),e.qZA()(),e.TgZ(4,"i",13),e.NdJ("click",function(){e.CHM(s);const n=e.oxw();return e.KtG(n.onCancel())}),e.qZA()()}}let qi=(()=>{var o;class i{constructor(t,n,a,l,f,C){this.sqlMetaService=t,this.connectionsService=n,this.tabsService=a,this.studioService=l,this.commands=f,this.router=C,this.destroy$=new D.x,this.cancelLoading=!1,this.loading$=new D.x,this.rowData$=new Mt.X([]),this.gridConfig={columnDefs:[{field:"objectType",rowGroup:!0,hide:!0},{field:"objectName",flex:1,cellRenderer:Ei,cellClass:"group-padding"}],getContextMenuItems:this.getContextMenuItems.bind(this),overlayNoRowsTemplate:'<div class="ag-overlay-loading-center">Select connection with DB objects</div>'}}onGridReady(t){this.gridApi=t.api,this.gridApi.setHeaderHeight(0),this.gridApi.setGroupHeaderHeight(0)}onChangeConnection(){var t=this;return(0,q.Z)(function*(){if(t.currentConnection){t.loading$.next(!0),t.rowData$.next([]),t.error=void 0;try{const n=yield t.sqlMetaService.getObjects(t.currentConnection,!0);t.cancelLoading||t.rowData$.next(n)}catch(n){t.cancelLoading||(t.error=(0,ce.e$)(n))}finally{t.cancelLoading=!1,t.loading$.next(!1)}}})()}onCellClicked(t){var n=this;return(0,q.Z)(function*(){return!!t.data&&n.selectDbItem(t.data)})()}ngOnInit(){var n,a,t=this;this.connectionsService.loadMyDbConnections(),this.connectionsService.dbConnectionsList$.pipe((0,I.R)(this.destroy$)).subscribe(l=>{this.dbConnectionsList=l}),this.studioService.dbItemAdded$.subscribe(function(l){return(n=n||(0,q.Z)(function*(f){yield t.connectionsService.loadMyDbConnections(!0),yield t.onChangeConnection(),t.selectDbLink(f)})).apply(this,arguments)}),this.tabsService.activeTab$.pipe((0,I.R)(this.destroy$)).subscribe(function(l){return(a=a||(0,q.Z)(function*(f){if("sql"===f?.tabParams.appOrSql){const C=(0,Pe.jE)(f.tabParams);t.currentConnection!==C?.connectionName&&(t.currentConnection=C?.connectionName,yield t.onChangeConnection()),t.selectDbLink(C)}else t.gridApi&&t.gridApi.deselectAll()})).apply(this,arguments)})}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete()}onCancel(){this.currentConnection=void 0,this.loading$.next(!1),this.cancelLoading=!0}selectDbLink(t){this.gridApi&&(0,cn.JE)(this.gridApi,n=>n.objectName===t.objectName)}get connection(){if(this.currentConnection)return this.dbConnectionsList?.find(t=>t.connectionName===this.currentConnection)}selectDbItem(t){var n=this;return(0,q.Z)(function*(){return n.router.navigate(["data-studio","sql",n.currentConnection,(0,Pe._1)(t)])})()}getContextMenuItems(t){if(!t.node)return[];const n=t.node;if(!this.currentConnection)return[];const l={...n.data,connectionName:this.currentConnection};switch(n.data?.objectType){case Ce.HA.Procedure:return this.getProcedureMenu(n,l);case Ce.HA.Table:return this.getTableMenu(n,l);case Ce.HA.View:return this.getViewMenu(n,l);case Ce.HA.Function:return this.getFunctionMenu(n,l);default:return this.getGroupMenu(n.key)}}getProcedureMenu(t,n){var l,a=this;return[{name:"JSPython: Execute",action:()=>this.commands.spExecuteInNewJspyTab(n),icon:(0,ce.YO)("code-square")},"separator",{name:"Edit Procedure",action:()=>this.commands.editViewInNewSqlTab(n),icon:(0,ce.YO)("code")},{name:"Delete Procedure",action:function(){return(l=l||(0,q.Z)(function*(){(yield a.commands.deleteSqlProcedure(n))&&a.onDbLinkRemoved(t)})).apply(this,arguments)},icon:(0,ce.YO)("trash")}]}getTableMenu(t,n){var l,a=this;return[{name:"SQL: Select top 1000",action:()=>this.commands.addSelect1000SqlTab(n),icon:(0,ce.YO)("filetype-sql")},{name:"JSPython: Select top 1000",action:()=>this.commands.addSelect1000JspyTab(n),icon:(0,ce.YO)("code")},{name:"Create New Data Query",action:()=>this.commands.addDataQueryTabFromTableLink(n),icon:(0,ce.YO)("journal-plus")},"separator",{name:"Design Table",action:()=>this.commands.editSqlTableMetadata(n).then(f=>{f&&this.tabsService.reloadSqlTab(n)}),icon:(0,ce.YO)("table")},{name:"Delete Table",action:function(){return(l=l||(0,q.Z)(function*(){(yield a.commands.deleteSqlTable(n))&&a.onDbLinkRemoved(t)})).apply(this,arguments)},icon:(0,ce.YO)("trash")}]}onDbLinkRemoved(t){const n=t.group?t.allLeafChildren:[t];this.gridApi?.applyTransaction({remove:n.map(a=>a.data).filter(a=>!!a)}),this.tabsService.removeConnectionTab({...t.data,connectionName:this.currentConnection})}getViewMenu(t,n){var l,a=this;return[{name:"SQL: Select top 1000",action:()=>this.commands.addSelect1000SqlTab(n),icon:(0,ce.YO)("filetype-sql")},{name:"JSPython: Select top 1000",action:()=>this.commands.addSelect1000JspyTab(n),icon:(0,ce.YO)("code")},{name:"Create New Data Query",action:()=>this.commands.addDataQueryTabFromTableLink(n),icon:(0,ce.YO)("journal-plus")},"separator",{name:"Edit View",action:()=>this.commands.editViewInNewSqlTab(n),icon:(0,ce.YO)("table")},{name:"Delete View",action:function(){return(l=l||(0,q.Z)(function*(){(yield a.commands.deleteSqlView(n))&&a.onDbLinkRemoved(t)})).apply(this,arguments)},icon:(0,ce.YO)("trash")}]}getFunctionMenu(t,n){var l,a=this;return[{name:"SPython: Execute",action:()=>this.commands.spExecuteInNewJspyTab(n),icon:(0,ce.YO)("code-square")},"separator",{name:"Edit Function",action:()=>this.commands.editViewInNewSqlTab(n),icon:(0,ce.YO)("code")},{name:"Delete Function",action:function(){return(l=l||(0,q.Z)(function*(){(yield a.commands.deleteSqlFunction(n))&&a.onDbLinkRemoved(t)})).apply(this,arguments)},icon:(0,ce.YO)("trash")}]}getGroupMenu(t){if(void 0===this.currentConnection)return[];const n=this.currentConnection;switch(t){case"Table":return[{name:"Create Table",action:()=>this.commands.createNewTable(n),icon:(0,ce.YO)("table")}];case"Function":return[{name:"Create Function",action:()=>this.commands.addNewFunctionTab(this.connection),icon:(0,ce.YO)("code")}];case"Procedure":return[{name:"Create Procedure",action:()=>this.commands.addNewProcedureTab(n),icon:(0,ce.YO)("code")}];case"View":return[{name:"Create View",action:()=>this.commands.addNewViewTab(n),icon:(0,ce.YO)("table")}]}return[]}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(Kt.h),e.Y36(We.F),e.Y36(xe.x),e.Y36(ve.F),e.Y36(Je.q),e.Y36(be.F0))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-db-tree"]],decls:11,vars:14,consts:[[1,"h-100","d-flex","flex-column"],["name","connections-list",1,"form-control","form-control-sm","m-2","w-auto",3,"ngModel","change","ngModelChange"],["selected","",3,"value"],[3,"value",4,"ngFor","ngForOf"],["type","danger","class","mx-2",4,"ngIf"],["groupDisplayType","groupRows",1,"flex-fill","w-auto","mx-2","mb-2","ag-theme-balham","ws-ag-tree",3,"rowHeight","gridOptions","rowData","rowSelection","animateRows","cellClicked","gridReady"],["grid",""],["class","d-flex justify-content-center position-absolute align-items-center w-100 h-100 spinner",4,"ngIf"],[3,"value"],["type","danger",1,"mx-2"],[1,"d-flex","justify-content-center","position-absolute","align-items-center","w-100","h-100","spinner"],["role","status",1,"spinner-border"],[1,"sr-only"],["aria-hidden","true",1,"fa","fa-times","cancel-loading","position-absolute","cursor-pointer",3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"select",1),e.NdJ("change",function(){return n.onChangeConnection()})("ngModelChange",function(l){return n.currentConnection=l}),e.TgZ(2,"option",2),e._uU(3,"Select connection"),e.qZA(),e.YNc(4,ki,2,2,"option",3),e.qZA(),e.YNc(5,Zi,4,1,"alert",4),e.TgZ(6,"ag-grid-angular",5,6),e.NdJ("cellClicked",function(l){return n.onCellClicked(l)})("gridReady",function(l){return n.onGridReady(l)}),e.ALo(8,"async"),e.qZA()(),e.YNc(9,Ri,5,0,"div",7),e.ALo(10,"async")),2&t&&(e.xp6(1),e.Q6J("ngModel",n.currentConnection),e.xp6(1),e.Q6J("value",void 0),e.xp6(2),e.Q6J("ngForOf",n.dbConnectionsList),e.xp6(1),e.Q6J("ngIf",n.error),e.xp6(1),e.Q6J("rowHeight",30)("gridOptions",n.gridConfig)("rowData",e.lcZ(8,10,n.rowData$))("rowSelection","single")("animateRows",!0),e.xp6(3),e.Q6J("ngIf",e.lcZ(10,12,n.loading$)))},dependencies:[r.sg,r.O5,xt.wx,u.YN,u.Kr,u.EJ,u.JJ,u.On,Ye.N8,r.Ov],styles:[".ws-ag-tree[_ngcontent-%COMP%]     .group-padding{padding-left:2rem}"]}),i})();var Ji=d(91334),it=function(o){return o.Project="Project",o.Connection="Connection",o}(it||{});class dn{static appToFilterItem(i){return{type:it.Project,name:i.title,value:[it.Project,i.appOwner,i.appName].join("/"),selected:!1}}static connectionToFilterItem(i){return{type:it.Connection,name:i.connectionName,value:`${it.Connection}/${i.connectionType}-${i.connectionName}`,selected:!1}}}var pn=d(30641);const ji=["pop"],$i=function(o){return{selected:o}};function Qi(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"button",2,3),e.NdJ("onHidden",function(){e.CHM(s);const n=e.oxw();return e.KtG(n.onHidden())}),e._UZ(2,"i",4),e.qZA()}if(2&o){const s=e.oxw(),t=e.MAs(2);e.Q6J("ngClass",e.VKq(3,$i,null==s.selected?null:s.selected.length))("outsideClick",!1)("popover",t)}}function Li(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"div",5)(1,"div",6)(2,"div",7),e._UZ(3,"i",8),e.qZA()(),e.TgZ(4,"input",9),e.NdJ("input",function(n){e.CHM(s);const a=e.oxw();return e.KtG(a.onSearch(n))}),e.qZA()(),e.TgZ(5,"div",10)(6,"ag-grid-angular",11),e.NdJ("gridReady",function(n){e.CHM(s);const a=e.oxw();return e.KtG(a.onGridReady(n))}),e.qZA()(),e.TgZ(7,"div",12)(8,"button",13),e.NdJ("click",function(){e.CHM(s);const n=e.oxw();return e.KtG(n.onClear())}),e._uU(9,"Clear"),e.qZA(),e.TgZ(10,"button",14),e.NdJ("click",function(){e.CHM(s);const n=e.oxw();return e.KtG(n.onApply())}),e._uU(11,"Apply"),e.qZA(),e.TgZ(12,"button",13),e.NdJ("click",function(){e.CHM(s);const n=e.oxw();return e.KtG(n.onClose())}),e._uU(13,"Close"),e.qZA()()}if(2&o){const s=e.oxw();e.xp6(4),e.Q6J("value",s.search),e.xp6(2),e.Q6J("columnDefs",s.columnDefs)("defaultColDef",s.defaultColDef)("groupDefaultExpanded",-1)("rowData",s.rows)("gridOptions",s.gridOptions)}}let Bi=(()=>{var o;class i{constructor(t,n,a){this.appService=t,this.connectionsService=n,this.authService=a,this.apply=new e.vpe,this.rows=[],this.selected=[],this.search="",this.hasMultipleItems=!1,this.defaultColDef={editable:!0,sortable:!1,suppressFiltersToolPanel:!0,suppressMovable:!0,suppressColumnsToolPanel:!0,suppressMenu:!0},this.gridOptions={},this.columnDefs=[{field:"type",hide:!0,width:0,rowGroup:!0,rowGroupIndex:0},{field:"selected",headerName:"?",width:40},{field:"name",flex:1}]}onGridReady(t){this.gridApi=t.api,this.gridApi.setHeaderHeight(0)}ngOnInit(){this.setUsersLocalSearchIn(),(0,nn.a)([this.appService.appsList$,this.connectionsService.dbConnectionsList$]).subscribe(([t,n])=>{this.rows=[...t.map(dn.appToFilterItem),...n.map(dn.connectionToFilterItem)],this.updateSelectedState(),this.hasMultipleItems=this.rows.length>1})}onApply(){this.selected=this.getValue(),this.apply.emit(this.selected),this.pop?.hide(),this.storageKey&&localStorage.setItem(this.storageKey,JSON.stringify(this.selected))}onClose(){this.pop?.hide()}onClear(){this.rows.forEach(t=>t.selected=!1),this.onApply()}onHidden(){this.updateSelectedState()}onSearch(t){this.search=t?.target?.value}getValue(){return this.rows.filter(t=>t.selected).map(t=>t.value)}updateSelectedState(){this.rows.forEach(t=>{t.selected=!!this.selected?.includes(t.value)})}setUsersLocalSearchIn(){this.authService.isAuthenticated$.pipe((0,K.h)(t=>t)).subscribe(()=>{this.storageKey=`${this.authService.user?.userId}-selected-search-in`;const t=localStorage.getItem(this.storageKey);if(t)try{const n=JSON.parse(t??"");Array.isArray(n)&&n.length&&(this.selected=n,this.apply.emit(this.selected))}catch(n){console.error(`Can't parse stored search in: ${n.message}`)}})}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(me.UW),e.Y36(We.F),e.Y36(me.$h))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-data-studio-search-filter"]],viewQuery:function(t,n){if(1&t&&e.Gf(ji,5),2&t){let a;e.iGM(a=e.CRH())&&(n.pop=a.first)}},hostBindings:function(t,n){1&t&&e.NdJ("keydown.enter",function(l){return n.onApply(l)},!1,e.pYS)},inputs:{value:"value"},outputs:{apply:"apply"},decls:3,vars:1,consts:[["type","button","class","btn btn-sm","containerClass","search-filter-popover","container","body","boundariesElement","viewport","placement","bottom","title","Filter search context",3,"ngClass","outsideClick","popover","onHidden",4,"ngIf"],["filterTemplate",""],["type","button","containerClass","search-filter-popover","container","body","boundariesElement","viewport","placement","bottom","title","Filter search context",1,"btn","btn-sm",3,"ngClass","outsideClick","popover","onHidden"],["pop","bs-popover"],[1,"fa","fa-filter"],[1,"input-group","mb-1"],[1,"input-group-prepend"],[1,"input-group-text"],[1,"fa","fa-search"],["type","text","placeholder","Search",1,"form-control","form-control-sm",3,"value","input"],[2,"height","350px","max-height","350px"],["rowSelection","single","groupDisplayType","groupRows",1,"ag-theme-balham","h-100","flex-fill","w-100",3,"columnDefs","defaultColDef","groupDefaultExpanded","rowData","gridOptions","gridReady"],[1,"d-flex","mt-2","pt-2","border-top"],["type","button",1,"btn","btn-light","btn-sm",3,"click"],["type","button",1,"btn","btn-primary","btn-sm","ml-auto","mr-2",3,"click"]],template:function(t,n){1&t&&(e.YNc(0,Qi,3,5,"button",0),e.YNc(1,Li,14,6,"ng-template",null,1,e.W1O)),2&t&&e.Q6J("ngIf",n.hasMultipleItems)},dependencies:[r.mk,r.O5,pn.k5,Ye.N8],styles:[".search-filter-popover{min-width:350px}button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--color);opacity:.5}button.selected[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{opacity:1}"]}),i})();function Ui(o,i){1&o&&e._UZ(0,"i",8)}function zi(o,i){1&o&&e._UZ(0,"i",9)}const Hi=function(o){return{"font-weight-bold highlighted":o}};function Yi(o,i){if(1&o&&(e.TgZ(0,"span",10),e._uU(1),e.qZA()),2&o){const s=i.$implicit;e.Q6J("ngClass",e.VKq(2,Hi,s.isBold)),e.xp6(1),e.Oqu(s.token)}}function Gi(o,i){if(1&o&&(e.YNc(0,Ui,1,0,"i",4),e.YNc(1,zi,1,0,"i",5),e.YNc(2,Yi,2,4,"span",6),e.TgZ(3,"span",7),e._uU(4),e.qZA()),2&o){const s=i.item;e.Q6J("ngIf","Connection"===s.projectOrConnection),e.xp6(1),e.Q6J("ngIf","Project"===s.projectOrConnection),e.xp6(1),e.Q6J("ngForOf",s.tokens),e.xp6(2),e.hij(" (",s.projectOrConnectionName,")")}}let Ki=(()=>{var o;class i{constructor(t,n){this.router=t,this.appService=n,this.searchItems=[],this.searchText$=new D.x,this.loading=!1;let a="";this.searchText$.pipe((0,Ue.b)(500),(0,Jt.x)(),(0,At.b)(l=>this.loading=!0),(0,jt.w)(l=>(a=l,this.appService.searchForLinks$(l||"",this.searchIn)))).subscribe(l=>{this.searchItems=l.map(f=>({...f,projectGroup:`${f.projectOrConnection}: ${f.projectOrConnectionName}`,tokens:(0,Ji.a$)(f.name,a)})),this.loading=!1})}onSearchSelected(t){if(t)if("Connection"===t.projectOrConnection)this.router.navigate(["data-studio/sql",t.projectOrConnectionName,`${t.name}.${t.contentType}`]);else if("Project"===t.projectOrConnection){const n=t.projectOrConnectionName.split("/");this.router.navigate(["data-studio/app",n[0],n[1]],{queryParams:{file:(0,ce.nV)(t)}})}}onFilterApply(t){this.searchIn=t}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(be.F0),e.Y36(me.UW))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-data-studio-search-box"]],decls:4,vars:4,consts:[[1,"d-flex","flex-row","overflow-hidden","h-100","pb-2","w-100"],["appendTo","body",1,"auto-grow","ng-select-sm","w-100",3,"placeholder","loading","items","typeahead","change"],["ng-option-tmp",""],[3,"apply"],["class","fa fa-database mr-2",4,"ngIf"],["class","fa fa-code mr-2",4,"ngIf"],[3,"ngClass",4,"ngFor","ngForOf"],[1,"font-italic"],[1,"fa","fa-database","mr-2"],[1,"fa","fa-code","mr-2"],[3,"ngClass"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"ng-select",1),e.NdJ("change",function(l){return n.onSearchSelected(l)}),e.YNc(2,Gi,5,4,"ng-template",2),e.qZA(),e.TgZ(3,"app-data-studio-search-filter",3),e.NdJ("apply",function(l){return n.onFilterApply(l)}),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("placeholder","Search for files or sql objects")("loading",n.loading)("items",n.searchItems)("typeahead",n.searchText$))},dependencies:[r.mk,r.sg,r.O5,pt.w9,pt.ir,Bi],styles:['[_ngcontent-%COMP%]:root{--bg: #fff;--body-bg: #e4e5e6;--header-bg: #ebedef;--color: #4f5d73;--border-color: #c4c9d0;--ws-alt: #f7f7f7;--form-input-bg: #fff;--form-input-color: #768192;--nav-link-color: #8a93a2;--secondary-color: #c4c9d0;--opacity: .05;--hover: "#f0f3f5"}ng-select[_ngcontent-%COMP%]{max-width:650px}']}),i})();function Vi(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"div",18)(1,"a",19),e.NdJ("click",function(){e.CHM(s);const n=e.oxw(2);return e.KtG(n.downloadApp())}),e._uU(2,"Download App"),e.qZA(),e.TgZ(3,"a",19),e.NdJ("click",function(){e.CHM(s);const n=e.oxw(2);return e.KtG(n.uploadApp())}),e._uU(4,"Upload App"),e.qZA()()}if(2&o){const s=e.oxw(2);e.xp6(3),e.uIk("disabled",!s.app)}}function Wi(o,i){1&o&&(e.TgZ(0,"span",14)(1,"button",15),e._UZ(2,"i",16),e.qZA(),e.YNc(3,Vi,5,1,"div",17),e.qZA())}let Xi=(()=>{var o;class i{constructor(t,n,a,l,f,C){this.connectionsService=t,this.container=n,this.dataStudioService=a,this.appUploaderService=l,this.dialogService=f,this.tabsService=C,this.appContentSize=200,this.collapsed=!1}ngOnInit(){this.dataStudioService.currentApp?this.setExplorerSize():(this.appContentSize=40,this.collapsed=!0),this.dataStudioService.currentApp$.pipe((0,At.b)(t=>this.app=t),(0,K.h)(t=>!!t&&this.collapsed&&40===this.appContentSize)).subscribe(()=>this.setExplorerSize()),this.tabsService.activeTab$.subscribe(t=>{this.activateTab(t?.tabParams.appOrSql)})}refreshConnections(){this.connectionsService.loadMyDbConnections(!0)}toggleExplorer(){this.collapsed?(this.collapsed=!1,this.appContentSize=this.container.element.nativeElement.offsetHeight/2):(this.collapsed=!0,this.appContentSize=40)}toggleConnection(){this.collapsed?(this.collapsed=!1,this.appContentSize=this.container.element.nativeElement.offsetHeight/2):(this.collapsed=!0,this.appContentSize=this.container.element.nativeElement.offsetHeight-90)}downloadApp(){if(!this.appTree)throw new Error("config is not initialized");this.dialogService.open(Ai,{initialState:{app:this.app}}).onCloseAsync()}uploadApp(){var t=this;return(0,q.Z)(function*(){if(!t.app)throw new Error("app is not initialized");const n=t.dialogService.open(Mi.b,{class:"modal-sm",initialState:{message:"Uploading files from zip..."}});try{yield t.appUploaderService.uploadApp(t.app),t.appTree?.refreshAppFiles(t.app)}finally{n.close()}})()}setExplorerSize(t){this.appContentSize=t||this.container.element.nativeElement.offsetHeight/2,this.collapsed=!1}activateTab(t){this.tabset?.tabs?.length&&("app"===t?this.tabset.tabs[0].active=!0:"sql"===t&&(this.tabset.tabs[1].active=!0))}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(We.F),e.Y36(e.s_b),e.Y36(ve.F),e.Y36(It),e.Y36(Te.x),e.Y36(xe.x))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-data-studio-sidebar"]],viewQuery:function(t,n){if(1&t&&(e.Gf(un,5),e.Gf(qe.AH,7)),2&t){let a;e.iGM(a=e.CRH())&&(n.appTree=a.first),e.iGM(a=e.CRH())&&(n.tabset=a.first)}},decls:17,vars:3,consts:[[1,"d-flex","flex-column","overflow-hidden","h-100"],[1,"tabset-fx","nav-tabs-boxed","overflow-hidden","navs-bottom"],["heading","Apps",3,"removable"],[1,"card","w-100","h-100","m-0"],[1,"card-header","px-2","py-1","d-flex","cursor-pointer","justify-content-between"],[3,"click"],["dropdown","","container","body","class","d-flex position-relative px-0","placement","bottom left",4,"ngIf"],[1,"card-body","p-0","overflow-hidden"],["heading","SQL",3,"removable"],[1,"card-header","px-2","py-1","d-flex","justify-content-between","align-items-center","cursor-pointer",3,"click"],[1,"m-0"],["type","button",1,"btn","btn-primary-outline","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-refresh"],[1,"card-body","overflow-hidden","p-0"],["dropdown","","container","body","placement","bottom left",1,"d-flex","position-relative","px-0"],["dropdownToggle","","type","button",1,"px-0","btn","btn-primary-outline","py-0"],[1,"fa","fa-ellipsis-v"],["id","add-dropdown","class","dropdown-menu dropdown-menu-right","aria-labelledby","add-btn-dropdown",4,"dropdownMenu"],["id","add-dropdown","aria-labelledby","add-btn-dropdown",1,"dropdown-menu","dropdown-menu-right"],[1,"dropdown-item",3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e._UZ(1,"app-data-studio-search-box"),e.TgZ(2,"tabset",1)(3,"tab",2)(4,"div",3)(5,"div",4)(6,"app-selection",5),e.NdJ("click",function(){return n.toggleExplorer()}),e.qZA(),e.YNc(7,Wi,4,0,"span",6),e.qZA(),e._UZ(8,"app-tree",7),e.qZA()(),e.TgZ(9,"tab",8)(10,"div",3)(11,"div",9),e.NdJ("click",function(){return n.toggleConnection()}),e.TgZ(12,"h5",10),e._uU(13,"SQL Connections"),e.qZA(),e.TgZ(14,"button",11),e.NdJ("click",function(l){return n.refreshConnections(),l.stopImmediatePropagation()}),e._UZ(15,"i",12),e.qZA()(),e._UZ(16,"app-db-tree",13),e.qZA()()()()),2&t&&(e.xp6(3),e.Q6J("removable",!1),e.xp6(4),e.Q6J("ngIf",n.app),e.xp6(2),e.Q6J("removable",!1))},dependencies:[r.O5,ye.Hz,ye.Mq,ye.TO,qe.wW,qe.AH,Fi,qi,Ki,un],styles:["[_nghost-%COMP%]{height:100%;display:block}span.disabled[_ngcontent-%COMP%]{opacity:.5}.files-panel[_ngcontent-%COMP%]     .panel.card{height:100%}.files-panel[_ngcontent-%COMP%]     .panel-title .accordion-toggle>button{color:var(--color);padding-left:.5rem;text-decoration:none}.files-panel[_ngcontent-%COMP%]     .panel-body.card-block.card-body{padding:0}.files-panel[_ngcontent-%COMP%]     .panel-collapse.collapse.in.show{overflow:auto!important}.files-panel[_ngcontent-%COMP%]     app-tree{min-height:100px;display:block}.files-panel.panel-open[_ngcontent-%COMP%]{flex:1 1 auto}.files-panel[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]{margin-bottom:8px}.files-panel[_ngcontent-%COMP%]   .fa.fa-folder-o[_ngcontent-%COMP%]{margin-left:-7px;position:absolute;top:11px}.files-panel[_ngcontent-%COMP%]   .fa.fa-file-o[_ngcontent-%COMP%]{margin-left:-6px;position:absolute;top:9px}accordion[_ngcontent-%COMP%]     .accordion-toggle{display:flex}accordion[_ngcontent-%COMP%]     .panel.card{margin-bottom:1px}accordion[_ngcontent-%COMP%]     .panel-body.card-block.card-body{padding:0}.disabled[_ngcontent-%COMP%]{opacity:.7}.card-header[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{color:var(--color)}.navs-bottom[_ngcontent-%COMP%]     .nav.nav-tabs{order:1}.navs-bottom[_ngcontent-%COMP%]     .tab-content{border-radius:.25rem .25rem .25rem 0}.navs-bottom[_ngcontent-%COMP%]     .nav-tabs .nav-item{margin-top:-1px;margin-bottom:0}.navs-bottom[_ngcontent-%COMP%]     .nav-tabs .nav-item:hover .nav-link, .navs-bottom[_ngcontent-%COMP%]     .nav-tabs .nav-item.active .nav-link{border-bottom-color:var(--border-color)}.navs-bottom[_ngcontent-%COMP%]     .nav-tabs .nav-link{border-top:none;border-top-left-radius:0;border-top-right-radius:0;border-bottom-left-radius:.25rem;border-bottom-right-radius:.25rem}"]}),i})();var eo=d(92604);function to(o,i){if(1&o&&(e.TgZ(0,"span",12),e._uU(1),e.qZA()),2&o){const s=i.ngIf;e.xp6(1),e.hij(" ",s/1e3,"s\n")}}function no(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"li",15)(1,"a",16),e.NdJ("click",function(){const a=e.CHM(s).$implicit,l=e.oxw(2);return e.KtG(null==l.tabContent?null:l.tabContent.onSelectConnection(a.connectionName))}),e._uU(2),e.qZA()()}if(2&o){const s=i.$implicit;e.xp6(2),e.Oqu(s.connectionName)}}function io(o,i){if(1&o&&(e.TgZ(0,"ul",13),e.YNc(1,no,3,1,"li",14),e.qZA()),2&o){const s=e.oxw();e.xp6(1),e.Q6J("ngForOf",null==s.tabContent?null:s.tabContent.connections)}}function oo(o,i){1&o&&e._UZ(0,"span",17)}function so(o,i){if(1&o&&(e.ynx(0),e._uU(1),e.BQk()),2&o){const s=e.oxw();e.xp6(1),e.hij(" ",((null==s.tabContent||null==s.tabContent.selectedText?null:s.tabContent.selectedText.length)||0)>5?"Run Selected SQL":"Run"," ")}}let ao=(()=>{var o;class i{constructor(){this.showSearch=!1}ngOnDestroy(){this.sub?.unsubscribe()}get tabContent(){return this.currentTab?.content}toggleDirection(){this.tabContent?.toggleDirection()}onRunClick(){var t=this;return(0,q.Z)(function*(){yield t.tabContent?.onRunClick()})()}}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tab-sql-content-actions"]],inputs:{currentTab:"currentTab"},decls:13,vars:6,consts:[["class","align-self-center badge badge-info p-2 mr-2",4,"ngIf"],["title","Show/ Hide loaded data search",1,"btn","btn-sm","px-1",3,"click"],[1,"fa","fa-search"],["dropdown","",1,"btn-group"],["id","button-basic","dropdownToggle","","type","button","disabled","disabled","aria-controls","dropdown-basic",1,"btn","btn-outline-primary","btn-sm","dropdown-toggle","px-3"],[1,"caret"],["id","dropdown-basic","class","dropdown-menu","role","menu","aria-labelledby","button-basic",4,"dropdownMenu"],["type","button",1,"btn","btn-sm","btn-success","mx-2","px-3",3,"disabled","click"],["class","spinner-border",4,"ngIf"],[4,"ngIf"],["title","Switch to horizontal/vertical layout",1,"cursor-pointer","btn","btn-outline-secondary","btn-sm",3,"click"],[1,"fa",3,"ngClass"],[1,"align-self-center","badge","badge-info","p-2","mr-2"],["id","dropdown-basic","role","menu","aria-labelledby","button-basic",1,"dropdown-menu"],["role","menuitem",4,"ngFor","ngForOf"],["role","menuitem"],[1,"dropdown-item",3,"click"],[1,"spinner-border"]],template:function(t,n){1&t&&(e.YNc(0,to,2,1,"span",0),e.TgZ(1,"button",1),e.NdJ("click",function(){return n.showSearch=!n.showSearch}),e._UZ(2,"i",2),e.qZA(),e.TgZ(3,"div",3)(4,"button",4),e._uU(5),e._UZ(6,"span",5),e.qZA(),e.YNc(7,io,2,1,"ul",6),e.qZA(),e.TgZ(8,"button",7),e.NdJ("click",function(){return n.onRunClick()}),e.YNc(9,oo,1,0,"span",8),e.YNc(10,so,2,1,"ng-container",9),e.qZA(),e.TgZ(11,"button",10),e.NdJ("click",function(){return n.toggleDirection()}),e._UZ(12,"i",11),e.qZA()),2&t&&(e.Q6J("ngIf",null==n.tabContent?null:n.tabContent.evaluationTime),e.xp6(5),e.Oqu(null==n.tabContent?null:n.tabContent.selectConnection),e.xp6(3),e.Q6J("disabled",null==n.tabContent?null:n.tabContent.evaluating),e.xp6(1),e.Q6J("ngIf",null==n.tabContent?null:n.tabContent.evaluating),e.xp6(1),e.Q6J("ngIf",!(null!=n.tabContent&&n.tabContent.evaluating)),e.xp6(2),e.Q6J("ngClass","vertical"===(null==n.tabContent?null:n.tabContent.direction)?"fa-arrows-h":"fa-arrows-v"))},dependencies:[r.mk,r.sg,r.O5,ye.Hz,ye.Mq,ye.TO],styles:["ng-select[_ngcontent-%COMP%]{flex:0 1 150px}"]}),i})();function ro(o,i){if(1&o&&(e.TgZ(0,"span",5),e._uU(1),e.qZA()),2&o){const s=i.ngIf;e.xp6(1),e.hij("",s/1e3," s")}}function lo(o,i){1&o&&e._UZ(0,"span",6)}function co(o,i){if(1&o&&(e.ynx(0),e._uU(1),e.BQk()),2&o){const s=e.oxw();e.xp6(1),e.hij(" ",null!=s.tabContent&&s.tabContent.selectedText?"Run Selected SQL":"Run"," ")}}let uo=(()=>{var o;class i{constructor(){this.ConnectionLevels=Fe.EQ}get tabContent(){return this.currentTab?.content}}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tab-sql-procedure-actions"]],inputs:{currentTab:"currentTab"},decls:6,vars:4,consts:[["class","align-self-center badge badge-info p-2 mr-2",4,"ngIf"],["type","button",1,"btn","btn-sm","btn-success","mx-2","px-3",3,"disabled","click"],["class","spinner-border",4,"ngIf"],[4,"ngIf"],[1,"btn","btn-sm","btn-outline-danger","mr-0",3,"click"],[1,"align-self-center","badge","badge-info","p-2","mr-2"],[1,"spinner-border"]],template:function(t,n){1&t&&(e.YNc(0,ro,2,1,"span",0),e.TgZ(1,"button",1),e.NdJ("click",function(){return null==n.tabContent?null:n.tabContent.onRun()}),e.YNc(2,lo,1,0,"span",2),e.YNc(3,co,2,1,"ng-container",3),e.qZA(),e.TgZ(4,"button",4),e.NdJ("click",function(){return null==n.tabContent?null:n.tabContent.onDelete()}),e._uU(5,"Delete"),e.qZA()),2&t&&(e.Q6J("ngIf",null==n.tabContent?null:n.tabContent.evaluationTime),e.xp6(1),e.Q6J("disabled",null==n.tabContent?null:n.tabContent.evaluating),e.xp6(1),e.Q6J("ngIf",null==n.tabContent?null:n.tabContent.evaluating),e.xp6(1),e.Q6J("ngIf",!(null!=n.tabContent&&n.tabContent.evaluating)))},dependencies:[r.O5],styles:["ng-select[_ngcontent-%COMP%]{flex:0 1 150px}"]}),i})();var hn=d(93613);function po(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"app-data-filters",5,6),e.NdJ("filtersBarChanged",function(n){e.CHM(s);const a=e.oxw();return e.KtG(null==a.tabContent?null:a.tabContent.onFiltersBarChanged(n))}),e.qZA()}if(2&o){const s=e.oxw();e.Q6J("filtersBar",null==s.tabContent||null==s.tabContent.queryInfo?null:s.tabContent.queryInfo.filtersBar)("dataSource",null==s.tabContent?null:s.tabContent.dataSource)}}let ho=(()=>{var o;class i{constructor(){this.ConnectionLevels=Fe.EQ,this.showFiltersBar=!1,this.showSearch=!1}ngOnChanges(t){t.currentTab?.currentValue&&(this.showFiltersBar=!1,ke.z.schedule(()=>{this.showFiltersBar=!0}))}get tabContent(){return this.currentTab?.content}}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tab-data-query-actions"]],inputs:{currentTab:"currentTab"},features:[e.TTD],decls:5,vars:2,consts:[[1,"d-flex","flex-row","mx-0","align-items-center"],[1,"mr-2","ml-auto"],[3,"filtersBar","dataSource","filtersBarChanged",4,"ngIf"],[1,"btn","px-2",3,"title","click"],[1,"fa","fa-cog"],[3,"filtersBar","dataSource","filtersBarChanged"],["filtersBar",""]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e._UZ(1,"div",1),e.YNc(2,po,2,2,"app-data-filters",2),e.TgZ(3,"button",3),e.NdJ("click",function(){return null==n.tabContent?null:n.tabContent.openQueryManager()}),e._UZ(4,"i",4),e.qZA()()),2&t&&(e.xp6(2),e.Q6J("ngIf",n.showFiltersBar&&(null==n.tabContent?null:n.tabContent.dataSource)),e.xp6(1),e.s9C("title",null==n.tabContent||null==n.tabContent.queryInfo||null==n.tabContent.queryInfo.sqlQuery?null:n.tabContent.queryInfo.sqlQuery.tableName))},dependencies:[r.O5,hn.K],styles:[".fa.fa-cog[_ngcontent-%COMP%], .fa.fa-refresh[_ngcontent-%COMP%], .fa.fa-search[_ngcontent-%COMP%]{color:var(--color)}"]}),i})();function fo(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"app-data-filters",6,7),e.NdJ("filtersBarChanged",function(n){e.CHM(s);const a=e.oxw();return e.KtG(null==a.tabContent?null:a.tabContent.onFiltersBarChanged(n))}),e.qZA()}if(2&o){const s=e.oxw();e.Q6J("dataSource",null==s.tabContent?null:s.tabContent.dataSource)("filtersBar",null==s.tabContent||null==s.tabContent.queryInfo?null:s.tabContent.queryInfo.filtersBar)}}let mo=(()=>{var o;class i{constructor(){this.ConnectionLevels=Fe.EQ}get tabContent(){return this.currentTab?.content}}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-sql-table-actions"]],inputs:{currentTab:"currentTab"},decls:6,vars:2,consts:[[1,"d-flex","flex-row","mx-0","align-items-center"],["class","pl-2 d-none d-md-flex",3,"dataSource","filtersBar","filtersBarChanged",4,"ngIf"],[1,"btn","px-1",3,"click"],[1,"fa","fa-refresh"],[1,"btn","px-1","d-none","d-md-flex",3,"title","click"],[1,"fa","fa-cog"],[1,"pl-2","d-none","d-md-flex",3,"dataSource","filtersBar","filtersBarChanged"],["filtersBar",""]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.YNc(1,fo,2,2,"app-data-filters",1),e.TgZ(2,"button",2),e.NdJ("click",function(){return null==n.currentTab||null==n.currentTab.content?null:n.currentTab.content.reload()}),e._UZ(3,"i",3),e.qZA(),e.TgZ(4,"button",4),e.NdJ("click",function(){return null==n.tabContent?null:n.tabContent.openQueryManager()}),e._UZ(5,"i",5),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("ngIf",null==n.tabContent?null:n.tabContent.dataSource),e.xp6(3),e.s9C("title",null==n.tabContent||null==n.tabContent.queryInfo||null==n.tabContent.queryInfo.sqlQuery?null:n.tabContent.queryInfo.sqlQuery.tableName))},dependencies:[r.O5,hn.K],styles:[".fa.fa-cog[_ngcontent-%COMP%], .fa.fa-refresh[_ngcontent-%COMP%], .fa.fa-search[_ngcontent-%COMP%]{color:var(--color)}"]}),i})();var go=d(61240);function _o(o,i){if(1&o&&(e.TgZ(0,"span",5),e._uU(1),e.qZA()),2&o){const s=i.ngIf;e.xp6(1),e.hij("",s/1e3," s")}}function bo(o,i){1&o&&e._UZ(0,"span",6)}function yo(o,i){if(1&o&&(e.ynx(0),e._uU(1),e.BQk()),2&o){const s=e.oxw();e.xp6(1),e.hij(" ",null!=s.tabContent&&s.tabContent.selectedText?"Run Selected SQL":"Run"," ")}}let vo=(()=>{var o;class i{constructor(){this.ConnectionLevels=Fe.EQ}get tabContent(){return this.currentTab?.content}}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tab-sql-function-actions"]],inputs:{currentTab:"currentTab"},decls:6,vars:4,consts:[["class","align-self-center badge badge-info p-2 mr-2",4,"ngIf"],["type","button",1,"btn","btn-sm","btn-success","mx-2","px-3",3,"disabled","click"],["class","spinner-border",4,"ngIf"],[4,"ngIf"],[1,"btn","btn-sm","btn-outline-danger","mr-0",3,"click"],[1,"align-self-center","badge","badge-info","p-2","mr-2"],[1,"spinner-border"]],template:function(t,n){1&t&&(e.YNc(0,_o,2,1,"span",0),e.TgZ(1,"button",1),e.NdJ("click",function(){return null==n.tabContent?null:n.tabContent.onRun()}),e.YNc(2,bo,1,0,"span",2),e.YNc(3,yo,2,1,"ng-container",3),e.qZA(),e.TgZ(4,"button",4),e.NdJ("click",function(){return null==n.tabContent?null:n.tabContent.onDelete()}),e._uU(5,"Delete"),e.qZA()),2&t&&(e.Q6J("ngIf",null==n.tabContent?null:n.tabContent.evaluationTime),e.xp6(1),e.Q6J("disabled",null==n.tabContent?null:n.tabContent.evaluating),e.xp6(1),e.Q6J("ngIf",null==n.tabContent?null:n.tabContent.evaluating),e.xp6(1),e.Q6J("ngIf",!(null!=n.tabContent&&n.tabContent.evaluating)))},dependencies:[r.O5],styles:["ng-select[_ngcontent-%COMP%]{flex:0 1 150px}"]}),i})(),Co=(()=>{var o;class i{constructor(){this.previewUrl=(0,e.tdS)("")}ngOnChanges({currentTab:t}){if(t){const{appOrSql:n,file:a,name:l,owner:f}=t.currentValue.tabParams;this.previewUrl.set(`/${n}/${f}/${l}/${a}`)}}}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-dcml-actions"]],inputs:{currentTab:"currentTab"},features:[e.TTD],decls:3,vars:1,consts:[["data-toggle","buttons",1,"btn-group"],["target","_blank",1,"btn","btn-sm","btn-outline-success","button",3,"href"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"a",1),e._uU(2,"Preview"),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("href",n.previewUrl(),e.LSH))},encapsulation:2,changeDetection:0}),i})();function To(o,i){if(1&o&&e._UZ(0,"app-jspy-actions",3),2&o){const s=e.oxw();e.Q6J("currentTab",s.currentTab)}}function So(o,i){if(1&o&&e._UZ(0,"app-tab-sql-content-actions",4),2&o){const s=e.oxw();e.Q6J("currentTab",s.currentTab)}}function xo(o,i){if(1&o&&e._UZ(0,"app-tab-sql-procedure-actions",3),2&o){const s=e.oxw();e.Q6J("currentTab",s.currentTab)}}function wo(o,i){if(1&o&&e._UZ(0,"app-tab-sql-function-actions",3),2&o){const s=e.oxw();e.Q6J("currentTab",s.currentTab)}}function Ao(o,i){if(1&o&&e._UZ(0,"app-sql-table-actions",3),2&o){const s=e.oxw();e.Q6J("currentTab",s.currentTab)}}function Mo(o,i){if(1&o&&e._UZ(0,"app-sql-table-actions",3),2&o){const s=e.oxw();e.Q6J("currentTab",s.currentTab)}}function Oo(o,i){if(1&o&&e._UZ(0,"app-tab-json-content-actions",3),2&o){const s=e.oxw();e.Q6J("currentTab",s.currentTab)}}function Do(o,i){if(1&o&&e._UZ(0,"app-tab-data-query-actions",3),2&o){const s=e.oxw();e.Q6J("currentTab",s.currentTab)}}function Io(o,i){if(1&o&&e._UZ(0,"app-dcml-actions",3),2&o){const s=e.oxw();e.Q6J("currentTab",s.currentTab)}}let Fo=(()=>{var o;class i{constructor(t){this.tabsService=t}ngOnInit(){this.tabsService.activeTab$.subscribe(t=>this.currentTab=t??void 0)}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(xe.x))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tab-actions"]],decls:10,vars:10,consts:[[3,"ngSwitch"],["class","h-100 w-100 d-flex",3,"currentTab",4,"ngSwitchCase"],["class","h-100 w-100 d-flex align-items-baseline",3,"currentTab",4,"ngSwitchCase"],[1,"h-100","w-100","d-flex",3,"currentTab"],[1,"h-100","w-100","d-flex","align-items-baseline",3,"currentTab"]],template:function(t,n){1&t&&(e.ynx(0,0),e.YNc(1,To,1,1,"app-jspy-actions",1),e.YNc(2,So,1,1,"app-tab-sql-content-actions",2),e.YNc(3,xo,1,1,"app-tab-sql-procedure-actions",1),e.YNc(4,wo,1,1,"app-tab-sql-function-actions",1),e.YNc(5,Ao,1,1,"app-sql-table-actions",1),e.YNc(6,Mo,1,1,"app-sql-table-actions",1),e.YNc(7,Oo,1,1,"app-tab-json-content-actions",1),e.YNc(8,Do,1,1,"app-tab-data-query-actions",1),e.YNc(9,Io,1,1,"app-dcml-actions",1),e.BQk()),2&t&&(e.Q6J("ngSwitch",null==n.currentTab?null:n.currentTab.tabType),e.xp6(1),e.Q6J("ngSwitchCase","jspy"),e.xp6(1),e.Q6J("ngSwitchCase","sql"),e.xp6(1),e.Q6J("ngSwitchCase","procedure"),e.xp6(1),e.Q6J("ngSwitchCase","function"),e.xp6(1),e.Q6J("ngSwitchCase","table"),e.xp6(1),e.Q6J("ngSwitchCase","view"),e.xp6(1),e.Q6J("ngSwitchCase","json"),e.xp6(1),e.Q6J("ngSwitchCase","query"),e.xp6(1),e.Q6J("ngSwitchCase","dcml"))},dependencies:[r.RF,r.n9,eo.A,ao,uo,ho,mo,go.k,vo,Co]}),i})();function Eo(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"a",7),e.NdJ("click",function(){const a=e.CHM(s).$implicit,l=e.oxw(2);return e.KtG(l.onAddNewTab(a.type))}),e._UZ(1,"i",8),e._uU(2),e.qZA()}if(2&o){const s=i.$implicit;e.xp6(2),e.hij("",s.title," ")}}function No(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"a",7),e.NdJ("click",function(){const a=e.CHM(s).$implicit,l=e.oxw(2);return e.KtG(l.onTabItem(a))}),e._UZ(1,"i",9),e._uU(2),e.qZA()}if(2&o){const s=i.$implicit;e.xp6(2),e.hij("",s.label," ")}}function Po(o,i){if(1&o&&(e.TgZ(0,"div",5),e.YNc(1,Eo,3,1,"a",6),e.YNc(2,No,3,1,"a",6),e.qZA()),2&o){const s=e.oxw();e.xp6(1),e.Q6J("ngForOf",s.createFileMenuItems),e.xp6(1),e.Q6J("ngForOf",s.tabsMenuItems)}}let ko=(()=>{var o;class i{constructor(t,n,a){this.tabsService=t,this.dataStudioService=n,this.authService=a,this.FileMenuItems=[{type:"jspy",title:"Jspy Script",allowAnonymous:!0},{type:"dcml",title:"DCML File",allowAnonymous:!0},{type:"json",title:"Json File",allowAnonymous:!0},{type:"query",title:"Data Query"},{type:"sql",title:"Sql Query"}],this.createFileMenuItems=[],this.tabsMenuItems=[{label:"Close All Tabs",click:()=>this.tabsService.removeAllTabs()},{label:"Close Other Tabs",click:()=>this.tabsService.removeUnActiveTabs()}],this.authService.isAuthenticated$.subscribe(l=>this.createFileMenuItems=this.FileMenuItems.filter(f=>l||f.allowAnonymous))}newFileContent(t){return"jspy"===t?Ee.EY:"dcml"===t?Ee.Ay:"\n"}onAddNewTab(t){this.tabsService.addNewAppTab(this.dataStudioService.currentApp,t,"",this.newFileContent(t))}onTabItem(t){t.click()}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(xe.x),e.Y36(ve.F),e.Y36(me.$h))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tab-creation"]],decls:5,vars:0,consts:[["dropdown","","container","body","placement","top left",1,"d-flex","position-absolute","px-0"],["dropdownToggle","","type","button",1,"px-1","btn","btn-light","py-0"],[1,"fa","fa-plus"],[1,"fa","fa-caret-down"],["id","add-dropdown","class","dropdown-menu dropdown-menu-right","aria-labelledby","add-btn-dropdown",4,"dropdownMenu"],["id","add-dropdown","aria-labelledby","add-btn-dropdown",1,"dropdown-menu","dropdown-menu-right"],["class","dropdown-item",3,"click",4,"ngFor","ngForOf"],[1,"dropdown-item",3,"click"],[1,"bi","bi-plus","mr-1"],[1,"bi","bi-x","mr-1"]],template:function(t,n){1&t&&(e.TgZ(0,"span",0)(1,"button",1),e._UZ(2,"i",2)(3,"i",3),e.qZA(),e.YNc(4,Po,3,2,"div",4),e.qZA())},dependencies:[r.sg,ye.Hz,ye.Mq,ye.TO],encapsulation:2}),i})();function Zo(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"button",19),e.NdJ("click",function(){e.CHM(s);const n=e.oxw();return e.KtG(n.onReloadContent())}),e._UZ(1,"i",20),e.qZA()}}function Ro(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"button",21),e.NdJ("click",function(){e.CHM(s);const n=e.oxw();return e.KtG(n.onSave())}),e._uU(1,"Save"),e.qZA()}}function qo(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"button",22),e.NdJ("click",function(){e.CHM(s);const n=e.oxw();return e.KtG(n.onShare())}),e._UZ(1,"i",23),e.qZA()}}function Jo(o,i){1&o&&(e.TgZ(0,"button",24),e._UZ(1,"i",25),e.qZA())}function jo(o,i){1&o&&(e.TgZ(0,"button",26),e._UZ(1,"i",25),e.qZA())}function $o(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"li",31)(1,"a",32),e.NdJ("click",function(){e.CHM(s);const n=e.oxw().$implicit;return e.KtG(n.click(n))}),e._UZ(2,"i"),e._uU(3),e.qZA()()}if(2&o){const s=e.oxw().$implicit;e.xp6(2),e.Gre("fa ",s.icon||"fa-circle-thin"," mr-2"),e.xp6(1),e.Oqu(s.label)}}function Qo(o,i){1&o&&e._UZ(0,"li",33)}function Lo(o,i){if(1&o&&(e.ynx(0),e.YNc(1,$o,4,4,"li",29),e.YNc(2,Qo,1,0,"li",30),e.BQk()),2&o){const s=i.$implicit;e.xp6(1),e.Q6J("ngIf",!s.isDivider),e.xp6(1),e.Q6J("ngIf",s.isDivider)}}function Bo(o,i){if(1&o&&(e.TgZ(0,"ul",27),e.YNc(1,Lo,3,2,"ng-container",28),e.Hsn(2),e.qZA()),2&o){const s=e.oxw();e.xp6(1),e.Q6J("ngForOf",null==s.currentTab||null==s.currentTab.content?null:s.currentTab.content.menuItems)}}const Uo=["*"];let zo=(()=>{var o;class i{constructor(t,n,a,l,f,C,E){this.tabsService=t,this.resizeSvc=n,this.authService=a,this.sqlMetaDataService=l,this.dialogService=f,this.dataStudioService=C,this.document=E,this.menuDisabled=!1,this.layoutConfig={icon:"worksheets_logo",smIcon:"worksheets_logo",toggle:!0},this.collapsed=!1,this.destroy$=new D.x,(0,Pe.MJ)(Ie,"python",new ii(()=>this.getDataContext(),()=>this.currentTab?.content?.currentFileLinks?.filter(k=>"jspy"===k.contentType||"json"===k.contentType)?.map(k=>`/${(0,ce.nV)(k)}`)||[])),(0,Pe.MJ)(Ie,"sql",new ri(()=>this.currentTab?.content?.connectionName||this.currentTab?.content?.connection?.connectionName||"",k=>l.getObjects(k).then(P=>P.filter(ie=>ie.objectType!==Ce.HA.Procedure).map(ie=>`${ie.schemaName}.${ie.objectName}`)),(k,P)=>l.getDbTableFields(k,P).then(ie=>ie.map(ue=>ue.fieldName))))}ngOnInit(){this.resizeSvc.onResize$.subscribe(t=>{this.size=t,this.collapsed=this.size<=Vt.y.MD}),this.tabsService.activeTab$.pipe((0,I.R)(this.destroy$)).subscribe(t=>this.currentTab=t),this.authService.isAuthenticated$.pipe((0,I.R)(this.destroy$),(0,K.h)(t=>t)).subscribe(()=>this.tabsService.initStateFromLocalStorage())}onToggleSidebar(){this.collapsed=!this.collapsed}onResized(){this.document.defaultView?.dispatchEvent(new Event("resize"))}onSave(){var t=this;return(0,q.Z)(function*(){"function"==typeof t.tabsService.activeTab?.content?.save&&(yield t.tabsService.activeTab.content.save())})()}onShare(){var t=this;return(0,q.Z)(function*(){const n=t.dataStudioService.currentApp;yield t.dialogService.open(pi,{class:"modal-lg",initialState:{config:{app:{...n},tab:t.tabsService.activeTab}}}).onCloseAsync()})()}onReloadContent(){this.tabsService.activeTab.content?.reload()}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete()}getDataContext(){const t="jspy"===this.currentTab?.tabType?this.currentTab?.content:null;return{...t?.interpreter?.lastExecutionContext||t?.interpreter?.initialExecutionContext}}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(xe.x),e.Y36(Vt._),e.Y36(me.$h),e.Y36(me.hp),e.Y36(Te.x),e.Y36(ve.F),e.Y36(r.K0))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-data-studio-layout"]],ngContentSelectors:Uo,decls:23,vars:10,consts:[[3,"config","toggleSidebar"],["title","",1,"mb-0","ml-0","top-sub-header","w-md-down-50","d-none","d-md-block"],[1,"text-primary"],["header","",1,"d-flex","flex-fill","align-items-center","ml-2"],[1,"tabs-title"],[1,"ml-auto"],["class","btn btn-sm px-1 ml-2","title","Reload content",3,"click",4,"ngIf"],["type","button","class","btn btn-primary btn-sm align-self-center ml-2 px-3",3,"click",4,"ngIf"],["type","button","class","btn btn-sm align-self-center ml-2",3,"click",4,"ngIf"],["settings","",1,"d-flex"],["dropdown","","placement","top left",1,"d-flex","position-relative","px-2"],["type","button","class","px-0 btn btn-primary-outline py-0 disabled",4,"ngIf"],["dropdownToggle","","type","button","class","px-0 btn btn-primary-outline py-0",4,"ngIf"],["class","dropdown-menu left-menu","role","menu",4,"dropdownMenu"],["content","","unit","pixel","direction","horizontal",3,"useTransition","gutterSize","transitionEnd","dragEnd"],[3,"size"],["sidebar",""],[1,"position-relative"],[1,"position-absolute"],["title","Reload content",1,"btn","btn-sm","px-1","ml-2",3,"click"],[1,"fa","fa-refresh","my-0"],["type","button",1,"btn","btn-primary","btn-sm","align-self-center","ml-2","px-3",3,"click"],["type","button",1,"btn","btn-sm","align-self-center","ml-2",3,"click"],[1,"fa","fa-share-alt","my-0"],["type","button",1,"px-0","btn","btn-primary-outline","py-0","disabled"],[1,"fa","fa-ellipsis-v"],["dropdownToggle","","type","button",1,"px-0","btn","btn-primary-outline","py-0"],["role","menu",1,"dropdown-menu","left-menu"],[4,"ngFor","ngForOf"],["role","menuitem",4,"ngIf"],["class","divider dropdown-divider",4,"ngIf"],["role","menuitem"],[1,"dropdown-item","cursor-pointer",3,"click"],[1,"divider","dropdown-divider"]],template:function(t,n){1&t&&(e.F$t(),e.TgZ(0,"app-layout",0),e.NdJ("toggleSidebar",function(){return n.onToggleSidebar()}),e.TgZ(1,"h2",1),e._uU(2,"WORKSHEETS "),e.TgZ(3,"span",2),e._uU(4,"DATA STUDIO"),e.qZA()(),e.TgZ(5,"div",3)(6,"span",4),e._uU(7),e.qZA(),e._UZ(8,"app-tab-actions",5),e.YNc(9,Zo,2,0,"button",6),e.YNc(10,Ro,2,0,"button",7),e.YNc(11,qo,2,0,"button",8),e.qZA(),e.TgZ(12,"div",9)(13,"span",10),e.YNc(14,Jo,2,0,"button",11),e.YNc(15,jo,2,0,"button",12),e.YNc(16,Bo,3,1,"ul",13),e.qZA()(),e.TgZ(17,"as-split",14),e.NdJ("transitionEnd",function(){return n.onResized()})("dragEnd",function(){return n.onResized()}),e.TgZ(18,"as-split-area",15),e._UZ(19,"app-data-studio-sidebar",16),e.qZA(),e.TgZ(20,"as-split-area",17),e._UZ(21,"app-tab-creation",18)(22,"router-outlet"),e.qZA()()()),2&t&&(e.Q6J("config",n.layoutConfig),e.xp6(7),e.Oqu(null==n.currentTab?null:n.currentTab.tabHeader),e.xp6(2),e.Q6J("ngIf",null==n.currentTab||null==n.currentTab.content?null:n.currentTab.content.canReload),e.xp6(1),e.Q6J("ngIf",null==n.currentTab||null==n.currentTab.content?null:n.currentTab.content.canSave),e.xp6(1),e.Q6J("ngIf",null==n.currentTab||null==n.currentTab.content?null:n.currentTab.content.canShare),e.xp6(3),e.Q6J("ngIf",n.menuDisabled),e.xp6(1),e.Q6J("ngIf",!n.menuDisabled),e.xp6(2),e.Q6J("useTransition",!0)("gutterSize",n.collapsed?0:11),e.xp6(1),e.Q6J("size",n.collapsed?0:300))},dependencies:[r.sg,r.O5,be.lC,hi.$,$e.Mq,$e.zE,ye.Hz,ye.Mq,ye.TO,Xi,Fo,ko],styles:['.section[_ngcontent-%COMP%]{background:var(--bg)}tabset[_ngcontent-%COMP%]     .bs-remove-tab{visibility:hidden;position:relative}tabset[_ngcontent-%COMP%]     .bs-remove-tab:after{content:"\\f00d";font-family:FontAwesome;color:inherit;position:absolute;visibility:visible;right:0}tabset[_ngcontent-%COMP%]     .tab-content{position:relative}.fa.fa-refresh[_ngcontent-%COMP%], .fa.fa-share-alt[_ngcontent-%COMP%], .fa.fa-ellipsis-v[_ngcontent-%COMP%]{color:var(--color)}.tabs-title[_ngcontent-%COMP%]{font-family:Calibri;font-size:19px;font-weight:550}app-tab-creation[_ngcontent-%COMP%]{right:0;display:block;width:40px;z-index:2}']}),i})();var fn=d(13389),mt=d(88093),Et=d(13231),Oe=d(60364),Ho=d(43093),Xe=d(99796);class Nt{constructor(i,s){this.tabItem=i,this.userId=s,this.userId||console.error("TabContentStore instantiated before user is authentificated!")}get tabContentStoreKey(){return`store-${this.tabItem?.tabId}-${this.userId}`}getChanges(){const i=localStorage.getItem(this.tabContentStoreKey);if(!i)return null;try{const s=JSON.parse(i);if("object"!=typeof s||!s)throw new Error("Stored content in wrong format was removed");return s}catch(s){return this.removeChanges(),console.error(s),null}}hasChanges(){return localStorage.hasOwnProperty(this.tabContentStoreKey)}saveChanges(i){localStorage.setItem(this.tabContentStoreKey,JSON.stringify(i))}removeChanges(){localStorage.removeItem(this.tabContentStoreKey)}}const Yo=["editorEl"];let et=(()=>{var o;class i{constructor(t,n,a,l,f,C,E,k){this.dataService=t,this.tabsService=n,this.dialogService=a,this.notificationService=l,this.dataStudioService=f,this.router=C,this.authService=E,this.commandsService=k,this.destroy$=new D.x,this.isActivated=!1,this._text="loading ...",this.contentChangeSubj$=new D.x,this.initialText$=new Mt.X(null),this.tabItem={},this.appName="",this.appOwner="",this.appContent=null,this.loading=!1,this.menuItems=[],this.canSave=!1,this.selectedText="",this.menuItems.push(k.closeAllMenuItem()),this.menuItems.push(k.closeOthersMenuItem()),this.menuItems.push({isDivider:!0})}get text(){return this._text}set text(t){this._text!==t&&(this._text=t,this.contentChangeSubj$.next())}get content(){return this.text}get initialText(){return this.initialText$.getValue()}get canReload(){return!0}ngOnInit(){var t=this;return(0,q.Z)(function*(){if(!t.tabItem?.tabId)throw new Error("TabItem is not initialized");t.contentChangeSubj$.pipe((0,I.R)(t.destroy$),(0,At.b)(()=>{t.canSave=!t.initialText||t.initialText!==t.content}),(0,Ue.b)(2e3)).subscribe(()=>t.storeContentChanges()),t.tabItem.content=t,t.authService.user?.userId&&(t.tabContentStore=new Nt(t.tabItem,t.authService.user.userId),t.canSave=t.tabContentStore.hasChanges())})()}initTab(){var t=this;return(0,q.Z)(function*(){yield t.initTabContent(),t.editorEl&&t.initializeEditor(t.editorEl.nativeElement),t.text&&!t.canReload&&t.storeContentChanges()})()}initializeEditor(t){this.editor=Ie.editor.create(t,{tabSize:2,scrollBeyondLastLine:!1,value:this.text,...this.editorOptions}),this.editor.onDidChangeCursorSelection(n=>{const a=this.editor?.getSelection();if(!this.editor||!a)return void(this.selectedText="");const l=this.editor.getModel()?.getValueInRange(a);this.selectedText=l&&l!==this.selectedText?l:""}),this.editor.onDidChangeModelContent(()=>{this.text=this.editor?.getValue()||""}),this.initialText$.pipe((0,I.R)(this.destroy$),(0,Ho.Q)(ke.z),(0,K.h)(n=>null!==n)).subscribe(()=>this.editor?.setValue(this.text??""))}storeContentChanges(){if(this.canSave&&this.appContent){const t={content:this.content,contentKey:(0,Xe.nV)(this.appContent)};this.tabContentStore?.saveChanges(t)}else this.tabContentStore?.removeChanges()}deleteLocalChanges(){this.tabContentStore?.removeChanges()}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete()}resize(){this.editor?.layout()}save(){var t=this;return(0,q.Z)(function*(){const{owner:n,name:a,file:l}=t.tabItem.tabParams;try{if((0,Pe.$P)(l)){const f=(0,Xe.x2)(l);f.name=f.name.replace("(new)-","");const C=yield t.dialogService.open(Ot,{initialState:{config:{link:f,folders:[],app:t.dataStudioService.currentApp}}}).onCloseAsync();if(C){const E={appName:t.dataStudioService.currentApp.appName,ownerName:t.dataStudioService.currentApp.appOwner,fileName:(0,Xe.nV)(C),content:t.content},k=E.fileName;yield t.dataService.saveAppContent(E),t.dataStudioService.appContentAdded(E.ownerName,E.appName,E.fileName),t.tabsService.removeTab(t.tabItem),t.notificationService.success(`File '${k}' created`),t.router.navigate(["data-studio/app",E.ownerName,E.appName],{queryParams:{file:k}})}}else{const f={appName:a,ownerName:n,content:t.content,fileName:(0,Xe.nV)(t.appContent)};yield t.dataService.saveAppContent(f),t.notificationService.success("File saved"),t.canSave=!1}t.tabContentStore?.removeChanges()}catch(f){t.notificationService.error(f)}})()}reload(){var t=this;return(0,q.Z)(function*(){const{owner:n,name:a,file:l}=t.tabItem.tabParams;t.appContent=yield t.dataService.loadAppFileContent(n,a,(0,Xe.x2)(l),!0),t.tabContentStore?.removeChanges();const f=t.appContent?.content||"";t.initialText$.next(f),t.text=f})()}onReload(t){return Promise.resolve()}activated(){var t=this;return(0,q.Z)(function*(){ke.z.schedule(()=>t.resize()),t.isActivated||(t.isActivated=!0,yield t.initTab())})()}initTabContent(){var t=this;return(0,q.Z)(function*(){t.loading=!0;const{owner:n,name:a,file:l}=t.tabItem.tabParams;t.appName=a,t.appOwner=n;try{const f=t.tabContentStore?.getChanges();(0,Pe.$P)(l)?(t.text=f?.content??(t.tabsService.popContentParameter(l)||"\n"),ke.z.schedule(()=>t.resize())):f?(t.appContent=(0,Xe.x2)(t.tabItem.tabParams.file),t.text=f.content):yield t.reload(),yield t.onReload(t.appContent)}catch(f){t.notificationService.error(f)}finally{t.loading=!1}})()}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(Dt.U),e.Y36(xe.x),e.Y36(Te.x),e.Y36(Se.g),e.Y36(ve.F),e.Y36(be.F0),e.Y36(me.$h),e.Y36(Je.q))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tab-app-content"]],viewQuery:function(t,n){if(1&t&&e.Gf(Yo,5),2&t){let a;e.iGM(a=e.CRH())&&(n.editorEl=a.first)}},inputs:{tabItem:"tabItem"},decls:0,vars:0,template:function(t,n){},encapsulation:2}),i})();var Go=d(63411);function Ko(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"app-data-query",2,3),e.NdJ("gridDataModified",function(n){e.CHM(s);const a=e.oxw();return e.KtG(a.onGridDataModified(n))})("queryInfoChange",function(n){e.CHM(s);const a=e.oxw();return e.KtG(a.onQueryInfoChange(n))}),e.qZA()}if(2&o){const s=e.oxw();e.Q6J("hidden",!!s.loading)("queryInfo",s.queryInfo)}}function Vo(o,i){1&o&&(e.TgZ(0,"div",4)(1,"div",5)(2,"span",6),e._uU(3,"Loading..."),e.qZA()()())}let Wo=(()=>{var o;class i extends et{constructor(t,n,a,l,f,C,E,k){super(n,a,l,f,C,E,k,t),this.loading=!1,this.gridContext={},this.queryInfo={},this.canShare=!0,this.menuItems.push(t.exportToCsvMenuItem(()=>this.dataQuery?.dataGrid?.grid?.rowData,()=>this.tabItem.tabHeader)),this.menuItems.push(t.exportToExcelMenuItem(()=>this.dataQuery?.dataGrid?.grid,()=>this.tabItem.tabHeader)),this.menuItems.push(t.saveToDatabaseMenuItem(()=>this.dataQuery?.dataGrid?.grid?.rowData||[])),this.menuItems.push({isDivider:!0}),this.menuItems.push({label:"Clone as Data Query",icon:"fa-clone",click:()=>t.addDataQueryTabFromQuery(this.queryInfo)}),this.menuItems.push({isDivider:!0}),this.menuItems.push({label:"Generate JSPY (Sql Data Api)",click:()=>t.addSelectWithSqlDataApiJspyTab(this.queryInfo?.sqlQuery)}),this.menuItems.push({label:"Generate SQL",click:()=>t.addSelectSqlTab(this.queryInfo?.sqlQuery)}),(0,Oe.setBearerToken)(k.token),(0,Oe.setBaseUrl)(Ge.Z.worksheetsApi)}ngOnInit(){var t=()=>super.ngOnInit,n=this;return(0,q.Z)(function*(){yield t().call(n)})()}reload(){var t=()=>super.reload,n=this;return(0,q.Z)(function*(){n.queryInfo={},yield t().call(n),n.onReload()})()}onReload(){var t=this;return(0,q.Z)(function*(){t.text?.trim()?t.queryInfo=JSON.parse(t.text):(t.queryInfo=yield t.createDataQuery(),t.queryInfo?.sqlQuery&&(t.text=JSON.stringify(t.queryInfo)))})()}createDataQuery(){var t=this;return(0,q.Z)(function*(){return{sqlQuery:yield t.dialogService.open(Go._,{class:"modal-xl full-height",keyboard:!1,initialState:{config:t.queryInfo?.sqlQuery,configQueryInfo:t.queryInfo}}).onCloseAsync(),viewType:Et.bW.DataGrid}})()}save(){var t=()=>super.save,n=this;return(0,q.Z)(function*(){n.text=JSON.stringify(n.queryInfo),yield t().call(n);const{connectionName:a,tableName:l}=n.queryInfo.sqlQuery;if(!a||!l)throw new Error("connectionName || !tableName is not defined");(n.gridContext?.state?.added||n.gridContext?.state?.deleted||n.gridContext?.state?.edited)&&(yield n.commandsService.saveGridData(a,l,n.gridContext))})()}get dataSource(){return this.dataQuery?.dataSource}onFiltersBarChanged(t){if(!this.dataQuery)throw new Error("dataQuery is not initialized");this.dataQuery.onFiltersBarChanged(t)}openQueryManager(){var t=this;return(0,q.Z)(function*(){if(!t.dataQuery)throw new Error("dataQuery is not initialized");yield t.dataQuery.openQueryManager()})()}onQueryInfoChange(t){this.text=JSON.stringify(t)}onGridDataModified(t){this.gridContext=t,this.canSave=!0}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(Je.q),e.Y36(Dt.U),e.Y36(xe.x),e.Y36(Te.x),e.Y36(Se.g),e.Y36(ve.F),e.Y36(be.F0),e.Y36(me.$h))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tab-data-query"]],viewQuery:function(t,n){if(1&t&&e.Gf(mt.n,5),2&t){let a;e.iGM(a=e.CRH())&&(n.dataQuery=a.first)}},features:[e.qOj],decls:2,vars:2,consts:[["class","h-100",3,"hidden","queryInfo","gridDataModified","queryInfoChange",4,"ngIf"],["class","d-flex justify-content-center position-absolute align-items-center w-100 h-100 spinner flex-column",4,"ngIf"],[1,"h-100",3,"hidden","queryInfo","gridDataModified","queryInfoChange"],["dataQuery",""],[1,"d-flex","justify-content-center","position-absolute","align-items-center","w-100","h-100","spinner","flex-column"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(t,n){1&t&&(e.YNc(0,Ko,2,2,"app-data-query",0),e.YNc(1,Vo,4,0,"div",1)),2&t&&(e.Q6J("ngIf",null==n.queryInfo?null:n.queryInfo.sqlQuery),e.xp6(1),e.Q6J("ngIf",n.loading))},dependencies:[r.O5,mt.n],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column}app-export-menu[_ngcontent-%COMP%]{margin-bottom:-.5rem}"]}),i})();var Xo=d(81196);function es(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"app-data-query",2,3),e.NdJ("dblClick",function(n){e.CHM(s);const a=e.oxw();return e.KtG(a.onDblClick(n))})("gridDataModified",function(n){e.CHM(s);const a=e.oxw();return e.KtG(a.onGridDataModified(n))})("queryInfoChange",function(n){e.CHM(s);const a=e.oxw();return e.KtG(a.onQueryInfoChange(n))})("additionalFiltersChange",function(n){e.CHM(s);const a=e.oxw();return e.KtG(a.onAdditionalFiltersChange(n))}),e.qZA()}if(2&o){const s=e.oxw();e.Q6J("hidden",!!s.loading)("queryInfo",s.queryInfo)("reflectUrl",!0)}}function ts(o,i){1&o&&(e.TgZ(0,"div",4)(1,"div",5)(2,"span",6),e._uU(3,"Loading..."),e.qZA()()())}let ns=(()=>{var o;class i{constructor(t,n,a,l,f){this.notificationService=t,this.commandsService=a,this.filtersSerializer=l,this.zone=f,this.destroy$=new D.x,this._pubSubBus={},this.canSave=!1,this.canReload=!1,this.menuItems=[],this.loading=!1,(0,Oe.setBearerToken)(n.token),(0,Oe.setBaseUrl)(Ge.Z.worksheetsApi),this.menuItems.push(a.exportToFileMenuItem(()=>this.dataQuery?.dataGrid?.grid,()=>this.tabItem?.tabHeader)),this.menuItems.push(a.saveToDatabaseMenuItem(()=>this.dataQuery?.dataGrid?.grid?.rowData||[])),this.menuItems.push({label:"Import CSV Data",icon:"fa-cloud-upload",click:()=>a.importCsvData()}),this.menuItems.push({isDivider:!0}),this.menuItems.push({label:"Clone as Data Query",icon:"fa-clone",click:()=>a.addDataQueryTabFromQuery(this.queryInfo)}),this.menuItems.push({label:"Design Table",icon:"fa-cog",click:()=>a.editSqlTableMetadata(this.dbItemLink)}),this.menuItems.push({label:"Delete Table",icon:"fa-times",click:()=>a.deleteSqlTable(this.dbItemLink)}),this.menuItems.push({isDivider:!0}),this.menuItems.push({label:"Generate JSPY (Sql Data Api)",click:()=>a.addSelectWithSqlDataApiJspyTab(this.queryInfo?.sqlQuery,this.dataSource?.additionalFilters)}),this.menuItems.push({label:"Generate SQL",click:()=>a.addSelectSqlTab(this.queryInfo?.sqlQuery,this.dataSource?.additionalFilters)}),this.menuItems.push({isDivider:!0}),this.menuItems.push({label:"Publish / Subscribe",icon:"fa-gg",click:()=>a.openPubSubSetting(this.queryInfo).subscribe(C=>{this.queryInfo.pubSub=C,this.onQueryInfoChange(this.queryInfo)})}),this.menuItems.push({isDivider:!0}),this.menuItems.push(a.closeAllMenuItem()),this.menuItems.push(a.closeOthersMenuItem())}get dataSource(){return this.dataQuery?.dataSource}onFiltersBarChanged(t){this.dataQuery?.onFiltersBarChanged(t)}ngOnInit(){var t=this;return(0,q.Z)(function*(){if(!t.tabItem)throw new Error("this.tabItem is not initilized");t.tabItem.content=t;const n=t.tabItem.tabParams.owner,l=t.tabItem.tabParams.name.split(".");if(3===l.length){if(t.dbItemLink={connectionName:n,schemaName:l[0],objectName:l[1],objectType:"view"===l[2].toLowerCase()?Ce.HA.View:Ce.HA.Table},t.dbItemLink.objectType===Ce.HA.View){const f=t.menuItems.findIndex(E=>"Design Table"===E.label);f>=0&&t.menuItems.splice(f,1,{label:"Edit View",icon:"fa-cog",click:()=>t.commandsService.editViewInNewSqlTab(t.dbItemLink)});const C=t.menuItems.find(E=>"Delete Table"===E.label);C&&(C.label="Delete View")}}else t.notificationService.error("Incorrect URL (name)")})()}ngOnDestroy(){const t=Object.keys(this._pubSubBus);for(const n of t)this._pubSubBus[n].close(),delete this._pubSubBus[n];this.destroy$.next(null),this.destroy$.complete()}save(){var t=this;return(0,q.Z)(function*(){if(!t.queryInfo)throw new Error("this.config is not initilized");if(!t.gridContext)return void t.notificationService.error("Grid Context is not initialized");const{connectionName:n,tableName:a}=t.queryInfo.sqlQuery,l=yield t.commandsService.saveGridData(n,a,t.gridContext);t.canSave=!l})()}reload(t=!1){var n=this;return(0,q.Z)(function*(){if(!n.dataQuery)throw new Error("this.config is not initilized");return!1===t?n.dataQuery?.reload():(n.queryInfo=void 0,new Promise(a=>{ke.z.schedule((0,q.Z)(function*(){n.initializeQueryInfo(),yield n.dataQuery?.reload(),n.canSave=!1,a()}))}))})()}onDblClick(t){this.queryInfo?.pubSub?.publish?.isEnabled&&3===t.cellType&&this.publishSelectedRow(this.queryInfo.pubSub.publish.topic,t.rowData)}onQueryInfoChange(t){this.subscribeOnTopic(t.pubSub?.subscribe?.isEnabled?t.pubSub?.subscribe?.topic:void 0),this.tabItem&&this.dataQuery?.queryInfoSerializer&&(this.tabItem.queryParams={...this.tabItem.queryParams,...this.dataQuery.queryInfoSerializer.serialize(t)})}onAdditionalFiltersChange(t){this.tabItem&&this.dataQuery?.queryInfoSerializer&&(this.tabItem.queryParams={...this.tabItem.queryParams,filter:this.filtersSerializer.getQueryParam(t)})}onGridDataModified(t){this.canSave=!0,this.gridContext=t}openQueryManager(){var t=this;return(0,q.Z)(function*(){if(!t.dataQuery)throw new Error("this.config is not initilized");yield t.dataQuery.openQueryManager()})()}activated(){var t=this;return(0,q.Z)(function*(){t.queryInfo||t.initializeQueryInfo()})()}subscribeOnTopic(t){this._pubSubBus[t=`${t}`]||(this._pubSubBus[t]=new BroadcastChannel(t)),this._pubSubBus[t].onmessage=n=>{const a=this.queryInfo?.pubSub?.subscribe||{};"applyFilter"===a.action&&this.zone.run(()=>this.applyFilter(a,n.data))}}publishSelectedRow(t,n){this._pubSubBus[t=`${t}`]||(this._pubSubBus[t]=new BroadcastChannel(t)),this._pubSubBus[t].postMessage(n)}applyFilter(t,n){const a=Object.entries(t.actionParams);for(let[l,f]of a)l=Object.keys(n).find(C=>C.toLowerCase()===l.toLowerCase()),f=this.queryInfo?.sqlQuery?.fields?.find(C=>C.name.toLowerCase()===f.toLowerCase())?.name,this.dataSource&&l&&f&&this.dataSource.addAdditionalFilter({columnName:f,filterValue:[n[l]],operation:Et.OX.In})}initializeQueryInfo(){this.dbItemLink&&(this.queryInfo={sqlQuery:{connectionName:this.dbItemLink.connectionName,tableName:`${this.dbItemLink.schemaName}.${this.dbItemLink.objectName}`,tableAlias:"t",limitRowsCount:1e3},viewType:Et.bW.DataGrid},this.queryInfo?.pubSub?.subscribe?.isEnabled&&this.subscribeOnTopic(this.queryInfo.pubSub.subscribe.topic))}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(Se.g),e.Y36(me.$h),e.Y36(Je.q),e.Y36(Xo.R),e.Y36(e.R0b))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tab-db-table"]],viewQuery:function(t,n){if(1&t&&e.Gf(mt.n,5),2&t){let a;e.iGM(a=e.CRH())&&(n.dataQuery=a.first)}},inputs:{tabItem:"tabItem"},decls:2,vars:2,consts:[["class","h-100",3,"hidden","queryInfo","reflectUrl","dblClick","gridDataModified","queryInfoChange","additionalFiltersChange",4,"ngIf"],["class","d-flex justify-content-center position-absolute align-items-center w-100 h-100 spinner flex-column",4,"ngIf"],[1,"h-100",3,"hidden","queryInfo","reflectUrl","dblClick","gridDataModified","queryInfoChange","additionalFiltersChange"],["dataQuery",""],[1,"d-flex","justify-content-center","position-absolute","align-items-center","w-100","h-100","spinner","flex-column"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(t,n){1&t&&(e.YNc(0,es,2,3,"app-data-query",0),e.YNc(1,ts,4,0,"div",1)),2&t&&(e.Q6J("ngIf",n.queryInfo),e.xp6(1),e.Q6J("ngIf",n.loading))},dependencies:[r.O5,mt.n]}),i})();function is(o,i){1&o&&(e.TgZ(0,"div",4)(1,"div",5)(2,"span",6),e._uU(3,"Loading..."),e.qZA()()())}let os=(()=>{var o;class i extends et{constructor(){super(...arguments),this.editorOptions={language:"javascript"}}handleKeyboardEvent(t){this.tabsService.activeTab===this.tabItem&&t.ctrlKey&&("s"===t.key||"S"===t.key)&&(t.preventDefault(),t.stopImmediatePropagation(),this.save())}}return(o=i).\u0275fac=function(){let s;return function(n){return(s||(s=e.n5z(o)))(n||o)}}(),o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tab-js"]],hostBindings:function(t,n){1&t&&e.NdJ("keydown",function(l){return n.handleKeyboardEvent(l)},!1,e.evT)},features:[e.qOj],decls:4,vars:1,consts:[[1,"h-100","position-relative"],[1,"h-100","w-100"],["editorEl",""],["class","d-flex justify-content-center position-absolute align-items-center w-100 h-100 spinner flex-column",4,"ngIf"],[1,"d-flex","justify-content-center","position-absolute","align-items-center","w-100","h-100","spinner","flex-column"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e._UZ(1,"div",1,2),e.YNc(3,is,4,0,"div",3),e.qZA()),2&t&&(e.xp6(3),e.Q6J("ngIf",n.loading))},dependencies:[r.O5]}),i})();function ss(o,i){1&o&&(e.TgZ(0,"div",4)(1,"div",5)(2,"span",6),e._uU(3,"Loading..."),e.qZA()()())}let as=(()=>{var o;class i extends et{constructor(){super(...arguments),this.editorOptions={language:"html"}}handleKeyboardEvent(t){this.tabsService.activeTab===this.tabItem&&t.ctrlKey&&("s"===t.key||"S"===t.key)&&(t.preventDefault(),t.stopImmediatePropagation(),this.save())}}return(o=i).\u0275fac=function(){let s;return function(n){return(s||(s=e.n5z(o)))(n||o)}}(),o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tab-dcml"]],hostBindings:function(t,n){1&t&&e.NdJ("keydown",function(l){return n.handleKeyboardEvent(l)},!1,e.evT)},features:[e.qOj],decls:4,vars:1,consts:[[1,"h-100","position-relative"],[1,"h-100","w-100"],["editorEl",""],["class","d-flex justify-content-center position-absolute align-items-center w-100 h-100 spinner flex-column",4,"ngIf"],[1,"d-flex","justify-content-center","position-absolute","align-items-center","w-100","h-100","spinner","flex-column"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e._UZ(1,"div",1,2),e.YNc(3,ss,4,0,"div",3),e.qZA()),2&t&&(e.xp6(3),e.Q6J("ngIf",n.loading))},dependencies:[r.O5]}),i})();var mn=d(76662);function rs(o,i){1&o&&(e.TgZ(0,"div",4)(1,"div",5)(2,"span",6),e._uU(3,"Loading..."),e.qZA()()())}let ls=(()=>{var o;class i extends et{ngOnInit(){var t=()=>super.ngOnInit,n=this;return(0,q.Z)(function*(){yield t().call(n),n.initialText$.pipe((0,I.R)(n.destroy$),(0,K.h)(a=>null!==a)).subscribe(a=>n.contentExplorer?.reload(a))})()}initTab(){var t=()=>super.initTab,n=this;return(0,q.Z)(function*(){yield t().call(n),n.contentExplorer?.reload(n.text)})()}setJsonText(t){this.contentExplorer?.reload(t)}onTextChanged(t){this.text=t,this.contentChangeSubj$.next()}handleKeyboardEvent(t){this.tabsService.activeTab===this.tabItem&&t.ctrlKey&&("s"===t.key||"S"===t.key)&&(t.preventDefault(),t.stopImmediatePropagation(),this.save())}resize(){this.contentExplorer?.resize()}save(){var t=()=>super.save,n=this;return(0,q.Z)(function*(){n.text=n.contentExplorer?.contentEditor?.getValue()||"",yield t().call(n)})()}}return(o=i).\u0275fac=function(){let s;return function(n){return(s||(s=e.n5z(o)))(n||o)}}(),o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tab-json"]],viewQuery:function(t,n){if(1&t&&e.Gf(mn.S,5),2&t){let a;e.iGM(a=e.CRH())&&(n.contentExplorer=a.first)}},hostBindings:function(t,n){1&t&&e.NdJ("keydown",function(l){return n.handleKeyboardEvent(l)},!1,e.evT)},features:[e.qOj],decls:4,vars:2,consts:[[1,"h-100","position-relative"],[1,"h-100","w-100",3,"formatter","textChanged"],["contentExplorer",""],["class","d-flex justify-content-center position-absolute align-items-center w-100 h-100 spinner flex-column",4,"ngIf"],[1,"d-flex","justify-content-center","position-absolute","align-items-center","w-100","h-100","spinner","flex-column"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"app-content-explorer",1,2),e.NdJ("textChanged",function(l){return n.onTextChanged(l)}),e.qZA(),e.YNc(3,rs,4,0,"div",3),e.qZA()),2&t&&(e.xp6(1),e.Q6J("formatter",!0),e.xp6(2),e.Q6J("ngIf",n.loading))},dependencies:[r.O5,mn.S]}),i})();var gn=d(50834),cs=d(25482);function us(o,i){1&o&&(e.TgZ(0,"div",4)(1,"div",5)(2,"span",6),e._uU(3,"Loading..."),e.qZA()()())}let ds=(()=>{var o;class i extends et{constructor(){super(...arguments),this.currentFileLinks=[],this.canShare=!0}ngOnInit(){var t=()=>super.ngOnInit,n=this;return(0,q.Z)(function*(){var a;yield t().call(n),n.menuItems.push({label:"Toggle Direction",click:()=>n.contentEditor?.toggleDirection()}),n.contentEditor?.setSettings({entryModule:n.tabItem?.tabParams?.file,moduleLoader:function(f){return(a=a||(0,q.Z)(function*(C){return yield n.jspyModuleLoader(C)})).apply(this,arguments)},settingsKey:`jspy-editor-${n.appOwner}-${n.appName}-${n.appContent?.name}`}),n.initialText$.pipe((0,I.R)(n.destroy$),(0,K.h)(l=>null!==l)).subscribe(l=>n.contentEditor?.reload(l))})()}get interpreter(){return this.contentEditor?.interpreter}initTab(){var t=()=>super.initTab,n=this;return(0,q.Z)(function*(){yield t().call(n),n.appOwner&&n.appName&&(n.linksSubscription=n.dataService.getAppFileLinks$(n.appOwner,n.appName).subscribe(a=>n.currentFileLinks=a)),n.contentEditor?.reload(n.text)})()}ngOnDestroy(){var t=()=>super.ngOnDestroy,n=this;return(0,q.Z)(function*(){n.linksSubscription&&n.linksSubscription.unsubscribe(),yield t().call(n)})()}handleKeyboardEvent(t){this.tabsService.activeTab===this.tabItem&&t.ctrlKey&&("s"===t.key||"S"===t.key)&&(t.preventDefault(),t.stopImmediatePropagation(),this.save())}scheduleRun(t){var n=this;return(0,q.Z)(function*(){yield n.dialogService.open(cs.s,{class:"modal-w-45",initialState:{config:{taskId:0,name:n.appContent?.name??"Content",appName:`${n.appOwner}/${n.appName}`,jspyFilePath:`${n.appContent?.name}.${n.appContent?.contentType}`,functionName:t,scheduleTime:"10:00",scheduleDays:"*",isEnabled:!0,notifyOn:0}}}).onCloseAsync()})()}resize(){super.resize(),ke.z.schedule(()=>{this.contentEditor?.resize()})}onTextChanged(t){this.text=t,this.contentChangeSubj$.next()}jspyModuleLoader(t){var n=this;return(0,q.Z)(function*(){return t.startsWith("./")&&(t=t.substring(2)),t.startsWith("/")&&(t=t.substring(1)),(yield n.dataService.loadAppFileContent(n.appOwner,n.appName,(0,ce.x2)(t))).content||""})()}}return(o=i).\u0275fac=function(){let s;return function(n){return(s||(s=e.n5z(o)))(n||o)}}(),o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tab-jspy"]],viewQuery:function(t,n){if(1&t&&e.Gf(gn.N,7),2&t){let a;e.iGM(a=e.CRH())&&(n.contentEditor=a.first)}},hostBindings:function(t,n){1&t&&e.NdJ("keydown",function(l){return n.handleKeyboardEvent(l)},!1,e.evT)},features:[e.qOj],decls:4,vars:1,consts:[[1,"d-flex","h-100","flex-column"],[1,"h-100","w-100",3,"textChanged"],["contentEditor",""],["class","d-flex justify-content-center position-absolute align-items-center w-100 h-100 spinner flex-column",4,"ngIf"],[1,"d-flex","justify-content-center","position-absolute","align-items-center","w-100","h-100","spinner","flex-column"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"app-jspy-content-editor",1,2),e.NdJ("textChanged",function(l){return n.onTextChanged(l)}),e.qZA(),e.YNc(3,us,4,0,"div",3),e.qZA()),2&t&&(e.xp6(3),e.Q6J("ngIf",n.loading))},dependencies:[r.O5,gn.N],styles:[".help-toggle[_ngcontent-%COMP%]{top:5px;right:13px;z-index:1}"]}),i})();var ps=d(41614),tt=d(6015),hs=d(38325),gt=d(3202),fs=d(30160);class Pt extends fs.T{constructor(){super()}getData(i){return(0,q.Z)(function*(){const s=i;try{const t=yield(0,Oe.sqlDataApi)(s.connectionName).sqlExecuteRaw(s.sql,s.sqlParams,s.sqlParamDirections);if(!t?.table)throw new Error("Table is not arrived from sqlExecuteRaw");return{message:t.message,items:(0,gt.fromTable)(t.table),outputParameters:t.outputParameters,fields:t.table.fieldNames.map((n,a)=>({name:n,dataType:t.table?.fieldDataTypes?t.table.fieldDataTypes[a]:hs.DataTypeName.String}))}}catch(t){return{errorMessage:(0,ce.e$)(t)}}})()}}var ms=d(18937);let gs=(()=>{var o;class i extends et{get text(){return super.text}set text(t){const n=this.getConnection(t);let a=!1;n&&(a=this.connectionName!==n,this.connectionName=n,t=this.getSqlCode(t)),a&&t===this.text&&this.contentChangeSubj$.next(),super.text=t}get content(){return`-- Connection: ${this.connectionName}\n${super.text}`}get selectConnection(){return this.connections?.map(t=>t.connectionName).includes(this.connectionName)?this.connectionName:"Select connection"}handleKeyboardEvent(t){this.tabsService.activeTab===this.tabItem&&("F5"===t.key||t.ctrlKey&&"Enter"===t.key)&&(t.preventDefault(),t.stopImmediatePropagation(),this.onRunClick())}constructor(t,n,a,l,f,C,E,k,P){super(t,n,l,f,C,E,P,a),this.connectionsService=k,this.connections=[],this.connectionName="",this.direction=Ve.Ar.horizontal,this.sqlDataSource=new Pt,this.isReadOnly=!1,this.evaluationTime=0,this.evaluating=!1,this.editorOptions={language:"sql",readOnly:this.isReadOnly},(0,Oe.setBearerToken)(P.token),(0,Oe.setBaseUrl)(Ge.Z.worksheetsApi),this.menuItems.push(a.exportToCsvMenuItem(()=>this.dataGrid?.grid?.rowData||[],()=>this.tabItem?.tabHeader)),this.menuItems.push(a.exportToExcelMenuItem(()=>this.dataGrid?.grid,()=>this.tabItem.tabHeader)),this.menuItems.push(a.saveToDatabaseMenuItem(()=>this.dataGrid?.grid?.rowData||[]))}onRunClick(){var t=this;return(0,q.Z)(function*(){const n=t.selectedText||t.editor?.getValue();t.evaluating=!0;const a=(new Date).getTime();n&&(yield t.sqlDataSource.reload({connectionName:t.connectionName,sql:n})),t.evaluationTime=+new Date-a,t.evaluating=!1})()}ngOnInit(){var t=()=>super.ngOnInit,n=this;return(0,q.Z)(function*(){var a;n.connectionsService.dbConnectionsList$.pipe((0,I.R)(n.destroy$),(0,K.h)(l=>!!l.length)).subscribe(function(l){return(a=a||(0,q.Z)(function*(f){n.connections=f,yield t().call(n),n.resize()})).apply(this,arguments)})})()}onSelectConnection(t){this.connectionName=t,this.canSave=!0,this.contentChangeSubj$.next()}toggleDirection(){this.direction=this.direction===Ve.Ar.vertical?Ve.Ar.horizontal:Ve.Ar.vertical,this.resize()}resize(){ps.Z.schedule(()=>{this.editor?.layout()})}getSqlCode(t){return(t=t.trimStart()).substring(t.indexOf("\n")+1)}getConnection(t){if(!t)return"";const a=t.split("\n")[0].match(/--\sConnection:\s(.*)/);return a&&a[1]}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(me.UW),e.Y36(xe.x),e.Y36(Je.q),e.Y36(Te.x),e.Y36(Se.g),e.Y36(ve.F),e.Y36(be.F0),e.Y36(We.F),e.Y36(me.$h))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tab-sql"]],viewQuery:function(t,n){if(1&t&&e.Gf(tt.Z,7),2&t){let a;e.iGM(a=e.CRH())&&(n.dataGrid=a.first)}},hostBindings:function(t,n){1&t&&e.NdJ("keydown",function(l){return n.handleKeyboardEvent(l)},!1,e.evT)},features:[e.qOj],decls:12,vars:2,consts:[[1,"h-100","overflow-hidden",3,"direction","resized"],["left","",1,"w-100","overflow-hidden"],["editorEl",""],["right",""],[3,"dataSource"],["dataGrid",""],["left-label",""],[1,"fa","fa-cogs","fa-lg","mr-2"],["right-label",""],[1,"fa","fa-table","fa-lg","mr-2"]],template:function(t,n){1&t&&(e.TgZ(0,"app-split-content",0),e.NdJ("resized",function(){return null==n.editor?null:n.editor.layout()}),e._UZ(1,"div",1,2),e.ynx(3,3),e._UZ(4,"app-ag-data-grid",4,5),e.BQk(),e.ynx(6,6),e._UZ(7,"i",7),e._uU(8," SQL 1 "),e.BQk(),e.ynx(9,8),e._UZ(10,"i",9),e._uU(11," Data "),e.BQk(),e.qZA()),2&t&&(e.Q6J("direction",n.direction),e.xp6(4),e.Q6J("dataSource",n.sqlDataSource))},dependencies:[tt.Z,ms.Y],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column}app-export-menu[_ngcontent-%COMP%]{margin-bottom:-.5rem}"]}),i})();var _t=d(37282),_n=d(94246);const _s=["sqlEditor"];function bs(o,i){1&o&&(e.TgZ(0,"div",27)(1,"div",28)(2,"span",29),e._uU(3,"Loading..."),e.qZA()()())}let bn=(()=>{var o;class i{constructor(t,n,a,l,f){this.notificationService=t,this.dialogService=n,this.sqlMetaDataService=a,this.route=l,this.router=f,this.procedureChanged=new e.vpe,this.isChanged=!1,this.codeContentSize=50,this.parametersSize=30,this.modeState={code:!0,result:!0,parameters:!0},this.loading=!1,this.selectedText="",this.ConnectionLevels=Fe.EQ,this.paramRows=[],this.sqlEditor={},this.destroy$=new D.x,this.editorChange$=new D.x,this.defaultColDef={editable:!0,sortable:!1,suppressFiltersToolPanel:!0,suppressMovable:!0,suppressColumnsToolPanel:!0,suppressMenu:!0},this.gridOptions={},this.columnDefs=[{field:"name",width:200},{field:"value",minWidth:50},{field:"dataType",width:80},{field:"direction"},{field:"isNullable"}],this.dataSource=new Pt,this.dataSource.data$.pipe((0,I.R)(this.destroy$),(0,K.h)(C=>!!C?.outputParameters)).subscribe(C=>{const E=Object.keys(C?.outputParameters);for(const k of E){const P=this.paramRows.find(ie=>ie.name.toLowerCase()===`@${k.toLowerCase()}`);P&&(P.value=(C?.outputParameters||{})[k])}})}ngOnInit(){if(!this.sqlElement)throw new Error("sqlElement is not initialized");if(!this.dataObject)throw new Error("dataObject is not initialized");this.sqlEditor=Ie.editor.create(this.sqlElement.nativeElement,{language:"sql",value:this.dataObject.sqlText||"",tabSize:2,scrollBeyondLastLine:!1,readOnly:(this.connection?.codeAccessLevel||0)<Fe.EQ.SqlExecute}),this.sqlEditor.onDidChangeCursorSelection(n=>{const a=this.sqlEditor?.getModel()?.getValueInRange(this.sqlEditor?.getSelection());a!==this.selectedText&&(this.selectedText=a||"")}),this.sqlEditor.onDidChangeModelContent(()=>{this.editorChange$.next(null)}),this.editorChange$.pipe((0,I.R)(this.destroy$),(0,Ue.b)(200)).subscribe(()=>{const n=this.sqlEditor.getValue();this.isChanged=this.dataObject?.sqlText!==n;const a=this.isChanged?{structure:{...this.dataObject,sqlText:n},connection:this.connection}:null;this.procedureChanged.emit(a)}),ke.z.schedule(()=>{this.resize()})}onGridReady(t){this.gridApi=t.api;const n=this.route.snapshot.queryParams;this.paramRows=(this.dataObject?.parameters||[]).map(a=>({name:a.parameterName,direction:a.parameterDirection,value:n.hasOwnProperty(a.parameterName)?n[a.parameterName]:null,isNullable:a.isNullable,dataType:a.dataType}))}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete()}ngOnChanges({dataObject:t}){t.firstChange||(this.isChanged=!1)}onRun(){var t=this;return(0,q.Z)(function*(){t.loading=!0;const n=t.paramRows.filter(l=>null!=l.value).reduce((l,f)=>(l[f.name.replace("@","")]=function ys(o,i){return!i||(i=i.toLowerCase()).indexOf("char")>=0?o:i.indexOf("date")>=0?(0,gt.parseDatetimeOrNull)(o):i.indexOf("int")>=0||i.indexOf("float")>=0||i.indexOf("double")>=0||i.indexOf("money")>=0||i.indexOf("numeric")>=0?(0,gt.parseNumberOrNull)(o):o}(f.value,f.dataType),l),{}),a=t.paramRows.filter(l=>null!=l.value).reduce((l,f)=>(l[f.name.replace("@","")]=f.direction,l),{});try{t.selectedText?yield t.dataSource.reload({connectionName:t.connection?.connectionName||"",sql:t.selectedText}):yield t.dataSource.reload({commandType:"StoredProcedure",connectionName:t.connection?.connectionName,sqlParams:n,sqlParamDirections:a,sql:`${t.dataObject?.schemaName}.${t.dataObject?.objectName}`}),t.syncQueryParams()}catch(l){t.notificationService.error(l)}finally{t.loading=!1}})()}syncQueryParams(){const t=this.paramRows.filter(n=>null!==n.value).reduce((n,a)=>(n[a.name]=a.value,n),{});this.router.navigate([],{relativeTo:this.route,queryParams:t})}onSave(){var t=this;return(0,q.Z)(function*(){if(!t.dataObject)throw new Error("dataObject is not initialized");const n=t.sqlEditor.getValue();if(!t.connection)throw new Error("Connection is not initialized");return yield t.sqlMetaDataService.saveDbObject(t.connection.connectionName,{...t.dataObject,sqlText:n})})()}onDelete(){var t=this;return(0,q.Z)(function*(){if(!t.connection)throw new Error("Connection is not initialized");yield t.sqlMetaDataService.deleteObject(t.connection.connectionName,t.dataObject)})()}onModeState(){const t=this.modeState.parameters||this.modeState.result;this.codeContentSize=this.modeState.code&&!t?100:this.modeState.code&&t?50:0,this.parametersSize=this.modeState.parameters&&!this.modeState.result?100:this.modeState.parameters&&this.modeState.result?30:0}resize(){this.sqlEditor?.layout()}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(Se.g),e.Y36(Te.x),e.Y36(me.hp),e.Y36(be.gz),e.Y36(be.F0))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-db-procedure"]],viewQuery:function(t,n){if(1&t&&(e.Gf(_s,7),e.Gf(tt.Z,7)),2&t){let a;e.iGM(a=e.CRH())&&(n.sqlElement=a.first),e.iGM(a=e.CRH())&&(n.dataGrid=a.first)}},inputs:{dataObject:"dataObject",connection:"connection"},outputs:{procedureChanged:"procedureChanged"},features:[e.TTD],decls:34,vars:27,consts:[[1,"card","overflow-hidden","mb-0","w-100","h-100"],[1,"card-body","d-flex","p-0","flex-column","h-100","position-relative"],[3,"useTransition","gutterSize","dragEnd","transitionEnd"],[1,"d-flex","mb-0","position-relative",3,"size"],["area0","asSplitArea"],["left","",1,"h-100","overflow-hidden","w-100"],["sqlEditor",""],[1,"d-flex","overflow-auto","flex-column","explorer-section",3,"size"],["area1","asSplitArea"],["direction","vertical",3,"hidden","restrictMove","useTransition","gutterSize"],[3,"size"],[1,"d-flex","flex-column","p-2","h-100"],[1,"mb-2"],["rowSelection","single",1,"ag-theme-balham","h-100","w-100",3,"columnDefs","defaultColDef","rowData","gridOptions","gridReady"],[1,"d-flex","flex-column","p-2","h-100","h-100","overflow-hidden"],[1,"d-flex","flex-row"],[1,"ml-auto",3,"grid","saveToTable"],[1,"h-100","overflow-hidden",3,"dataSource"],["dataGrid",""],["class","d-flex justify-content-center align-items-center w-100 h-100 spinner flex-column",4,"ngIf"],[1,"btn-group","d-block","mode"],["ngDefaultControl","","btnCheckbox","","tabindex","0","role","button","name","mode-code","title","SQL Procedure panel",1,"btn","btn-secondary","btn-sm","cursor-pointer","mb-0",3,"ngModel","ngModelChange","click"],[1,"fa","fa-code","fa-lg","mr-2"],["ngDefaultControl","","btnCheckbox","","tabindex","0","role","button","name","mode-result","title","Result panel",1,"btn","btn-secondary","btn-sm","cursor-pointer","mb-0",3,"ngModel","ngModelChange","click"],[1,"fa","fa-table","fa-lg","mr-2"],["ngDefaultControl","","btnCheckbox","","tabindex","0","role","button","name","mode-parameters",1,"btn","btn-secondary","btn-sm","cursor-pointer","mb-0",3,"ngModel","ngModelChange","click"],[1,"fa","fa-check","fa-lg","mr-2"],[1,"d-flex","justify-content-center","align-items-center","w-100","h-100","spinner","flex-column"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(t,n){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"as-split",2),e.NdJ("dragEnd",function(){return n.resize()})("transitionEnd",function(){return n.resize()}),e.TgZ(3,"as-split-area",3,4),e._UZ(5,"div",5,6),e.qZA(),e.TgZ(7,"as-split-area",7,8)(9,"as-split",9)(10,"as-split-area",10)(11,"div",11)(12,"h4",12),e._uU(13,"Parameters"),e.qZA(),e.TgZ(14,"ag-grid-angular",13),e.NdJ("gridReady",function(l){return n.onGridReady(l)}),e.qZA()()(),e.TgZ(15,"as-split-area",10)(16,"div",14)(17,"div",15)(18,"h4",12),e._uU(19,"Results"),e.qZA(),e._UZ(20,"app-export-menu",16),e.qZA(),e._UZ(21,"app-ag-data-grid",17,18),e.qZA()()(),e.YNc(23,bs,4,0,"div",19),e.qZA()()()(),e.TgZ(24,"div",20)(25,"label",21),e.NdJ("ngModelChange",function(l){return n.modeState.code=l})("click",function(){return n.onModeState()}),e._UZ(26,"i",22),e._uU(27," SQL Procedure "),e.qZA(),e.TgZ(28,"label",23),e.NdJ("ngModelChange",function(l){return n.modeState.result=l})("click",function(){return n.onModeState()}),e._UZ(29,"i",24),e._uU(30," Results "),e.qZA(),e.TgZ(31,"label",25),e.NdJ("ngModelChange",function(l){return n.modeState.parameters=l})("click",function(){return n.onModeState()}),e._UZ(32,"i",26),e._uU(33," Parameters "),e.qZA()()),2&t){const a=e.MAs(22);e.xp6(2),e.Q6J("useTransition",!0)("gutterSize",50===n.codeContentSize?11:0),e.xp6(1),e.Q6J("size",n.codeContentSize),e.xp6(4),e.Q6J("size",100-n.codeContentSize),e.xp6(2),e.Q6J("hidden",n.loading)("restrictMove",!0)("useTransition",!0)("gutterSize",30===n.parametersSize?11:0),e.xp6(1),e.Q6J("size",n.parametersSize),e.xp6(4),e.Q6J("columnDefs",n.columnDefs)("defaultColDef",n.defaultColDef)("rowData",n.paramRows)("gridOptions",n.gridOptions),e.xp6(1),e.Q6J("size",100-n.parametersSize),e.xp6(5),e.Q6J("grid",a.grid)("saveToTable",!0),e.xp6(1),e.Q6J("dataSource",n.dataSource),e.xp6(2),e.Q6J("ngIf",n.loading),e.xp6(2),e.ekj("active",n.modeState.code),e.Q6J("ngModel",n.modeState.code),e.xp6(3),e.ekj("active",n.modeState.result),e.Q6J("ngModel",n.modeState.result),e.xp6(3),e.ekj("active",n.modeState.parameters),e.Q6J("ngModel",n.modeState.parameters)}},dependencies:[r.O5,u.Fj,u.JJ,u.On,$e.Mq,$e.zE,_t.DF,tt.Z,_n.U,Ye.N8],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}"]}),i})();function vs(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"app-db-procedure",2),e.NdJ("procedureChanged",function(n){e.CHM(s);const a=e.oxw();return e.KtG(a.onChange(n))})("procedureDeleted",function(){e.CHM(s);const n=e.oxw();return e.KtG(n.onDelete())}),e.qZA()}if(2&o){const s=e.oxw();e.Q6J("dataObject",s.dataObject)("connection",s.connection)}}function Cs(o,i){1&o&&(e.TgZ(0,"div",3)(1,"div",4)(2,"span",5),e._uU(3,"Loading..."),e.qZA()()())}let Ts=(()=>{var o;class i{constructor(t,n,a,l,f,C){this.notificationService=t,this.sqlMetaDataService=n,this.tabsService=a,this.authService=l,this.dbConnectionService=C,this.destroy$=new D.x,this.dataObject={},this.loading=!1,this.connections=[],this.evaluationTime=0,this.evaluating=!1,this.isActivated=!1,this.canSave=!1,this.canReload=!0,this.menuItems=[],(0,Oe.setBearerToken)(l.token),(0,Oe.setBaseUrl)(Ge.Z.worksheetsApi),this.menuItems.push(f.exportToCsvMenuItem(()=>this.procedureComponent?.dataGrid?.grid?.rowData||[],()=>this.tabItem?.tabHeader||"")),this.menuItems.push(f.exportToExcelMenuItem(()=>this.procedureComponent?.dataGrid?.grid,()=>this.tabItem?.tabHeader)),this.menuItems.push(f.saveToDatabaseMenuItem(()=>this.procedureComponent?.dataGrid?.grid?.rowData||[])),this.menuItems.push({isDivider:!0}),this.menuItems.push(f.closeAllMenuItem()),this.menuItems.push(f.closeOthersMenuItem())}save(){var t=this;return(0,q.Z)(function*(){if(!t.procedureComponent)throw Error("Component is not initialized");try{const n=yield t.procedureComponent.onSave();t.canSave=!1,t.notificationService.success(`Procedure ${n.schemaName}.${n.objectName} saved`),t.tabStore?.removeChanges()}catch(n){t.notificationService.error(n)}})()}get selectedText(){return this.procedureComponent?.selectedText||""}activated(){var t=this;return(0,q.Z)(function*(){t.isActivated||(t.isActivated=!0,t.dbConnectionService.dbConnectionsList$.pipe((0,I.R)(t.destroy$),(0,K.h)(n=>!!n.length)).subscribe(n=>{t.connections=n,t.initTab()})),t.procedureComponent?.syncQueryParams()})()}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete()}ngOnInit(){var t=this;return(0,q.Z)(function*(){if(!t.tabItem)throw new Error("tabItem is not initialized");t.tabItem.content=t,t.authService.isAuthenticated$.pipe((0,I.R)(t.destroy$),(0,K.h)(n=>n)).subscribe(()=>{const n=t.authService.user?.userId;t.tabStore=new Nt(t.tabItem,n),t.canSave=t.tabStore.hasChanges()})})()}initTab(){var t=this;return(0,q.Z)(function*(){const n=t.tabStore?.getChanges();if(n){const a=t.tabItem?.tabParams.owner;t.connection=t.connections.find(l=>l.connectionName===a),t.dataObject=n,t.canSave=!0,t.canReload=!0}else t.reload()})()}reload(){var t=this;return(0,q.Z)(function*(){if(!t.tabItem)throw new Error("tabItem is not initialized");const n=t.tabItem.tabParams.owner,a=(t.tabItem.tabParams.name||"").split(".");t.loading=!0;const l=n,f=a[0],C=a[1];try{t.connection=t.connections.find(E=>E.connectionName===l),t.dataObject=yield t.sqlMetaDataService.getMetaDataObject(l,f,C,Ce.HA.Procedure),t.canSave=!1,t.tabStore?.removeChanges()}catch{t.notificationService.error(`Failed to load meta data ${f}.${C}`)}finally{t.loading=!1}})()}handleKeyboardEvent(t){this.tabsService.activeTab===this.tabItem&&("F5"===t.key||t.ctrlKey&&"Enter"===t.key)&&(t.preventDefault(),t.stopImmediatePropagation(),this.onRun())}onRun(){var t=this;return(0,q.Z)(function*(){if(!t.procedureComponent)throw new Error("procedureComponent is not initialized");t.canSave&&!t.selectedText&&(yield t.notificationService.confirmation("Do you want to save latest changes, before 'Run'?"))&&(yield t.save()),t.evaluating=!0;const n=(new Date).getTime();yield t.procedureComponent.onRun(),t.evaluationTime=+new Date-n,t.evaluating=!1})()}onDelete(){var t=this;return(0,q.Z)(function*(){if(!t.procedureComponent)throw new Error("procedureComponent is not initialized");if(yield t.notificationService.confirmation("Are you sure you want to delete this Stored Procedure?"))try{yield t.procedureComponent.onDelete();const{objectName:n,schemaName:a}=t.dataObject;t.notificationService.success(`Procedure '${a}.${n}'' deleted`)}catch(n){t.notificationService.error(n)}})()}onChange({structure:t}){var n=this;return(0,q.Z)(function*(){n.tabStore?.saveChanges(t),n.canSave=!0})()}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(Se.g),e.Y36(me.hp),e.Y36(xe.x),e.Y36(me.$h),e.Y36(Je.q),e.Y36(We.F))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tab-procedure"]],viewQuery:function(t,n){if(1&t&&e.Gf(bn,5),2&t){let a;e.iGM(a=e.CRH())&&(n.procedureComponent=a.first)}},hostBindings:function(t,n){1&t&&e.NdJ("keydown",function(l){return n.handleKeyboardEvent(l)},!1,e.evT)},inputs:{tabItem:"tabItem"},decls:2,vars:2,consts:[[3,"dataObject","connection","procedureChanged","procedureDeleted",4,"ngIf"],["class","d-flex justify-content-center position-absolute align-items-center w-100 h-100 spinner flex-column",4,"ngIf"],[3,"dataObject","connection","procedureChanged","procedureDeleted"],[1,"d-flex","justify-content-center","position-absolute","align-items-center","w-100","h-100","spinner","flex-column"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(t,n){1&t&&(e.YNc(0,vs,1,2,"app-db-procedure",0),e.YNc(1,Cs,4,0,"div",1)),2&t&&(e.Q6J("ngIf",!n.loading&&n.dataObject&&n.connection),e.xp6(1),e.Q6J("ngIf",n.loading))},dependencies:[r.O5,bn]}),i})();const Ss=function(o,i){return["/data-studio","app",o,i]},xs=function(o){return{file:o}};function ws(o,i){if(1&o&&(e.TgZ(0,"div",8),e._UZ(1,"i"),e.TgZ(2,"a",9),e._uU(3),e.qZA()()),2&o){const s=i.$implicit,t=e.oxw(2);e.xp6(1),e.Gre("ml-3 fa ",t.getIcon(s.contentType),""),e.xp6(1),e.Q6J("routerLink",e.WLB(6,Ss,null==t.currentApp?null:t.currentApp.appOwner,null==t.currentApp?null:t.currentApp.appName))("queryParams",e.VKq(9,xs,t.fromPathFile(s))),e.xp6(1),e.Oqu(t.fromPathFile(s).replace("/"," / "))}}function As(o,i){if(1&o&&(e.TgZ(0,"div",5)(1,"h2",6),e._uU(2),e.qZA(),e.YNc(3,ws,4,11,"div",7),e.qZA()),2&o){const s=e.oxw();e.xp6(2),e.AsE("",null==s.currentApp?null:s.currentApp.appOwner," / ",null==s.currentApp?null:s.currentApp.appName,""),e.xp6(1),e.Q6J("ngForOf",s.links)}}let Ms=(()=>{var o;class i{constructor(t,n){this.studioService=t,this.appService=n,this.destroy$=new D.x,this.currentApp=null,this.links=null}ngOnInit(){var t=this;return(0,q.Z)(function*(){var n;t.studioService.currentApp$.pipe((0,I.R)(t.destroy$)).subscribe(function(a){return(n=n||(0,q.Z)(function*(l){return yield t.onAppChanged(l)})).apply(this,arguments)})})()}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete()}onAppChanged(t){var n=this;return(0,q.Z)(function*(){n.currentApp=t,t&&(n.links=yield n.appService.loadAppFileLinks(t.appOwner,t.appName,!0))})()}getIcon(t){return on(t)}fromPathFile(t){return(0,ce.nV)(t)}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(ve.F),e.Y36(me.UW))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-welcome-project"]],decls:6,vars:1,consts:[[1,"h-100","w-100","overflow-auto"],[1,"d-flex","flex-column","w-100","container"],[1,"d-flex","flex-column","flex-md-row","w-100"],["class","flex-fill w-100 d-flex flex-column pt-4",4,"ngIf"],[1,"flex-fill","w-100"],[1,"flex-fill","w-100","d-flex","flex-column","pt-4"],[1,"pr-2"],["class","d-flex flex-row align-items-center",4,"ngFor","ngForOf"],[1,"d-flex","flex-row","align-items-center"],[1,"btn-link","ml-2",3,"routerLink","queryParams"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e.YNc(3,As,4,3,"div",3),e.TgZ(4,"div",4),e._UZ(5,"app-welcome-core"),e.qZA()()()()),2&t&&(e.xp6(3),e.Q6J("ngIf",null==n.currentApp?null:n.currentApp.appOwner))},dependencies:[r.sg,r.O5,be.rH,wt.P],styles:['[_ngcontent-%COMP%]:root{--bg: #fff;--body-bg: #e4e5e6;--header-bg: #ebedef;--color: #4f5d73;--border-color: #c4c9d0;--ws-alt: #f7f7f7;--form-input-bg: #fff;--form-input-color: #768192;--nav-link-color: #8a93a2;--secondary-color: #c4c9d0;--opacity: .05;--hover: "#f0f3f5"}[_nghost-%COMP%]{display:flex;background:var(--bg);height:100%}ul[_ngcontent-%COMP%]{padding-inline-start:.8em}ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{list-style:none}ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#20a8d8}']}),i})();const Os=["sqlEditor"];function Ds(o,i){1&o&&(e.TgZ(0,"div",27)(1,"div",28)(2,"span",29),e._uU(3,"Loading..."),e.qZA()()())}let yn=(()=>{var o;class i{constructor(t,n,a,l,f){this.notificationService=t,this.dialogService=n,this.sqlMetaDataService=a,this.route=l,this.router=f,this.functionChanged=new e.vpe,this.isChanged=!1,this.paramRows=[],this.codeContentSize=50,this.parametersSize=30,this.modeState={code:!0,result:!0,parameters:!0},this.loading=!1,this.selectedText="",this.ConnectionLevels=Fe.EQ,this.defaultColDef={editable:!0,sortable:!1,suppressFiltersToolPanel:!0,suppressMovable:!0,suppressColumnsToolPanel:!0,suppressMenu:!0},this.gridOptions={},this.columnDefs=[{field:"name",width:200},{field:"value",minWidth:50},{field:"dataType",width:80},{field:"direction"},{field:"isNullable"}],this.sqlEditor={},this.destroy$=new D.x,this.editorChange$=new D.x,this.dataSource=new Pt,this.dataSource.data$.pipe((0,I.R)(this.destroy$),(0,K.h)(C=>!!C?.outputParameters)).subscribe(C=>{const E=Object.keys(C?.outputParameters);for(const k of E){const P=this.paramRows.find(ie=>ie.name.toLowerCase()===`@${k.toLowerCase()}`);P&&(P.value=(C?.outputParameters||{})[k])}})}onGridReady(t){}ngOnInit(){if(!this.sqlElement)throw new Error("sqlElement is not initialized");if(!this.dataObject)throw new Error("dataObject is not initialized");this.sqlEditor=Ie.editor.create(this.sqlElement.nativeElement,{language:"sql",value:this.dataObject.sqlText||"",tabSize:2,scrollBeyondLastLine:!1,readOnly:(this.connection?.codeAccessLevel||0)<Fe.EQ.SqlExecute}),this.sqlEditor.onDidChangeCursorSelection(a=>{const l=this.sqlEditor?.getModel()?.getValueInRange(this.sqlEditor?.getSelection());l!==this.selectedText&&(this.selectedText=l||"")}),this.sqlEditor.onDidChangeModelContent(()=>{this.editorChange$.next(null)}),this.editorChange$.pipe((0,I.R)(this.destroy$),(0,Ue.b)(200)).subscribe(()=>{const a=this.sqlEditor.getValue();this.isChanged=this.dataObject?.sqlText!==a;const l=this.isChanged?{structure:{...this.dataObject,sqlText:a},connection:this.connection}:null;this.functionChanged.emit(l)});const n=this.route.snapshot.queryParams;this.paramRows=(this.dataObject.parameters||[]).map(a=>({name:a.parameterName,direction:a.parameterDirection,value:n.hasOwnProperty(a.parameterName)?n[a.parameterName]:null,isNullable:a.isNullable})),ke.z.schedule(()=>{this.resize()})}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete()}ngOnChanges({dataObject:t}){t.firstChange||(this.isChanged=!1)}onRun(){var t=this;return(0,q.Z)(function*(){t.loading=!0;const n=t.paramRows.filter(C=>null!=C.value).reduce((C,E)=>(C[E.name.replace("@","")]=(0,gt.parseNumberOrNull)(E.value)||E.value,C),{}),a=t.paramRows.filter(C=>null!=C.value).reduce((C,E)=>(C[E.name.replace("@","")]=E.direction,C),{});let l="";for(var f=0;f<Object.values(n).length;f++)Object.values(n),"number"==typeof Object.values(n)[f]&&(l+=`${Object.values(n)[f]}, `),"string"==typeof Object.values(n)[f]&&(l+=`'${Object.values(n)[f]}', `);try{t.selectedText?yield t.dataSource.reload({connectionName:t.connection?.connectionName||"",sql:t.selectedText}):yield t.dataSource.reload({commandType:"Function",connectionName:t.connection?.connectionName,sqlParams:n,sqlParamDirections:a,sql:`select * from ${t.dataObject?.schemaName}.${t.dataObject?.objectName}(${l.slice(0,-2)})`}),t.syncQueryParams()}catch(C){t.notificationService.error(C)}finally{t.loading=!1}})()}syncQueryParams(){const t=this.paramRows.filter(n=>null!==n.value).reduce((n,a)=>(n[a.name]=a.value,n),{});this.router.navigate([],{relativeTo:this.route,queryParams:t})}onSave(){var t=this;return(0,q.Z)(function*(){if(!t.dataObject)throw new Error("dataObject is not initialized");const n=t.sqlEditor.getValue();if(!t.connection)throw new Error("Connection is not initialized");return yield t.sqlMetaDataService.saveDbObject(t.connection.connectionName,{...t.dataObject,sqlText:n})})()}onDelete(){var t=this;return(0,q.Z)(function*(){if(!t.connection)throw new Error("Connection is not initialized");yield t.sqlMetaDataService.deleteObject(t.connection.connectionName,t.dataObject)})()}onModeState(){const t=this.modeState.parameters||this.modeState.result;this.codeContentSize=this.modeState.code&&!t?100:this.modeState.code&&t?50:0,this.parametersSize=this.modeState.parameters&&!this.modeState.result?100:this.modeState.parameters&&this.modeState.result?30:0}resize(){this.sqlEditor?.layout()}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(Se.g),e.Y36(Te.x),e.Y36(me.hp),e.Y36(be.gz),e.Y36(be.F0))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-db-function"]],viewQuery:function(t,n){if(1&t&&(e.Gf(Os,7),e.Gf(tt.Z,7)),2&t){let a;e.iGM(a=e.CRH())&&(n.sqlElement=a.first),e.iGM(a=e.CRH())&&(n.dataGrid=a.first)}},inputs:{dataObject:"dataObject",connection:"connection"},outputs:{functionChanged:"functionChanged"},features:[e.TTD],decls:34,vars:27,consts:[[1,"card","overflow-hidden","mb-0","w-100","h-100"],[1,"card-body","d-flex","p-0","flex-column","h-100","position-relative"],[3,"useTransition","gutterSize","dragEnd","transitionEnd"],[1,"d-flex","mb-0","position-relative",3,"size"],["area0","asSplitArea"],["left","",1,"h-100","overflow-hidden","w-100"],["sqlEditor",""],[1,"d-flex","overflow-auto","flex-column","explorer-section",3,"size"],["area1","asSplitArea"],["direction","vertical",3,"hidden","restrictMove","useTransition","gutterSize"],[3,"size"],[1,"d-flex","flex-column","p-2","h-100"],[1,"mb-2"],["rowSelection","single",1,"ag-theme-balham","h-100","w-100",3,"columnDefs","defaultColDef","rowData","gridOptions","gridReady"],[1,"d-flex","flex-column","p-2","h-100","h-100","overflow-hidden"],[1,"d-flex","flex-row"],[1,"ml-auto",3,"grid","saveToTable"],[1,"h-100","overflow-hidden",3,"dataSource"],["dataGrid",""],["class","d-flex justify-content-center align-items-center w-100 h-100 spinner flex-column",4,"ngIf"],[1,"btn-group","d-block","mode"],["ngDefaultControl","","btnCheckbox","","tabindex","0","role","button","name","mode-code","title","SQL Function panel",1,"btn","btn-secondary","btn-sm","cursor-pointer","mb-0",3,"ngModel","ngModelChange","click"],[1,"fa","fa-code","fa-lg","mr-2"],["ngDefaultControl","","btnCheckbox","","tabindex","0","role","button","name","mode-result","title","Result panel",1,"btn","btn-secondary","btn-sm","cursor-pointer","mb-0",3,"ngModel","ngModelChange","click"],[1,"fa","fa-table","fa-lg","mr-2"],["ngDefaultControl","","btnCheckbox","","tabindex","0","role","button","name","mode-parameters",1,"btn","btn-secondary","btn-sm","cursor-pointer","mb-0",3,"ngModel","ngModelChange","click"],[1,"fa","fa-check","fa-lg","mr-2"],[1,"d-flex","justify-content-center","align-items-center","w-100","h-100","spinner","flex-column"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(t,n){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"as-split",2),e.NdJ("dragEnd",function(){return n.resize()})("transitionEnd",function(){return n.resize()}),e.TgZ(3,"as-split-area",3,4),e._UZ(5,"div",5,6),e.qZA(),e.TgZ(7,"as-split-area",7,8)(9,"as-split",9)(10,"as-split-area",10)(11,"div",11)(12,"h4",12),e._uU(13,"Parameters"),e.qZA(),e.TgZ(14,"ag-grid-angular",13),e.NdJ("gridReady",function(l){return n.onGridReady(l)}),e.qZA()()(),e.TgZ(15,"as-split-area",10)(16,"div",14)(17,"div",15)(18,"h4",12),e._uU(19,"Results"),e.qZA(),e._UZ(20,"app-export-menu",16),e.qZA(),e._UZ(21,"app-ag-data-grid",17,18),e.qZA()()(),e.YNc(23,Ds,4,0,"div",19),e.qZA()()()(),e.TgZ(24,"div",20)(25,"label",21),e.NdJ("ngModelChange",function(l){return n.modeState.code=l})("click",function(){return n.onModeState()}),e._UZ(26,"i",22),e._uU(27," SQL Function "),e.qZA(),e.TgZ(28,"label",23),e.NdJ("ngModelChange",function(l){return n.modeState.result=l})("click",function(){return n.onModeState()}),e._UZ(29,"i",24),e._uU(30," Results "),e.qZA(),e.TgZ(31,"label",25),e.NdJ("ngModelChange",function(l){return n.modeState.parameters=l})("click",function(){return n.onModeState()}),e._UZ(32,"i",26),e._uU(33," Parameters "),e.qZA()()),2&t){const a=e.MAs(22);e.xp6(2),e.Q6J("useTransition",!0)("gutterSize",50===n.codeContentSize?11:0),e.xp6(1),e.Q6J("size",n.codeContentSize),e.xp6(4),e.Q6J("size",100-n.codeContentSize),e.xp6(2),e.Q6J("hidden",n.loading)("restrictMove",!0)("useTransition",!0)("gutterSize",30===n.parametersSize?11:0),e.xp6(1),e.Q6J("size",n.parametersSize),e.xp6(4),e.Q6J("columnDefs",n.columnDefs)("defaultColDef",n.defaultColDef)("rowData",n.paramRows)("gridOptions",n.gridOptions),e.xp6(1),e.Q6J("size",100-n.parametersSize),e.xp6(5),e.Q6J("grid",a.grid)("saveToTable",!0),e.xp6(1),e.Q6J("dataSource",n.dataSource),e.xp6(2),e.Q6J("ngIf",n.loading),e.xp6(2),e.ekj("active",n.modeState.code),e.Q6J("ngModel",n.modeState.code),e.xp6(3),e.ekj("active",n.modeState.result),e.Q6J("ngModel",n.modeState.result),e.xp6(3),e.ekj("active",n.modeState.parameters),e.Q6J("ngModel",n.modeState.parameters)}},dependencies:[r.O5,u.Fj,u.JJ,u.On,$e.Mq,$e.zE,_t.DF,tt.Z,_n.U,Ye.N8],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}"]}),i})();function Is(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"app-db-function",2),e.NdJ("functionChanged",function(n){e.CHM(s);const a=e.oxw();return e.KtG(a.onChange(n))})("functionDeleted",function(){e.CHM(s);const n=e.oxw();return e.KtG(n.onDelete())}),e.qZA()}if(2&o){const s=e.oxw();e.Q6J("dataObject",s.dataObject)("connection",s.connection)}}function Fs(o,i){1&o&&(e.TgZ(0,"div",3)(1,"div",4)(2,"span",5),e._uU(3,"Loading..."),e.qZA()()())}let Es=(()=>{var o;class i{constructor(t,n,a,l,f,C){this.notificationService=t,this.sqlMetaDataService=n,this.tabsService=a,this.authService=l,this.dbConnectionService=C,this.destroy$=new D.x,this.dataObject={},this.loading=!1,this.connections=[],this.evaluationTime=0,this.evaluating=!1,this.isActivated=!1,this.canSave=!1,this.canReload=!0,this.menuItems=[],(0,Oe.setBearerToken)(l.token),(0,Oe.setBaseUrl)(Ge.Z.worksheetsApi),this.menuItems.push(f.exportToCsvMenuItem(()=>this.functionComponent?.dataGrid?.grid?.rowData||[],()=>this.tabItem?.tabHeader||"")),this.menuItems.push(f.exportToExcelMenuItem(()=>this.functionComponent?.dataGrid?.grid,()=>this.tabItem?.tabHeader)),this.menuItems.push(f.saveToDatabaseMenuItem(()=>this.functionComponent?.dataGrid?.grid?.rowData||[])),this.menuItems.push({isDivider:!0}),this.menuItems.push(f.closeAllMenuItem()),this.menuItems.push(f.closeOthersMenuItem())}save(){var t=this;return(0,q.Z)(function*(){if(!t.functionComponent)throw Error("Component is not initialized");try{const n=yield t.functionComponent.onSave();t.canSave=!1,t.notificationService.success(`Function ${n.schemaName}.${n.objectName} saved`),t.tabStore?.removeChanges()}catch(n){t.notificationService.error(n)}})()}get selectedText(){return this.functionComponent?.selectedText||""}activated(){var t=this;return(0,q.Z)(function*(){t.isActivated||(t.isActivated=!0,t.dbConnectionService.dbConnectionsList$.pipe((0,I.R)(t.destroy$),(0,K.h)(n=>!!n.length)).subscribe(n=>{t.connections=n,t.initTab()})),t.functionComponent?.syncQueryParams()})()}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete()}ngOnInit(){var t=this;return(0,q.Z)(function*(){if(!t.tabItem)throw new Error("tabItem is not initialized");t.tabItem.content=t,t.authService.isAuthenticated$.pipe((0,I.R)(t.destroy$),(0,K.h)(n=>n)).subscribe(()=>{const n=t.authService.user?.userId;t.tabStore=new Nt(t.tabItem,n),t.canSave=t.tabStore.hasChanges()})})()}initTab(){var t=this;return(0,q.Z)(function*(){const n=t.tabStore?.getChanges();if(n){const a=t.tabItem?.tabParams.owner;t.connection=t.connections.find(l=>l.connectionName===a),t.dataObject=n,t.canSave=!0,t.canReload=!0}else t.reload()})()}reload(){var t=this;return(0,q.Z)(function*(){if(!t.tabItem)throw new Error("tabItem is not initialized");const n=t.tabItem.tabParams.owner,a=(t.tabItem.tabParams.name||"").split("."),l=n,f=a[0],C=a[1];t.connection=t.connections.find(E=>E.connectionName===l);try{t.loading=!0,t.dataObject=yield t.sqlMetaDataService.getMetaDataObject(l,f,C,Ce.HA.Procedure),t.canSave=!1,t.tabStore?.removeChanges()}catch{t.notificationService.error(`Failed to load meta data ${f}.${C}`)}finally{t.loading=!1}})()}handleKeyboardEvent(t){this.tabsService.activeTab===this.tabItem&&("F5"===t.key||t.ctrlKey&&"Enter"===t.key)&&(t.preventDefault(),t.stopImmediatePropagation(),this.onRun())}onRun(){var t=this;return(0,q.Z)(function*(){if(!t.functionComponent)throw new Error("functionComponent is not initialized");t.canSave&&!t.selectedText&&(yield t.notificationService.confirmation("Do you want to save latest changes, before 'Run'?"))&&(yield t.save()),t.evaluating=!0;const n=(new Date).getTime();yield t.functionComponent.onRun(),t.evaluationTime=+new Date-n,t.evaluating=!1})()}onDelete(){var t=this;return(0,q.Z)(function*(){if(!t.functionComponent)throw new Error("functionComponent is not initialized");if(yield t.notificationService.confirmation("Are you sure you want to delete this Function?"))try{yield t.functionComponent.onDelete();const{objectName:n,schemaName:a}=t.dataObject;t.notificationService.success(`Function '${a}.${n}'' deleted`)}catch(n){t.notificationService.error(n)}})()}onChange({structure:t}){var n=this;return(0,q.Z)(function*(){n.tabStore?.saveChanges(t),n.canSave=!0})()}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(Se.g),e.Y36(me.hp),e.Y36(xe.x),e.Y36(me.$h),e.Y36(Je.q),e.Y36(We.F))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tab-function"]],viewQuery:function(t,n){if(1&t&&e.Gf(yn,5),2&t){let a;e.iGM(a=e.CRH())&&(n.functionComponent=a.first)}},hostBindings:function(t,n){1&t&&e.NdJ("keydown",function(l){return n.handleKeyboardEvent(l)},!1,e.evT)},inputs:{tabItem:"tabItem"},decls:2,vars:2,consts:[[3,"dataObject","connection","functionChanged","functionDeleted",4,"ngIf"],["class","d-flex justify-content-center position-absolute align-items-center w-100 h-100 spinner flex-column",4,"ngIf"],[3,"dataObject","connection","functionChanged","functionDeleted"],[1,"d-flex","justify-content-center","position-absolute","align-items-center","w-100","h-100","spinner","flex-column"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(t,n){1&t&&(e.YNc(0,Is,1,2,"app-db-function",0),e.YNc(1,Fs,4,0,"div",1)),2&t&&(e.Q6J("ngIf",!n.loading&&n.dataObject&&n.connection),e.xp6(1),e.Q6J("ngIf",n.loading))},dependencies:[r.O5,yn]}),i})();function Ns(o,i){if(1&o&&(e.TgZ(0,"span",9),e._uU(1),e.qZA()),2&o){const s=e.oxw().$implicit;e.oxw();const t=e.MAs(5);e.Q6J("cdkContextMenuTriggerFor",t)("title",s.tabId),e.xp6(1),e.AsE("",null!=s&&null!=s.content&&s.content.canSave?"* ":"","",s.tabHeader,"")}}function Ps(o,i){if(1&o&&e._UZ(0,"app-tab-jspy",10),2&o){const s=e.oxw().$implicit;e.Q6J("tabItem",s)}}function ks(o,i){if(1&o&&e._UZ(0,"app-tab-dcml",10),2&o){const s=e.oxw().$implicit;e.Q6J("tabItem",s)}}function Zs(o,i){if(1&o&&e._UZ(0,"app-tab-js",10),2&o){const s=e.oxw().$implicit;e.Q6J("tabItem",s)}}function Rs(o,i){if(1&o&&e._UZ(0,"app-tab-json",10),2&o){const s=e.oxw().$implicit;e.Q6J("tabItem",s)}}function qs(o,i){if(1&o&&e._UZ(0,"app-tab-data-query",10),2&o){const s=e.oxw().$implicit;e.Q6J("tabItem",s)}}function Js(o,i){if(1&o&&e._UZ(0,"app-tab-db-table",10),2&o){const s=e.oxw().$implicit;e.Q6J("tabItem",s)}}function js(o,i){if(1&o&&e._UZ(0,"app-tab-db-table",10),2&o){const s=e.oxw().$implicit;e.Q6J("tabItem",s)}}function $s(o,i){if(1&o&&e._UZ(0,"app-tab-procedure",10),2&o){const s=e.oxw().$implicit;e.Q6J("tabItem",s)}}function Qs(o,i){if(1&o&&e._UZ(0,"app-tab-function",10),2&o){const s=e.oxw().$implicit;e.Q6J("tabItem",s)}}function Ls(o,i){if(1&o&&e._UZ(0,"app-tab-sql",10),2&o){const s=e.oxw().$implicit;e.Q6J("tabItem",s)}}function Bs(o,i){if(1&o&&(e.TgZ(0,"div"),e._uU(1),e.qZA()),2&o){const s=e.oxw().$implicit;e.xp6(1),e.hij(" ",s.tabHeader," ")}}function Us(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"tab",4),e.NdJ("removed",function(){const a=e.CHM(s).$implicit,l=e.oxw();return e.KtG(l.onTabRemove(a))})("selectTab",function(){const a=e.CHM(s).$implicit,l=e.oxw();return e.KtG(l.onSelectTab(a))}),e.YNc(1,Ns,2,4,"ng-template",5),e.ynx(2,6),e.YNc(3,Ps,1,1,"app-tab-jspy",7),e.YNc(4,ks,1,1,"app-tab-dcml",7),e.YNc(5,Zs,1,1,"app-tab-js",7),e.YNc(6,Rs,1,1,"app-tab-json",7),e.YNc(7,qs,1,1,"app-tab-data-query",7),e.YNc(8,Js,1,1,"app-tab-db-table",7),e.YNc(9,js,1,1,"app-tab-db-table",7),e.YNc(10,$s,1,1,"app-tab-procedure",7),e.YNc(11,Qs,1,1,"app-tab-function",7),e.YNc(12,Ls,1,1,"app-tab-sql",7),e.YNc(13,Bs,2,1,"div",8),e.BQk(),e.qZA()}if(2&o){const s=i.$implicit;e.Q6J("removable",!0)("id",s.tabId),e.xp6(2),e.Q6J("ngSwitch",s.tabType),e.xp6(1),e.Q6J("ngSwitchCase","jspy"),e.xp6(1),e.Q6J("ngSwitchCase","dcml"),e.xp6(1),e.Q6J("ngSwitchCase","js"),e.xp6(1),e.Q6J("ngSwitchCase","json"),e.xp6(1),e.Q6J("ngSwitchCase","query"),e.xp6(1),e.Q6J("ngSwitchCase","table"),e.xp6(1),e.Q6J("ngSwitchCase","view"),e.xp6(1),e.Q6J("ngSwitchCase","procedure"),e.xp6(1),e.Q6J("ngSwitchCase","function"),e.xp6(1),e.Q6J("ngSwitchCase","sql")}}function zs(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"button",15),e.NdJ("cdkMenuItemTriggered",function(){e.CHM(s);const n=e.oxw().$implicit,a=e.oxw(2);return e.KtG(a.onContextMenuClick(n))}),e._UZ(1,"i"),e._uU(2),e.qZA()}if(2&o){const s=e.oxw().$implicit;e.xp6(1),e.Gre("fa ",s.icon||"fa-circle-thin"," mr-2"),e.xp6(1),e.hij("",s.label," ")}}function Hs(o,i){1&o&&e._UZ(0,"hr")}function Ys(o,i){if(1&o&&(e.ynx(0),e.YNc(1,zs,3,4,"button",13),e.YNc(2,Hs,1,0,"hr",14),e.BQk()),2&o){const s=i.$implicit;e.xp6(1),e.Q6J("ngIf",!s.isDivider),e.xp6(1),e.Q6J("ngIf",s.isDivider)}}function Gs(o,i){if(1&o&&(e.TgZ(0,"div",11),e.YNc(1,Ys,3,2,"ng-container",12),e.qZA()),2&o){const s=e.oxw();e.xp6(1),e.Q6J("ngForOf",s.activeTabMenuItems)}}let Ks=(()=>{var o;class i{constructor(t,n,a){this.tabsService=t,this.router=n,this.route=a,this.activeTabMenuItems=[],this.contentsToResize=new Set,this.destroy$=new D.x,this.tabs=t.tabs,t.activeTab$.subscribe(l=>{this.activeTabMenuItems.splice(0,this.activeTabMenuItems.length),l?.content?.menuItems?.forEach(f=>this.activeTabMenuItems.push(f))})}ngOnInit(){var t=this;return(0,q.Z)(function*(){var n;t.subscribeOnRouter(),t.tabsService.activeTab$.pipe((0,I.R)(t.destroy$),(0,K.h)(a=>!!a)).subscribe(function(a){return(n=n||(0,q.Z)(function*(l){return yield t.selectTab(l)})).apply(this,arguments)})})()}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete(),this.tabsService.removeAllTabs(),this.tabsService.destroy()}onTabRemove(t){let n=this.tabsService.tabs.indexOf(t);if(n<0)return;const a=this.tabsService.activeTab?.tabId===t.tabId;this.tabsService.removeTab(t),"function"==typeof t.content.deleteLocalChanges&&t.content.deleteLocalChanges(),a&&this.tabsService.tabs.length?this.onSelectTab(this.tabsService.tabs[Math.max(0,n-1)]):this.tabsService.tabs.length||this.router.navigate([],{relativeTo:this.route,queryParams:{}})}onSelectTab(t){const{appOrSql:n,owner:a,name:l}=t.tabParams;this.router.navigate([`data-studio/${n}`,a,l],{queryParams:t.queryParams})}resize(){const t=this.tabsService.activeTab;t&&(t.content?.resize?.(),this.tabs.forEach(n=>{n!==t&&this.contentsToResize.add(n.content)}))}selectTab(t){var n=this;return(0,q.Z)(function*(){if(!n.tabset)throw new Error("this.tabset is not initilized");const a=(n.tabset?.tabs||[]).map(l=>l.id).indexOf(n.tabsService.getTabKey(t));-1!==a&&(n.tabset.tabs[a].active=!0,"function"==typeof t.content?.activated?(yield t.content.activated(),n.contentsToResize.has(t.content)&&(t.content.resize?.(),n.contentsToResize.delete(t.content))):console.warn("activate is not implemented here"))})()}subscribeOnRouter(){this.route.queryParams.pipe((0,I.R)(this.destroy$),(0,K.h)(t=>"app"===this.route.snapshot.params.appOrSql&&t.file)).subscribe(t=>this.tabsService.activateTab(this.createAppContentTabFromUrl())),this.route.params.pipe((0,I.R)(this.destroy$),(0,K.h)(t=>"sql"===t.appOrSql)).subscribe(t=>this.tabsService.activateTab(this.createSqlTabFromUrl()))}createAppContentTabFromUrl(){const{appOrSql:t}=this.route.snapshot.params,{file:l}=this.route.snapshot.queryParams;if("app"!==t||!l)throw new Error("Can't create App Content Tab. appOrSql !== 'app' || !file ");const f=(0,ce.x2)(l);let C=`${f.name||""}${f.name?".":""}${f.contentType}`;C=C.length<25?C:"..."+C.substring(C.length-25);const{params:E,queryParams:k}=this.route.snapshot,P={...E,...k};return new fn.E({tabId:this.tabsService.getTabKeyFromUrlParams(E,k),queryParams:k,tabParams:P,tabType:f.contentType,tabHeader:C})}createSqlTabFromUrl(){const t=this.route.snapshot.params.name,n=`${t.substring(0,t.lastIndexOf("."))}`,{params:a,queryParams:l}=this.route.snapshot,f={...a,...l},C=String(t).toLowerCase().substring(String(t).lastIndexOf(".")+1);return new fn.E({tabHeader:n,tabType:C,queryParams:l,tabParams:f,tabId:this.tabsService.getTabKeyFromUrlParams(a,l)})}onContextMenuClick(t){const n=this.tabsService.activeTab?.content?.menuItems?.find(a=>a.label===t.label);n?.click(n)}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(xe.x),e.Y36(be.F0),e.Y36(be.gz))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tabs"]],viewQuery:function(t,n){if(1&t&&e.Gf(qe.AH,7),2&t){let a;e.iGM(a=e.CRH())&&(n.tabset=a.first)}},hostBindings:function(t,n){1&t&&e.NdJ("resize",function(l){return n.resize(l)},!1,e.Jf7)},decls:6,vars:3,consts:[[1,"h-100",3,"hidden"],[1,"tabset-fx","nav-tabs-boxed","overflow-hidden",3,"hidden"],[3,"removable","id","removed","selectTab",4,"ngFor","ngForOf"],["ctxMenu",""],[3,"removable","id","removed","selectTab"],["tabHeading",""],[3,"ngSwitch"],["class","h-100 w-100",3,"tabItem",4,"ngSwitchCase"],[4,"ngSwitchDefault"],[3,"cdkContextMenuTriggerFor","title"],[1,"h-100","w-100",3,"tabItem"],["cdkMenu","",1,"context-menu"],[4,"ngFor","ngForOf"],["class","context-menu-item","cdkMenuItem","",3,"cdkMenuItemTriggered",4,"ngIf"],[4,"ngIf"],["cdkMenuItem","",1,"context-menu-item",3,"cdkMenuItemTriggered"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e._UZ(1,"app-welcome-project"),e.qZA(),e.TgZ(2,"tabset",1),e.YNc(3,Us,14,13,"tab",2),e.qZA(),e.YNc(4,Gs,2,1,"ng-template",null,3,e.W1O)),2&t&&(e.Q6J("hidden",!!n.tabs.length),e.xp6(2),e.Q6J("hidden",!n.tabs.length),e.xp6(1),e.Q6J("ngForOf",n.tabs))},dependencies:[r.sg,r.O5,r.RF,r.n9,r.ED,qe.wW,qe.AH,qe.y3,Ht,ze,Yt,Wo,ns,os,as,ls,ds,gs,Ts,Ms,Es],styles:['tabset[_ngcontent-%COMP%]     .bs-remove-tab{visibility:hidden;position:relative}tabset[_ngcontent-%COMP%]     .bs-remove-tab:after{content:"\\f00d";font-family:FontAwesome;color:inherit;position:absolute;visibility:visible;right:0}tabset[_ngcontent-%COMP%]     .tab-content{position:relative}']}),i})();var Vs=d(10708),Ws=d(22096),Xs=d(37398),ea=d(58504);let vn=(()=>{var o;class i{constructor(t,n,a){this.router=t,this.authenticationService=n,this.appStateService=a}canActivate(t,n){var a=this;return(0,q.Z)(function*(){const{appOrSql:l,owner:f,name:C}=t.params;return"app"===l&&C===Ee.b5||("app"===l?yield(0,Vs.n)(a.navigateToApp(f,C)):"sql"===l&&a.navigateToSql(f,C))})()}navigateToApp(t,n){return t===Ee.m5||n===Ee.b5?(this.appStateService.setCurrentApp(null),(0,Ws.of)(!0)):this.appStateService.getApp(t,n).pipe((0,Xs.U)(a=>(a||(0,ea._)(`No access to application ${t}/${n}`),this.appStateService.setCurrentApp(a),!!a)))}navigateToSql(t,n){return this.appStateService.currentConnection=t,!0}}return(o=i).\u0275fac=function(t){return new(t||o)(e.LFG(be.F0),e.LFG(me.$h),e.LFG(ve.F))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac}),i})(),Cn=(()=>{var o;class i{constructor(t,n){this.router=t,this.studioStateService=n}canActivate(t,n){const{connection:a}=t.params;return this.studioStateService.currentConnection=a,!0}}return(o=i).\u0275fac=function(t){return new(t||o)(e.LFG(be.F0),e.LFG(ve.F))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac}),i})();const ta=[{path:"editors",loadChildren:()=>d.e(964).then(d.bind(d,50964)).then(o=>o.EditorModule)},{path:"",component:zo,children:[{path:"",component:wt.P},{path:"sql/:connection",canActivate:[Cn],component:wt.P},{path:":appOrSql/:owner/:name",component:Ks,canActivate:[vn]}]}];let na=(()=>{var o;class i{}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[be.Bz.forChild(ta),be.Bz]}),i})();var ia=d(20362),oa=d(52667);let sa=(()=>{var o;class i{}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[r.ez,xt.nM,u.u5,Gt.fx.forRoot(),ye.mr.forRoot(),_t.Fq.forRoot()]}),i})(),aa=(()=>{var o;class i{}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({providers:[Te.x,ve.F,vn,Cn,Kt.h,Ve.j5,xe.x,Je.q,It],imports:[r.ez,na,W.JF,Wn.I,xt.nM,u.u5,oa.c,$e.fX,Gt.fx.forRoot(),ye.mr.forRoot(),_t.Fq.forRoot(),qe.P4.forRoot(),pn.UU.forRoot(),pt.A0,ia.T,sa,Ye.sF,Vn]}),i})()},13389:(_e,le,d)=>{d.d(le,{E:()=>u});var r=d(32013);class u{constructor({queryParams:e,tabHeader:O,tabId:v,tabParams:oe,tabType:K}){this.isLoadedSubj$=new r.x,this.isLoaded$=this.isLoadedSubj$.asObservable(),this.queryParams=e,this.tabId=v,this.tabHeader=O,this.tabParams=oe,this.tabType=K}set content(e){this.content_=e,this.content&&(this.isLoadedSubj$.next(!0),this.isLoadedSubj$.complete())}get content(){return this.content_}get routePath(){const{appOrSql:e,owner:O,name:v}=this.tabParams;return[e,O,v]}static serialize(e){return JSON.stringify({tabId:e.tabId,tabHeader:e.tabHeader,tabType:e.tabType,tabParams:e.tabParams,queryParams:e.queryParams})}static deserialize(e){try{return new u(JSON.parse(e))}catch(O){return console.error(O),null}}}},94782:(_e,le,d)=>{d.d(le,{q:()=>Q});var r=d(15861),u=d(13509),W=d(85132),e=d(82974),O=d(13231),v=d(91334);function oe(D,b){const{connectionName:_,tableName:p,tableAlias:x,fields:j,tablesJoin:Y,limitRowsCount:te,orderBy:$}=D;let se;se=j?.length?`\n\t${j.map(function A(h){const g=h.sqlExpression?.indexOf(".")?h.sqlExpression?.substring(h.sqlExpression?.indexOf(".")+1):h.sqlExpression;return(h.name===g?h.sqlExpression||h.name:`${h.sqlExpression||""} ${h.name}`).trim()}).join(",\n\t")}\n`:"*";let G=`-- Connection: ${_}\n\n`;if(G+="SELECT"+(te?` TOP ${te} `:""),G+=`${se}FROM ${p}`,x&&(G+=` ${x}`),Y?.forEach(h=>{const g=h.joinType.split("Join");G+=`\n\t${g[0]} Join ${h.tableName} ${h.tableAlias} ON ${h.joinCondition}${h.joinCondition2?` AND ${h.joinCondition2}`:""}`}),b&&(G+=function K(D,b){const{tableAlias:A}=b;let _="";for(let p=0;p<D.length;p++)if(D[p].filterValue){const x=(0,v.UT)(D[p].filterValue),j=B(D[p].operation,x,D[p].columnName);0===p&&(_+=`\nWHERE (${A}.${j} )`),0!==p&&(_+=`\n\tAND (${A}.${j} )`)}return _}(b,D)),j){const h=j.filter(g=>!0===g.groupBy).map(g=>g.sqlExpression);0!==h.length&&(G+=`\nGROUP BY ${h.toString()}`)}return $?.length&&(G+=`\nORDER BY ${$.map(h=>`${h.fieldName} ${h.direction||"ASC"}`).join(", ")}`),G.trim()+"\n"}function B(D,b,A){let _,p,x="";const j=String(b).split(",");let Y="";return j.forEach(te=>{Y+=`'${te}',`}),"Like"===D&&(x+=`${A} LIKE '${j}'`),"NotLike"===D&&(x+=`${A} NOT LIKE '${j}'`),"In"===D&&(x+=`${A} IN (${Y.substring(0,Y.length-1).split("\r")})`),"NotIn"===D&&(x+=`${A} NOT IN (${Y.substring(0,Y.length-1).split("\r")})`),"Custom"===D&&(x+=`${b}`),"Search"===D&&(x+="string"==typeof b?`${A} = '${j}'`:`${A} = ${b}`),"Between"===D&&(p=j[0],_=j[1],p!==O.yv&&_!==O.yv&&(x+=`${A} BETWEEN ${p} AND ${_}`),p!==O.yv&&_===O.yv&&(x+=`${A} >= ${p}`),p===O.yv&&_!==O.yv&&(x+=`${A} <= ${_}`)),x}function I(D,b){const{connectionName:_,tableName:p,tableAlias:x,tablesJoin:j,fields:Y,orderBy:te,limitRowsCount:$}=D;let se=`from 'sql-data-api' import sqlDataApi\n\nsqlDataApi("${_}")`;const[G,h]=(0,v.dp)("",{},"",D,b);return j?.forEach(T=>{const Z=T.joinType.charAt(0).toLowerCase()+T.joinType.slice(1);se+=`\n\t.${Z}("${T.tableName} ${T.tableAlias}", "${T.joinCondition}"${T.joinCondition2?`, "${T.joinCondition2}"`:""})`}),Y?.length&&(se+=`\n\t.select("""\n\t\t\t${Y.map(function A(T){const Z=T.sqlExpression?.indexOf(".")?T.sqlExpression?.substring(T.sqlExpression?.indexOf(".")+1):T.sqlExpression;let he=T.name===Z?T.sqlExpression:`${T.sqlExpression||""} ${T.name}`;if(T.groupBy&&(he=`groupBy|${he}`),!he)throw new Error("Sql Expression is not defined");return he.trim()}).join(",\n\t\t\t")}\n\t\t\t""")`),te?.length&&(se+=`\n\t.orderBy("${te.map(T=>`${T.fieldName} ${T.direction||"ASC"}`).join(", ")}")`),$&&(se+=`\n\t.top(${$})`),G&&h&&(se+=`\n\t.filter("${G}", ${JSON.stringify(h).trim()})`),se+=`\n\t.query("${`${p} ${x||""}`.trim()}")\n`,se}var c=d(28169),F=d(60364),V=d(30046),ae=d(32181),U=d(10708),H=d(37398),L=d(66166),M=d(42014),S=d(22263),m=d(80014),y=d(23991),w=d(65879),R=d(33374),N=d(69569),J=d(8050),ne=d(71997),X=d(75263),re=d(55314),ee=d(75187);let Q=(()=>{var D;class b{constructor(_,p,x,j,Y,te,$,se){this.dialogService=_,this.notificationService=p,this.fileService=x,this.tabsService=j,this.studioService=Y,this.sqlMetaService=te,this.connectionsService=$,this.router=se}exportToCsvMenuItem(_,p){return{label:"Export To Csv",icon:"fa-cloud-download",click:()=>this.fileService.exportToFile(_(),{fileType:u.Tv.CSV,fileName:p()})}}exportToFileMenuItem(_,p){return{label:"Export to file",icon:"fa-cloud-download",click:()=>this.dialogService.open(y.r,{initialState:{grid:_(),fileName:p()}})}}exportToExcelMenuItem(_,p){return{label:"Export To Excel",icon:"fa-file-excel-o",click:()=>_()?.api.exportDataAsExcel({skipColumnHeaders:!1,fileName:p()})}}saveToDatabaseMenuItem(_){return{label:"Save To Database",icon:"fa-database",click:()=>{this.dialogService.open(W.E,{class:"modal-xl full-height",keyboard:!1,initialState:{config:_()}}).onClose$.pipe((0,ae.h)(x=>!!x)).subscribe(x=>this.router.navigate(["data-studio","sql",x.connectionName,(0,V._1)(x)]))}}}addNewJspyTab(){this.tabsService.addNewAppTab(this.studioService.currentApp,"jspy","",S.EY)}addNewJsonTab(){this.tabsService.addNewAppTab(this.studioService.currentApp,"json","","")}addNewSqlQueryTab(_){this.tabsService.addNewAppTab(this.studioService.currentApp,"sql","",`-- Connection: ${_}\n\n\n`)}addNewProcedureTab(_){this.tabsService.addNewAppTab(this.studioService.currentApp,"sql","",`-- Connection: ${_}\n\nCREATE OR ALTER PROCEDURE [procedureName] AS\n`)}addNewFunctionTab(_){let p;"SqlServer"===_.connectionType&&(p=`-- Connection: ${_.connectionName}\n\nCREATE OR ALTER FUNCTION [functionName] (parameters) \n`),"PostgreSql"===_.connectionType&&(p=`-- Connection: ${_.connectionName}\n\nCREATE OR REPLACE FUNCTION [functionName] (parameters) \n`),this.tabsService.addNewAppTab(this.studioService.currentApp,"sql","",p)}addNewViewTab(_){this.tabsService.addNewAppTab(this.studioService.currentApp,"sql","",`-- Connection: ${_}\n\nCREATE OR ALTER VIEW [viewName] AS\n`)}addSelect1000SqlTab(_){var p=this;return(0,r.Z)(function*(){const{connectionName:x,schemaName:j,objectName:Y}=_,te=oe(yield p.getSqlQueryInfo(x,j,Y));p.tabsService.addNewAppTab(p.studioService.currentApp,"sql","",te)})()}addSelectSqlTab(_,p){const x=oe(_,p);this.tabsService.addNewAppTab(this.studioService.currentApp,"sql","",x)}closeAllMenuItem(){return{label:"Close All Tabs",icon:"bi bi-x",click:()=>this.tabsService.removeAllTabs()}}closeOthersMenuItem(){return{label:"Close Other Tabs",icon:"bi bi-x",click:()=>this.tabsService.removeUnActiveTabs()}}addSelectWithSqlDataApiJspyTab(_,p){const x=I(_,p);this.tabsService.addNewAppTab(this.studioService.currentApp,"jspy","",x)}addSelect1000JspyTab(_){var p=this;return(0,r.Z)(function*(){const{connectionName:x,schemaName:j,objectName:Y}=_,te=I(yield p.getSqlQueryInfo(x,j,Y));p.tabsService.addNewAppTab(p.studioService.currentApp,"jspy","",te)})()}addDataQueryTabFromTableLink(_){var p=this;return(0,r.Z)(function*(){const{connectionName:x,schemaName:j,objectName:Y}=_;p.addDataQueryTabFromQuery({sqlQuery:{connectionName:x,tableName:`${j}.${Y}`,tableAlias:"t",limitRowsCount:1e3},viewType:"DataGrid"})})()}addDataQueryTabFromQuery(_){var p=this;return(0,r.Z)(function*(){p.tabsService.addNewAppTab(p.studioService.currentApp,"query","",JSON.stringify(_))})()}editSqlTableMetadata(_){var p=this;return(0,r.Z)(function*(){const{connectionName:x}=_,j=yield p.connectionsService.loadMyDbConnections(),Y=j.find($=>$.connectionName===x),te=p.dialogService.open(e.W,{class:"modal-xl full-height",keyboard:!1,initialState:{config:{connection:Y,connections:j,isNew:!1,dbObjectLink:_}}});return(0,U.n)(te.onClose$.pipe((0,H.U)($=>!!$)))})()}createNewTable(_){var p=this;return(0,r.Z)(function*(){const x=yield p.connectionsService.loadMyDbConnections(),j=x.find(te=>te.connectionName===_),Y=p.dialogService.open(e.W,{class:"modal-xl full-height",keyboard:!1,initialState:{config:{connection:j,connections:x,isNew:!0}}}).onClose$.pipe((0,ae.h)(te=>!!te)).subscribe(te=>{Y.unsubscribe(),p.router.navigate(["data-studio","sql",te.connectionName,`${te.schemaName}.${te.objectName}.table`]),p.studioService.dbItemAdded(te)})})()}importCsvData(){var _=this;return(0,r.Z)(function*(){const p=yield _.connectionsService.loadMyDbConnections();_.dialogService.open(M.J,{class:"modal-xl full-height",keyboard:!1,initialState:{config:{connections:p}}}).onClose$.pipe((0,ae.h)(x=>!!x)).subscribe(x=>_.router.navigate(["data-studio","sql",x.connectionName,`${x.schemaName}.${x.objectName}.table`]))})()}createApp(){var _=this;return(0,r.Z)(function*(){yield _.dialogService.open(L.b,{initialState:{config:{appName:"NewApp"}}}).onCloseAsync()})()}deleteSqlTable(_){var p=this;return(0,r.Z)(function*(){const{connectionName:x,schemaName:j,objectName:Y}=_,te=`${x}: '${j}.${Y}'`;return!!(yield p.notificationService.confirmation(`Are you sure you want to delete ${te}?`))&&(yield p.sqlMetaService.deleteObject(x,_),p.notificationService.success(`Table ${te} deleted`),p.tabsService.removeConnectionTab(_),!0)})()}deleteSqlView(_){var p=this;return(0,r.Z)(function*(){const{connectionName:x,schemaName:j,objectName:Y}=_,te=`${x} ${j}.${Y}`;return!!(yield p.notificationService.confirmation(`Are you sure you want to delete ${te} ?`))&&(yield p.sqlMetaService.deleteObject(x,_),p.notificationService.success(`View ${te} deleted.`),p.tabsService.removeConnectionTab(_),!0)})()}deleteSqlProcedure(_){var p=this;return(0,r.Z)(function*(){const{connectionName:x,schemaName:j,objectName:Y}=_,te=`'${j}.${Y}' (${x})`;return!!(yield p.notificationService.confirmation(`Are you sure you want to delete ${te} ?`))&&(yield p.sqlMetaService.deleteObject(x,_),p.notificationService.success(`Stored Procedure ${te} deleted.`),p.tabsService.removeConnectionTab(_),!0)})()}deleteSqlFunction(_){var p=this;return(0,r.Z)(function*(){const{connectionName:x,schemaName:j,objectName:Y}=_,te=`'${j}.${Y}' (${x})`;return!!(yield p.notificationService.confirmation(`Are you sure you want to delete ${te} ?`))&&(yield p.sqlMetaService.deleteObject(x,_),p.notificationService.success(`Function ${te} deleted.`),p.tabsService.removeConnectionTab(_),!0)})()}editViewInNewSqlTab(_){var p=this;return(0,r.Z)(function*(){const{connectionName:x}=_,j=yield p.loadMetaData(_);p.tabsService.addNewAppTab(p.studioService.currentApp,"sql","",`-- Connection: ${x}\n\n${j.sqlText}`)})()}spExecuteInNewJspyTab(_){var p=this;return(0,r.Z)(function*(){const j=function z(D){return`# SP Execution needs to be here ...\n# Name: ${D.schemaName}.${D.objectName}\n# Params:  ${JSON.stringify(D.parameters??{})}\n`}(yield p.loadMetaData(_));p.tabsService.addNewAppTab(p.studioService.currentApp,"jspy","",j)})()}saveGridData(_,p,x){var j=this;return(0,r.Z)(function*(){if(!x)return!0;const Y=j.dialogService.open(c.b);try{const te=(x.state?.edited||[]).concat(x.state?.added||[]);if(te?.length||x.state?.deleted?.length){const $=yield(0,F.sqlDataApi)(_).save(p,te,x.state?.deleted);j.notificationService.success(`Saved ${JSON.stringify($)}`)}"function"==typeof x.clear&&x.clear()}catch(te){return j.notificationService.error(te),!1}finally{Y.close()}return!0})()}loadMetaData(_){var p=this;return(0,r.Z)(function*(){const{connectionName:x,schemaName:j,objectName:Y,objectType:te}=_,$=p.dialogService.open(c.b,{class:"modal-sm",initialState:{message:"Loading metadata ..."}});let se=null;try{se=yield p.sqlMetaService.getMetaDataObject(x,j,Y,te)}catch(G){throw p.notificationService.error(G),new Error(G)}finally{$.close()}return se})()}getSqlQueryInfo(_,p,x){var j=this;return(0,r.Z)(function*(){const Y=yield j.loadMetaData({connectionName:_,schemaName:p,objectName:x});return{connectionName:_,limitRowsCount:1e3,tableName:`${p}.${x}`,fields:Y.fields.map(te=>({name:te.fieldName}))}})()}openPubSubSetting(_){if(!_)throw new Error("configQueryInfo is not defined");return this.dialogService.open(m.a,{class:"modal-md",initialState:{configPubSub:_.pubSub,configQueryInfo:_}}).onClose$.pipe((0,ae.h)(x=>!!x))}}return(D=b).\u0275fac=function(_){return new(_||D)(w.LFG(R.x),w.LFG(N.g),w.LFG(u.j5),w.LFG(J.x),w.LFG(ne.F),w.LFG(X.hp),w.LFG(re.F),w.LFG(ee.F0))},D.\u0275prov=w.Yz7({token:D,factory:D.\u0275fac}),b})()},71997:(_e,le,d)=>{d.d(le,{F:()=>K});var r=d(65619),u=d(32013),W=d(22096),e=d(93997),O=d(21473),v=d(65879),oe=d(75263);let K=(()=>{var B;class I{constructor(c){this.dataService=c,this.appSubj$=new r.X(null),this.appContentAddedSubj$=new u.x,this.dbItemAddedSubj$=new u.x,this._connection="",this.currentApp$=this.appSubj$.asObservable().pipe((0,e.x)()),this.appContentAdded$=this.appContentAddedSubj$.asObservable(),this.dbItemAdded$=this.dbItemAddedSubj$.asObservable()}getApp(c,F){return this.currentApp?.appOwner===c&&this.currentApp?.appName===F?(0,W.of)(this.currentApp):this.dataService.getAppDefinition(c,F)}appContentAdded(c,F,V){this.currentApp?.appOwner!==c||this.currentApp?.appName!==F||this.appContentAddedSubj$.next([(0,O.x2)(V)])}dbItemAdded(c){c.connectionName===this._connection&&this.dbItemAddedSubj$.next(c)}get currentApp(){return this.appSubj$.getValue()}set currentConnection(c){this._connection=c}get currentConnection(){return this._connection}setCurrentApp(c){(this.currentApp?.appOwner!==c?.appOwner||this.currentApp?.appName!==c?.appName)&&this.appSubj$.next(c)}}return(B=I).\u0275fac=function(c){return new(c||B)(v.LFG(oe.UW))},B.\u0275prov=v.Yz7({token:B,factory:B.\u0275fac}),I})()},8050:(_e,le,d)=>{d.d(le,{x:()=>ae});var r=d(32013),u=d(65619),W=d(83620),e=d(52572),O=d(59773),v=d(32181),oe=d(69384),K=d(99796),B=d(13389),I=d(30046),z=d(22263),c=d(65879),F=d(75187),V=d(75263);let ae=(()=>{var U;class H{constructor(M,S,m){this.router=M,this.route=S,this.authenticationService=m,this.destroy$=new r.x,this.activeTabSubj$=new u.X(null),this.contentParams={},this.tabs=[],this.activeTab$=this.activeTabSubj$.asObservable().pipe((0,W.b)(1)),(0,e.a)([this.activeTab$,this.route.queryParams]).pipe((0,O.R)(this.destroy$),(0,W.b)(1),(0,v.h)(([y])=>!(!y||!this.authenticationService.user))).subscribe(()=>this.storeState()),this.authenticationService.isAuthenticated$.pipe((0,O.R)(this.destroy$),(0,oe.G)(),(0,v.h)(([y,w])=>!w&&y)).subscribe(()=>{this.tabs.length&&this.removeAllTabs(),this.router.navigate(["data-studio"])})}destroy(){this.destroy$.next(null),this.destroy$.complete()}activateTab(M){const S=this.tabs.find(m=>M.tabId===m.tabId);S?this.activeTabSubj$.next(S):(this.tabs.push(M),M.isLoaded$.subscribe(()=>this.activeTabSubj$.next(M)))}removeAllTabs(){for(let M of this.tabs)localStorage.removeItem(`store-${M.tabId}`);this.tabs.splice(0,this.tabs.length),this.storeState()}removeUnActiveTabs(){let M=0;for(;M<this.tabs.length;)this.tabs[M]===this.activeTab?M++:(localStorage.removeItem(`store-${this.tabs[M].tabId}`),this.tabs.splice(M,1));this.storeState()}removeTab(M){const S=this.tabs.indexOf(M);S>=0?(this.tabs.splice(S,1),this.tabs.length||this.activeTabSubj$.next(null),this.storeState(),localStorage.removeItem(`store-${M.tabId}`)):console.warn("Can't find tab to remove.")}removeAppTabs(M,S){let m=null;const y=this.activeTab;S.forEach(w=>{const R=this.getTabAppLinkKey(M,w),N=this.tabs.findIndex(J=>R===this.getTabKey(J));if(-1!==N){const J=this.tabs[N];(J===y||J===m)&&this.tabs.length>1&&(m=this.tabs[N?N-1:N+1]),this.removeTab(J)}}),m&&this.activateTab(m)}removeConnectionTab(M){let S=null;const m=this.activeTab,y=(0,I.MU)(M)?.toLowerCase(),w=this.tabs.findIndex(R=>y===this.getTabKey(R).toLowerCase());if(-1!=w){const R=this.tabs[w];R===m&&this.tabs.length>1&&(S=this.tabs[w?w-1:w+1]),this.removeTab(R)}S&&this.activateTab(S)}reloadSqlTab(M){const S=(0,I.MU)(M)?.toLowerCase(),m=this.tabs.find(y=>S===this.getTabKey(y).toLowerCase());m&&m.content?.reload(!0)}popContentParameter(M){const S=this.contentParams[M];return this.contentParams[M]="",S}nextUntitledNumber(M){const S=this.tabs.filter(m=>(0,I.$P)(m.tabHeader)).map(m=>parseInt(m.tabHeader.replace(z.Bi,"").replace(M,"")))??[0];return Math.max(...S,0)+1}addNewAppTab(M,S,m="",y){m&&(m+="/");const w=`${m}${z.Bi}${this.nextUntitledNumber(S)}.${S}`;this.contentParams[w]=y||"";const R=this.authenticationService.user?.userName;this.router.navigate(["data-studio/app",M?.appOwner||R||z.m5,M?.appName||z.b5],{queryParams:{file:w}})}get activeTab(){return this.activeTabSubj$.getValue()}get tabsStoreKey(){return`tabs-state-${this.authenticationService.user?.userId}`}getTabAppLinkKey(M,S){return(0,I.Ew)(M)+"-"+(0,K.nV)(S)}getTabKeyFromUrlParams(M,S){return this.getTabKeyByLink({...M,...S})}getTabKey(M){return this.getTabKeyByLink(M.tabParams)}storeState(){localStorage.setItem(this.tabsStoreKey,JSON.stringify({tabs:this.tabs.map(M=>B.E.serialize(M)),activeTab:this.activeTab?.tabId}))}getTabKeyByLink(M){const{appOrSql:S,owner:m,name:y,file:w}=M;if("app"===S){const R={appName:y,appOwner:m},N=(0,K.x2)(w);return this.getTabAppLinkKey(R,N)}if("sql"===S)return`${m}-${y}`;throw new Error(`Unknown appOrSql [${S}]`)}initStateFromLocalStorage(){try{const M=localStorage.getItem(this.tabsStoreKey);if(M){const S=JSON.parse(M),m=S.tabs.map(w=>new B.E(JSON.parse(w))).filter(w=>w),y=new Set(this.tabs.map(w=>w.tabId));if(this.tabs.push(...m.filter(w=>!y.has(w.tabId))),S.activeTab){const w=this.tabs.find(R=>R.tabId===S.activeTab);w&&!this.hasTabInUrl()&&this.router.navigate(["data-studio",...w.routePath],{queryParams:w.queryParams})}}}catch(M){console.error(M),console.info("Failed to initialize tabs state from local storage")}}hasTabInUrl(){if(this.route.snapshot.queryParams.file)return!0;let M=this.route,S=M.snapshot.params;for(;M.firstChild;)M=M.firstChild,S={...S,...M.snapshot.params};return!("sql"!==S.appOrSql||!S.name||!S.owner)}}return(U=H).\u0275fac=function(M){return new(M||U)(c.LFG(F.F0),c.LFG(F.gz),c.LFG(V.$h))},U.\u0275prov=c.Yz7({token:U,factory:U.\u0275fac}),H})()},37282:(_e,le,d)=>{d.d(le,{DF:()=>e,Fq:()=>B});var r=d(65879),u=d(56223);const W={provide:u.JU,useExisting:(0,r.Gpc)(()=>e),multi:!0};let e=(()=>{var I;class z{constructor(){this.btnCheckboxTrue=!0,this.btnCheckboxFalse=!1,this.state=!1,this.isDisabled=!1,this.onChange=Function.prototype,this.onTouched=Function.prototype}onClick(){this.isDisabled||(this.toggle(!this.state),this.onChange(this.value))}ngOnInit(){this.toggle(this.trueValue===this.value)}get trueValue(){return!(typeof this.btnCheckboxTrue<"u")||this.btnCheckboxTrue}get falseValue(){return typeof this.btnCheckboxFalse<"u"&&this.btnCheckboxFalse}toggle(F){this.state=F,this.value=this.state?this.trueValue:this.falseValue}writeValue(F){this.state=this.trueValue===F,this.value=F?this.trueValue:this.falseValue}setDisabledState(F){this.isDisabled=F}registerOnChange(F){this.onChange=F}registerOnTouched(F){this.onTouched=F}}return(I=z).\u0275fac=function(F){return new(F||I)},I.\u0275dir=r.lG2({type:I,selectors:[["","btnCheckbox",""]],hostVars:3,hostBindings:function(F,V){1&F&&r.NdJ("click",function(){return V.onClick()}),2&F&&(r.uIk("aria-pressed",V.state),r.ekj("active",V.state))},inputs:{btnCheckboxTrue:"btnCheckboxTrue",btnCheckboxFalse:"btnCheckboxFalse"},features:[r._Bn([W])]}),z})();const O={provide:u.JU,useExisting:(0,r.Gpc)(()=>v),multi:!0};let v=(()=>{var I;class z{get value(){return this.group?this.group.value:this._value}set value(F){this.group?this.group.value=F:(this._value=F,this._onChange(F))}get disabled(){return this._disabled}set disabled(F){this.setDisabledState(F)}get controlOrGroupDisabled(){return!!(this.disabled||this.group&&this.group.disabled)||void 0}get hasDisabledClass(){return this.controlOrGroupDisabled&&!this.isActive}get isActive(){return this.btnRadio===this.value}get tabindex(){if(!this.controlOrGroupDisabled)return this.isActive||null==this.group?0:-1}get hasFocus(){return this._hasFocus}constructor(F,V,ae,U){this.el=F,this.cdr=V,this.renderer=ae,this.group=U,this.onChange=Function.prototype,this.onTouched=Function.prototype,this.uncheckable=!1,this.role="radio",this._disabled=!1,this._hasFocus=!1}toggleIfAllowed(){this.canToggle()&&(this.value=this.uncheckable&&this.btnRadio===this.value?void 0:this.btnRadio)}onSpacePressed(F){this.toggleIfAllowed(),F.preventDefault()}focus(){this.el.nativeElement.focus()}onFocus(){this._hasFocus=!0}onBlur(){this._hasFocus=!1,this.onTouched()}canToggle(){return!this.controlOrGroupDisabled&&(this.uncheckable||this.btnRadio!==this.value)}ngOnChanges(F){"uncheckable"in F&&(this.uncheckable=!1!==this.uncheckable&&typeof this.uncheckable<"u")}_onChange(F){this.group?this.group.value=F:(this.onTouched(),this.onChange(F))}writeValue(F){this.value=F,this.cdr.markForCheck()}registerOnChange(F){this.onChange=F}registerOnTouched(F){this.onTouched=F}setDisabledState(F){this._disabled=F,F?this.renderer.setAttribute(this.el.nativeElement,"disabled","disabled"):this.renderer.removeAttribute(this.el.nativeElement,"disabled")}}return(I=z).\u0275fac=function(F){return new(F||I)(r.Y36(r.SBq),r.Y36(r.sBO),r.Y36(r.Qsj),r.Y36((0,r.Gpc)(()=>K),8))},I.\u0275dir=r.lG2({type:I,selectors:[["","btnRadio",""]],hostVars:8,hostBindings:function(F,V){1&F&&r.NdJ("click",function(){return V.toggleIfAllowed()})("keydown.space",function(U){return V.onSpacePressed(U)})("focus",function(){return V.onFocus()})("blur",function(){return V.onBlur()}),2&F&&(r.uIk("aria-disabled",V.controlOrGroupDisabled)("aria-checked",V.isActive)("role",V.role)("tabindex",V.tabindex),r.ekj("disabled",V.hasDisabledClass)("active",V.isActive))},inputs:{btnRadio:"btnRadio",uncheckable:"uncheckable",value:"value",disabled:"disabled"},features:[r._Bn([O]),r.TTD]}),z})();const oe={provide:u.JU,useExisting:(0,r.Gpc)(()=>K),multi:!0};let K=(()=>{var I;class z{constructor(F){this.cdr=F,this.onChange=Function.prototype,this.onTouched=Function.prototype,this.role="radiogroup",this._disabled=!1}get value(){return this._value}set value(F){this._value=F,this.onChange(F)}get disabled(){return this._disabled}get tabindex(){return this._disabled?null:0}writeValue(F){this._value=F,this.cdr.markForCheck()}registerOnChange(F){this.onChange=F}registerOnTouched(F){this.onTouched=F}setDisabledState(F){this.radioButtons&&(this._disabled=F,this.radioButtons.forEach(V=>{V.setDisabledState(F)}),this.cdr.markForCheck())}onFocus(){if(this._disabled)return;const F=this.getActiveOrFocusedRadio();if(F)F.focus();else if(this.radioButtons){const V=this.radioButtons.find(ae=>!ae.disabled);V&&V.focus()}}onBlur(){this.onTouched&&this.onTouched()}selectNext(F){this.selectInDirection("next"),F.preventDefault()}selectPrevious(F){this.selectInDirection("previous"),F.preventDefault()}selectInDirection(F){if(this._disabled)return;function V(U,H){let M=(U+("next"===F?1:-1))%H.length;return M<0&&(M=H.length-1),M}const ae=this.getActiveOrFocusedRadio();if(ae&&this.radioButtons){const U=this.radioButtons.toArray(),H=U.indexOf(ae);for(let L=V(H,U);L!==H;L=V(L,U))if(U[L].canToggle()){U[L].toggleIfAllowed(),U[L].focus();break}}}getActiveOrFocusedRadio(){if(this.radioButtons)return this.radioButtons.find(F=>F.isActive)||this.radioButtons.find(F=>F.hasFocus)}}return(I=z).\u0275fac=function(F){return new(F||I)(r.Y36(r.sBO))},I.\u0275dir=r.lG2({type:I,selectors:[["","btnRadioGroup",""]],contentQueries:function(F,V,ae){if(1&F&&r.Suo(ae,v,4),2&F){let U;r.iGM(U=r.CRH())&&(V.radioButtons=U)}},hostVars:2,hostBindings:function(F,V){1&F&&r.NdJ("focus",function(){return V.onFocus()})("blur",function(){return V.onBlur()})("keydown.ArrowRight",function(U){return V.selectNext(U)})("keydown.ArrowDown",function(U){return V.selectNext(U)})("keydown.ArrowLeft",function(U){return V.selectPrevious(U)})("keydown.ArrowUp",function(U){return V.selectPrevious(U)}),2&F&&r.uIk("role",V.role)("tabindex",V.tabindex)},features:[r._Bn([oe])]}),z})(),B=(()=>{var I;class z{static forRoot(){return{ngModule:z,providers:[]}}}return(I=z).\u0275fac=function(F){return new(F||I)},I.\u0275mod=r.oAB({type:I}),I.\u0275inj=r.cJS({}),z})()}}]);