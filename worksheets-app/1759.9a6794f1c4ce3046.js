"use strict";(self.webpackChunkworksheets_app_runtime=self.webpackChunkworksheets_app_runtime||[]).push([[1759],{28169:(G,A,t)=>{t.d(A,{b:()=>x});var e=t(65879);let x=(()=>{var v;class g{constructor(){this.message=""}}return(v=g).\u0275fac=function(s){return new(s||v)},v.\u0275cmp=e.Xpm({type:v,selectors:[["app-loading-dialog"]],inputs:{message:"message"},decls:5,vars:1,consts:[[1,"modal-body","py-8","d-flex","flex-column"],[1,"d-flex","justify-content-center","align-items-center","w-100","spinner","flex-column"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(s,F){1&s&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),e._uU(4),e.qZA()()()()),2&s&&(e.xp6(4),e.Oqu(F.message||"Loading..."))}}),g})()},93613:(G,A,t)=>{t.d(A,{K:()=>f});var e=t(65879),x=t(65619),v=t(32013),g=t(37398),o=t(59773),s=t(93997),F=t(69384),Z=t(32181),N=t(94664),D=t(33374),$=t(72500),S=t(96814);function j(p,h){if(1&p){const b=e.EpF();e.TgZ(0,"li",14),e._uU(1),e._UZ(2,"i",15),e.TgZ(3,"i",16),e.NdJ("click",function(){const E=e.CHM(b).index,W=e.oxw();return e.KtG(W.removeFilter(E))}),e.qZA()()}if(2&p){const b=h.$implicit;e.xp6(1),e.hij(" ",b.columnName," ")}}function L(p,h){if(1&p){const b=e.EpF();e.TgZ(0,"li",19)(1,"a",20),e.NdJ("click",function(){const E=e.CHM(b).$implicit,W=e.oxw(2);return e.KtG(W.addFilter(E))}),e._uU(2),e.qZA()()}if(2&p){const b=h.$implicit;e.xp6(2),e.Oqu(b.name)}}function K(p,h){if(1&p&&(e.TgZ(0,"ul",17),e.YNc(1,L,3,1,"li",18),e.qZA()),2&p){const b=e.oxw();e.xp6(1),e.Q6J("ngForOf",b.fields)}}let J=(()=>{var p;class h{constructor(m){this.dialogRef=m,this.config={},this.filters=[],this.fields=[]}ngOnInit(){this.filters=[...this.config.filters],this.setFields()}onApply(){this.dialogRef.close(this.filters)}onClose(){this.dialogRef.close()}addFilter(m){this.filters.push({columnName:m.name}),this.setFields()}removeFilter(m){this.filters.splice(m,1)}setFields(){const m=this.filters.map(C=>C.columnName);this.fields=this.config.fields.filter(C=>!m.includes(C.name))}}return(p=h).\u0275fac=function(m){return new(m||p)(e.Y36(D.z))},p.\u0275cmp=e.Xpm({type:p,selectors:[["app-manage-filters"]],inputs:{config:"config"},decls:19,vars:2,consts:[[1,"modal-header"],[1,"modal-title","pull-left"],["type","button","aria-label","Close",1,"close","pull-right",3,"click"],["aria-hidden","true"],[1,"modal-body","px-4","d-flex","flex-column","h-100"],["dragula","filters",1,"container"],["class","row py-1 my-1 pl-2 border rounded align-items-baseline",4,"ngFor","ngForOf"],["dropdown","",1,"btn-group","mr-2","mb-2","align-self-baseline"],["id","button-basic","dropdownToggle","","type","button","aria-controls","dropdown-basic",1,"btn","btn-primary","dropdown-toggle","align-self-baseline","btn-sm",3,"disabled"],["id","dropdown-basic","class","dropdown-menu overflow-auto","role","menu","aria-labelledby","button-basic",4,"dropdownMenu"],[1,"modal-footer","flex-column"],[1,"row","w-100","mx-0","px-0"],["type","button",1,"btn","btn-primary","ml-auto","mr-2",3,"click"],["type","button",1,"btn","btn-light",3,"click"],[1,"row","py-1","my-1","pl-2","border","rounded","align-items-baseline"],[1,"fa","fa-arrows","ml-auto","handle"],[1,"fa","fa-remove","mx-2","cursor-pointer",3,"click"],["id","dropdown-basic","role","menu","aria-labelledby","button-basic",1,"dropdown-menu","overflow-auto"],["role","menuitem",4,"ngFor","ngForOf"],["role","menuitem"],[1,"dropdown-item","cursor-pointer",3,"click"]],template:function(m,C){1&m&&(e.TgZ(0,"div",0)(1,"h4",1),e._uU(2,"Manage Filters"),e.qZA(),e.TgZ(3,"button",2),e.NdJ("click",function(){return C.onClose()}),e.TgZ(4,"span",3),e._uU(5,"\xd7"),e.qZA()()(),e.TgZ(6,"div",4)(7,"ul",5),e.YNc(8,j,4,1,"li",6),e.qZA(),e.TgZ(9,"div",7)(10,"button",8),e._uU(11,"Add filter "),e.qZA(),e.YNc(12,K,2,1,"ul",9),e.qZA()(),e.TgZ(13,"div",10)(14,"div",11)(15,"button",12),e.NdJ("click",function(){return C.onApply()}),e._uU(16,"Apply"),e.qZA(),e.TgZ(17,"button",13),e.NdJ("click",function(){return C.onClose()}),e._uU(18,"Cancel"),e.qZA()()()),2&m&&(e.xp6(8),e.Q6J("ngForOf",C.filters),e.xp6(2),e.Q6J("disabled",!C.fields.length))},dependencies:[$.Hz,$.Mq,$.TO,S.sg],styles:[".fa-arrows[_ngcontent-%COMP%]{cursor:grab}"]}),h})();var M=t(28252),w=t(43829),r=t(68171);function l(p,h){if(1&p&&(e.TgZ(0,"div",6),e._UZ(1,"app-data-grid-filter",7),e.qZA()),2&p){const b=h.$implicit,m=e.oxw();e.xp6(1),e.Q6J("columnName",b.name)("dataSource",m.dataSource)}}function i(p,h){if(1&p){const b=e.EpF();e.TgZ(0,"li",15),e.NdJ("click",function(C){return C.stopImmediatePropagation()}),e.TgZ(1,"div",16)(2,"app-search",17),e.NdJ("search",function(C){e.CHM(b);const E=e.oxw(2);return e.KtG(E.onSearch(C))}),e.qZA()()()}}function n(p,h){if(1&p){const b=e.EpF();e.TgZ(0,"li",9)(1,"a",10),e.NdJ("click",function(){const E=e.CHM(b).$implicit,W=e.oxw(2);return e.KtG(W.addFilter(E))}),e._uU(2),e.qZA()()}if(2&p){const b=h.$implicit;e.xp6(2),e.Oqu(b.name)}}function c(p,h){if(1&p){const b=e.EpF();e.TgZ(0,"ul",8)(1,"li",9)(2,"a",10),e.NdJ("click",function(){e.CHM(b);const C=e.oxw();return e.KtG(C.manageFilter())}),e._UZ(3,"i",11),e._uU(4," Manage Filter"),e.qZA()(),e.YNc(5,i,3,0,"li",12),e._UZ(6,"li",13),e.YNc(7,n,3,1,"li",14),e.ALo(8,"async"),e.qZA()}if(2&p){const b=e.oxw();e.xp6(5),e.Q6J("ngIf",b.fields.length>5||b.search$.value),e.xp6(2),e.Q6J("ngForOf",e.lcZ(8,2,b.filteredFields$))}}let f=(()=>{var p;class h{constructor(m){this.dialogService=m,this.filtersBarChanged=new e.vpe,this.search$=new x.X(""),this.fields=[],this.selectedFilters$=new x.X([]),this.destroy$=new v.x}ngOnInit(){this.filtersBar&&this.selectedFilters$.next(this.filtersBar),this.selectedFields$=this.selectedFilters$.pipe((0,g.U)(C=>C?C.map(E=>this.fields.find(W=>W.name===E.columnName)).filter(E=>!!E).map(E=>E):[])),this.selectedFilters$.pipe((0,o.R)(this.destroy$),(0,s.x)((C,E)=>JSON.stringify(C)===JSON.stringify(E)),(0,F.G)()).subscribe(([C,E])=>{this.filtersBarChanged.emit(E)}),this.subscribeOnDataSource()}ngOnChanges({dataSource:m,filtersBar:C}){m?.firstChange||this.subscribeOnDataSource(),C&&!C.firstChange&&this.setFiltersBar(C.currentValue)}onSearch(m){this.search$.next(m)}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete()}addFilter(m){this.selectedFilters$.value.map(E=>E.columnName).includes(m.name)||this.selectedFilters$.next([...this.selectedFilters$.value,{columnName:m.name}])}manageFilter(){this.dialogService.open(J,{initialState:{config:{filters:this.selectedFilters$.value,fields:this.fields}}}).onClose$.pipe((0,Z.h)(m=>!!m)).subscribe(m=>this.selectedFilters$.next(m??[]))}setFiltersBar(m){this.selectedFilters$.next(m??[])}subscribeOnDataSource(){(0,M.m)(this.dataSource),this.dataSource.fields$.pipe((0,o.R)(this.destroy$)).subscribe(m=>{this.fields=m??[],this.setFiltersBar(this.filtersBar??[])}),this.filteredFields$=this.dataSource.fields$.pipe((0,o.R)(this.destroy$),(0,N.w)(m=>this.search$.pipe((0,g.U)(C=>m.filter(E=>E.name.toLowerCase().includes(C.toLowerCase()))))))}}return(p=h).\u0275fac=function(m){return new(m||p)(e.Y36(D.x))},p.\u0275cmp=e.Xpm({type:p,selectors:[["app-data-filters"]],inputs:{dataSource:"dataSource",filtersBar:"filtersBar"},outputs:{filtersBarChanged:"filtersBarChanged"},features:[e.TTD],decls:7,vars:3,consts:[[1,"row","m-0"],["class","pr-2",4,"ngFor","ngForOf"],["dropdown","","placement","bottom right",1,"btn-group","mr-2"],["id","panel-filters-button-basic","dropdownToggle","","type","button","aria-controls","panel-filters-dropdown-basic","triggers","mouseenter:mouseleave","containerClass","applied-popover",1,"btn","btn-sm","btn-outline-secondary","dropdown-toggle","align-self-baseline"],[1,"fa","fa-filter"],["id","panel-filters-dropdown-basic","class","dropdown-menu overflow-auto dropdown-menu-right","role","menu","aria-labelledby","panel-filters-button-basic",4,"dropdownMenu"],[1,"pr-2"],[3,"columnName","dataSource"],["id","panel-filters-dropdown-basic","role","menu","aria-labelledby","panel-filters-button-basic",1,"dropdown-menu","overflow-auto","dropdown-menu-right"],["role","menuitem"],[1,"dropdown-item","cursor-pointer",3,"click"],[1,"fa","fa-cogs"],["role","menuitem",3,"click",4,"ngIf"],[1,"divider","dropdown-divider"],["role","menuitem",4,"ngFor","ngForOf"],["role","menuitem",3,"click"],[1,"dropdown-item","input-group","py-0"],[3,"search"]],template:function(m,C){1&m&&(e.TgZ(0,"div",0),e.YNc(1,l,2,2,"div",1),e.ALo(2,"async"),e.TgZ(3,"div",2)(4,"button",3),e._UZ(5,"i",4),e.qZA(),e.YNc(6,c,9,4,"ul",5),e.qZA()()),2&m&&(e.xp6(1),e.Q6J("ngForOf",e.lcZ(2,1,C.selectedFields$)))},dependencies:[$.Hz,$.Mq,$.TO,S.sg,S.O5,w.g,r.E,S.Ov],styles:['[_ngcontent-%COMP%]:root{--bg: #fff;--body-bg: #e4e5e6;--header-bg: #ebedef;--color: #4f5d73;--border-color: #c4c9d0;--ws-alt: #f7f7f7;--form-input-bg: #fff;--form-input-color: #768192;--nav-link-color: #8a93a2;--secondary-color: #c4c9d0;--opacity: .05;--hover: "#f0f3f5";--ag-edited-cell-bg: "rgba(255, 218, 218, 0.6)";--ag-added-cell-bg: "rgba(226, 255, 226, 0.5)"}.border[dropdown][_ngcontent-%COMP%]{border-color:transparent}.dropdown-menu[_ngcontent-%COMP%]{max-height:500px}.fa.fa-cogs[_ngcontent-%COMP%]{color:#636f83}  .applied-popover{min-width:100px}#panel-filters-dropdown-basic[_ngcontent-%COMP%]{min-width:250px}div.dropdown-item[_ngcontent-%COMP%]:hover{background:inherit}']}),h})()},89250:(G,A,t)=>{t.d(A,{U:()=>J});var e=t(15861),x=t(3202),v=t(21473),g=t(49568),o=t(13509),s=t(65879),F=t(69569),Z=t(8050),N=t(71997),D=t(33374),$=t(96814),S=t(56223);function j(M,w){if(1&M&&(s.TgZ(0,"span",18),s._uU(1),s.qZA()),2&M){const r=s.oxw();s.xp6(1),s.hij("",r.progressPct," ")}}function L(M,w){1&M&&s._UZ(0,"span",19)}function K(M,w){1&M&&(s.ynx(0),s._uU(1,"Open File"),s.BQk())}let J=(()=>{var M;class w{constructor(l,i,n,c){this.notificationService=l,this.tabsService=i,this.studioService=n,this.dialogRef=c,this.fileService=new o.j5,this.take="1000",this.skip="",this.containsText="",this.distinct="",this.progressPct=""}ngOnInit(){this.take=this.options?.take?String(this.options?.take):"",this.skip=this.options?.skip?String(this.options?.skip):"",this.containsText=this.options?.containsText?String(this.options?.containsText):"",this.distinct=this.options?.distinct?String(this.options?.distinct):""}onFileChange(l){var i=this;return(0,e.Z)(function*(){const n=l?.files[0];if(!n)return void i.notificationService.error("No file selected");let c={take:(0,x.parseNumberOrNull)(i.take)||void 0,skip:(0,x.parseNumberOrNull)(i.skip)||void 0,containsText:i.containsText||void 0,distinct:i.distinct||void 0};c={...i.options||{},...c};const f={parser:new g.cB,fileName:n.name,count:0,finished:!1,data:[],chunkItems:[]};i.progressPct="Reading ...";try{var p;yield i.fileService.openTextFilePartially(n,function(h,b){return(p=p||(0,e.Z)(function*(m,C){return i.progressPct=`Reading ${C} %`,yield i.fileService.processJsonChunk(m,f,c)})).apply(this,arguments)},i.options?.chunkSize),i.dialogRef.close({fileName:n.name,fileSize:n.size,data:f.data})}catch(h){i.dialogRef.close({fileName:n.name,fileSize:n.size,errorMessage:(0,v.e$)(h)})}})()}onGenerateJspy(){this.tabsService.addNewAppTab(this.studioService.currentApp,"jspy","",`# press run button and select JSON/JSV file\nreturn openFileAsArray({\n  #filter: r => r.id == 1, # filter predicate\n  #map: r => # add transformation logic here\n  take: ${this.take}\n  #skip: 3\n}).data\n    `),this.dialogRef.close(null)}onCancel(){this.dialogRef.close(null)}}return(M=w).\u0275fac=function(l){return new(l||M)(s.Y36(F.g),s.Y36(Z.x),s.Y36(N.F),s.Y36(D.z))},M.\u0275cmp=s.Xpm({type:M,selectors:[["app-open-file-settings-dialog"]],inputs:{options:"options"},decls:43,vars:12,consts:[[1,"modal-header"],[1,"pull-left"],[1,"modal-title"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body","px-4","d-flex","flex-column","h-100","overflow-hidden"],[1,"row","mr-0","mb-2","flex-fill"],["for","folder",1,"col-4","col-form-label"],[1,"form-control","col",3,"ngModel","disabled","ngModelChange"],[1,"row","mr-0","mt-3","flex-fill"],[1,"modal-footer","d-flex","flex-row"],["type","button",1,"btn","btn-sm","btn-outline-secondary","mr-auto",3,"click"],["class","align-middle badge badge-info p-2",4,"ngIf"],["for","my-file-selector",1,"btn","btn-sm","btn-primary","ml-auto","mr-2"],["id","my-file-selector","type","file",1,"d-none",3,"disabled","change"],["class","spinner-border",4,"ngIf"],[4,"ngIf"],["type","button",1,"btn","btn-sm","btn-light",3,"click"],[1,"align-middle","badge","badge-info","p-2"],[1,"spinner-border"]],template:function(l,i){1&l&&(s.TgZ(0,"div",0)(1,"div",1)(2,"h4",2),s._uU(3," Open file partially "),s.qZA()(),s.TgZ(4,"button",3),s.NdJ("click",function(){return i.onCancel()}),s.TgZ(5,"span",4),s._uU(6,"\xd7"),s.qZA()()(),s.TgZ(7,"div",5)(8,"div",6)(9,"label",7),s._uU(10,"Take:"),s.qZA(),s.TgZ(11,"input",8),s.NdJ("ngModelChange",function(c){return i.take=c}),s.qZA()(),s.TgZ(12,"div",6)(13,"label",7),s._uU(14,"Skip:"),s.qZA(),s.TgZ(15,"input",8),s.NdJ("ngModelChange",function(c){return i.skip=c}),s.qZA()(),s.TgZ(16,"div",6)(17,"label",7),s._uU(18,"Contains:"),s.qZA(),s.TgZ(19,"input",8),s.NdJ("ngModelChange",function(c){return i.containsText=c}),s.qZA()(),s.TgZ(20,"div",6)(21,"label",7),s._uU(22,"Distinct:"),s.qZA(),s.TgZ(23,"input",8),s.NdJ("ngModelChange",function(c){return i.distinct=c}),s.qZA()(),s.TgZ(24,"div",9)(25,"span"),s._uU(26,"* Specify how many rows to "),s.TgZ(27,"b"),s._uU(28,"take"),s.qZA(),s._uU(29," or to "),s.TgZ(30,"b"),s._uU(31,"skip"),s.qZA(),s._uU(32,". Works well with very big files"),s.qZA()()(),s.TgZ(33,"div",10)(34,"label",11),s.NdJ("click",function(){return i.onGenerateJspy()}),s._uU(35,"Generate JSPY"),s.qZA(),s.YNc(36,j,2,1,"span",12),s.TgZ(37,"label",13)(38,"input",14),s.NdJ("change",function(c){return i.onFileChange(c.target)}),s.qZA(),s.YNc(39,L,1,0,"span",15),s.YNc(40,K,2,0,"ng-container",16),s.qZA(),s.TgZ(41,"label",17),s.NdJ("click",function(){return i.onCancel()}),s._uU(42,"Cancel"),s.qZA()()),2&l&&(s.xp6(11),s.Q6J("ngModel",i.take)("disabled",!!i.progressPct),s.xp6(4),s.Q6J("ngModel",i.skip)("disabled",!!i.progressPct),s.xp6(4),s.Q6J("ngModel",i.containsText)("disabled",!!i.progressPct),s.xp6(4),s.Q6J("ngModel",i.distinct)("disabled",!!i.progressPct),s.xp6(13),s.Q6J("ngIf",i.progressPct),s.xp6(2),s.Q6J("disabled",!!i.progressPct),s.xp6(1),s.Q6J("ngIf",i.progressPct),s.xp6(1),s.Q6J("ngIf",!i.progressPct))},dependencies:[$.O5,S.Fj,S.JJ,S.On],encapsulation:2}),w})()},18942:(G,A,t)=>{t.d(A,{W:()=>i});var e=t(612),x=t(16321),v=t(76662),g=t(24530),o=t(65879),s=t(96814),F=t(72237),Z=t(32013),N=t(3202),D=t(53546);function $(n,c){1&n&&(o.TgZ(0,"div",3)(1,"div",4)(2,"span",5),o._uU(3,"Evaluating..."),o.qZA()()())}let S=(()=>{var n;class c{constructor(){this.defaultColDef={editable:!1,sortable:!1,suppressFiltersToolPanel:!0,suppressMovable:!0,suppressColumnsToolPanel:!0,suppressMenu:!0},this.gridOptions={},this.columnDefs=[{field:"level",width:70},{field:"time",width:80,valueFormatter:p=>(0,N.dateToString)(p.value).slice(11,19)},{field:"message",flex:1}],this.destroy$=new Z.x}onGridReady(p){this.gridApi=p.api}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete()}}return(n=c).\u0275fac=function(p){return new(p||n)},n.\u0275cmp=o.Xpm({type:n,selectors:[["app-run-logs"]],inputs:{dataContext:"dataContext"},decls:3,vars:6,consts:[[1,"d-flex","flex-column","h-100"],["class","d-flex justify-content-center align-items-center w-100 spinner flex-column mb-2",4,"ngIf"],["rowSelection","multiple",1,"ag-theme-balham","h-100","flex-fill","w-100",3,"columnDefs","defaultColDef","enableRangeSelection","rowData","gridOptions","gridReady"],[1,"d-flex","justify-content-center","align-items-center","w-100","spinner","flex-column","mb-2"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(p,h){1&p&&(o.TgZ(0,"div",0),o.YNc(1,$,4,0,"div",1),o.TgZ(2,"ag-grid-angular",2),o.NdJ("gridReady",function(m){return h.onGridReady(m)}),o.qZA()()),2&p&&(o.xp6(1),o.Q6J("ngIf",null==h.dataContext?null:h.dataContext.evaluating),o.xp6(1),o.Q6J("columnDefs",h.columnDefs)("defaultColDef",h.defaultColDef)("enableRangeSelection",!0)("rowData",null==h.dataContext?null:h.dataContext.logs)("gridOptions",h.gridOptions))},dependencies:[s.O5,D.N8],encapsulation:2}),c})();function j(n,c){if(1&n&&(o.TgZ(0,"p",8),o._uU(1),o.qZA()),2&n){const f=c.$implicit;o.xp6(1),o.Oqu(f)}}function L(n,c){if(1&n&&(o.TgZ(0,"alert",6)(1,"strong"),o._uU(2,"Runtime Error:"),o.qZA(),o.YNc(3,j,2,1,"p",7),o.qZA()),2&n){const f=o.oxw().ngIf;o.xp6(3),o.Q6J("ngForOf",f.errors)}}function K(n,c){if(1&n&&o._UZ(0,"app-content-explorer",15),2&n){const f=o.oxw(2).$implicit;o.Q6J("formatter",!1)("data",f.data)}}function J(n,c){if(1&n&&o._UZ(0,"app-run-logs",16),2&n){const f=o.oxw(2).$implicit;o.Q6J("dataContext",f.data)}}function M(n,c){if(1&n&&(o.ynx(0,12),o.YNc(1,K,1,2,"app-content-explorer",13),o.YNc(2,J,1,1,"app-run-logs",14),o.BQk()),2&n){const f=o.oxw().$implicit,p=o.oxw(2);o.Q6J("ngSwitch",f.type),o.xp6(1),o.Q6J("ngSwitchCase",p.ShowInTypes.ObjectExplorer),o.xp6(1),o.Q6J("ngSwitchCase",p.ShowInTypes.RunningLog)}}function w(n,c){1&n&&(o.TgZ(0,"div",17),o._uU(1,"[No data]"),o.qZA())}function r(n,c){if(1&n){const f=o.EpF();o.TgZ(0,"tab",9),o.NdJ("selectTab",function(){o.CHM(f);const h=o.oxw(2);return o.KtG(h.resize())}),o.YNc(1,M,3,3,"ng-container",10),o.YNc(2,w,2,0,"div",11),o.qZA()}if(2&n){const f=c.$implicit;o.Q6J("heading",f.title||"Tab "+c.index),o.xp6(1),o.Q6J("ngIf",void 0!==f.data),o.xp6(1),o.Q6J("ngIf",!f.data)}}function l(n,c){if(1&n&&(o.ynx(0),o.YNc(1,L,4,1,"alert",2),o.TgZ(2,"tabset",3,4),o.YNc(4,r,3,3,"tab",5),o.qZA(),o.BQk()),2&n){const f=c.ngIf;o.xp6(1),o.Q6J("ngIf",f.errors&&f.errors.length),o.xp6(3),o.Q6J("ngForOf",f.showInItems)}}let i=(()=>{var n;class c{constructor(){this.ShowInTypes=g.r}resize(){x.z.schedule(()=>{this.contentExplorers?.toArray()?.forEach(p=>p.resize())})}activateLastTab(){this.tabset&&(this.tabset.tabs[this.tabset.tabs.length-1].active=!0),this.resize()}}return(n=c).\u0275fac=function(p){return new(p||n)},n.\u0275cmp=o.Xpm({type:n,selectors:[["app-jspy-results-panel"]],viewQuery:function(p,h){if(1&p&&(o.Gf(e.AH,5),o.Gf(v.S,5)),2&p){let b;o.iGM(b=o.CRH())&&(h.tabset=b.first),o.iGM(b=o.CRH())&&(h.contentExplorers=b)}},inputs:{evaluationContext:"evaluationContext"},decls:2,vars:1,consts:[[1,"card","overflow-hidden","mb-0","w-100","h-100","p-2"],[4,"ngIf"],["type","danger",4,"ngIf"],[1,"tabset-fx","nav-tabs-boxed"],["resultTabs",""],[3,"heading","selectTab",4,"ngFor","ngForOf"],["type","danger"],["class","mb-0",4,"ngFor","ngForOf"],[1,"mb-0"],[3,"heading","selectTab"],[3,"ngSwitch",4,"ngIf"],["class","m-4",4,"ngIf"],[3,"ngSwitch"],["class","d-block h-100",3,"formatter","data",4,"ngSwitchCase"],["class","w-100 h-100",3,"dataContext",4,"ngSwitchCase"],[1,"d-block","h-100",3,"formatter","data"],[1,"w-100","h-100",3,"dataContext"],[1,"m-4"]],template:function(p,h){1&p&&(o.TgZ(0,"div",0),o.YNc(1,l,5,2,"ng-container",1),o.qZA()),2&p&&(o.xp6(1),o.Q6J("ngIf",h.evaluationContext))},dependencies:[s.sg,s.O5,s.RF,s.n9,F.wx,e.wW,e.AH,v.S,S],encapsulation:2}),c})()},52667:(G,A,t)=>{t.d(A,{c:()=>D});var e=t(96814),x=t(53546),v=t(90690),g=t(72237),o=t(30641),s=t(612),F=t(20362),Z=t(2048),N=t(65879);let D=(()=>{var $;class S{}return($=S).\u0275fac=function(L){return new(L||$)},$.\u0275mod=N.oAB({type:$}),$.\u0275inj=N.cJS({providers:[Z.N],imports:[e.ez,v.fX,g.nM,s.P4,o.UU,F.T,x.sF]}),S})()},24530:(G,A,t)=>{t.d(A,{c:()=>e,r:()=>x});var e=function(v){return v.Assert="assert",v.TryAssert="tryAssert",v.Print="print",v.Error="error",v.ShowInObjectExplorer="showInObjectExplorer",v.ShowInJSON="showInJSON",v.ShowAsserts="showAsserts",v.InputDialog="inputDialog",v.RenderPage="renderPage",v.OpenFileAsArray="openFileAsArray",v}(e||{}),x=function(v){return v.ObjectExplorer="object-explorer",v.JSON="JSON",v.RunningLog="running-log",v}(x||{})},2048:(G,A,t)=>{t.d(A,{N:()=>M});var e=t(15861),x=t(32013),v=t(16321),g=t(24530),o=t(58051),s=t(89250),F=t(85926),Z=t(18916),N=t(42793),D=new WeakMap,$=new WeakMap;class S{constructor(r,l,i){(0,F.Z)(this,D,{writable:!0,value:void 0}),(0,F.Z)(this,$,{writable:!0,value:void 0}),this.assert=r,this.dataContext=l,(0,N.Z)(this,D,1),this.status=!0,(0,N.Z)(this,$,i)}equal(r,l){return this.assertFunction(r,l,(i,n)=>i&&"object"==typeof i&&n&&"object"==typeof n?JSON.stringify(i)!==JSON.stringify(n):i===n,(i,n)=>`Expected '${i}', received '${n}'`)}notEqual(r,l){return this.assertFunction(r,l,(i,n)=>"object"==typeof i?JSON.stringify(i)!==JSON.stringify(n):i!==n,(i,n)=>`Expected '${i}' is the same as received '${n}'`)}isTruthy(r){return this.assertFunction(r,null,(l,i)=>!!l,(l,i)=>`Value '${l}' is not Truthy - https://developer.mozilla.org/en-US/docs/Glossary/Truthy`)}isFalsy(r){return this.assertFunction(r,null,(l,i)=>!l,(l,i)=>`Value '${l}' is not Falsy - https://developer.mozilla.org/en-US/docs/Glossary/Falsy`)}isTrue(r){return this.assertFunction(r,null,(l,i)=>!0===l,(l,i)=>`Value '${l}' is not true`)}isFalse(r){return this.assertFunction(r,null,(l,i)=>!1===l,(l,i)=>`Value '${l}' is not false`)}greaterThan(r,l){return this.assertFunction(r,l,(i,n)=>i>n,(i,n)=>`${i}' is not greater than ${n}`)}greaterOrEqualThan(r,l){return this.assertFunction(r,l,(i,n)=>i>=n,(i,n)=>`${i}' is not greater (or equal) than ${n}`)}inRange(r,l,i){return this.between(r,l,i)}between(r,l,i){return this.assertFunction(r,{min:l,max:i},(n,c)=>n>=c.min&&n<=c.max,(n,c)=>`${n}' is NOT in range of ${c.min} and ${c.max}`)}lessThan(r,l){return this.assertFunction(r,l,(i,n)=>i<n,(i,n)=>`${i}' is not lesser than ${n}`)}lessOrEqualThan(r,l){return this.assertFunction(r,l,(i,n)=>i<=n,(i,n)=>`${i}' is not lesser (or equal) than ${n}`)}assertFunction(r,l,i,n){var c;if("function"==typeof r&&(r=r(this.dataContext)),"function"==typeof l&&(l=l(this.dataContext)),!i(r,l))throw this.status=!1,this.message=`[${(0,Z.Z)(this,D)}] - ${n(r,l)}`,(0,Z.Z)(this,$).call(this,!1,this.message),new Error(`'${this.assert}' failed: ${this.message}`);return(0,Z.Z)(this,$).call(this,!0,""),(0,N.Z)(this,D,(c=(0,Z.Z)(this,D),++c)),this}}var L=t(21473),K=t(65879),J=t(33374);let M=(()=>{var w;class r{get editorInterpreter(){return this._editorInterpreter}get context(){return this.editorInterpreter?.context}get interpreter(){return this.editorInterpreter.interpreter}get runtimeContext(){return this._runtimeContext}constructor(i){var n;this.dialogService=i,this.loadingSubj$=new x.x,this._runtimeContext={logs:[],evaluating:!1},this.loading$=this.loadingSubj$.asObservable(),this._editorInterpreter=function j(w,r,l){const i=(0,o.Pi)(w),n=function c(){return{asserts:[],errors:[],showInItems:[],reset(){this.asserts=[],this.errors=[],this.showInItems=[]}}}();return i.addFunction(g.c.ShowInObjectExplorer,(h,b)=>{!function f(h){n.showInItems=[...n.showInItems,h]}({type:g.r.ObjectExplorer,data:h,title:b})}),i.addFunction(g.c.Print,(...h)=>{console.log(...h);const b=h.map(m=>"object"==typeof m?JSON.stringify(m):String(m)).join(", ");return l({level:"info",message:b,time:new Date}),h.length>0?h[0]:null}),i.addFunction(g.c.Assert,function p(h,b){if("boolean"==typeof b){if(l({level:b?"success":"fail",message:h||"",time:new Date}),n.asserts.push({success:!!b,name:h}),!b)throw Error(`Assert '${h}' failed`);return{status:!0,message:""}}return new S(h,b,function m(C,E){l({logId:h,level:C?"success":"fail",message:`${h}${E?":":""} ${E||""}`.trim(),time:new Date});const W=n.asserts?.find(O=>O.name===h);W?W.success&&(W.success=!!C,W.description=E):n.asserts.push({success:!!C,name:h,description:E})})}),i.addFunction(g.c.OpenFileAsArray,h=>r.open(s.U,{initialState:{options:h}}).onCloseAsync().then(b=>b?.errorMessage?Promise.reject(b.errorMessage):b)),{interpreter:i,context:n}}(function(c){return(n=n||(0,e.Z)(function*(f){return console.error(new Error(`Cannot import ${f}. JSPY module loader is not provided`)),f})).apply(this,arguments)},this.dialogService,c=>this.appendLogMessage(c.level,c.message?.substring(0,2500)||"",c.logId))}appendLogMessage(i,n,c){if(c){const f=this.runtimeContext.logs.find(p=>p.logKey===c);if(f)return void("error"!==f.level&&(f.level=i,f.message=n,"function"==typeof this.runtimeContext.onChanged&&this.runtimeContext.onChanged(this.runtimeContext.logs)))}this.runtimeContext.logs.push({level:i,logKey:c,message:n,time:new Date}),"function"==typeof this.runtimeContext.onChanged&&this.runtimeContext.onChanged(this.runtimeContext.logs)}run(i){var n=this;return(0,e.Z)(function*(){if(!n.context)throw new Error("Evaluation Context is not initialized");if(!n.interpreter)throw new Error("Interpreter is not initialized");n.startRuntimeOutputPanel(),n.loadingSubj$.next(!0);try{const c=yield n.jspyEvaluate(i);n.appendLogMessage("info","completed"),c&&n.context.showInItems.push({type:g.r.ObjectExplorer,title:"Return Value",data:c})}catch(c){n.appendLogMessage("error","JSPython evaluation failed: "+(0,L.e$)(c)),n.context.errors=[...n.context?.errors,(0,L.e$)(c)]}finally{v.z.schedule(()=>n.loadingSubj$.next(!1),100)}})()}cancel(){return this._evaluationContext&&(this._evaluationContext.cancellationToken.cancel=!0),!!this._editorInterpreter}startRuntimeOutputPanel(){this.runtimeContext.logs.splice(0,this.runtimeContext.logs.length),"function"==typeof this.runtimeContext.onChanged&&this.runtimeContext.onChanged(this.runtimeContext.logs),this.context&&(this.context.reset(),this.context.showInItems=[{type:g.r.RunningLog,title:"Runtime Output",data:this.runtimeContext}]),this.appendLogMessage("info","start")}jspyEvaluate({script:i,method:n,entryModule:c}){var f=this;return(0,e.Z)(function*(){if(!f.context)throw new Error("Evaluation Context is not initialized");if(!f.interpreter)throw new Error("Interpreter is not initialized");return yield f.interpreter.evaluate(i,{__env:{args:{},entryModule:c,entryFunction:n||"",runsAt:"WORKSHEETS Data Studio"}},n,c,p=>f._evaluationContext=p)})()}}return(w=r).\u0275fac=function(i){return new(i||w)(K.LFG(J.x))},w.\u0275prov=K.Yz7({token:w,factory:w.\u0275fac}),r})()},13389:(G,A,t)=>{t.d(A,{E:()=>x});var e=t(32013);class x{constructor({queryParams:g,tabHeader:o,tabId:s,tabParams:F,tabType:Z}){this.isLoadedSubj$=new e.x,this.isLoaded$=this.isLoadedSubj$.asObservable(),this.queryParams=g,this.tabId=s,this.tabHeader=o,this.tabParams=F,this.tabType=Z}set content(g){this.content_=g,this.content&&(this.isLoadedSubj$.next(!0),this.isLoadedSubj$.complete())}get content(){return this.content_}get routePath(){const{appOrSql:g,owner:o,name:s}=this.tabParams;return[g,o,s]}static serialize(g){return JSON.stringify({tabId:g.tabId,tabHeader:g.tabHeader,tabType:g.tabType,tabParams:g.tabParams,queryParams:g.queryParams})}static deserialize(g){try{return new x(JSON.parse(g))}catch(o){return console.error(o),null}}}},94782:(G,A,t)=>{t.d(A,{q:()=>W});var e=t(15861),x=t(13509),v=t(85132),g=t(82974),o=t(13231),s=t(91334);function F(O,Q){const{connectionName:d,tableName:a,tableAlias:u,fields:_,tablesJoin:y,limitRowsCount:T,orderBy:R}=O;let B;B=_?.length?`\n\t${_.map(function U(P){const z=P.sqlExpression?.indexOf(".")?P.sqlExpression?.substring(P.sqlExpression?.indexOf(".")+1):P.sqlExpression;return(P.name===z?P.sqlExpression||P.name:`${P.sqlExpression||""} ${P.name}`).trim()}).join(",\n\t")}\n`:"*";let Y=`-- Connection: ${d}\n\n`;if(Y+="SELECT"+(T?` TOP ${T} `:""),Y+=`${B}FROM ${a}`,u&&(Y+=` ${u}`),y?.forEach(P=>{const z=P.joinType.split("Join");Y+=`\n\t${z[0]} Join ${P.tableName} ${P.tableAlias} ON ${P.joinCondition}${P.joinCondition2?` AND ${P.joinCondition2}`:""}`}),Q&&(Y+=function Z(O,Q){const{tableAlias:U}=Q;let d="";for(let a=0;a<O.length;a++)if(O[a].filterValue){const u=(0,s.UT)(O[a].filterValue),_=N(O[a].operation,u,O[a].columnName);0===a&&(d+=`\nWHERE (${U}.${_} )`),0!==a&&(d+=`\n\tAND (${U}.${_} )`)}return d}(Q,O)),_){const P=_.filter(z=>!0===z.groupBy).map(z=>z.sqlExpression);0!==P.length&&(Y+=`\nGROUP BY ${P.toString()}`)}return R?.length&&(Y+=`\nORDER BY ${R.map(P=>`${P.fieldName} ${P.direction||"ASC"}`).join(", ")}`),Y.trim()+"\n"}function N(O,Q,U){let d,a,u="";const _=String(Q).split(",");let y="";return _.forEach(T=>{y+=`'${T}',`}),"Like"===O&&(u+=`${U} LIKE '${_}'`),"NotLike"===O&&(u+=`${U} NOT LIKE '${_}'`),"In"===O&&(u+=`${U} IN (${y.substring(0,y.length-1).split("\r")})`),"NotIn"===O&&(u+=`${U} NOT IN (${y.substring(0,y.length-1).split("\r")})`),"Custom"===O&&(u+=`${Q}`),"Search"===O&&(u+="string"==typeof Q?`${U} = '${_}'`:`${U} = ${Q}`),"Between"===O&&(a=_[0],d=_[1],a!==o.yv&&d!==o.yv&&(u+=`${U} BETWEEN ${a} AND ${d}`),a!==o.yv&&d===o.yv&&(u+=`${U} >= ${a}`),a===o.yv&&d!==o.yv&&(u+=`${U} <= ${d}`)),u}function D(O,Q){const{connectionName:d,tableName:a,tableAlias:u,tablesJoin:_,fields:y,orderBy:T,limitRowsCount:R}=O;let B=`from 'sql-data-api' import sqlDataApi\n\nsqlDataApi("${d}")`;const[Y,P]=(0,s.dp)("",{},"",O,Q);return _?.forEach(I=>{const H=I.joinType.charAt(0).toLowerCase()+I.joinType.slice(1);B+=`\n\t.${H}("${I.tableName} ${I.tableAlias}", "${I.joinCondition}"${I.joinCondition2?`, "${I.joinCondition2}"`:""})`}),y?.length&&(B+=`\n\t.select("""\n\t\t\t${y.map(function U(I){const H=I.sqlExpression?.indexOf(".")?I.sqlExpression?.substring(I.sqlExpression?.indexOf(".")+1):I.sqlExpression;let q=I.name===H?I.sqlExpression:`${I.sqlExpression||""} ${I.name}`;if(I.groupBy&&(q=`groupBy|${q}`),!q)throw new Error("Sql Expression is not defined");return q.trim()}).join(",\n\t\t\t")}\n\t\t\t""")`),T?.length&&(B+=`\n\t.orderBy("${T.map(I=>`${I.fieldName} ${I.direction||"ASC"}`).join(", ")}")`),R&&(B+=`\n\t.top(${R})`),Y&&P&&(B+=`\n\t.filter("${Y}", ${JSON.stringify(P).trim()})`),B+=`\n\t.query("${`${a} ${u||""}`.trim()}")\n`,B}var S=t(28169),j=t(30968),L=t(30046),K=t(32181),J=t(10708),M=t(37398),w=t(66166),r=t(42014),l=t(22263),i=t(80014),n=t(23991),c=t(65879),f=t(33374),p=t(69569),h=t(8050),b=t(71997),m=t(75263),C=t(55314),E=t(75187);let W=(()=>{var O;class Q{constructor(d,a,u,_,y,T,R,B){this.dialogService=d,this.notificationService=a,this.fileService=u,this.tabsService=_,this.studioService=y,this.sqlMetaService=T,this.connectionsService=R,this.router=B}exportToCsvMenuItem(d,a){return{label:"Export To Csv",icon:"fa-cloud-download",click:()=>this.fileService.exportToFile(d(),{fileType:x.Tv.CSV,fileName:a()})}}exportToFileMenuItem(d,a){return{label:"Export to file",icon:"fa-cloud-download",click:()=>this.dialogService.open(n.r,{initialState:{grid:d(),fileName:a()}})}}exportToExcelMenuItem(d,a){return{label:"Export To Excel",icon:"fa-file-excel-o",click:()=>d()?.api.exportDataAsExcel({skipColumnHeaders:!1,fileName:a()})}}saveToDatabaseMenuItem(d){return{label:"Save To Database",icon:"fa-database",click:()=>{this.dialogService.open(v.E,{class:"modal-xl full-height",keyboard:!1,initialState:{config:d()}}).onClose$.pipe((0,K.h)(u=>!!u)).subscribe(u=>this.router.navigate(["data-studio","sql",u.connectionName,(0,L._1)(u)]))}}}addNewJspyTab(){this.tabsService.addNewAppTab(this.studioService.currentApp,"jspy","",l.EY)}addNewJsonTab(){this.tabsService.addNewAppTab(this.studioService.currentApp,"json","","")}addNewSqlQueryTab(d){this.tabsService.addNewAppTab(this.studioService.currentApp,"sql","",`-- Connection: ${d}\n\n\n`)}addNewProcedureTab(d){this.tabsService.addNewAppTab(this.studioService.currentApp,"sql","",`-- Connection: ${d}\n\nCREATE OR ALTER PROCEDURE [procedureName] AS\n`)}addNewFunctionTab(d){let a;"SqlServer"===d.connectionType&&(a=`-- Connection: ${d.connectionName}\n\nCREATE OR ALTER FUNCTION [functionName] (parameters) \n`),"PostgreSql"===d.connectionType&&(a=`-- Connection: ${d.connectionName}\n\nCREATE OR REPLACE FUNCTION [functionName] (parameters) \n`),this.tabsService.addNewAppTab(this.studioService.currentApp,"sql","",a)}addNewViewTab(d){this.tabsService.addNewAppTab(this.studioService.currentApp,"sql","",`-- Connection: ${d}\n\nCREATE OR ALTER VIEW [viewName] AS\n`)}addSelect1000SqlTab(d){var a=this;return(0,e.Z)(function*(){const{connectionName:u,schemaName:_,objectName:y}=d,T=F(yield a.getSqlQueryInfo(u,_,y));a.tabsService.addNewAppTab(a.studioService.currentApp,"sql","",T)})()}addSelectSqlTab(d,a){const u=F(d,a);this.tabsService.addNewAppTab(this.studioService.currentApp,"sql","",u)}closeAllMenuItem(){return{label:"Close All Tabs",icon:"bi bi-x",click:()=>this.tabsService.removeAllTabs()}}closeOthersMenuItem(){return{label:"Close Other Tabs",icon:"bi bi-x",click:()=>this.tabsService.removeUnActiveTabs()}}addSelectWithSqlDataApiJspyTab(d,a){const u=D(d,a);this.tabsService.addNewAppTab(this.studioService.currentApp,"jspy","",u)}addSelect1000JspyTab(d){var a=this;return(0,e.Z)(function*(){const{connectionName:u,schemaName:_,objectName:y}=d,T=D(yield a.getSqlQueryInfo(u,_,y));a.tabsService.addNewAppTab(a.studioService.currentApp,"jspy","",T)})()}addDataQueryTabFromTableLink(d){var a=this;return(0,e.Z)(function*(){const{connectionName:u,schemaName:_,objectName:y}=d;a.addDataQueryTabFromQuery({sqlQuery:{connectionName:u,tableName:`${_}.${y}`,tableAlias:"t",limitRowsCount:1e3},viewType:"DataGrid"})})()}addDataQueryTabFromQuery(d){var a=this;return(0,e.Z)(function*(){a.tabsService.addNewAppTab(a.studioService.currentApp,"query","",JSON.stringify(d))})()}editSqlTableMetadata(d){var a=this;return(0,e.Z)(function*(){const{connectionName:u}=d,_=yield a.connectionsService.loadMyDbConnections(),y=_.find(R=>R.connectionName===u),T=a.dialogService.open(g.W,{class:"modal-xl full-height",keyboard:!1,initialState:{config:{connection:y,connections:_,isNew:!1,dbObjectLink:d}}});return(0,J.n)(T.onClose$.pipe((0,M.U)(R=>!!R)))})()}createNewTable(d){var a=this;return(0,e.Z)(function*(){const u=yield a.connectionsService.loadMyDbConnections(),_=u.find(T=>T.connectionName===d),y=a.dialogService.open(g.W,{class:"modal-xl full-height",keyboard:!1,initialState:{config:{connection:_,connections:u,isNew:!0}}}).onClose$.pipe((0,K.h)(T=>!!T)).subscribe(T=>{y.unsubscribe(),"deleted"!==T&&a.router.navigate(["data-studio","sql",T.connectionName,`${T.schemaName}.${T.objectName}.table`]),a.studioService.dbItemsChanged({connectionName:d})})})()}importCsvData(){var d=this;return(0,e.Z)(function*(){const a=yield d.connectionsService.loadMyDbConnections();d.dialogService.open(r.J,{class:"modal-xl full-height",keyboard:!1,initialState:{config:{connections:a}}}).onClose$.pipe((0,K.h)(u=>!!u)).subscribe(u=>d.router.navigate(["data-studio","sql",u.connectionName,`${u.schemaName}.${u.objectName}.table`]))})()}createApp(){var d=this;return(0,e.Z)(function*(){yield d.dialogService.open(w.b,{initialState:{config:{appName:"NewApp"}}}).onCloseAsync()})()}deleteSqlTable(d){var a=this;return(0,e.Z)(function*(){const{connectionName:u,schemaName:_,objectName:y}=d,T=`${u}: '${_}.${y}'`;return!!(yield a.notificationService.confirmation(`Are you sure you want to delete ${T}?`))&&(yield a.sqlMetaService.deleteObject(u,d),a.notificationService.success(`Table ${T} deleted`),a.tabsService.removeConnectionTab(d),a.studioService.dbItemsChanged(d),!0)})()}deleteSqlView(d){var a=this;return(0,e.Z)(function*(){const{connectionName:u,schemaName:_,objectName:y}=d,T=`${u} ${_}.${y}`;return!!(yield a.notificationService.confirmation(`Are you sure you want to delete ${T} ?`))&&(yield a.sqlMetaService.deleteObject(u,d),a.notificationService.success(`View ${T} deleted.`),a.tabsService.removeConnectionTab(d),!0)})()}deleteSqlProcedure(d){var a=this;return(0,e.Z)(function*(){const{connectionName:u,schemaName:_,objectName:y}=d,T=`'${_}.${y}' (${u})`;return!!(yield a.notificationService.confirmation(`Are you sure you want to delete ${T} ?`))&&(yield a.sqlMetaService.deleteObject(u,d),a.notificationService.success(`Stored Procedure ${T} deleted.`),a.tabsService.removeConnectionTab(d),!0)})()}deleteSqlFunction(d){var a=this;return(0,e.Z)(function*(){const{connectionName:u,schemaName:_,objectName:y}=d,T=`'${_}.${y}' (${u})`;return!!(yield a.notificationService.confirmation(`Are you sure you want to delete ${T} ?`))&&(yield a.sqlMetaService.deleteObject(u,d),a.notificationService.success(`Function ${T} deleted.`),a.tabsService.removeConnectionTab(d),!0)})()}editViewInNewSqlTab(d){var a=this;return(0,e.Z)(function*(){const{connectionName:u}=d,_=yield a.loadMetaData(d);a.tabsService.addNewAppTab(a.studioService.currentApp,"sql","",`-- Connection: ${u}\n\n${_.sqlText}`)})()}spExecuteInNewJspyTab(d){var a=this;return(0,e.Z)(function*(){const _=function $(O){return`# SP Execution needs to be here ...\n# Name: ${O.schemaName}.${O.objectName}\n# Params:  ${JSON.stringify(O.parameters??{})}\n`}(yield a.loadMetaData(d));a.tabsService.addNewAppTab(a.studioService.currentApp,"jspy","",_)})()}saveGridData(d,a,u){var _=this;return(0,e.Z)(function*(){if(!u)return!0;const y=_.dialogService.open(S.b);try{const T=(u.state?.edited||[]).concat(u.state?.added||[]);if(T?.length||u.state?.deleted?.length){const R=yield(0,j.sqlDataApi)(d).save(a,T,u.state?.deleted);_.notificationService.success(`Saved ${JSON.stringify(R)}`)}"function"==typeof u.clear&&u.clear()}catch(T){return _.notificationService.error(T),!1}finally{y.close()}return!0})()}loadMetaData(d){var a=this;return(0,e.Z)(function*(){const{connectionName:u,schemaName:_,objectName:y,objectType:T}=d,R=a.dialogService.open(S.b,{class:"modal-sm",initialState:{message:"Loading metadata ..."}});let B=null;try{B=yield a.sqlMetaService.getMetaDataObject(u,_,y,T)}catch(Y){throw a.notificationService.error(Y),new Error(Y)}finally{R.close()}return B})()}getSqlQueryInfo(d,a,u){var _=this;return(0,e.Z)(function*(){const y=yield _.loadMetaData({connectionName:d,schemaName:a,objectName:u});return{connectionName:d,limitRowsCount:1e3,tableName:`${a}.${u}`,fields:y.fields.map(T=>({name:T.fieldName}))}})()}openPubSubSetting(d){if(!d)throw new Error("configQueryInfo is not defined");return this.dialogService.open(i.a,{class:"modal-md",initialState:{configPubSub:d.pubSub,configQueryInfo:d}}).onClose$.pipe((0,K.h)(u=>!!u))}}return(O=Q).\u0275fac=function(d){return new(d||O)(c.LFG(f.x),c.LFG(p.g),c.LFG(x.j5),c.LFG(h.x),c.LFG(b.F),c.LFG(m.hp),c.LFG(C.F),c.LFG(E.F0))},O.\u0275prov=c.Yz7({token:O,factory:O.\u0275fac}),Q})()},71997:(G,A,t)=>{t.d(A,{F:()=>Z});var e=t(65619),x=t(32013),v=t(22096),g=t(93997),o=t(21473),s=t(65879),F=t(75263);let Z=(()=>{var N;class D{constructor(S){this.dataService=S,this.appSubj$=new e.X(null),this.appOrSqlSubj$=new e.X("app"),this.currentConnectionSubj$=new e.X(void 0),this.appContentAddedSubj$=new x.x,this.dbItemsChangedSubj$=new x.x,this.currentApp$=this.appSubj$.asObservable().pipe((0,g.x)()),this.currentConnection$=this.currentConnectionSubj$.asObservable().pipe((0,g.x)()),this.appContentAdded$=this.appContentAddedSubj$.asObservable(),this.dbItemsChanged$=this.dbItemsChangedSubj$.asObservable(),this.appOrSql$=this.appOrSqlSubj$.asObservable().pipe((0,g.x)())}getApp(S,j){return this.currentApp?.appOwner===S&&this.currentApp?.appName===j?(0,v.of)(this.currentApp):this.dataService.getAppDefinition(S,j)}appContentAdded(S,j,L){this.currentApp?.appOwner!==S||this.currentApp?.appName!==j||this.appContentAddedSubj$.next([(0,o.x2)(L)])}dbItemsChanged(S){S.connectionName===this.getCurrentConnection()&&this.dbItemsChangedSubj$.next(S)}get currentApp(){return this.appSubj$.getValue()}getCurrentConnection(){return this.currentConnectionSubj$.value}setCurrentConnection(S){this.currentConnectionSubj$.next(S)}setAppOrSql(S){this.appOrSqlSubj$.next(S)}setCurrentApp(S){(this.currentApp?.appOwner!==S?.appOwner||this.currentApp?.appName!==S?.appName)&&this.appSubj$.next(S)}}return(N=D).\u0275fac=function(S){return new(S||N)(s.LFG(F.UW))},N.\u0275prov=s.Yz7({token:N,factory:N.\u0275fac}),D})()},8050:(G,A,t)=>{t.d(A,{x:()=>K});var e=t(32013),x=t(65619),v=t(83620),g=t(52572),o=t(59773),s=t(32181),F=t(69384),Z=t(99796),N=t(13389),D=t(30046),$=t(22263),S=t(65879),j=t(75187),L=t(75263);let K=(()=>{var J;class M{constructor(r,l,i){this.router=r,this.route=l,this.authenticationService=i,this.destroy$=new e.x,this.activeTabSubj$=new x.X(null),this.contentParams={},this.tabs=[],this.activeTab$=this.activeTabSubj$.asObservable().pipe((0,v.b)(1)),(0,g.a)([this.activeTab$,this.route.queryParams]).pipe((0,o.R)(this.destroy$),(0,v.b)(1),(0,s.h)(([n])=>!(!n||!this.authenticationService.user))).subscribe(()=>this.storeState()),this.authenticationService.isAuthenticated$.pipe((0,o.R)(this.destroy$),(0,F.G)(),(0,s.h)(([n,c])=>!c&&n)).subscribe(()=>{this.tabs.length&&this.removeAllTabs(),this.router.navigate(["data-studio"])})}destroy(){this.destroy$.next(null),this.destroy$.complete()}activateTab(r){const l=this.tabs.find(i=>r.tabId===i.tabId);l?this.activeTabSubj$.next(l):(this.tabs.push(r),r.isLoaded$.subscribe(()=>this.activeTabSubj$.next(r)))}removeAllTabs(){for(let r of this.tabs)localStorage.removeItem(`store-${r.tabId}`);this.tabs.splice(0,this.tabs.length),this.storeState()}removeUnActiveTabs(){let r=0;for(;r<this.tabs.length;)this.tabs[r]===this.activeTab?r++:(localStorage.removeItem(`store-${this.tabs[r].tabId}`),this.tabs.splice(r,1));this.storeState()}removeTab(r){const l=this.tabs.indexOf(r);l>=0?(this.tabs.splice(l,1),this.tabs.length||this.activeTabSubj$.next(null),this.storeState(),localStorage.removeItem(`store-${r.tabId}`)):console.warn("Can't find tab to remove.")}removeAppTabs(r,l){let i=null;const n=this.activeTab;l.forEach(c=>{const f=this.getTabAppLinkKey(r,c),p=this.tabs.findIndex(h=>f===this.getTabKey(h));if(-1!==p){const h=this.tabs[p];(h===n||h===i)&&this.tabs.length>1&&(i=this.tabs[p?p-1:p+1]),this.removeTab(h)}}),i&&this.activateTab(i)}removeConnectionTab(r){let l=null;const i=this.activeTab,n=(0,D.MU)(r)?.toLowerCase(),c=this.tabs.findIndex(f=>n===this.getTabKey(f).toLowerCase());if(-1!=c){const f=this.tabs[c];f===i&&this.tabs.length>1&&(l=this.tabs[c?c-1:c+1]),this.removeTab(f)}l&&this.activateTab(l)}reloadSqlTab(r){const l=(0,D.MU)(r)?.toLowerCase(),i=this.tabs.find(n=>l===this.getTabKey(n).toLowerCase());i&&i.content?.reload(!0)}popContentParameter(r){const l=this.contentParams[r];return this.contentParams[r]="",l}nextUntitledNumber(r){const l=this.tabs.filter(i=>(0,D.$P)(i.tabHeader)).map(i=>parseInt(i.tabHeader.replace($.Bi,"").replace(r,"")))??[0];return Math.max(...l,0)+1}addNewAppTab(r,l,i="",n){i&&(i+="/");const c=`${i}${$.Bi}${this.nextUntitledNumber(l)}.${l}`;this.contentParams[c]=n||"";const f=this.authenticationService.user?.userName;this.router.navigate(["data-studio/app",r?.appOwner||f||$.m5,r?.appName||$.b5],{queryParams:{file:c}})}get activeTab(){return this.activeTabSubj$.getValue()}get tabsStoreKey(){return`tabs-state-${this.authenticationService.user?.userId}`}getTabAppLinkKey(r,l){return(0,D.Ew)(r)+"-"+(0,Z.nV)(l)}getTabKeyFromUrlParams(r,l){return this.getTabKeyByLink({...r,...l})}getTabKey(r){return this.getTabKeyByLink(r.tabParams)}storeState(){localStorage.setItem(this.tabsStoreKey,JSON.stringify({tabs:this.tabs.map(r=>N.E.serialize(r)),activeTab:this.activeTab?.tabId}))}getTabKeyByLink(r){const{appOrSql:l,owner:i,name:n,file:c}=r;if("app"===l){const f={appName:n,appOwner:i},p=(0,Z.x2)(c);return this.getTabAppLinkKey(f,p)}if("sql"===l)return`${i}-${n}`;throw new Error(`Unknown appOrSql [${l}]`)}initStateFromLocalStorage(){try{const r=localStorage.getItem(this.tabsStoreKey);if(r){const l=JSON.parse(r),i=l.tabs.map(c=>new N.E(JSON.parse(c))).filter(c=>c),n=new Set(this.tabs.map(c=>c.tabId));if(this.tabs.push(...i.filter(c=>!n.has(c.tabId))),l.activeTab){const c=this.tabs.find(f=>f.tabId===l.activeTab);c&&!this.hasTabInUrl()&&this.router.navigate(["data-studio",...c.routePath],{queryParams:c.queryParams})}}}catch(r){console.error(r),console.info("Failed to initialize tabs state from local storage")}}hasTabInUrl(){if(this.route.snapshot.queryParams.file)return!0;let r=this.route,l=r.snapshot.params;for(;r.firstChild;)r=r.firstChild,l={...l,...r.snapshot.params};return!("sql"!==l.appOrSql||!l.name||!l.owner)}}return(J=M).\u0275fac=function(r){return new(r||J)(S.LFG(j.F0),S.LFG(j.gz),S.LFG(L.$h))},J.\u0275prov=S.Yz7({token:J,factory:J.\u0275fac}),M})()},1519:(G,A,t)=>{function e(x,v,g){if(!v.has(x))throw new TypeError("attempted to "+g+" private field on non-instance");return v.get(x)}t.d(A,{Z:()=>e})},18916:(G,A,t)=>{t.d(A,{Z:()=>v});var e=t(26983),x=t(1519);function v(g,o){var s=(0,x.Z)(g,o,"get");return(0,e.Z)(g,s)}},85926:(G,A,t)=>{function x(v,g,o){(function e(v,g){if(g.has(v))throw new TypeError("Cannot initialize the same private elements twice on an object")})(v,g),g.set(v,o)}t.d(A,{Z:()=>x})},42793:(G,A,t)=>{t.d(A,{Z:()=>v});var e=t(86011),x=t(1519);function v(g,o,s){var F=(0,x.Z)(g,o,"set");return(0,e.Z)(g,F,s),s}}}]);