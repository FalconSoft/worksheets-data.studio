<dcml>
<script>

import "/alphavantage-lib.jspy" as api

async def onInit():
  refreshData('IBM')

async def onLoadDataFor(symbol):
  refreshData(symbol)

async def refreshData(symbol):
  print('refreshing data for symbol: ' + symbol)
  data = api.getTimeseries(symbol)
  setUIValue({
    columnsDef: Object.keys(data[0]).map(f => {field: f}),
    rowData: data
  })

  </script>

  <layout src="/home.layout.dcml"/>
  <template>

		<div class="h-100 w-100">
			<div class="container my-2 p-2 h-100 w-100 bg-main overflow-auto">
        <div class="d-flex flex-column h-100">
          <div class="py-2 d-flex">
            <button class="ml-auto btn btn-success mr-2" onClick="onLoadDataFor('IBM')">IBM</button>
            <button class="btn btn-success mr-2" onClick="onLoadDataFor('MSFT')">MSFT</button>
          </div>
          <ag-grid id="testGrid1" class="h-100" rowData="$.rowData" columnsDef="$.columnsDef"></ag-grid>
        </div>
			</div>
		</div>

  </template>
</dcml>
