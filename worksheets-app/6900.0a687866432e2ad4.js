"use strict";(self.webpackChunkworksheets_app_runtime=self.webpackChunkworksheets_app_runtime||[]).push([[6900],{93613:(be,ue,d)=>{d.d(ue,{K:()=>k});var r=d(65879),u=d(65619),te=d(32013),e=d(37398),D=d(59773),v=d(93997),ie=d(69384),H=d(32181),z=d(94664),E=d(33374),R=d(72500),l=d(96814);function I(F,q){if(1&F){const ne=r.EpF();r.TgZ(0,"li",14),r._uU(1),r._UZ(2,"i",15),r.TgZ(3,"i",16),r.NdJ("click",function(){const X=r.CHM(ne).index,L=r.oxw();return r.KtG(L.removeFilter(X))}),r.qZA()()}if(2&F){const ne=q.$implicit;r.xp6(1),r.hij(" ",ne.columnName," ")}}function V(F,q){if(1&F){const ne=r.EpF();r.TgZ(0,"li",19)(1,"a",20),r.NdJ("click",function(){const X=r.CHM(ne).$implicit,L=r.oxw(2);return r.KtG(L.addFilter(X))}),r._uU(2),r.qZA()()}if(2&F){const ne=q.$implicit;r.xp6(2),r.Oqu(ne.name)}}function ae(F,q){if(1&F&&(r.TgZ(0,"ul",17),r.YNc(1,V,3,1,"li",18),r.qZA()),2&F){const ne=r.oxw();r.xp6(1),r.Q6J("ngForOf",ne.fields)}}let Q=(()=>{var F;class q{constructor(W){this.dialogRef=W,this.config={},this.filters=[],this.fields=[]}ngOnInit(){this.filters=[...this.config.filters],this.setFields()}onApply(){this.dialogRef.close(this.filters)}onClose(){this.dialogRef.close()}addFilter(W){this.filters.push({columnName:W.name}),this.setFields()}removeFilter(W){this.filters.splice(W,1)}setFields(){const W=this.filters.map(re=>re.columnName);this.fields=this.config.fields.filter(re=>!W.includes(re.name))}}return(F=q).\u0275fac=function(W){return new(W||F)(r.Y36(E.z))},F.\u0275cmp=r.Xpm({type:F,selectors:[["app-manage-filters"]],inputs:{config:"config"},decls:19,vars:2,consts:[[1,"modal-header"],[1,"modal-title","pull-left"],["type","button","aria-label","Close",1,"close","pull-right",3,"click"],["aria-hidden","true"],[1,"modal-body","px-4","d-flex","flex-column","h-100"],["dragula","filters",1,"container"],["class","row py-1 my-1 pl-2 border rounded align-items-baseline",4,"ngFor","ngForOf"],["dropdown","",1,"btn-group","mr-2","mb-2","align-self-baseline"],["id","button-basic","dropdownToggle","","type","button","aria-controls","dropdown-basic",1,"btn","btn-primary","dropdown-toggle","align-self-baseline","btn-sm",3,"disabled"],["id","dropdown-basic","class","dropdown-menu overflow-auto","role","menu","aria-labelledby","button-basic",4,"dropdownMenu"],[1,"modal-footer","flex-column"],[1,"row","w-100","mx-0","px-0"],["type","button",1,"btn","btn-primary","ml-auto","mr-2",3,"click"],["type","button",1,"btn","btn-light",3,"click"],[1,"row","py-1","my-1","pl-2","border","rounded","align-items-baseline"],[1,"fa","fa-arrows","ml-auto","handle"],[1,"fa","fa-remove","mx-2","cursor-pointer",3,"click"],["id","dropdown-basic","role","menu","aria-labelledby","button-basic",1,"dropdown-menu","overflow-auto"],["role","menuitem",4,"ngFor","ngForOf"],["role","menuitem"],[1,"dropdown-item","cursor-pointer",3,"click"]],template:function(W,re){1&W&&(r.TgZ(0,"div",0)(1,"h4",1),r._uU(2,"Manage Filters"),r.qZA(),r.TgZ(3,"button",2),r.NdJ("click",function(){return re.onClose()}),r.TgZ(4,"span",3),r._uU(5,"\xd7"),r.qZA()()(),r.TgZ(6,"div",4)(7,"ul",5),r.YNc(8,I,4,1,"li",6),r.qZA(),r.TgZ(9,"div",7)(10,"button",8),r._uU(11,"Add filter "),r.qZA(),r.YNc(12,ae,2,1,"ul",9),r.qZA()(),r.TgZ(13,"div",10)(14,"div",11)(15,"button",12),r.NdJ("click",function(){return re.onApply()}),r._uU(16,"Apply"),r.qZA(),r.TgZ(17,"button",13),r.NdJ("click",function(){return re.onClose()}),r._uU(18,"Cancel"),r.qZA()()()),2&W&&(r.xp6(8),r.Q6J("ngForOf",re.filters),r.xp6(2),r.Q6J("disabled",!re.fields.length))},dependencies:[R.Hz,R.Mq,R.TO,l.sg],styles:[".fa-arrows[_ngcontent-%COMP%]{cursor:grab}"]}),q})();var U=d(28252),B=d(43829),M=d(68171);function T(F,q){if(1&F&&(r.TgZ(0,"div",6),r._UZ(1,"app-data-grid-filter",7),r.qZA()),2&F){const ne=q.$implicit,W=r.oxw();r.xp6(1),r.Q6J("columnName",ne.name)("dataSource",W.dataSource)}}function f(F,q){if(1&F){const ne=r.EpF();r.TgZ(0,"li",15),r.NdJ("click",function(re){return re.stopImmediatePropagation()}),r.TgZ(1,"div",16)(2,"app-search",17),r.NdJ("search",function(re){r.CHM(ne);const X=r.oxw(2);return r.KtG(X.onSearch(re))}),r.qZA()()()}}function y(F,q){if(1&F){const ne=r.EpF();r.TgZ(0,"li",9)(1,"a",10),r.NdJ("click",function(){const X=r.CHM(ne).$implicit,L=r.oxw(2);return r.KtG(L.addFilter(X))}),r._uU(2),r.qZA()()}if(2&F){const ne=q.$implicit;r.xp6(2),r.Oqu(ne.name)}}function x(F,q){if(1&F){const ne=r.EpF();r.TgZ(0,"ul",8)(1,"li",9)(2,"a",10),r.NdJ("click",function(){r.CHM(ne);const re=r.oxw();return r.KtG(re.manageFilter())}),r._UZ(3,"i",11),r._uU(4," Manage Filter"),r.qZA()(),r.YNc(5,f,3,0,"li",12),r._UZ(6,"li",13),r.YNc(7,y,3,1,"li",14),r.ALo(8,"async"),r.qZA()}if(2&F){const ne=r.oxw();r.xp6(5),r.Q6J("ngIf",ne.fields.length>5||ne.search$.value),r.xp6(2),r.Q6J("ngForOf",r.lcZ(8,2,ne.filteredFields$))}}let k=(()=>{var F;class q{constructor(W){this.dialogService=W,this.filtersBarChanged=new r.vpe,this.search$=new u.X(""),this.fields=[],this.selectedFilters$=new u.X([]),this.destroy$=new te.x}ngOnInit(){this.filtersBar&&this.selectedFilters$.next(this.filtersBar),this.selectedFields$=this.selectedFilters$.pipe((0,e.U)(re=>re?re.map(X=>this.fields.find(L=>L.name===X.columnName)).filter(X=>!!X).map(X=>X):[])),this.selectedFilters$.pipe((0,D.R)(this.destroy$),(0,v.x)((re,X)=>JSON.stringify(re)===JSON.stringify(X)),(0,ie.G)()).subscribe(([re,X])=>{this.filtersBarChanged.emit(X)}),this.subscribeOnDataSource()}ngOnChanges({dataSource:W,filtersBar:re}){W?.firstChange||this.subscribeOnDataSource(),re&&!re.firstChange&&this.setFiltersBar(re.currentValue)}onSearch(W){this.search$.next(W)}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete()}addFilter(W){this.selectedFilters$.value.map(X=>X.columnName).includes(W.name)||this.selectedFilters$.next([...this.selectedFilters$.value,{columnName:W.name}])}manageFilter(){this.dialogService.open(Q,{initialState:{config:{filters:this.selectedFilters$.value,fields:this.fields}}}).onClose$.pipe((0,H.h)(W=>!!W)).subscribe(W=>this.selectedFilters$.next(W??[]))}setFiltersBar(W){this.selectedFilters$.next(W??[])}subscribeOnDataSource(){(0,U.m)(this.dataSource),this.dataSource.fields$.pipe((0,D.R)(this.destroy$)).subscribe(W=>{this.fields=W??[],this.setFiltersBar(this.filtersBar??[])}),this.filteredFields$=this.dataSource.fields$.pipe((0,D.R)(this.destroy$),(0,z.w)(W=>this.search$.pipe((0,e.U)(re=>W.filter(X=>X.name.toLowerCase().includes(re.toLowerCase()))))))}}return(F=q).\u0275fac=function(W){return new(W||F)(r.Y36(E.x))},F.\u0275cmp=r.Xpm({type:F,selectors:[["app-data-filters"]],inputs:{dataSource:"dataSource",filtersBar:"filtersBar"},outputs:{filtersBarChanged:"filtersBarChanged"},features:[r.TTD],decls:7,vars:3,consts:[[1,"row","m-0"],["class","pr-2",4,"ngFor","ngForOf"],["dropdown","","placement","bottom right",1,"btn-group","mr-2"],["id","panel-filters-button-basic","dropdownToggle","","type","button","aria-controls","panel-filters-dropdown-basic","triggers","mouseenter:mouseleave","containerClass","applied-popover",1,"btn","btn-sm","btn-outline-secondary","dropdown-toggle","align-self-baseline"],[1,"fa","fa-filter"],["id","panel-filters-dropdown-basic","class","dropdown-menu overflow-auto dropdown-menu-right","role","menu","aria-labelledby","panel-filters-button-basic",4,"dropdownMenu"],[1,"pr-2"],[3,"columnName","dataSource"],["id","panel-filters-dropdown-basic","role","menu","aria-labelledby","panel-filters-button-basic",1,"dropdown-menu","overflow-auto","dropdown-menu-right"],["role","menuitem"],[1,"dropdown-item","cursor-pointer",3,"click"],[1,"fa","fa-cogs"],["role","menuitem",3,"click",4,"ngIf"],[1,"divider","dropdown-divider"],["role","menuitem",4,"ngFor","ngForOf"],["role","menuitem",3,"click"],[1,"dropdown-item","input-group","py-0"],[3,"search"]],template:function(W,re){1&W&&(r.TgZ(0,"div",0),r.YNc(1,T,2,2,"div",1),r.ALo(2,"async"),r.TgZ(3,"div",2)(4,"button",3),r._UZ(5,"i",4),r.qZA(),r.YNc(6,x,9,4,"ul",5),r.qZA()()),2&W&&(r.xp6(1),r.Q6J("ngForOf",r.lcZ(2,1,re.selectedFields$)))},dependencies:[R.Hz,R.Mq,R.TO,l.sg,l.O5,B.g,M.E,l.Ov],styles:['[_ngcontent-%COMP%]:root{--bg: #fff;--body-bg: #e4e5e6;--header-bg: #ebedef;--color: #4f5d73;--border-color: #c4c9d0;--ws-alt: #f7f7f7;--form-input-bg: #fff;--form-input-color: #768192;--nav-link-color: #8a93a2;--secondary-color: #c4c9d0;--opacity: .05;--hover: "#f0f3f5"}.border[dropdown][_ngcontent-%COMP%]{border-color:transparent}.dropdown-menu[_ngcontent-%COMP%]{max-height:500px}.fa.fa-cogs[_ngcontent-%COMP%]{color:#636f83}  .applied-popover{min-width:100px}#panel-filters-dropdown-basic[_ngcontent-%COMP%]{min-width:250px}div.dropdown-item[_ngcontent-%COMP%]:hover{background:inherit}']}),q})()},81196:(be,ue,d)=>{d.d(ue,{R:()=>D});var r=d(3202),u=d(65879);function te(v){return v instanceof Date?`dt(${(0,r.dateToString)(v)})`:Array.isArray(v)?v.map(ie=>te(ie)):v}function e(v){return"string"==typeof v&&v.startsWith("dt(")&&v.endsWith(")")?(0,r.parseDatetimeOrNull)(v.substring(3,v.length-1)):Array.isArray(v)?v.map(ie=>e(ie)):v}let D=(()=>{var v;class ie{getQueryParam(z){if(!z?.length)return;const E=JSON.stringify(z.map(l=>[l.columnName,l.operation,te(l.filterValue)])),R=1===z.length?2:1;return E.substring(R,E.length-R)}getFilterItems(z){if(!z)return[];try{let E=JSON.parse(`[${z}]`);return Array.isArray(E[0])||(E=[E]),E.map(R=>({columnName:R[0],operation:R[1],filterValue:e(R[2])}))}catch(E){return console.error("parsing url error",E),[]}}}return(v=ie).\u0275fac=function(z){return new(z||v)},v.\u0275prov=u.Yz7({token:v,factory:v.\u0275fac,providedIn:"root"}),ie})()},88093:(be,ue,d)=>{d.d(ue,{n:()=>re});var r=d(15861),u=d(65879),te=d(32013),e=d(59773),D=d(32181),v=d(13231),ie=d(81872),H=d(63411),z=d(61862),E=d(3202);class R{constructor(){this.SEPARATOR="!",this.KEY_VALUE_SEPARATOR=":"}set initQueryInfo(L){this._initQueryInfo=(0,E.deepClone)(L)}serialize(L){if(!L)return{};const O={fields:void 0,top:void 0,orderBy:void 0,joins:void 0,filtersBar:void 0};L.dataGrid&&(O.columns=this.serializeDataGridInfo(L.dataGrid)),L.dataChart&&(O.chart=this.serializeDataChartInfo(L.dataChart)),L.dataChart?.series&&(O.chartSeries=this.serializeDataChartSeries(L.dataChart.series)),L.viewType&&(O.viewType=L.viewType),L.filtersBar?.length&&(O.filtersBar=L.filtersBar.map(A=>A.columnName).join());const b=L.sqlQuery;return b&&(b.limitRowsCount!==this._initQueryInfo?.sqlQuery?.limitRowsCount&&(O.top=b.limitRowsCount),b.orderBy?.length&&(O.orderBy=b.orderBy.map(({fieldName:A,direction:g})=>`${A}${this.SEPARATOR}${g}`).join(",")),this.isFieldsChanged(b)&&(O.fields=b?.fields?.map(A=>[A.name,A.sqlExpression,A.groupBy].filter(g=>g).join(this.SEPARATOR)).join(",")),b.tablesJoin?.length&&(O.joins=b.tablesJoin.map(A=>[A.joinType,A.tableName,A.tableAlias,A.joinCondition,A.joinCondition2||""].join(this.SEPARATOR)).join())),O}deserialize(L){const O={sqlQuery:{}};return L.viewType&&(O.viewType=L.viewType),O.sqlQuery&&(L.columns&&(O.dataGrid=this.deserializeDataGridInfo(L.columns)),L.top&&(O.sqlQuery.limitRowsCount=L.top),L.orderBy&&(O.sqlQuery.orderBy=(0,z.split)(L.orderBy,",").map(b=>{const[A,g]=b.split(this.SEPARATOR);return{fieldName:A,direction:g}})),L.fields&&(O.sqlQuery.fields=(0,z.split)(L.fields,",",["()"]).map(b=>{const[A,g,p]=b.split(this.SEPARATOR);return{name:A,sqlExpression:g,groupBy:"true"===p}})),L.joins&&(O.sqlQuery.tablesJoin=(0,z.split)(L.joins,",",["()"]).map(b=>{const[A,g,p,S,J]=b.split(this.SEPARATOR);return{joinType:A,tableName:g,tableAlias:p,joinCondition:S,joinCondition2:J}})),L.chart&&(O.dataChart=this.deserializeDataChartInfo(L.chart)),L.chartSeries&&(O.dataChart=O.dataChart??{},O.dataChart.series=this.deserializeDataChartSeries(L.chartSeries)),L.filtersBar&&(O.filtersBar=(0,z.split)(L.filtersBar,",",["()"]).map(b=>({columnName:b})))),O}isFieldsChanged(L){return JSON.stringify(this._initQueryInfo?.sqlQuery?.fields)!==JSON.stringify(L.fields)}serializeDataGridInfo(L){const O=[];return Object.entries(L.columnsMap).forEach(([b,A])=>{Object.values(A).some(([g,p])=>"name"!==g&&p)&&O.push(A)}),O.map(b=>{const A=[b.name];return Object.entries(b).filter(([g,p])=>!["dataMap","valuesData","name"].includes(g)&&p&&"function"!=typeof p).forEach(([g,p])=>{Array.isArray(p)&&(p=p.join("/")),A.push(`${g}${this.KEY_VALUE_SEPARATOR}${p}`)}),A.join(this.SEPARATOR)}).join(",")}serializeDataChartInfo(L){return["bindingX","chartType","legendPosition","hasRangeSelector"].filter(O=>L.hasOwnProperty(O)).map(O=>`${O}-${L[O]}`).join(this.SEPARATOR)}serializeDataChartSeries(L){return L.map(O=>Object.entries(O).filter(([b,A])=>!!A).map(([b,A])=>"binding"===b?`${b}-(${A})`:`${b}-${A}`).join(this.SEPARATOR)).join(",")}deserializeDataChartInfo(L){return(0,z.split)(L,this.SEPARATOR).reduce((O,b)=>{const[A,g]=(0,z.split)(b,this.KEY_VALUE_SEPARATOR);return g&&(O[A]=g),O},{})}deserializeDataChartSeries(L){return(0,z.split)(L,",",["()"]).map(O=>(0,z.split)(O,this.SEPARATOR).reduce((A,g)=>{const[p,S]=(0,z.split)(g,this.KEY_VALUE_SEPARATOR);return A[p]=S.replace(/\(|\)/g,""),A},{}))}deserializeDataGridInfo(L){return{columnsMap:(0,z.split)(L,",").reduce((b,A)=>{const g=(0,z.split)(A,this.SEPARATOR),p=g.shift();return b[p]=g.reduce((S,J)=>{const[G,ee]=(0,z.split)(J,this.KEY_VALUE_SEPARATOR);return["width","dataType"].includes(G)?S[G]=+ee:"valuesSource"===G?S[G]=ee.split("/"):"function"!=typeof ee&&(S[G]=ee),S},{name:p,field:p}),b},{})}}}var l=d(612),I=d(6015),V=d(33374),ae=d(75187),Q=d(81196),U=d(60364),B=d(69569),M=d(72500),T=d(96814),f=d(56223),y=d(30641);const x=["pop"];function k(X,L){if(1&X){const O=u.EpF();u.TgZ(0,"li",21)(1,"a",22),u.NdJ("click",function(){const g=u.CHM(O).$implicit,p=u.oxw(3);return u.KtG(p.addField(g))}),u._uU(2),u.qZA()()}if(2&X){const O=L.$implicit;u.xp6(2),u.Oqu(O.name)}}function F(X,L){if(1&X&&(u.TgZ(0,"ul",19),u.YNc(1,k,3,1,"li",20),u.qZA()),2&X){const O=u.oxw(2);u.xp6(1),u.Q6J("ngForOf",O.fields)}}function q(X,L){if(1&X){const O=u.EpF();u.TgZ(0,"li",23),u._uU(1),u.TgZ(2,"select",24),u.NdJ("ngModelChange",function(A){const p=u.CHM(O).$implicit;return u.KtG(p.direction=A)}),u.TgZ(3,"option",25),u._uU(4,"DESC"),u.qZA(),u.TgZ(5,"option",26),u._uU(6,"ASC"),u.qZA()(),u._UZ(7,"i",27),u.TgZ(8,"i",28),u.NdJ("click",function(A){const p=u.CHM(O).index,S=u.oxw(2);return u.KtG(S.removeField(A,p))}),u.qZA()()}if(2&X){const O=L.$implicit;u.xp6(1),u.hij(" ",O.fieldName," "),u.xp6(1),u.Q6J("ngModel",O.direction)}}function ne(X,L){if(1&X){const O=u.EpF();u.TgZ(0,"div",5)(1,"div",6)(2,"span",7),u._uU(3,"Limit rows "),u.qZA(),u.TgZ(4,"input",8),u.NdJ("ngModelChange",function(A){u.CHM(O);const g=u.oxw();return u.KtG(g.limitRowsCountText=A)}),u.qZA()(),u.TgZ(5,"div",9)(6,"span",7),u._uU(7,"Sort By "),u.qZA(),u.TgZ(8,"div",10)(9,"button",11),u._uU(10,"Add Field "),u.qZA(),u.YNc(11,F,2,1,"ul",12),u.qZA()(),u.TgZ(12,"div",13)(13,"ul",14),u.YNc(14,q,9,2,"li",15),u.qZA()(),u.TgZ(15,"div",16)(16,"button",17),u.NdJ("click",function(){u.CHM(O);const A=u.oxw();return u.KtG(A.onApply())}),u._uU(17,"Apply"),u.qZA(),u.TgZ(18,"button",18),u.NdJ("click",function(){u.CHM(O);const A=u.oxw();return u.KtG(A.onCancel())}),u._uU(19,"Cancel"),u.qZA()()()}if(2&X){const O=u.oxw();u.xp6(4),u.Q6J("ngModel",O.limitRowsCountText),u.xp6(4),u.Q6J("dropup",!0),u.xp6(1),u.Q6J("disabled",!O.fields.length),u.xp6(5),u.Q6J("ngForOf",O.sortBy)}}let W=(()=>{var X;class L{get totalRowsCountText(){return this.realRowsCount!==this.rowsCount?` of ${this.rowsCount.toLocaleString()}`:""}constructor(b){this.notificationService=b,this.sqlQueryChange=new u.vpe,this.pop={},this.rowsCount=0,this.timestamp=0,this.sortBy=[],this.appliedSortBy=[],this.sortByList="",this.limitRowsCountText="",this.destroy$=new te.x}get fields(){return this.sqlQueryInfo?.fields||[]}ngOnInit(){this.timestamp=(new Date).getTime(),this.sqlQueryInfo?.tableName&&this.loadTotalRowsCount()}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete()}onQueryDetailsPopoverShown(b){this.limitRowsCountText=(this.sqlQueryInfo?.limitRowsCount||0).toLocaleString(),this.sqlQueryInfo?.orderBy?.length&&(this.sortBy=this.sqlQueryInfo.orderBy,this.appliedSortBy=[...this.sortBy],this.sortByList=this.getSortList())}loadTotalRowsCount(){if(!this.sqlQueryInfo?.connectionName)throw new Error("ConnectionName is not defined");const[b,A]=this.sqlQueryInfo?.tableName?.split(".")||[];(0,U.sqlDataApi)(this.sqlQueryInfo?.connectionName).query(`${b}.${A}`,"count(*) count").then(g=>this.rowsCount=g.length?g[0].count:0,g=>this.notificationService.error(g))}addField(b){this.sortBy.push({fieldName:b.name,direction:"ASC"})}onApply(){if(!this.sqlQueryInfo)throw new Error("sqlQueryInfo is null");this.appliedSortBy=[...this.sortBy],this.sqlQueryInfo.orderBy=this.appliedSortBy,this.sqlQueryInfo.limitRowsCount=(0,E.parseNumberOrNull)(this.limitRowsCountText)||0,this.sqlQueryChange.emit({sqlQuery:this.sqlQueryInfo,property:"orderBy"}),this.sqlQueryChange.emit({sqlQuery:this.sqlQueryInfo,property:"limitRowsCount"}),this.pop.hide(),this.sortByList=this.getSortList()}onCancel(){this.pop.hide()}removeField(b,A){b.stopImmediatePropagation(),this.sortBy.splice(A,1)}getKey(){return`${this.sqlQueryInfo?.connectionName}${this.sqlQueryInfo?.tableName}${this.timestamp.toString()}`}getSortList(){return this.appliedSortBy.map(b=>`${b.fieldName} ${b.direction}`).join(", ")}}return(X=L).\u0275fac=function(b){return new(b||X)(u.Y36(B.g))},X.\u0275cmp=u.Xpm({type:X,selectors:[["app-data-query-footer"]],viewQuery:function(b,A){if(1&b&&u.Gf(x,7),2&b){let g;u.iGM(g=u.CRH())&&(A.pop=g.first)}},inputs:{realRowsCount:"realRowsCount",sqlQueryInfo:"sqlQueryInfo"},outputs:{sqlQueryChange:"sqlQueryChange"},decls:8,vars:6,consts:[[1,"grid-footer"],["containerClass","query-info-popover","placement","top","container","body",1,"cursor-pointer",3,"popover","outsideClick","onShown"],["pop","bs-popover"],[1,"fa","fa-caret-square-o-up","ml-2"],["popQueryDetailsTemplate",""],[1,"d-flex","flex-column"],[1,"d-flex","align-items-center"],[1,"popup-label"],["type","text",1,"form-control","form-control-sm","ml-auto","show-max-input","mr-0",3,"ngModel","ngModelChange"],[1,"d-flex","flex-row","mt-2","align-items-center"],["dropdown","",1,"btn-group","ml-auto","mb-2","align-self-baseline",3,"dropup"],["id","button-basic","dropdownToggle","","type","button","aria-controls","sort-fields-popover",1,"btn","btn-light","dropdown-toggle","align-self-baseline","btn-sm",3,"disabled"],["id","sort-fields-popover","class","dropdown-menu overflow-auto","role","menu","aria-labelledby","button-basic",4,"dropdownMenu"],[1,"d-flex","flex-column","h-100"],[1,"container"],["class","row py-1 my-1 pl-2 border rounded align-items-baseline",4,"ngFor","ngForOf"],[1,"row","w-100","mx-0","px-0"],["type","button",1,"btn","btn-primary","btn-sm","ml-auto","mr-2",3,"click"],["type","button",1,"btn","btn-secondary","btn-sm",3,"click"],["id","sort-fields-popover","role","menu","aria-labelledby","button-basic",1,"dropdown-menu","overflow-auto"],["role","menuitem",4,"ngFor","ngForOf"],["role","menuitem"],[1,"dropdown-item","cursor-pointer",3,"click"],[1,"row","py-1","my-1","pl-2","border","rounded","align-items-baseline"],[1,"form-control","form-control-sm","mr-3","ml-auto","select-direction",3,"ngModel","ngModelChange"],["value","DESC"],["value","ASC","selected",""],[1,"fa","fa-arrows","handle"],[1,"fa","fa-remove","mx-2","cursor-pointer",3,"click"]],template:function(b,A){if(1&b&&(u.TgZ(0,"div",0)(1,"a",1,2),u.NdJ("onShown",function(p){return A.onQueryDetailsPopoverShown(p)}),u._uU(3),u.ALo(4,"number"),u._UZ(5,"i",3),u.qZA()(),u.YNc(6,ne,20,4,"ng-template",null,4,u.W1O)),2&b){const g=u.MAs(7);u.xp6(1),u.Q6J("popover",g)("outsideClick",!0),u.xp6(2),u.AsE(" ",u.lcZ(4,4,A.realRowsCount),"",A.totalRowsCountText,"")}},dependencies:[M.Hz,M.Mq,M.TO,T.sg,f.YN,f.Kr,f.Fj,f.EJ,f.JJ,f.On,y.k5,T.JJ],styles:["[_nghost-%COMP%]{display:flex}.grid-footer[_ngcontent-%COMP%]{display:inline-block;width:auto;z-index:11}.grid-footer[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{display:inline-block;height:1.5rem;width:auto}.select-direction[_ngcontent-%COMP%]{width:70px}.popup-label[_ngcontent-%COMP%]{font-size:120%;font-weight:600;white-space:nowrap}.show-max-input[_ngcontent-%COMP%]{width:85px}  .query-info-popover{min-width:400px}#sort-fields-popover[_ngcontent-%COMP%]{right:0!important;left:auto!important}@media (max-width: 767.98px){  .query-info-popover{min-width:300px}.rows-count[_ngcontent-%COMP%]{position:initial}}"]}),L})(),re=(()=>{var X;class L{constructor(b,A,g,p){this.dialogService=b,this.router=A,this.route=g,this.filtersSerializers=p,this.destroy$=new te.x,this.reflectUrl=!1,this.gridDataModified=new u.vpe,this.queryInfoChange=new u.vpe,this.additionalFiltersChange=new u.vpe,this.dblClick=new u.vpe,this.dataSource=new ie.n,this.additionalFilters=[],this.ViewType=v.bW}ngOnInit(){var b=this;return(0,r.Z)(function*(){if(!b.dataGrid)throw new Error("this.dataGrid is not initilized");if(!b.queryInfo)throw new Error("this.queryInfo is not initilized");if(b.dataGrid.dataGridInfo=b.queryInfo.dataGrid,b.reflectUrl&&(b.queryInfoSerializer=new R),!b.queryInfo?.sqlQuery)throw new Error("this.queryInfo.sqlQuery is not defined");b.dataSource.data$.pipe((0,e.R)(b.destroy$),(0,D.h)(A=>!!A?.fields&&!b.queryInfo?.sqlQuery?.fields?.length)).subscribe(A=>{b.queryInfo?.sqlQuery&&(b.queryInfo.sqlQuery.fields=A?.fields?.map(g=>({name:g.name,sqlExpression:b.queryInfo?.sqlQuery?.tableAlias?`${b.queryInfo.sqlQuery.tableAlias}.${g.name}`:g.name,groupBy:!1})),b.reflectUrl&&b.queryInfoSerializer&&(b.queryInfoSerializer.initQueryInfo=b.queryInfo))}),b.initAdditionalFilters(),b.initUrlQueryInfo(),b.queryInfo.sqlQuery.connectionName&&(yield b.dataSource.reload(b.queryInfo.sqlQuery))})()}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete()}onDblClick(b){this.dblClick.next(b)}onDataGridColumnMoved(b){const A=this.queryInfo?.sqlQuery?.fields||[];let g=b.from<b.to?1:0;A.splice(b.to+g,0,A[b.from]),g=b.from>b.to?1:0,A.splice(b.from+g,1),this.reflectChangesToUrl(),this.queryInfoChange.emit(this.queryInfo)}reload(){var b=this;return(0,r.Z)(function*(){if(!b.dataGrid)throw new Error("this.dataGrid is not initilized");if(!b.queryInfo)throw new Error("this.queryInfo is not initilized");yield b.dataSource.reload(b.queryInfo.sqlQuery)})()}sqlFieldChanged(b){var A=this;return(0,r.Z)(function*(){if(!A.queryInfo)throw new Error("this.queryInfo is not initilized");const g=A.queryInfo.sqlQuery?.fields?.find(p=>p.name===b.name);g&&(g.sqlExpression=b.sqlExpression,A.reflectChangesToUrl(),yield A.dataSource.reload(A.queryInfo.sqlQuery))})()}onDataGridInfoChanged(b){var A=this;return(0,r.Z)(function*(){if(!A.queryInfo)throw new Error("this.queryInfo is not initilized");A.queryInfo.dataGrid=b,A.reflectChangesToUrl(),A.queryInfoChange.emit(A.queryInfo)})()}onDataChartInfoChanged(b){if(!this.queryInfo)throw new Error("this.queryInfo is not initilized");this.queryInfo.dataChart=b,this.reflectChangesToUrl(),this.queryInfoChange.emit(this.queryInfo)}onViewTypeChanged(b){if(!this.queryInfo)throw new Error("this.queryInfo is not initilized");this.queryInfo.viewType=b,this.reflectChangesToUrl(),this.queryInfoChange.emit(this.queryInfo)}onFiltersBarChanged(b){if(!this.queryInfo)throw new Error("this.dataGrid is not initilized");this.queryInfo.filtersBar=b,this.queryInfoChange.emit(this.queryInfo),this.reflectChangesToUrl()}onSqlQueryChange(b){this.reflectChangesToUrl(),this.dataSource.reload(b.sqlQuery)}openQueryManager(){var b=this;return(0,r.Z)(function*(){return new Promise(A=>{var g;b.dialogService.open(H._,{class:"modal-xl full-height",keyboard:!1,initialState:{config:b.queryInfo?.sqlQuery,configQueryInfo:b.queryInfo}}).onClose$.pipe((0,D.h)(p=>!!p)).subscribe(function(p){return(g=g||(0,r.Z)(function*(S){b.queryInfo&&(b.queryInfo.sqlQuery=S,b.queryInfoChange.emit(b.queryInfo),yield b.dataSource.reload(b.queryInfo.sqlQuery),b.reflectChangesToUrl(),A())})).apply(this,arguments)})})})()}initAdditionalFilters(){this.filtersSerializers.getFilterItems(this.route.snapshot.queryParams.filter).forEach(g=>this.dataSource.addAdditionalFilter(g)),this.dataSource.additionalFilters$.pipe((0,e.R)(this.destroy$)).subscribe(g=>{this.additionalFilters=g,this.additionalFiltersChange.emit(g),this.syncQueryFilterParam({filter:this.filtersSerializers.getQueryParam(this.additionalFilters)})})}initUrlQueryInfo(){if(this.reflectUrl&&this.queryInfoSerializer){const b=this.queryInfoSerializer.deserialize(this.route.snapshot.queryParams);this.queryInfo&&(this.queryInfo.dataGrid=b.dataGrid,this.queryInfo.dataChart=b.dataChart,this.queryInfo.viewType=b.viewType??v.bW.DataGrid,this.queryInfo.filtersBar=b.filtersBar,Object.assign(this.queryInfo.sqlQuery,b.sqlQuery),this.tabsComponent&&b.viewType===v.bW.Chart&&(this.tabsComponent.tabs[1].active=!0))}}reflectChangesToUrl(){if(this.reflectUrl&&this.queryInfoSerializer){const b=this.queryInfoSerializer.serialize(this.queryInfo);this.syncQueryFilterParam(b)}}setViewType(b){this.queryInfo&&(this.queryInfo.viewType=b,this.reflectChangesToUrl(),this.queryInfoChange.emit(this.queryInfo))}syncQueryFilterParam(b){this.router.navigate([],{relativeTo:this.route,queryParams:b,queryParamsHandling:"merge"})}}return(X=L).\u0275fac=function(b){return new(b||X)(u.Y36(V.x),u.Y36(ae.F0),u.Y36(ae.gz),u.Y36(Q.R))},X.\u0275cmp=u.Xpm({type:X,selectors:[["app-data-query"]],viewQuery:function(b,A){if(1&b&&(u.Gf(I.Z,7),u.Gf(l.AH,7)),2&b){let g;u.iGM(g=u.CRH())&&(A.dataGrid=g.first),u.iGM(g=u.CRH())&&(A.tabsComponent=g.first)}},inputs:{dataFilters:"dataFilters",reflectUrl:"reflectUrl",queryInfo:"queryInfo"},outputs:{gridDataModified:"gridDataModified",queryInfoChange:"queryInfoChange",additionalFiltersChange:"additionalFiltersChange",dblClick:"dblClick"},decls:5,vars:7,consts:[[1,"d-flex","flex-column","h-100"],[1,"d-flex","h-100","flex-column","overflow-hidden","mb-0"],[3,"dataSource","dataGridInfo","showEmptyGrid","dataChartInfo","viewType","dblClick","dataGridInfoChanged","sqlFieldChanged","dataGridColumnMoved","gridDataModified","dataChartInfoChanged","viewTypeChanged"],["dataGrid",""],["footer-right","",3,"realRowsCount","sqlQueryInfo","sqlQueryChange"]],template:function(b,A){1&b&&(u.TgZ(0,"div",0)(1,"div",1)(2,"app-ag-data-grid",2,3),u.NdJ("dblClick",function(p){return A.onDblClick(p)})("dataGridInfoChanged",function(p){return A.onDataGridInfoChanged(p)})("sqlFieldChanged",function(p){return A.sqlFieldChanged(p)})("dataGridColumnMoved",function(p){return A.onDataGridColumnMoved(p)})("gridDataModified",function(p){return A.gridDataModified.emit(p)})("dataChartInfoChanged",function(p){return A.onDataChartInfoChanged(p)})("viewTypeChanged",function(p){return A.onViewTypeChanged(p)}),u.TgZ(4,"app-data-query-footer",4),u.NdJ("sqlQueryChange",function(p){return A.onSqlQueryChange(p)}),u.qZA()()()()),2&b&&(u.xp6(2),u.Q6J("dataSource",A.dataSource)("dataGridInfo",null==A.queryInfo?null:A.queryInfo.dataGrid)("showEmptyGrid",!0)("dataChartInfo",null==A.queryInfo?null:A.queryInfo.dataChart)("viewType",null==A.queryInfo?null:A.queryInfo.viewType),u.xp6(2),u.Q6J("realRowsCount",A.dataSource.loadedRowsCount)("sqlQueryInfo",null==A.queryInfo?null:A.queryInfo.sqlQuery))},dependencies:[I.Z,W],styles:[".fa.fa-cog[_ngcontent-%COMP%], .fa.fa-refresh[_ngcontent-%COMP%]{color:var(--color)}"]}),L})()},89250:(be,ue,d)=>{d.d(ue,{U:()=>Q});var r=d(15861),u=d(3202),te=d(21473),e=d(49568),D=d(13509),v=d(65879),ie=d(69569),H=d(8050),z=d(71997),E=d(33374),R=d(96814),l=d(56223);function I(U,B){if(1&U&&(v.TgZ(0,"span",18),v._uU(1),v.qZA()),2&U){const M=v.oxw();v.xp6(1),v.hij("",M.progressPct," ")}}function V(U,B){1&U&&v._UZ(0,"span",19)}function ae(U,B){1&U&&(v.ynx(0),v._uU(1,"Open File"),v.BQk())}let Q=(()=>{var U;class B{constructor(T,f,y,x){this.notificationService=T,this.tabsService=f,this.studioService=y,this.dialogRef=x,this.fileService=new D.j5,this.take="1000",this.skip="",this.containsText="",this.distinct="",this.progressPct=""}ngOnInit(){this.take=this.options?.take?String(this.options?.take):"",this.skip=this.options?.skip?String(this.options?.skip):"",this.containsText=this.options?.containsText?String(this.options?.containsText):"",this.distinct=this.options?.distinct?String(this.options?.distinct):""}onFileChange(T){var f=this;return(0,r.Z)(function*(){const y=T?.files[0];if(!y)return void f.notificationService.error("No file selected");let x={take:(0,u.parseNumberOrNull)(f.take)||void 0,skip:(0,u.parseNumberOrNull)(f.skip)||void 0,containsText:f.containsText||void 0,distinct:f.distinct||void 0};x={...f.options||{},...x};const k={parser:new e.cB,fileName:y.name,count:0,finished:!1,data:[],chunkItems:[]};f.progressPct="Reading ...";try{var F;yield f.fileService.openTextFilePartially(y,function(q,ne){return(F=F||(0,r.Z)(function*(W,re){return f.progressPct=`Reading ${re} %`,yield f.fileService.processJsonChunk(W,k,x)})).apply(this,arguments)},f.options?.chunkSize),f.dialogRef.close({fileName:y.name,fileSize:y.size,data:k.data})}catch(q){f.dialogRef.close({fileName:y.name,fileSize:y.size,errorMessage:(0,te.e$)(q)})}})()}onGenerateJspy(){this.tabsService.addNewAppTab(this.studioService.currentApp,"jspy","",`# press run button and select JSON/JSV file\nreturn openFileAsArray({\n  #filter: r => r.id == 1, # filter predicate\n  #map: r => # add transformation logic here\n  take: ${this.take}\n  #skip: 3\n}).data\n    `),this.dialogRef.close(null)}onCancel(){this.dialogRef.close(null)}}return(U=B).\u0275fac=function(T){return new(T||U)(v.Y36(ie.g),v.Y36(H.x),v.Y36(z.F),v.Y36(E.z))},U.\u0275cmp=v.Xpm({type:U,selectors:[["app-open-file-settings-dialog"]],inputs:{options:"options"},decls:43,vars:12,consts:[[1,"modal-header"],[1,"pull-left"],[1,"modal-title"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body","px-4","d-flex","flex-column","h-100","overflow-hidden"],[1,"row","mr-0","mb-2","flex-fill"],["for","folder",1,"col-4","col-form-label"],[1,"form-control","col",3,"ngModel","disabled","ngModelChange"],[1,"row","mr-0","mt-3","flex-fill"],[1,"modal-footer","d-flex","flex-row"],["type","button",1,"btn","btn-sm","btn-outline-secondary","mr-auto",3,"click"],["class","align-middle badge badge-info p-2",4,"ngIf"],["for","my-file-selector",1,"btn","btn-sm","btn-primary","ml-auto","mr-2"],["id","my-file-selector","type","file",1,"d-none",3,"disabled","change"],["class","spinner-border",4,"ngIf"],[4,"ngIf"],["type","button",1,"btn","btn-sm","btn-light",3,"click"],[1,"align-middle","badge","badge-info","p-2"],[1,"spinner-border"]],template:function(T,f){1&T&&(v.TgZ(0,"div",0)(1,"div",1)(2,"h4",2),v._uU(3," Open file partially "),v.qZA()(),v.TgZ(4,"button",3),v.NdJ("click",function(){return f.onCancel()}),v.TgZ(5,"span",4),v._uU(6,"\xd7"),v.qZA()()(),v.TgZ(7,"div",5)(8,"div",6)(9,"label",7),v._uU(10,"Take:"),v.qZA(),v.TgZ(11,"input",8),v.NdJ("ngModelChange",function(x){return f.take=x}),v.qZA()(),v.TgZ(12,"div",6)(13,"label",7),v._uU(14,"Skip:"),v.qZA(),v.TgZ(15,"input",8),v.NdJ("ngModelChange",function(x){return f.skip=x}),v.qZA()(),v.TgZ(16,"div",6)(17,"label",7),v._uU(18,"Contains:"),v.qZA(),v.TgZ(19,"input",8),v.NdJ("ngModelChange",function(x){return f.containsText=x}),v.qZA()(),v.TgZ(20,"div",6)(21,"label",7),v._uU(22,"Distinct:"),v.qZA(),v.TgZ(23,"input",8),v.NdJ("ngModelChange",function(x){return f.distinct=x}),v.qZA()(),v.TgZ(24,"div",9)(25,"span"),v._uU(26,"* Specify how many rows to "),v.TgZ(27,"b"),v._uU(28,"take"),v.qZA(),v._uU(29," or to "),v.TgZ(30,"b"),v._uU(31,"skip"),v.qZA(),v._uU(32,". Works well with very big files"),v.qZA()()(),v.TgZ(33,"div",10)(34,"label",11),v.NdJ("click",function(){return f.onGenerateJspy()}),v._uU(35,"Generate JSPY"),v.qZA(),v.YNc(36,I,2,1,"span",12),v.TgZ(37,"label",13)(38,"input",14),v.NdJ("change",function(x){return f.onFileChange(x.target)}),v.qZA(),v.YNc(39,V,1,0,"span",15),v.YNc(40,ae,2,0,"ng-container",16),v.qZA(),v.TgZ(41,"label",17),v.NdJ("click",function(){return f.onCancel()}),v._uU(42,"Cancel"),v.qZA()()),2&T&&(v.xp6(11),v.Q6J("ngModel",f.take)("disabled",!!f.progressPct),v.xp6(4),v.Q6J("ngModel",f.skip)("disabled",!!f.progressPct),v.xp6(4),v.Q6J("ngModel",f.containsText)("disabled",!!f.progressPct),v.xp6(4),v.Q6J("ngModel",f.distinct)("disabled",!!f.progressPct),v.xp6(13),v.Q6J("ngIf",f.progressPct),v.xp6(2),v.Q6J("disabled",!!f.progressPct),v.xp6(1),v.Q6J("ngIf",f.progressPct),v.xp6(1),v.Q6J("ngIf",!f.progressPct))},dependencies:[R.O5,l.Fj,l.JJ,l.On],encapsulation:2}),B})()},80014:(be,ue,d)=>{d.d(ue,{a:()=>Q});var r=d(15861),u=d(46681),te=d(91334),e=d(65879),D=d(69569),v=d(75263),ie=d(33374),H=d(96814),z=d(56223),E=d(54807);function R(U,B){if(1&U&&(e.TgZ(0,"option",22),e._uU(1),e.qZA()),2&U){const M=B.$implicit;e.Q6J("ngValue",M),e.xp6(1),e.Oqu(M)}}function l(U,B){if(1&U&&(e.TgZ(0,"option",22),e._uU(1),e.qZA()),2&U){const M=B.$implicit;e.Q6J("ngValue",M),e.xp6(1),e.Oqu(M)}}function I(U,B){1&U&&(e.TgZ(0,"label",29),e._uU(1,"Subscribe Field"),e.qZA())}function V(U,B){1&U&&(e.TgZ(0,"label",29),e._uU(1,"Publish Field"),e.qZA())}function ae(U,B){if(1&U){const M=e.EpF();e.TgZ(0,"div",23)(1,"div",24),e.YNc(2,I,2,0,"label",25),e.TgZ(3,"div",26)(4,"ng-select",27),e.NdJ("ngModelChange",function(f){const x=e.CHM(M).$implicit;return e.KtG(x.subscribeField=f)})("change",function(){const y=e.CHM(M).$implicit,x=e.oxw();return e.KtG(x.onSubscribeFieldChanged(y))}),e.qZA()()(),e.TgZ(5,"div",24),e.YNc(6,V,2,0,"label",25),e.TgZ(7,"div",26)(8,"input",28),e.NdJ("ngModelChange",function(f){const x=e.CHM(M).$implicit;return e.KtG(x.publishField=f)}),e.qZA()()()()}if(2&U){const M=B.$implicit,T=B.index,f=e.oxw();e.xp6(2),e.Q6J("ngIf",0===T),e.xp6(2),e.MGl("name","left-field-name-",T,""),e.Q6J("ngModel",M.subscribeField)("items",f.subscribeFields),e.xp6(2),e.Q6J("ngIf",0===T),e.xp6(2),e.MGl("name","right-field-name-",T,""),e.Q6J("ngModel",M.publishField)}}let Q=(()=>{var U;class B{constructor(T,f,y){this.notificationService=T,this.sqlMetaDataService=f,this.dialogRef=y,this.configPubSub={},this.configQueryInfo={},this.pubTopic="",this.pubMessage="selectedRow",this.pubMessages=[],this.pubEnabled=!1,this.subAction="applyFilter",this.subActions=[],this.subIsEnabled=!1,this.subTopic="",this.subscribeFields=[],this.configsInfo=[],this.formatLabel=te.N4}ngOnInit(){var T=this;return(0,r.Z)(function*(){if(T.pubMessages.push(T.configPubSub?.publish?.message||"selectedRow"),T.pubTopic=T.configPubSub?.publish?.topic||"table_dbl_click",T.pubEnabled=!!T.configPubSub?.publish?.isEnabled,T.subActions.push(T.configPubSub?.subscribe?.action||"applyFilter"),T.configQueryInfo.sqlQuery?.fields&&(T.subscribeFields=T.configQueryInfo.sqlQuery.fields.map(f=>f.name)),T.subIsEnabled=!!T.configPubSub?.subscribe?.isEnabled,T.subTopic=T.configPubSub?.subscribe?.topic||"table_dbl_click",T.configPubSub?.subscribe?.actionParams)for(const[f,y]of Object.entries(T.configPubSub.subscribe.actionParams))T.configsInfo.push({publishField:f,subscribeField:y}),T.subscribeFields.push(y);else{const f=(0,u.first)(T.configQueryInfo.sqlQuery?.fields||[])?.name||"";T.configsInfo.push({publishField:f,subscribeField:f})}})()}onSave(){const T={publish:{isEnabled:!!this.pubEnabled,topic:this.pubTopic,message:this.pubMessage},subscribe:{isEnabled:!!this.subIsEnabled,topic:this.subTopic,action:this.subAction,actionParams:this.configsInfo.reduce((f,y)=>({...f,[y.publishField]:y.subscribeField}),{})}};this.dialogRef.close(T)}onCancel(){this.dialogRef.close()}onAddParams(){this.configQueryInfo.sqlQuery?.fields&&(this.subscribeFields=this.configQueryInfo.sqlQuery.fields.map(T=>T.name),this.configsInfo.push({publishField:"publishField_Name",subscribeField:this.subscribeFields[0]}))}onSubscribeFieldChanged(T){T.publishField=T.subscribeField,this.subIsEnabled=!0}}return(U=B).\u0275fac=function(T){return new(T||U)(e.Y36(D.g),e.Y36(v.hp),e.Y36(ie.z))},U.\u0275cmp=e.Xpm({type:U,selectors:[["app-publish-subscribe-dialog"]],inputs:{configPubSub:"configPubSub",configQueryInfo:"configQueryInfo"},decls:45,vars:9,consts:[[1,"modal-header"],[1,"modal-title","pull-left"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body","px-4","d-flex","flex-column","h-100","overflow-hidden"],[1,"form-group","row","mr-0","mb-2","align-items-center"],["type","checkbox",1,"col-1",3,"ngModel","ngModelChange"],[1,"my-2"],[1,"row","mr-0","mb-2","flex-fill"],["for","folder",1,"col-4","col-form-label"],[1,"form-control","col",3,"ngModel","ngModelChange"],[1,"row","mr-0","mb-2","flex-nowrap"],[1,"form-control","form-control-sm",3,"ngModel","ngModelChange"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"form-group","row","mr-0","mb-1","align-items-center"],[1,"ml-2"],["type","button",1,"ml-auto","btn","btn-light","btn-sm",3,"click"],["class","form-row mx-0 fx-100 ",4,"ngFor","ngForOf"],[1,"modal-footer","flex-column"],[1,"row","w-100","mx-0","px-0"],["type","button",1,"btn","btn-primary","ml-auto","mr-2","fx-100",3,"click"],["type","button",1,"btn","btn-light","fx-80",3,"click"],[3,"ngValue"],[1,"form-row","mx-0","fx-100"],[1,"px-1","p-1","col-sm-6","col-md-6"],["class","col-form-label px-0",4,"ngIf"],[1,"p-0","m-0"],["placeholder","Enter Field Name","required","","appendTo","body",1,"auto-grow",3,"ngModel","name","items","ngModelChange","change"],[1,"form-control","col",3,"ngModel","name","ngModelChange"],[1,"col-form-label","px-0"]],template:function(T,f){1&T&&(e.TgZ(0,"div",0)(1,"h4",1),e._uU(2," Publish / Subscribe "),e.qZA(),e.TgZ(3,"button",2),e.NdJ("click",function(){return f.onCancel()}),e.TgZ(4,"span",3),e._uU(5,"\xd7"),e.qZA()()(),e.TgZ(6,"div",4)(7,"div",5)(8,"input",6),e.NdJ("ngModelChange",function(x){return f.pubEnabled=x}),e.qZA(),e.TgZ(9,"h4",7),e._uU(10,"Publish"),e.qZA()(),e.TgZ(11,"div",8)(12,"label",9),e._uU(13,"Topic:"),e.qZA(),e.TgZ(14,"input",10),e.NdJ("ngModelChange",function(x){return f.pubTopic=x}),e.qZA()(),e.TgZ(15,"div",11)(16,"label",9),e._uU(17,"Message:"),e.qZA(),e.TgZ(18,"select",12),e.NdJ("ngModelChange",function(x){return f.pubMessage=x}),e.YNc(19,R,2,2,"option",13),e.qZA()(),e.TgZ(20,"div",5)(21,"input",6),e.NdJ("ngModelChange",function(x){return f.subIsEnabled=x}),e.qZA(),e.TgZ(22,"h4",7),e._uU(23,"Subscribe"),e.qZA()(),e.TgZ(24,"div",8)(25,"label",9),e._uU(26,"Topic:"),e.qZA(),e.TgZ(27,"input",10),e.NdJ("ngModelChange",function(x){return f.subTopic=x}),e.qZA()(),e.TgZ(28,"div",11)(29,"label",9),e._uU(30,"Action:"),e.qZA(),e.TgZ(31,"select",12),e.NdJ("ngModelChange",function(x){return f.subAction=x}),e.YNc(32,l,2,2,"option",13),e.qZA()(),e.TgZ(33,"div",14)(34,"h4",15),e._uU(35,"Action Params:"),e.qZA(),e.TgZ(36,"button",16),e.NdJ("click",function(){return f.onAddParams()}),e._uU(37,"Add Params"),e.qZA()(),e.YNc(38,ae,9,7,"div",17),e.qZA(),e.TgZ(39,"div",18)(40,"div",19)(41,"button",20),e.NdJ("click",function(){return f.onSave()}),e._uU(42,"Save"),e.qZA(),e.TgZ(43,"button",21),e.NdJ("click",function(){return f.onCancel()}),e._uU(44,"Cancel"),e.qZA()()()),2&T&&(e.xp6(8),e.Q6J("ngModel",f.pubEnabled),e.xp6(6),e.Q6J("ngModel",f.pubTopic),e.xp6(4),e.Q6J("ngModel",f.pubMessage),e.xp6(1),e.Q6J("ngForOf",f.pubMessages),e.xp6(2),e.Q6J("ngModel",f.subIsEnabled),e.xp6(6),e.Q6J("ngModel",f.subTopic),e.xp6(4),e.Q6J("ngModel",f.subAction),e.xp6(1),e.Q6J("ngForOf",f.subActions),e.xp6(6),e.Q6J("ngForOf",f.configsInfo))},dependencies:[H.sg,H.O5,z.YN,z.Kr,z.Fj,z.Wl,z.EJ,z.JJ,z.Q7,z.On,E.w9],encapsulation:2}),B})()},63411:(be,ue,d)=>{d.d(ue,{_:()=>p});var r=d(15861),u=d(3202),te=d(32013),e=d(65619),D=d(32181),v=d(46681),ie=d(60364),H=d(99796),z=d(4786),E=d(21473),R=d(91334),l=d(65879),I=d(69569),V=d(75263),ae=d(33374),Q=d(96814),U=d(56223),B=d(54807);function M($,oe){if(1&$&&(l.TgZ(0,"option",23),l._uU(1),l.qZA()),2&$){const K=oe.$implicit,h=l.oxw();l.Q6J("value",K),l.xp6(1),l.Oqu(h.formatLabel(K))}}function T($,oe){if(1&$&&(l.TgZ(0,"label",28),l._uU(1,"Primary Key Field"),l.qZA()),2&$){const K=l.oxw().index;l.MGl("for","left-field-name-",K,"")}}function f($,oe){if(1&$&&(l.TgZ(0,"label",28),l._uU(1,"Foreign Key Field"),l.qZA()),2&$){const K=l.oxw().index;l.MGl("for","right-field-name-",K,"")}}function y($,oe){if(1&$){const K=l.EpF();l.TgZ(0,"div",6)(1,"div",24),l.YNc(2,T,2,1,"label",25),l.TgZ(3,"div",16)(4,"ng-select",26),l.NdJ("ngModelChange",function(m){const N=l.CHM(K).$implicit;return l.KtG(N.primaryFieldName=m)})("open",function(){l.CHM(K);const m=l.oxw();return l.KtG(m.onPrimaryFieldOpen(m.joinInfo))}),l.qZA()()(),l.TgZ(5,"div",24),l.YNc(6,f,2,1,"label",25),l.TgZ(7,"div",16)(8,"ng-select",27),l.NdJ("ngModelChange",function(m){const N=l.CHM(K).$implicit;return l.KtG(N.foreignFieldName=m)})("close",function(){const C=l.CHM(K).$implicit,N=l.oxw();return l.KtG(N.onForeignFieldClose(C))})("open",function(){l.CHM(K);const m=l.oxw();return l.KtG(m.onForeignFieldOpen(m.joinInfo))}),l.qZA()()()()}if(2&$){const K=oe.$implicit,h=oe.index,m=l.oxw();l.xp6(2),l.Q6J("ngIf",0===h),l.xp6(2),l.MGl("name","left-field-name-",h,""),l.Q6J("ngModel",K.primaryFieldName)("items",m.joinInfo.primaryFieldNames),l.xp6(2),l.Q6J("ngIf",0===h),l.xp6(2),l.MGl("name","right-field-name-",h,""),l.Q6J("ngModel",K.foreignFieldName)("items",m.joinInfo.foreignFieldNames)}}let x=(()=>{var $;class oe{constructor(h,m,C){this.notificationService=h,this.sqlMetaDataService=m,this.dialogRef=C,this.joinInfo={},this.tablesInfo=[],this.joinTypes=["InnerJoin","LeftJoin","RightJoin","FullJoin"],this.formatLabel=R.N4,this.foreingKeyTables=[],this.selectedForeignKeyTable="",this.mainTableFieldNames=[],this.leftFieldNames=[],this.leftFieldName="",this.mainTableAlias="",this.connectionName="",this.tableAlias=""}ngOnInit(){var h=this;return(0,r.Z)(function*(){function m(C,N){return`${C} ${N||""}`.trim()}if(!h.config)throw new Error("Input is not supplied");if(h.joinInfo.joinType=ie.JoinType.LeftJoin,h.joinInfo.fieldsInfo=[],h.mainTableAlias=h.config.mainTableAlias||"",h.connectionName=h.config.connectionName,h.joinInfo.foreignKeyTables=[m(h.config.mainTableName,h.mainTableAlias)],h.joinInfo.primaryKeyTables=h.config.allTableNames,h.config.selectedJoin){const C=h.config.selectedJoin;h.joinInfo.joinType=C.joinType,h.joinInfo.primaryKeyTable=C.tableName,h.joinInfo.tableAlias=C.tableAlias||"",h.joinInfo.joinCondition2=C.joinCondition2||"";const N=C.joinCondition.split("AND"),he=N[0][0][0];for(let me of N){const pe=me.split("=").map(Qe=>Qe.trim().split("."));h.joinInfo.fieldsInfo.push({primaryFieldName:pe[0][1],foreignFieldName:pe[1][1]})}for(let me=0;me<h.config.joins.length;me++){const pe=h.config.joins[me];if(pe.tableName===C.tableName&&(pe.tableAlias||"")===(C.tableAlias||""))break;h.joinInfo.foreignKeyTables.push(m(pe.tableName,pe.tableAlias))}h.joinInfo.foreignKeyTable=h.joinInfo.foreignKeyTables.find(me=>me.endsWith(` ${he}`))}else{h.joinInfo.foreignKeyTable=m(h.config.mainTableName,h.mainTableAlias);for(let C of h.config.joins||[])h.joinInfo.foreignKeyTables.push(m(C.tableName,C.tableAlias))}h.config.selectedJoin||(yield h.onAddJoinTable())})()}onPrimaryTableSelect(h){var m=this;return(0,r.Z)(function*(){let C=[];m.config?.joins&&(C=m.config.joins.filter(he=>he.tableAlias!==h.tableAlias&&he.tableAlias).map(he=>he.tableAlias||"")),h.tableAlias=(0,E.Tg)(h.primaryKeyTable,3,C);const N=h.primaryKeyTable.split(".");h.tableAlias===N[0].slice(0,1)&&(h.tableAlias=N[1].slice(0,1)),m.joinInfo.fieldsInfo=[],m.joinInfo.fieldsInfo.push({foreignFieldName:m.mainTableFieldNames[0]})})()}onForeignTableSelect(h){return(0,r.Z)(function*(){const m=h.foreignKeyTable?.split(" ")||[];h.foreignTableAlias=m[1]})()}onPrimaryFieldOpen(h){var m=this;return(0,r.Z)(function*(){const C=h.primaryKeyTable;if(!C&&C.indexOf(".")>0)throw new Error("joinModel.tableName can't be empty and have schemaName e.g. dbo.tableName");const N=(yield m.sqlMetaDataService.getMetaDataObject(m.connectionName,C.split(".")[0],C.split(".")[1])).fields.map(he=>he.fieldName);m.joinInfo.primaryFieldNames=N,m.joinInfo.primaryFieldNames.unshift("<None>")})()}onForeignFieldClose(h){var m=this;return(0,r.Z)(function*(){"<None>"===h.foreignFieldName&&"<None>"===h.primaryFieldName&&0!==m.joinInfo.fieldsInfo.length&&(m.joinInfo.fieldsInfo=m.joinInfo.fieldsInfo.filter(C=>"<None>"!==C.foreignFieldName&&"<None>"!==C.primaryFieldName))})()}onForeignFieldOpen(h){var m=this;return(0,r.Z)(function*(){const C=h.foreignKeyTable?.split(" ")||"";if(!C[0]&&C.indexOf(".")>0)throw new Error("joinModel.tableName can't be empty and have schemaName e.g. dbo.tableName");const N=(yield m.sqlMetaDataService.getMetaDataObject(m.connectionName,C[0].split(".")[0],C[0].split(".")[1])).fields.map(he=>he.fieldName);m.joinInfo.foreignFieldNames=N,m.joinInfo.foreignFieldNames.unshift("<None>")})()}onJoinDialogSave(){var h=this;return(0,r.Z)(function*(){const m=h.isValidJoins();if(!0===m){const C=h.fromModelToDto(h.joinInfo);h.dialogRef.close(C)}else h.notificationService.error(m)})()}onAddJoinTable(){var h=this;return(0,r.Z)(function*(){h.joinInfo.fieldsInfo.push({foreignFieldName:h.mainTableFieldNames[0]})})()}removeItem(h){}fromModelToDto(h){const m=h.foreignKeyTable?.split(" ")||"",C=m[m.length-1],N=h.fieldsInfo.map(me=>`${C}.${me.foreignFieldName} = ${h.tableAlias}.${me.primaryFieldName}`).join(" AND ");return{joinType:h.joinType,tableName:h.primaryKeyTable,tableAlias:h.tableAlias,joinCondition:N,joinCondition2:h.joinCondition2}}isValidJoins(){const h=this.joinInfo.tableAlias;return this.joinInfo.primaryKeyTable?0===this.joinInfo.fieldsInfo.length?"Field name is empty in the row ":this.joinInfo.tableAlias?!this.config?.selectedJoin&&this.config?.joins&&1===this.config.joins.map(C=>C.tableAlias||"").concat([this.mainTableAlias]).filter(C=>C===h).length?`Dublicated table1 alias ${this.joinInfo.tableAlias}.`:this.mainTableAlias!==h||`Dublicated table2 alias ${this.joinInfo.tableAlias}.`:"Table alias is empty in the row ":"Table name is empty in the row "}onJoinCancel(){this.dialogRef.close()}}return($=oe).\u0275fac=function(h){return new(h||$)(l.Y36(I.g),l.Y36(V.hp),l.Y36(ae.z))},$.\u0275cmp=l.Xpm({type:$,selectors:[["app-join-table-dialog"]],inputs:{config:"config"},decls:36,vars:9,consts:[[1,"modal-header"],[1,"modal-title","pull-left"],[1,"col-auto","col-form-label","ml-auto"],["type","text",1,"col-sm-2","px-0","auto-grow","form-control",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"modal-body","px-4","d-flex","flex-column","h-100","overflow-hidden"],[1,"form-row","mx-0","col","fx-100"],[1,"px-1","p-0","col-sm-6","col-md-5"],[1,"align-items-center"],["placeholder","Select table","appendTo","body",1,"auto-grow",3,"items","ngModel","ngModelChange","change"],[1,"px-1","p-0","col-sm-6","col-md-1"],["type","text","name","join-table-alias","required","",1,"form-control",3,"ngModel","ngModelChange"],[1,"px-1","p-0","col-sm-6","col-md-6"],["class","form-row mx-0 col fx-100 ",4,"ngFor","ngForOf"],[1,"px-1","p-1","col-12"],["for","custom-sql-condition",1,"col-form-label","px-0"],[1,"p-0","m-0"],["type","text","name","custom-sql","required","",1,"form-control",3,"ngModel","ngModelChange"],[1,"modal-footer","flex-column"],[1,"row","w-100","mx-0","px-0"],["type","button",1,"btn","btn-light",3,"click"],["type","button",1,"btn","btn-primary","ml-auto","mr-2","fx-100",3,"click"],["type","button",1,"btn","btn-light","fx-80",3,"click"],[3,"value"],[1,"px-1","p-1","col-sm-6","col-md-6"],["class","col-form-label px-0",3,"for",4,"ngIf"],["placeholder","Enter Field Name","required","","appendTo","body",1,"auto-grow",3,"ngModel","name","items","ngModelChange","open"],["placeholder","Enter Field Name","required","","appendTo","body",1,"auto-grow",3,"ngModel","name","items","ngModelChange","close","open"],[1,"col-form-label","px-0",3,"for"]],template:function(h,m){1&h&&(l.TgZ(0,"div",0)(1,"h4",1),l._uU(2," Tables and Columns "),l.qZA(),l.TgZ(3,"label",2),l._uU(4,"Join Type"),l.qZA(),l.TgZ(5,"select",3),l.NdJ("ngModelChange",function(N){return m.joinInfo.joinType=N}),l.YNc(6,M,2,2,"option",4),l.qZA()(),l.TgZ(7,"div",5)(8,"div",6)(9,"div",7)(10,"span",8),l._uU(11,"Primary Key Table"),l.qZA(),l.TgZ(12,"ng-select",9),l.NdJ("ngModelChange",function(N){return m.joinInfo.primaryKeyTable=N})("change",function(){return m.onPrimaryTableSelect(m.joinInfo)}),l.qZA()(),l.TgZ(13,"div",10)(14,"span",8),l._uU(15,"Alias"),l.qZA(),l.TgZ(16,"input",11),l.NdJ("ngModelChange",function(N){return m.joinInfo.tableAlias=N}),l.qZA()(),l.TgZ(17,"div",12)(18,"span",8),l._uU(19,"Foreign Key Table"),l.qZA(),l.TgZ(20,"ng-select",9),l.NdJ("ngModelChange",function(N){return m.joinInfo.foreignKeyTable=N})("change",function(){return m.onForeignTableSelect(m.joinInfo)}),l.qZA()()(),l.YNc(21,y,9,8,"div",13),l.TgZ(22,"div",6)(23,"div",14)(24,"label",15),l._uU(25,"Extra Conditions Sql"),l.qZA(),l.TgZ(26,"div",16)(27,"input",17),l.NdJ("ngModelChange",function(N){return m.joinInfo.joinCondition2=N}),l.qZA()()()()(),l.TgZ(28,"div",18)(29,"div",19)(30,"button",20),l.NdJ("click",function(){return m.onAddJoinTable()}),l._uU(31,"Add Field Key"),l.qZA(),l.TgZ(32,"button",21),l.NdJ("click",function(){return m.onJoinDialogSave()}),l._uU(33,"Save"),l.qZA(),l.TgZ(34,"button",22),l.NdJ("click",function(){return m.onJoinCancel()}),l._uU(35,"Cancel"),l.qZA()()()),2&h&&(l.xp6(5),l.Q6J("ngModel",m.joinInfo.joinType),l.xp6(1),l.Q6J("ngForOf",m.joinTypes),l.xp6(6),l.Q6J("items",m.joinInfo.primaryKeyTables)("ngModel",m.joinInfo.primaryKeyTable),l.xp6(4),l.Q6J("ngModel",m.joinInfo.tableAlias),l.xp6(4),l.Q6J("items",m.joinInfo.foreignKeyTables)("ngModel",m.joinInfo.foreignKeyTable),l.xp6(1),l.Q6J("ngForOf",m.joinInfo.fieldsInfo),l.xp6(6),l.Q6J("ngModel",m.joinInfo.joinCondition2))},dependencies:[Q.sg,Q.O5,U.YN,U.Kr,U.Fj,U.EJ,U.JJ,U.Q7,U.On,B.w9],encapsulation:2}),oe})();var k=d(38325),F=d(80014),q=d(40092),ne=d(55314),W=d(28946),re=d(53546),X=d(72500),L=d(43829);const O=["selectTable"];function b($,oe){if(1&$){const K=l.EpF();l.TgZ(0,"ul",66)(1,"li",67)(2,"a",68),l.NdJ("click",function(){l.CHM(K);const m=l.oxw();return l.KtG(m.onGeneratJoins())}),l._uU(3,"Generate"),l.qZA()()()}}function A($,oe){if(1&$){const K=l.EpF();l.TgZ(0,"div",69)(1,"i",70),l.NdJ("click",function(){const C=l.CHM(K).$implicit,N=l.oxw();return l.KtG(N.delJoin(C))}),l.qZA(),l.TgZ(2,"a",71),l.NdJ("click",function(){const m=l.CHM(K),C=m.$implicit,N=m.index,he=l.oxw();return l.KtG(he.editJoin(C,N))}),l._uU(3),l.qZA()()}if(2&$){const K=oe.$implicit,h=l.oxw();l.xp6(3),l.xDo("",h.formatLabel(K.joinType).toUpperCase()," ",K.tableName," ",K.tableAlias," ON ",K.joinCondition," ",K.joinCondition2?" AND "+K.joinCondition2:""," ")}}function g($,oe){1&$&&(l.TgZ(0,"div",72)(1,"div",73)(2,"span",74),l._uU(3,"Loading..."),l.qZA()()())}let p=(()=>{var $;class oe{onAvailableFieldsGridReady(h){this.avFieldsGridApi=h.api,h.api.setHeaderHeight(0)}onSelectedFieldsGridReady(h){this.selectedFieldsGridApi=h.api,h.api.setHeaderHeight(0)}constructor(h,m,C,N,he){this.dbConnectionsService=h,this.sqlMetaDataService=m,this.notificationService=C,this.dialogService=N,this.dialogRef=he,this.destroy$=new te.x,this.config={},this.configQueryInfo={},this.selectTable={},this.mainTableFields=[],this.selectedField={},this.selectedSortItems=[],this.loading=!1,this.dbConnectionNames=[],this.allTables=[],this.allAvailableFields=[],this.defaultColDef={editable:!1,sortable:!1,suppressFiltersToolPanel:!0,suppressMovable:!0,suppressColumnsToolPanel:!0,suppressMenu:!0},this.availableColumnDefs=[{field:"tableNameWithAlias",hide:!0,width:0,rowGroup:!0,rowGroupIndex:0},{field:"fieldName",flex:1}],this.selectedColumnDefs=[{field:"fieldName",flex:1}],this.removeSelected$=new e.X(!0),this.sortByList=[],this.options={},this.aliasesMap={},this.query={},this.queryInfo={},this.formatLabel=R.N4}loadTables(){var h=this;return(0,r.Z)(function*(){h.query.connectionName&&(h.allTables=(yield h.sqlMetaDataService.getObjects(h.query.connectionName)).filter(m=>m.objectType===z.HA.Table||m.objectType===z.HA.View).map(m=>`${m.schemaName}.${m.objectName}`))})()}loadAvailableFields(){var h=this;return(0,r.Z)(function*(){var m;if(!h.query.tableName)return h.avFieldsGridApi.setRowData([]),h.selectedFieldsGridApi.setRowData([]),void(h.selectedField={fieldName:"",tableNameWithAlias:""});const C=h;if(!C)return;function N(pe,ke,Ae){return(m=m||(0,r.Z)(function*(Qe,Le,Pe){(yield C.sqlMetaDataService.getMetaDataObject(C.query.connectionName||"",Le.split(".")[0],Le.split(".")[1])).fields.forEach(Ze=>Qe.push({fieldName:Ze.fieldName,dataType:(0,ie.dbTypeConverter)().fromDbType(Ze.dataType,"SqlServer"),fieldExpressionText:Pe?`${Pe}.${Ze.fieldName}`:Ze.fieldName,sqlExpression:Pe?`${Pe}.${Ze.fieldName}`:Ze.fieldName,tableName:Le,tableAlias:Pe,tableNameWithAlias:`${Le} ${Pe||""}`.trim()}))})).apply(this,arguments)}const me=[];h.aliasesMap={[h.query.tableAlias||""]:h.query.tableName},yield N(me,h.query.tableName,h.query.tableAlias||""),h.mainTableFields=me.map(pe=>pe.fieldName||"");for(const pe of h.query.tablesJoin||[])yield N(me,pe.tableName||"",pe.tableAlias||""),h.aliasesMap[pe.tableAlias||""]=pe.tableName||"";h.allAvailableFields=me,h.avFieldsGridApi.setRowData(me.filter(pe=>function he(pe){return!C.removeSelected$.value||!(0,v.first)(C.query.fields||[],Ae=>`${pe.tableAlias?pe.tableAlias+".":""}${pe.fieldName}`.toLowerCase()===(Ae.sqlExpression||Ae.name).toLowerCase())}(pe)))})()}ngOnInit(){var h=this;return(0,r.Z)(function*(){h.loading=!0,h.dbConnectionNames=(yield h.dbConnectionsService.loadMyDbConnections()).map(m=>m.connectionName),h.config=h.config||{},h.config.connectionName||(h.config.connectionName=(0,v.first)(h.dbConnectionNames)||"",h.config.limitRowsCount=1e3),h.query=(0,u.deepClone)(h.config),h.selectedSortItems=(h.query.orderBy||[]).map(m=>({...m,displayName:`${m.fieldName}.${m.direction}`}));try{if(yield h.loadTables(),yield h.loadAvailableFields(),h.query.fields?.length){const m=h.query.fields.map(C=>{const N={fieldName:C.name,sqlExpression:C.sqlExpression||C.name,groupBy:C.groupBy,tableNameWithAlias:""};return N.tableAlias=C.sqlExpression?.substring(0,C.sqlExpression.indexOf(".")),N.tableName=h.aliasesMap[N.tableAlias||""],N.tableNameWithAlias=`${N.tableName} ${N.tableAlias||""}`.trim(),N.tableName||(N.tableAlias=""),N.fieldExpressionText=function J($){return $.tableAlias?.length?$.sqlExpression===`${$.tableAlias}.${$.fieldName}`?$.sqlExpression:`${$.sqlExpression} ${$.fieldName}`:$.sqlExpression===$.fieldName?$.fieldName||"":`${$.sqlExpression} ${$.fieldName}`}(N),N});h.selectedFieldsGridApi.setRowData(m)}}catch(m){h.notificationService.error(m)}finally{h.loading=!1}})()}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete()}onGroupBy(h){for(const m of(0,q.VB)(this.selectedFieldsGridApi)){const C=this.allAvailableFields.find(N=>N.tableName===m.tableName&&N.fieldName===m.fieldName);m===this.selectedField||!C||(C.dataType===k.DataTypeName.FloatNumber||C.dataType===k.DataTypeName.WholeNumber?(m.fieldExpressionText=`sum(${m.tableAlias}.${m.fieldName}) ${m.fieldName}`,m.sqlExpression=`sum(${m.tableAlias}.${m.fieldName})`):m.groupBy=!0)}}onTableNameChanged(h){var m=this;return(0,r.Z)(function*(){m.query.fields=[],m.query.tablesJoin=[],m.query.tableAlias=(0,H.Tg)(m.query?.tableName||""),m.selectedField={tableNameWithAlias:"",fieldName:"",fieldExpressionText:"",groupBy:!1},m.selectedFieldsGridApi.setRowData([]),yield m.loadAvailableFields()})()}onDbConnectionChanged(h){var m=this;return(0,r.Z)(function*(){m.query.tableName="",m.query.tableAlias="",yield m.loadTables(),yield m.loadAvailableFields()})()}onSelectedFieldsSearch(h){this.onGridSearch(this.selectedFieldsGridApi,h)}onAvailableFieldsSearch(h){this.onGridSearch(this.avFieldsGridApi,h)}onGridSearch(h,m){h.deselectAll(),h.clearRangeSelection(),h.setQuickFilter(m)}onRemoveSelectedChange(h){this.removeSelected$.next(h)}onFieldExpressionChanged(){(function S($,oe){const K=$.lastIndexOf(" ");K>0&&(oe.fieldName=$.substring(K+1),oe.sqlExpression=$.substring(0,K))})(this.selectedField?.fieldExpressionText?.trim()||"",this.selectedField),this.selectedFieldsGridApi.refreshCells()}onJoinTable(){var h=this;return(0,r.Z)(function*(){var m;h.dialogService.open(x,{class:"modal-lg",initialState:{config:{joins:h.query.tablesJoin||[],allTableNames:h.allTables,mainTableName:h.query.tableName,mainTableAlias:h.query.tableAlias,mainTableFields:h.mainTableFields,connectionName:h.query.connectionName}}}).onClose$.pipe((0,D.h)(N=>!!N)).subscribe(function(N){return(m=m||(0,r.Z)(function*(he){h.query.tablesJoin||(h.query.tablesJoin=[]),h.query.tablesJoin.push(he),yield h.loadAvailableFields()})).apply(this,arguments)})})()}moveNext(){ee(this.selectedFieldsGridApi,1)}movePrev(){ee(this.selectedFieldsGridApi,-1)}onFieldSelect(){this.selectedField=(0,q.Ym)(this.selectedFieldsGridApi)[0]||{}}addCustomField(){const h={fieldName:"",groupBy:!1,fieldExpressionText:"[alias].[FieldExpression] [fieldName]",tableNameWithAlias:`${this.query.tableName} ${this.query.tableAlias||""}`.trim()},m=this.selectedFieldsGridApi.getSelectedNodes()[0]?.rowIndex||0,C=(0,q.VB)(this.selectedFieldsGridApi);m>=0?C.splice(m+1,0,h):C.push(h),this.selectedFieldsGridApi.setRowData(C),(0,q.JE)(this.selectedFieldsGridApi,N=>N==h)}addFields(){G(this.avFieldsGridApi,this.selectedFieldsGridApi,this.removeSelected$.value)}removeFields(){G(this.selectedFieldsGridApi,this.avFieldsGridApi)}onSave(){this.query.fields=(0,q.VB)(this.selectedFieldsGridApi).map(m=>({name:m.fieldName,sqlExpression:m.sqlExpression,groupBy:!!m.groupBy})),this.query.orderBy=this.selectedSortItems.map(m=>({fieldName:m.fieldName,direction:m.direction}));const h=this.isValidQuery();!0===h?this.dialogRef.close(this.query):this.notificationService.error(h)}onCancel(){this.dialogRef.close()}onSortByOpen(){const h=(0,q.VB)(this.selectedFieldsGridApi),m=[];for(const C of h)m.push({fieldName:C.fieldName||"",direction:"ASC",displayName:`${C.fieldName}.ASC`}),m.push({fieldName:C.fieldName||"",direction:"DESC",displayName:`${C.fieldName}.DESC`});this.sortByList=m}isValidQuery(){if(!this.query.connectionName)return"Connection field must be defined";if(!this.query.tableName)return"Table/View field must be defined";if(!this.query.fields?.length)return"At least one field should be selected";const h=new Set,m=[];for(const C of this.query.fields)h.has(C.name)?m.push(C?.name||""):h.add(C.name);if(m.length)return"Fields should be unique. Check: "+m.join(", ")+".";for(const C of this.query.orderBy||[])if(!h.has(C.fieldName))return`Incorrect Sort Field [${C.fieldName}]`;return!0}delJoin(h){var m=this;return(0,r.Z)(function*(){m.query.tablesJoin=m.query.tablesJoin?.filter(C=>C.tableAlias!==h.tableAlias),yield m.loadAvailableFields()})()}editJoin(h,m){var C=this;return(0,r.Z)(function*(){var N;C.dialogService.open(x,{class:"modal-lg",initialState:{config:{joins:C.query.tablesJoin||[],selectedJoin:h,allTableNames:C.allTables,mainTableName:C.query.tableName,mainTableFields:C.mainTableFields,mainTableAlias:C.query.tableAlias,connectionName:C.query.connectionName}}}).onClose$.pipe((0,D.h)(me=>!!me)).subscribe(function(me){return(N=N||(0,r.Z)(function*(pe){C.query.tablesJoin?.splice(m,1,pe),yield C.loadAvailableFields()})).apply(this,arguments)})})()}onGeneratJoins(){var h=this;return(0,r.Z)(function*(){let m=h.query.tableName,C=[];const N=yield h.sqlMetaDataService.getMetaDataObject(h.query.connectionName||"",m.split(".")[0],m.split(".")[1]);if(N.foreignKeys){h.query.tablesJoin=[];for(let he of N.foreignKeys){C=h.query.tablesJoin?.filter(Ae=>!!Ae.tableAlias).map(Ae=>Ae.tableAlias||"");const me=h.query.tableAlias,pe=(0,H.Tg)(he.primaryTableName,3,C);h.query.tablesJoin.push({joinType:ie.JoinType.LeftJoin,tableName:he.primaryTableName,tableAlias:pe,joinCondition:`${me}.${he.fieldName} = ${pe}.${he.primaryFieldName}`}),h.loadAvailableFields()}}})()}onPublishSubscribe(){if(!this.configQueryInfo)throw new Error("configQueryInfo is not defined");this.dialogService.open(F.a,{class:"modal-md",initialState:{configPubSub:this.configQueryInfo.pubSub,configQueryInfo:this.configQueryInfo}}).onClose$.pipe((0,D.h)(m=>!!m)).subscribe(m=>this.configQueryInfo.pubSub=m)}}return($=oe).\u0275fac=function(h){return new(h||$)(l.Y36(ne.F),l.Y36(W.h),l.Y36(I.g),l.Y36(ae.x),l.Y36(ae.z))},$.\u0275cmp=l.Xpm({type:$,selectors:[["app-query-dialog"]],viewQuery:function(h,m){if(1&h&&l.Gf(O,7),2&h){let C;l.iGM(C=l.CRH())&&(m.selectTable=C.first)}},inputs:{config:"config",configQueryInfo:"configQueryInfo"},decls:98,vars:25,consts:[[1,"modal-header"],[1,"modal-title","pull-left"],[1,"col-auto","col-form-label","ml-auto"],["placeholder","Select connection",1,"px-0","col-sm-3",3,"ngModel","items","ngModelChange","change"],["type","button","aria-label","Close",1,"close","pull-right","ml-2",3,"click"],["aria-hidden","true"],[1,"modal-body","px-4","d-flex","flex-column","h-100","overflow-hidden"],[1,"mr-0","d-flex","flex-wrap"],[1,"d-flex","flex-row","my-2"],["for","object-name",1,"col-form-label","mr-2"],["placeholder","Select table",1,"px-0","auto-grow",3,"items","ngModel","ngModelChange","change"],["selectTable",""],[1,"fx-120","pl-0","d-flex","flex-row","mr-2","my-2"],["for","main-table-alias",1,"col-form-label","px-2"],["type","text","placeholder","Enter alias","readonly","true","name","main-table-alias","id","main-table-alias","required","",1,"form-control",3,"ngModel","ngModelChange"],["dropdown","",1,"btn-group","my-2"],["type","button",1,"btn","btn-light",3,"click"],["id","button-split","type","button","dropdownToggle","","aria-controls","dropdown-split",1,"btn","btn-light","dropdown-toggle","dropdown-toggle-split"],[1,"caret"],[1,"sr-only","visually-hidden"],["id","dropdown-split","class","dropdown-menu","placement","top right","role","menu","aria-labelledby","button-split",4,"dropdownMenu"],["for","order-by",1,"col-form-label","px-2"],["bindLabel","displayName",1,"col","px-0","auto-grow",2,"min-width","90px","max-width","120px",3,"multiple","ngModel","items","ngModelChange","open"],["for","limit-rows-count",1,"col-form-label","px-2"],["type","text","name","limit-rows-count","id","limit-rows-count",1,"form-control",2,"width","60px",3,"ngModel","ngModelChange"],[1,"py-2"],["class","d-flex border-gray align-items-center",4,"ngFor","ngForOf"],[1,"row","h-100","overflow-hidden","position-relative"],[1,"col","py-2","d-flex","flex-column","h-100","pr-0"],[1,"row","align-items-center"],[1,"col-auto"],[1,"col","max-w-260","ml-auto","mb-2",3,"search"],["rowSelection","multiple","groupDisplayType","groupRows",1,"ag-theme-balham","h-100","w-100",3,"columnDefs","defaultColDef","enableRangeSelection","groupDefaultExpanded","gridReady"],[1,"row"],[1,"form-check","form-check-inline","mr-1","ml-auto"],["id","available-remove-selected","type","radio","name","inline-radios",1,"form-check-input",3,"value","checked","change"],["for","available-remove-selected",1,"form-check-label"],[1,"form-check","form-check-inline","mr-1"],["id","available-show-all","type","radio","name","inline-radios",1,"form-check-input",3,"value","checked","change"],["for","available-show-all",1,"form-check-label"],[1,"col-auto","d-flex","flex-column","align-self-center"],[1,"btn","btn-light","mb-2",3,"click"],["aria-hidden","true",1,"fa","fa-plus","fa-lg"],["title","Add field",1,"btn","btn-light","mb-2",3,"click"],["aria-hidden","true",1,"fa","fa-angle-double-right","fa-lg"],[1,"btn","btn-light","mb-4",3,"click"],["aria-hidden","true",1,"fa","fa-angle-double-left","fa-lg"],[1,"col","py-2","px-0","d-flex","flex-column","h-100"],["rowSelection","multiple",1,"ag-theme-balham","h-100","w-100",3,"columnDefs","defaultColDef","enableRangeSelection","selectionChanged","gridReady"],[1,"row","pt-2"],[1,"col-12"],[1,"form-check-label","col-auto","h5","mb-0"],[1,"form-check","form-check-inline","ml-auto","col-auto"],["type","checkbox","id","groupby-selection",1,"form-check-input","mr-2",3,"ngModel","change","ngModelChange"],["for","groupby-selection",1,"form-check-label"],["type","text","placeholder","Sql field expression",1,"form-control",3,"ngModel","input","ngModelChange"],["aria-hidden","true",1,"fa","fa-angle-up","fa-lg"],["aria-hidden","true",1,"fa","fa-angle-down","fa-lg"],["class","d-flex justify-content-center position-absolute align-items-center w-100 h-100 spinner",4,"ngIf"],[1,"col-form-label","col-auto","h5","mb-0","py-0"],["type","text",1,"form-control",3,"ngModel","ngModelChange"],[1,"modal-footer","flex-column"],[1,"row","w-100","mx-0","px-0"],["type","button",1,"col-auto","btn","btn-link","px-0",3,"click"],["type","button",1,"btn","btn-primary","ml-auto","mr-2","fx-80",3,"click"],["type","button",1,"btn","btn-light","fx-80",3,"click"],["id","dropdown-split","placement","top right","role","menu","aria-labelledby","button-split",1,"dropdown-menu"],["role","menuitem"],[1,"dropdown-item",3,"click"],[1,"d-flex","border-gray","align-items-center"],[1,"fa","fa-times","cursor-pointer","mr-2",2,"color","red",3,"click"],[1,"cursor-pointer",3,"click"],[1,"d-flex","justify-content-center","position-absolute","align-items-center","w-100","h-100","spinner"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(h,m){1&h&&(l.TgZ(0,"div",0)(1,"h4",1),l._uU(2,"Query Manager"),l.qZA(),l.TgZ(3,"label",2),l._uU(4,"Connection"),l.qZA(),l.TgZ(5,"ng-select",3),l.NdJ("ngModelChange",function(N){return m.query.connectionName=N})("change",function(N){return m.onDbConnectionChanged(N)}),l.qZA(),l.TgZ(6,"button",4),l.NdJ("click",function(){return m.onCancel()}),l.TgZ(7,"span",5),l._uU(8,"\xd7"),l.qZA()()(),l.TgZ(9,"div",6)(10,"div",7)(11,"div",8)(12,"label",9),l._uU(13,"Table/View"),l.qZA(),l.TgZ(14,"ng-select",10,11),l.NdJ("ngModelChange",function(N){return m.query.tableName=N})("change",function(N){return m.onTableNameChanged(N)}),l.qZA()(),l.TgZ(16,"div",12)(17,"label",13),l._uU(18,"Alias"),l.qZA(),l.TgZ(19,"input",14),l.NdJ("ngModelChange",function(N){return m.query.tableAlias=N}),l.qZA()(),l.TgZ(20,"div",15)(21,"button",16),l.NdJ("click",function(){return m.onJoinTable()}),l._uU(22,"Join Tables"),l.qZA(),l.TgZ(23,"button",17),l._UZ(24,"span",18),l.TgZ(25,"span",19),l._uU(26,"Split button!"),l.qZA()(),l.YNc(27,b,4,0,"ul",20),l.qZA(),l.TgZ(28,"div",8)(29,"label",21),l._uU(30,"Sort By"),l.qZA(),l.TgZ(31,"ng-select",22),l.NdJ("ngModelChange",function(N){return m.selectedSortItems=N})("open",function(){return m.onSortByOpen()}),l.qZA()(),l.TgZ(32,"div",8)(33,"label",23),l._uU(34,"Limit"),l.qZA(),l.TgZ(35,"input",24),l.NdJ("ngModelChange",function(N){return m.query.limitRowsCount=N}),l.qZA()()(),l.TgZ(36,"div",25),l.YNc(37,A,4,5,"div",26),l.qZA(),l.TgZ(38,"div",27)(39,"div",28)(40,"div",29)(41,"h5",30),l._uU(42,"Available"),l.qZA(),l.TgZ(43,"app-search",31),l.NdJ("search",function(N){return m.onAvailableFieldsSearch(N)}),l.qZA()(),l.TgZ(44,"ag-grid-angular",32),l.NdJ("gridReady",function(N){return m.onAvailableFieldsGridReady(N)}),l.qZA(),l.TgZ(45,"div",33)(46,"div",2)(47,"div",34)(48,"input",35),l.NdJ("change",function(){return m.onRemoveSelectedChange(!0)}),l.qZA(),l.TgZ(49,"label",36),l._uU(50,"Remove Selected"),l.qZA()(),l.TgZ(51,"div",37)(52,"input",38),l.NdJ("change",function(){return m.onRemoveSelectedChange(!1)}),l.qZA(),l.TgZ(53,"label",39),l._uU(54,"Show All"),l.qZA()()()()(),l.TgZ(55,"div",40)(56,"button",41),l.NdJ("click",function(){return m.addCustomField()}),l._UZ(57,"i",42),l.qZA(),l.TgZ(58,"button",43),l.NdJ("click",function(){return m.addFields()}),l._UZ(59,"i",44),l.qZA(),l.TgZ(60,"button",45),l.NdJ("click",function(){return m.removeFields()}),l._UZ(61,"i",46),l.qZA()(),l.TgZ(62,"div",47)(63,"div",29)(64,"h5",30),l._uU(65,"Selected"),l.qZA(),l.TgZ(66,"app-search",31),l.NdJ("search",function(N){return m.onSelectedFieldsSearch(N)}),l.qZA()(),l.TgZ(67,"ag-grid-angular",48),l.NdJ("selectionChanged",function(){return m.onFieldSelect()})("gridReady",function(N){return m.onSelectedFieldsGridReady(N)}),l.qZA(),l.TgZ(68,"div",49)(69,"div",50)(70,"div",33)(71,"label",51),l._uU(72,"Field Expression"),l.qZA(),l.TgZ(73,"div",52)(74,"input",53),l.NdJ("change",function(N){return m.onGroupBy(N.target)})("ngModelChange",function(N){return m.selectedField.groupBy=N}),l.qZA(),l.TgZ(75,"label",54),l._uU(76,"group by"),l.qZA()()()(),l.TgZ(77,"div",50)(78,"input",55),l.NdJ("input",function(){return m.onFieldExpressionChanged()})("ngModelChange",function(N){return m.selectedField.fieldExpressionText=N}),l.qZA()()()(),l.TgZ(79,"div",40)(80,"button",41),l.NdJ("click",function(){return m.movePrev()}),l._UZ(81,"i",56),l.qZA(),l.TgZ(82,"button",45),l.NdJ("click",function(){return m.moveNext()}),l._UZ(83,"i",57),l.qZA()(),l.YNc(84,g,4,0,"div",58),l.qZA(),l.TgZ(85,"div",33)(86,"label",59),l._uU(87,"Filters"),l.qZA(),l.TgZ(88,"div",50)(89,"input",60),l.NdJ("ngModelChange",function(N){return m.query.filterString=N}),l.qZA()()()(),l.TgZ(90,"div",61)(91,"div",62)(92,"button",63),l.NdJ("click",function(){return m.onPublishSubscribe()}),l._uU(93,"Publish / Subscribe"),l.qZA(),l.TgZ(94,"button",64),l.NdJ("click",function(){return m.onSave()}),l._uU(95,"OK"),l.qZA(),l.TgZ(96,"button",65),l.NdJ("click",function(){return m.onCancel()}),l._uU(97,"Cancel"),l.qZA()()()),2&h&&(l.xp6(5),l.Q6J("ngModel",m.query.connectionName)("items",m.dbConnectionNames),l.xp6(9),l.Q6J("items",m.allTables)("ngModel",m.query.tableName),l.xp6(5),l.Q6J("ngModel",m.query.tableAlias),l.xp6(12),l.Q6J("multiple",!0)("ngModel",m.selectedSortItems)("items",m.sortByList),l.xp6(4),l.Q6J("ngModel",m.query.limitRowsCount),l.xp6(2),l.Q6J("ngForOf",m.query.tablesJoin),l.xp6(7),l.Q6J("columnDefs",m.availableColumnDefs)("defaultColDef",m.defaultColDef)("enableRangeSelection",!0)("groupDefaultExpanded",-1),l.xp6(4),l.Q6J("value",!0)("checked",m.removeSelected$.value),l.xp6(4),l.Q6J("value",!1)("checked",!m.removeSelected$.value),l.xp6(15),l.Q6J("columnDefs",m.selectedColumnDefs)("defaultColDef",m.defaultColDef)("enableRangeSelection",!0),l.xp6(7),l.Q6J("ngModel",m.selectedField.groupBy),l.xp6(4),l.Q6J("ngModel",m.selectedField.fieldExpressionText),l.xp6(6),l.Q6J("ngIf",m.loading),l.xp6(5),l.Q6J("ngModel",m.query.filterString))},dependencies:[re.N8,X.Hz,X.Mq,X.TO,Q.sg,Q.O5,L.g,U.Fj,U.Wl,U.JJ,U.Q7,U.On,B.w9],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column}.fx-120[_ngcontent-%COMP%]{flex:0 0 120px}.fx-100[_ngcontent-%COMP%]{flex:0 0 100px}.fx-80[_ngcontent-%COMP%]{flex:0 0 80px}"]}),oe})();function G($,oe,K=!0){const h=(0,q.VB)($),m=(0,q.VB)(oe),C=(0,q.Ym)($),N=(0,q.Ym)(oe),he=Math.max(m.indexOf(N[0]),0);let me=0;for(const pe of C)m.splice(he+ ++me,0,pe);if(oe.setRowData(m),K){let pe=0;for(;pe<h.length;)C.indexOf(h[pe])>=0?h.splice(pe,1):pe++;$.setRowData(h)}(0,q.JE)(oe,pe=>C.indexOf(pe)>=0),$.deselectAll(),$.clearRangeSelection()}function ee($,oe){let K=(0,q.VB)($);const h=(0,q.Ym)($);if(!h?.length)return;const m=h[0],C=K.indexOf(m);K=K.filter(N=>N!==m),K.splice(C+oe,0,m),$.setRowData(K),(0,q.JE)($,N=>N===m)}},50834:(be,ue,d)=>{d.d(ue,{N:()=>O});var r=d(15861),u=d(65879),te=d(82668),e=d(65619),D=d(32013),v=d(16321),ie=d(21473),H=d(4786);const z="$test_";function E(b){return b?b.split("\n").map(g=>{const p=g.match(/(def\s)(.*)(\(.*\)):/);return p?p[2].replace(/ /g,""):""}).filter(g=>!!g):[]}function R(b){return b.split("\n").map((g,p)=>(g.startsWith("def "+z)||g.startsWith("async def "+z))&&g.trimEnd().endsWith(":")?{line:p+1,state:"none",funcName:g.substring(g.indexOf(z)+6,g.indexOf("("))}:{}).filter(g=>g.funcName)}var V=d(24530),ae=d(12044),Q=d(18942),U=d(2048),B=d(96814),M=d(90690);const T=["data = [",'\t{color: "blue", value: 10},','\t{color: "yellow", value: 20},','\t{color: "red", value: 15},','\t{color: "black", value: 25}',"]"],y=[{group:"JSPY IDE Basics",snippets:[{title:"Print to console",script:'print("Hello World!") # Print to output console'},{title:"Asserts",script:['assert("My Test 1", 5 == 10, "Testing falsy assertion")','assert("My Test 2", 5 == 5, "Testing success assertion")'].join("\n")},{title:"Session usage",script:['# Save and restore data between "Runs" in a session object',"if session.someData == null:",'\tsession.someData = "some value" # or heavy load operation',"print(session.someData)"].join("\n")}]},{group:"Show Results As",snippets:[{title:"Show results in object explorer",script:[...T,'showInObjectExplorer(data, "Tab title")'].join("\n")},{title:"Show results in JSON",script:[...T,'showInJSON(data, "JSON")'].join("\n")},{title:"Create chart tab",script:"\ncountries = \"US,Canada,Mexico,Germany,UK,France,Italy,Japan,Korea,China\".split(\",\")\ndata = []\nfor country in countries:\n    item = {}\n    item.country = country\n    item.sales = Math.random() * 100 + 10\n    item.expenses = Math.random() * 200 + 10\n    item.downloads = Math.round(Math.random() * 100)\n    data.push(item)\n\n# https://www.grapecity.com/wijmo/demos/Chart/Overview/purejs\noptions = {\n    itemsSource: data,\n    bindingX: 'country',\n    legend: {\n        position: 'Bottom'\n    },\n    chartType: \"Line\",\n    legendToggle: true,\n    series: [\n        { binding: 'sales', name: 'sales' },\n        { binding: 'expenses', name: 'expenses' }\n    ]\n}\n\ncreateFlexChartTab(\"Countries Chart\", options)\n        "},{title:"Create grid tab",script:'\n  \ncountries = "US,Canada,Mexico,Germany,UK,France,Italy,Japan,Korea,China".split(",")\ndata = []\nfor country in countries:\n    item = {}\n    item.country = country\n    item.sales = Math.random() * 10000 + 1000\n    item.expenses = Math.random() * 5000 + 1000\n    item.downloads = Math.round(Math.random() * 100000)\n    data.push(item)\n    \n\n  createGridTab("Countries table").show(data)\n  '}]},{group:"IDE Notifications",snippets:[{title:"notify",script:'notify("Notification message")'},{title:"warning",script:'notify("Warning message", "Warning")'},{title:"alert",script:'alert("Alert message")'}]},{group:"Rest (HTTP) Calls",snippets:[{title:"httpGet request",script:['return httpGet("https://restcountries.com/v3.1/region/eu")'].join("\n")},{title:"httpPost request",script:['sendData = {name: "John"}','httpPost("url/to/post/data", sendData)'].join("\n")},{title:"httpDelete request",script:['httpDelete("url/to/delete/data")'].join("\n")},{title:"httpPut request",script:['updateData = {id: 1, name: "John"}','httpPut("url/to/update/data", updateData)'].join("\n")},{title:"fetch",script:["return {",'  objectValue: fetch("https://restcountries.eu/rest/v2/regionalbloc/eu").json(),','  text: fetch("https://raw.githubusercontent.com/FalconSoft/sample-data/master/CSV/sample-testing-data-100.csv").text()',"}"].join("\n")},{title:"httpRequest from sqlDataApi",script:['from "sql-data-api" import httpRequest',"","# use ","return {",'  object: httpRequest("GET", "https://restcountries.eu/rest/v2/regionalbloc/eu"),','  text: httpRequest("GET", "https://raw.githubusercontent.com/FalconSoft/sample-data/master/CSV/sample-testing-data-100.csv", null, {"Content-Type": "text/plain"})',"}"].join("\n")}]},{group:"sql Data Api",snippets:[{title:"query Sql Data",script:['from "sql-data-api" import sqlDataApi',"",'return sqlDataApi("northwind-db-connection")','\t.filter("title = @title", {title: "Sales Representative"})','\t.query("northwind.NorthwindEmployees", "Title, FirstName, LastName")'].join("\n")},{title:"Execute Stored Procedure",script:['from "sql-data-api" import sqlDataApi',"",'return sqlDataApi("northwind-db-connection")','\t.sqlExecute("northwind.NorthwindTop10CustomersList", {startDate: "2017-10-10"})'].join("\n")}]}];function x(b,A){if(1&b){const g=u.EpF();u.TgZ(0,"li")(1,"a",5),u.NdJ("click",function(){const J=u.CHM(g).$implicit,G=u.oxw(2);return u.KtG(G.onSnippetClick(J.script))}),u._uU(2),u.qZA()()}if(2&b){const g=A.$implicit;u.xp6(2),u.Oqu(g.title)}}function k(b,A){if(1&b&&(u.TgZ(0,"div")(1,"h5"),u._uU(2),u.qZA(),u.TgZ(3,"ul"),u.YNc(4,x,3,1,"li",4),u.qZA()()),2&b){const g=A.$implicit;u.xp6(2),u.Oqu(g.group),u.xp6(2),u.Q6J("ngForOf",g.snippets)}}let F=(()=>{var b;class A{constructor(){this.snippetClick=new u.vpe,this.closeClick=new u.vpe,this.snippets=y}onSnippetClick(p){this.snippetClick.next(p)}close(){this.closeClick.next(null)}}return(b=A).\u0275fac=function(p){return new(p||b)},b.\u0275cmp=u.Xpm({type:b,selectors:[["app-jspy-help-panel"]],outputs:{snippetClick:"snippetClick",closeClick:"closeClick"},decls:9,vars:1,consts:[[1,"content","m-2"],[1,"d-flex","flex-row","w-100"],["type","button","title","Close Panel",1,"btn","btn-sm","ml-auto",3,"click"],[1,"fa","fa-times"],[4,"ngFor","ngForOf"],[1,"cursor-pointer",3,"click"]],template:function(p,S){1&p&&(u.TgZ(0,"div",0)(1,"div",1)(2,"h3"),u._uU(3,"Code snippets"),u.qZA(),u.TgZ(4,"button",2),u.NdJ("click",function(){return S.close()}),u._UZ(5,"i",3),u.qZA()(),u.TgZ(6,"p"),u._uU(7," JSPython is a python-like scripting language to facilitate running multi-requests, data transformations, and testing tasks."),u.qZA(),u.YNc(8,k,5,2,"div",4),u.qZA()),2&p&&(u.xp6(8),u.Q6J("ngForOf",S.snippets))},dependencies:[B.sg],styles:['[_ngcontent-%COMP%]:root{--bg: #fff;--body-bg: #e4e5e6;--header-bg: #ebedef;--color: #4f5d73;--border-color: #c4c9d0;--ws-alt: #f7f7f7;--form-input-bg: #fff;--form-input-color: #768192;--nav-link-color: #8a93a2;--secondary-color: #c4c9d0;--opacity: .05;--hover: "#f0f3f5"}.content[_ngcontent-%COMP%]{margin:1em;overflow-y:scroll}ul[_ngcontent-%COMP%]{padding-inline-start:.8em}ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{list-style:none}ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#20a8d8}']}),A})();function q(b,A){if(1&b&&(u.TgZ(0,"div",9),u._uU(1),u.qZA()),2&b){const g=u.oxw();u.xp6(1),u.hij(" ",null==g.runParams?null:g.runParams.status," ")}}function ne(b,A){if(1&b&&(u.TgZ(0,"span",15),u._uU(1),u.qZA()),2&b){const g=u.oxw().$implicit;u.xp6(1),u.Oqu(g.errorMessage||"")}}function W(b,A){if(1&b){const g=u.EpF();u.TgZ(0,"div",10)(1,"div"),u._UZ(2,"i"),u.qZA(),u.TgZ(3,"div",11)(4,"span",12),u.NdJ("click",function(){const J=u.CHM(g).$implicit,G=u.oxw();return u.KtG(G.gotoLine(J))}),u._uU(5),u.qZA(),u.YNc(6,ne,2,1,"span",13),u.qZA(),u.TgZ(7,"button",14),u.NdJ("click",function(){const J=u.CHM(g).$implicit,G=u.oxw();return u.KtG(G.runSelected(J))}),u._uU(8,"Run"),u.qZA()()}if(2&b){const g=A.$implicit,p=u.oxw();u.xp6(2),u.Gre("mr-2 fa fa-lg ",p.funcState(g),""),u.xp6(3),u.hij(" ",g.funcName," "),u.xp6(1),u.Q6J("ngIf","failed"===(null==g?null:g.state))}}let re=(()=>{var b;class A{constructor(){this.runAllClick=new u.vpe,this.runSelectedClick=new u.vpe,this.gotoLineClick=new u.vpe,this.runParallel=!1}funcName(p){return"failed"===p.state?`${p.funcName}: ${p.errorMessage}`:p.funcName}funcState(p){return"running"===p.state?"fa-spinner fa-spin":"completed"===p.state?"fa-check-square-o":"failed"===p.state?"fa-minus-square-o":"fa-square-o"}onRunParallelChange(){this.runParams&&(this.runParams.runParallel=!this.runParams.runParallel)}runAll(){this.runAllClick.next(null)}runSelected(p){this.runSelectedClick.next(p)}gotoLine(p){this.gotoLineClick.next(p)}}return(b=A).\u0275fac=function(p){return new(p||b)},b.\u0275cmp=u.Xpm({type:b,selectors:[["app-jspy-test-functions"]],inputs:{testFunctions:"testFunctions",runParams:"runParams"},outputs:{runAllClick:"runAllClick",runSelectedClick:"runSelectedClick",gotoLineClick:"gotoLineClick"},decls:11,vars:3,consts:[[1,"d-flex","flex-column","mx-2","h-100","overflow-hidden"],[1,"d-flex","flex-row","w-100"],["type","button","title","Run All",1,"btn","btn-sm","btn-success","m-1","mr-2",3,"click"],[1,"form-check","form-check-inline","mr-auto"],["type","checkbox","id","create-tabel",1,"form-check-input","mr-1",3,"checked","change"],["for","create-tabel",1,"form-check-label"],["class","d-flex flex-row w-100 my-2",4,"ngIf"],[1,"d-flex","flex-column","h-100","overflow-auto","mb-2"],["class","d-flex flex-row border-bottom border-gray align-items-center pb-1 mb-1",4,"ngFor","ngForOf"],[1,"d-flex","flex-row","w-100","my-2"],[1,"d-flex","flex-row","border-bottom","border-gray","align-items-center","pb-1","mb-1"],[1,"mr-1","w-100",2,"overflow-x","auto"],[1,"mr-2","mb-0","link-text","cursor-pointer",3,"click"],["class","text-danger",4,"ngIf"],[1,"btn","btn-run","btn-outline-success","ml-auto","mr-1",3,"click"],[1,"text-danger"]],template:function(p,S){1&p&&(u.TgZ(0,"div",0)(1,"div",1)(2,"button",2),u.NdJ("click",function(){return S.runAll()}),u._uU(3," Run All "),u.qZA(),u.TgZ(4,"div",3)(5,"input",4),u.NdJ("change",function(){return S.onRunParallelChange()}),u.qZA(),u.TgZ(6,"label",5),u._uU(7,"Parallel"),u.qZA()()(),u.YNc(8,q,2,1,"div",6),u.TgZ(9,"div",7),u.YNc(10,W,9,5,"div",8),u.qZA()()),2&p&&(u.xp6(5),u.Q6J("checked",null==S.runParams?null:S.runParams.runParallel),u.xp6(3),u.Q6J("ngIf",null==S.runParams?null:S.runParams.status),u.xp6(2),u.Q6J("ngForOf",S.testFunctions))},dependencies:[B.sg,B.O5],styles:['[_ngcontent-%COMP%]:root{--bg: #fff;--body-bg: #e4e5e6;--header-bg: #ebedef;--color: #4f5d73;--border-color: #c4c9d0;--ws-alt: #f7f7f7;--form-input-bg: #fff;--form-input-color: #768192;--nav-link-color: #8a93a2;--secondary-color: #c4c9d0;--opacity: .05;--hover: "#f0f3f5"}.btn-run[_ngcontent-%COMP%]{height:22px;padding-top:0}.link-text[_ngcontent-%COMP%]:hover{text-decoration:underline}']}),A})();const X=["editorEl"];function L(b,A){if(1&b){const g=u.EpF();u.TgZ(0,"app-jspy-test-functions",15),u.NdJ("runAllClick",function(){u.CHM(g);const S=u.oxw();return u.KtG(S.onRunAllTests())})("gotoLineClick",function(S){u.CHM(g);const J=u.oxw();return u.KtG(J.onGotoLine(S))})("runSelectedClick",function(S){u.CHM(g);const J=u.oxw();return u.KtG(J.onRunSelectedTest(S))}),u.qZA()}if(2&b){const g=u.oxw();u.Q6J("runParams",g.testRunsParams)("testFunctions",g.testFunctions)}}let O=(()=>{var b;class A{get jspyFunctions(){return this.jspyFunctionsListSubj$.value}constructor(p,S){this.resizeSvc=p,this.evaluationService=S,this.textChanged=new u.vpe,this.jspyFunctionsListSubj$=new e.X([]),this.evaluationResultSubj$=new D.x,this._evaluating=!1,this.cancelling=!1,this.testRunsParams={runParallel:!1,status:""},this.currentFileLinks=[],this.testFunctions=[],this.isHelpCollapsed=!1,this.jspyFunctionsList$=this.jspyFunctionsListSubj$.asObservable(),this.evaluationResult$=this.evaluationResultSubj$.asObservable(),this.direction=H.Ar.vertical,this.ShowInTypes=V.r,this.scriptSize=100,this.scriptHelpSize=30,this.minSize=20,this.selectedFunction=null,this.text=""}get evaluating(){return this._evaluating}set evaluating(p){this._evaluating=p,this.runtimeContext.evaluating=p}ngOnInit(){var p=this;return(0,r.Z)(function*(){p.resizeSvc.onResize$.subscribe(S=>{p.size=S,p.size<=ae.y.MD&&(p.scriptHelpSize=0,p.isHelpCollapsed=!0)}),p.evaluationService.loading$.subscribe(S=>p.evaluating=S),p.runtimeContext=p.evaluationService.runtimeContext,p.interpreter=p.evaluationService.interpreter,p.evaluationContext=p.evaluationService.context,p.loadSettings(),p.initializeEditor(p.editorEl.nativeElement)})()}reload(p){this.editor?.setValue(p),this.mergeTestFunctions(R(this.text)),this.jspyFunctionsListSubj$.next(E(this.text))}setSettings(p){this.settings=p,this.settings.settingsKey&&this.loadSettings(),this.settings.moduleLoader&&this.interpreter?.registerModuleLoader(this.settings.moduleLoader)}initializeEditor(p){this.editor=te.editor.create(p,{tabSize:2,scrollBeyondLastLine:!1,value:this.text,language:"python"}),this.editor.onDidChangeModelContent(()=>{this.text=this.editor?.getValue()||"",this.textChanged.emit(this.text),this.jspyFunctionsListSubj$.next(E(this.text)),this.mergeTestFunctions(R(this.text))}),this.resize()}handleKeyboardEvent(p){("F5"===p.key||p.ctrlKey&&"Enter"===p.key)&&(p.preventDefault(),p.stopImmediatePropagation(),this.run(this.selectedFunction||""))}appendLogMessage(p,S,J){if(J){const G=this.runtimeContext.logs.find(ee=>ee.logKey===J);if(G)return void("error"!==G.level&&(G.level=p,G.message=S,"function"==typeof this.runtimeContext.onChanged&&this.runtimeContext.onChanged(this.runtimeContext.logs)))}this.runtimeContext.logs.push({level:p,logKey:J,message:S,time:new Date}),"function"==typeof this.runtimeContext.onChanged&&this.runtimeContext.onChanged(this.runtimeContext.logs)}cancelRun(){this.evaluationService.cancel()&&(this.cancelling=!0)}run(p){var S=this;return(0,r.Z)(function*(){yield S.evaluationService.run({script:S.text,method:p,entryModule:S.settings?.entryModule}),S.scriptSize=60,S.cancelling=!1,setTimeout(()=>{S.resultsPanel?.activateLastTab()},350)})()}startRuntimeOutputPanel(){this.scriptSize=60,this.runtimeContext.logs.splice(0,this.runtimeContext.logs.length),"function"==typeof this.runtimeContext.onChanged&&this.runtimeContext.onChanged(this.runtimeContext.logs),this.evaluationContext&&(this.evaluationContext.reset(),this.evaluationContext.showInItems=[{type:V.r.RunningLog,title:"Runtime Output",data:this.runtimeContext}],this.evaluationResultSubj$.next(null)),this.appendLogMessage("info","start")}onRunAllTests(){var p=this;return(0,r.Z)(function*(){yield p.runTest()})()}runTest(p){var S=this;return(0,r.Z)(function*(){var J;const G=function(K){return(J=J||(0,r.Z)(function*(h){try{h.state="running",yield S.evaluationService.jspyEvaluate({script:S.text,entryModule:S.settings?.entryModule,method:z+h.funcName}),h.state="completed"}catch(m){h.state="failed";let C=(0,ie.e$)(m);C.startsWith("JspyEvalError:")&&(C=C.substring(C.indexOf("("))),h.errorMessage=C}})).apply(this,arguments)},ee=S.testFunctions;S.startRuntimeOutputPanel(),p||ee.forEach(oe=>oe.state="none");const $=ee.find(oe=>"init"===oe.funcName.toLowerCase());if(!$||(S.testRunsParams.status="Running INIT test ...",yield G($),"failed"!==$.state))if(p)yield G(p);else{const oe=ee.filter(K=>K!=$);if(S.testRunsParams.runParallel)S.testRunsParams.status=`Running ${oe.length} tests parallel ...`,yield Promise.all(oe.map(K=>G(K))),S.testRunsParams.status="";else{let K=1;for(const h of oe)S.testRunsParams.status=`Running test [${K++}:${oe.length}] ...'${h.funcName}' ...`,yield G(h);S.testRunsParams.status=""}}})()}onRunSelectedTest(p){var S=this;return(0,r.Z)(function*(){S.runTest(p)})()}onGotoLine(p){this.editor?.setPosition({lineNumber:p.line,column:1}),this.editor?.revealLineNearTop(p.line)}resize(){v.z.schedule(()=>{this.editor?.layout(),this.resultsPanel?.resize()})}toggleHelp(){this.isHelpCollapsed=!this.isHelpCollapsed,this.scriptHelpSize=this.isHelpCollapsed?0:30,this.saveSettings(),v.z.schedule(()=>this.resize())}toggleDirection(){this.direction=this.direction===H.Ar.horizontal?H.Ar.vertical:H.Ar.horizontal,this.saveSettings(),v.z.schedule(()=>this.resize())}onSnippetClick(p){if(!this.editor)throw new Error("editor is not initialized");const S=this.editor.getPosition();this.editor.executeEdits("",[{range:new te.Range(S?.lineNumber,S?.column,S?.lineNumber,S?.column),text:`\n${p.trim()}\n`}])}saveSettings(){this.settings?.settingsKey&&localStorage.setItem(this.settings.settingsKey,JSON.stringify({scriptHelpSize:this.scriptHelpSize,direction:this.direction,isHelpCollapsed:this.isHelpCollapsed}))}loadSettings(){if(!this.settings?.settingsKey)return;const p=JSON.parse(localStorage.getItem(this.settings.settingsKey)||"{}");this.scriptHelpSize=void 0!==p.scriptHelpSize?p.scriptHelpSize:30,this.direction=p.direction||H.Ar.vertical,this.isHelpCollapsed=!!p.isHelpCollapsed}mergeTestFunctions(p){this.testFunctions.splice(0,this.testFunctions.length),p.forEach(S=>this.testFunctions.push(S))}}return(b=A).\u0275fac=function(p){return new(p||b)(u.Y36(ae._),u.Y36(U.N))},b.\u0275cmp=u.Xpm({type:b,selectors:[["app-jspy-content-editor"]],viewQuery:function(p,S){if(1&p&&(u.Gf(Q.W,5),u.Gf(X,7)),2&p){let J;u.iGM(J=u.CRH())&&(S.resultsPanel=J.first),u.iGM(J=u.CRH())&&(S.editorEl=J.first)}},hostBindings:function(p,S){1&p&&u.NdJ("keydown",function(G){return S.handleKeyboardEvent(G)},!1,u.evT)},outputs:{textChanged:"textChanged"},features:[u._Bn([U.N])],decls:18,vars:13,consts:[[1,"h-100",3,"direction","useTransition","transitionEnd","dragEnd"],["split","asSplit"],[1,"d-flex",3,"size","minSize"],["area1","asSplitArea"],["unit","percent","direction","horizontal",3,"useTransition","gutterSize","dragEnd","transitionEnd"],[1,"d-flex","position-relative","h-100",3,"size","minSize"],["type","button","title","Show/hide help panel",1,"btn","btn-secondary","btn-sm","px-1","py-0","position-absolute","help-toggle",3,"click"],[1,"fa","fa-question","fa-lg"],[1,"flex-fill","overflow-hidden"],["editorEl",""],["class","h-100 overflow-hidden","style","width:300px;min-width:300px",3,"runParams","testFunctions","runAllClick","gotoLineClick","runSelectedClick",4,"ngIf"],[1,"d-flex",3,"size"],[3,"snippetClick","closeClick"],[1,"position-relative",3,"size","minSize"],[3,"evaluationContext"],[1,"h-100","overflow-hidden",2,"width","300px","min-width","300px",3,"runParams","testFunctions","runAllClick","gotoLineClick","runSelectedClick"]],template:function(p,S){1&p&&(u.TgZ(0,"as-split",0,1),u.NdJ("transitionEnd",function(){return S.resize()})("dragEnd",function(){return S.resize()}),u.TgZ(2,"as-split-area",2,3)(4,"as-split",4,1),u.NdJ("dragEnd",function(){return S.resize()})("transitionEnd",function(){return S.resize()}),u.TgZ(6,"as-split-area",5,3)(8,"button",6),u.NdJ("click",function(){return S.toggleHelp()}),u._UZ(9,"i",7),u.qZA(),u._UZ(10,"div",8,9),u.YNc(12,L,1,2,"app-jspy-test-functions",10),u.qZA(),u.TgZ(13,"as-split-area",11,3)(15,"app-jspy-help-panel",12),u.NdJ("snippetClick",function(G){return S.onSnippetClick(G)})("closeClick",function(){return S.toggleHelp()}),u.qZA()()()(),u.TgZ(16,"as-split-area",13),u._UZ(17,"app-jspy-results-panel",14),u.qZA()()),2&p&&(u.Q6J("direction",S.direction)("useTransition",!0),u.xp6(2),u.Q6J("size",S.scriptSize)("minSize",S.minSize),u.xp6(2),u.Q6J("useTransition",!0)("gutterSize",S.isHelpCollapsed?0:11),u.xp6(2),u.Q6J("size",100-S.scriptHelpSize)("minSize",S.minSize),u.xp6(6),u.Q6J("ngIf",null==S.testFunctions?null:S.testFunctions.length),u.xp6(1),u.Q6J("size",S.scriptHelpSize),u.xp6(3),u.Q6J("size",100-S.scriptSize)("minSize",S.minSize),u.xp6(1),u.Q6J("evaluationContext",S.evaluationContext))},dependencies:[B.O5,M.Mq,M.zE,F,re,Q.W],styles:[".help-toggle[_ngcontent-%COMP%]{top:5px;right:13px;z-index:1}"]}),A})()},18942:(be,ue,d)=>{d.d(ue,{W:()=>f});var r=d(612),u=d(16321),te=d(76662),e=d(24530),D=d(65879),v=d(96814),ie=d(72237),H=d(32013),z=d(3202),E=d(53546);function R(y,x){1&y&&(D.TgZ(0,"div",3)(1,"div",4)(2,"span",5),D._uU(3,"Evaluating..."),D.qZA()()())}let l=(()=>{var y;class x{constructor(){this.defaultColDef={editable:!1,sortable:!1,suppressFiltersToolPanel:!0,suppressMovable:!0,suppressColumnsToolPanel:!0,suppressMenu:!0},this.gridOptions={},this.columnDefs=[{field:"level",width:70},{field:"time",width:80,valueFormatter:F=>(0,z.dateToString)(F.value).slice(11,19)},{field:"message",flex:1}],this.destroy$=new H.x}onGridReady(F){this.gridApi=F.api}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete()}}return(y=x).\u0275fac=function(F){return new(F||y)},y.\u0275cmp=D.Xpm({type:y,selectors:[["app-run-logs"]],inputs:{dataContext:"dataContext"},decls:3,vars:6,consts:[[1,"d-flex","flex-column","h-100"],["class","d-flex justify-content-center align-items-center w-100 spinner flex-column mb-2",4,"ngIf"],["rowSelection","multiple",1,"ag-theme-balham","h-100","flex-fill","w-100",3,"columnDefs","defaultColDef","enableRangeSelection","rowData","gridOptions","gridReady"],[1,"d-flex","justify-content-center","align-items-center","w-100","spinner","flex-column","mb-2"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(F,q){1&F&&(D.TgZ(0,"div",0),D.YNc(1,R,4,0,"div",1),D.TgZ(2,"ag-grid-angular",2),D.NdJ("gridReady",function(W){return q.onGridReady(W)}),D.qZA()()),2&F&&(D.xp6(1),D.Q6J("ngIf",null==q.dataContext?null:q.dataContext.evaluating),D.xp6(1),D.Q6J("columnDefs",q.columnDefs)("defaultColDef",q.defaultColDef)("enableRangeSelection",!0)("rowData",null==q.dataContext?null:q.dataContext.logs)("gridOptions",q.gridOptions))},dependencies:[v.O5,E.N8],encapsulation:2}),x})();function I(y,x){if(1&y&&(D.TgZ(0,"p",8),D._uU(1),D.qZA()),2&y){const k=x.$implicit;D.xp6(1),D.Oqu(k)}}function V(y,x){if(1&y&&(D.TgZ(0,"alert",6)(1,"strong"),D._uU(2,"Runtime Error:"),D.qZA(),D.YNc(3,I,2,1,"p",7),D.qZA()),2&y){const k=D.oxw().ngIf;D.xp6(3),D.Q6J("ngForOf",k.errors)}}function ae(y,x){if(1&y&&D._UZ(0,"app-content-explorer",15),2&y){const k=D.oxw(2).$implicit;D.Q6J("formatter",!1)("data",k.data)}}function Q(y,x){if(1&y&&D._UZ(0,"app-run-logs",16),2&y){const k=D.oxw(2).$implicit;D.Q6J("dataContext",k.data)}}function U(y,x){if(1&y&&(D.ynx(0,12),D.YNc(1,ae,1,2,"app-content-explorer",13),D.YNc(2,Q,1,1,"app-run-logs",14),D.BQk()),2&y){const k=D.oxw().$implicit,F=D.oxw(2);D.Q6J("ngSwitch",k.type),D.xp6(1),D.Q6J("ngSwitchCase",F.ShowInTypes.ObjectExplorer),D.xp6(1),D.Q6J("ngSwitchCase",F.ShowInTypes.RunningLog)}}function B(y,x){1&y&&(D.TgZ(0,"div",17),D._uU(1,"[No data]"),D.qZA())}function M(y,x){if(1&y){const k=D.EpF();D.TgZ(0,"tab",9),D.NdJ("selectTab",function(){D.CHM(k);const q=D.oxw(2);return D.KtG(q.resize())}),D.YNc(1,U,3,3,"ng-container",10),D.YNc(2,B,2,0,"div",11),D.qZA()}if(2&y){const k=x.$implicit;D.Q6J("heading",k.title||"Tab "+x.index),D.xp6(1),D.Q6J("ngIf",void 0!==k.data),D.xp6(1),D.Q6J("ngIf",!k.data)}}function T(y,x){if(1&y&&(D.ynx(0),D.YNc(1,V,4,1,"alert",2),D.TgZ(2,"tabset",3,4),D.YNc(4,M,3,3,"tab",5),D.qZA(),D.BQk()),2&y){const k=x.ngIf;D.xp6(1),D.Q6J("ngIf",k.errors&&k.errors.length),D.xp6(3),D.Q6J("ngForOf",k.showInItems)}}let f=(()=>{var y;class x{constructor(){this.ShowInTypes=e.r}resize(){u.z.schedule(()=>{this.contentExplorers?.toArray()?.forEach(F=>F.resize())})}activateLastTab(){this.tabset&&(this.tabset.tabs[this.tabset.tabs.length-1].active=!0),this.resize()}}return(y=x).\u0275fac=function(F){return new(F||y)},y.\u0275cmp=D.Xpm({type:y,selectors:[["app-jspy-results-panel"]],viewQuery:function(F,q){if(1&F&&(D.Gf(r.AH,5),D.Gf(te.S,5)),2&F){let ne;D.iGM(ne=D.CRH())&&(q.tabset=ne.first),D.iGM(ne=D.CRH())&&(q.contentExplorers=ne)}},inputs:{evaluationContext:"evaluationContext"},decls:2,vars:1,consts:[[1,"card","overflow-hidden","mb-0","w-100","h-100","p-2"],[4,"ngIf"],["type","danger",4,"ngIf"],[1,"tabset-fx","nav-tabs-boxed"],["resultTabs",""],[3,"heading","selectTab",4,"ngFor","ngForOf"],["type","danger"],["class","mb-0",4,"ngFor","ngForOf"],[1,"mb-0"],[3,"heading","selectTab"],[3,"ngSwitch",4,"ngIf"],["class","m-4",4,"ngIf"],[3,"ngSwitch"],["class","d-block h-100",3,"formatter","data",4,"ngSwitchCase"],["class","w-100 h-100",3,"dataContext",4,"ngSwitchCase"],[1,"d-block","h-100",3,"formatter","data"],[1,"w-100","h-100",3,"dataContext"],[1,"m-4"]],template:function(F,q){1&F&&(D.TgZ(0,"div",0),D.YNc(1,T,5,2,"ng-container",1),D.qZA()),2&F&&(D.xp6(1),D.Q6J("ngIf",q.evaluationContext))},dependencies:[v.sg,v.O5,v.RF,v.n9,ie.wx,r.wW,r.AH,te.S,l],encapsulation:2}),x})()},52667:(be,ue,d)=>{d.d(ue,{c:()=>E});var r=d(96814),u=d(53546),te=d(90690),e=d(72237),D=d(30641),v=d(612),ie=d(20362),H=d(2048),z=d(65879);let E=(()=>{var R;class l{}return(R=l).\u0275fac=function(V){return new(V||R)},R.\u0275mod=z.oAB({type:R}),R.\u0275inj=z.cJS({providers:[H.N],imports:[r.ez,te.fX,e.nM,v.P4,D.UU,ie.T,u.sF]}),l})()},24530:(be,ue,d)=>{d.d(ue,{c:()=>r,r:()=>u});var r=function(te){return te.Assert="assert",te.TryAssert="tryAssert",te.Print="print",te.Error="error",te.ShowInObjectExplorer="showInObjectExplorer",te.ShowInJSON="showInJSON",te.ShowAsserts="showAsserts",te.InputDialog="inputDialog",te.RenderPage="renderPage",te.OpenFileAsArray="openFileAsArray",te}(r||{}),u=function(te){return te.ObjectExplorer="object-explorer",te.JSON="JSON",te.RunningLog="running-log",te}(u||{})},2048:(be,ue,d)=>{d.d(ue,{N:()=>U});var r=d(15861),u=d(32013),te=d(16321),e=d(24530),D=d(60674),v=d(89250),ie=d(85926),H=d(18916),z=d(42793),E=new WeakMap,R=new WeakMap;class l{constructor(M,T,f){(0,ie.Z)(this,E,{writable:!0,value:void 0}),(0,ie.Z)(this,R,{writable:!0,value:void 0}),this.assert=M,this.dataContext=T,(0,z.Z)(this,E,1),this.status=!0,(0,z.Z)(this,R,f)}equal(M,T){return this.assertFunction(M,T,(f,y)=>f&&"object"==typeof f&&y&&"object"==typeof y?JSON.stringify(f)!==JSON.stringify(y):f===y,(f,y)=>`Expected '${f}', received '${y}'`)}notEqual(M,T){return this.assertFunction(M,T,(f,y)=>"object"==typeof f?JSON.stringify(f)!==JSON.stringify(y):f!==y,(f,y)=>`Expected '${f}' is the same as received '${y}'`)}isTruthy(M){return this.assertFunction(M,null,(T,f)=>!!T,(T,f)=>`Value '${T}' is not Truthy - https://developer.mozilla.org/en-US/docs/Glossary/Truthy`)}isFalsy(M){return this.assertFunction(M,null,(T,f)=>!T,(T,f)=>`Value '${T}' is not Falsy - https://developer.mozilla.org/en-US/docs/Glossary/Falsy`)}isTrue(M){return this.assertFunction(M,null,(T,f)=>!0===T,(T,f)=>`Value '${T}' is not true`)}isFalse(M){return this.assertFunction(M,null,(T,f)=>!1===T,(T,f)=>`Value '${T}' is not false`)}greaterThan(M,T){return this.assertFunction(M,T,(f,y)=>f>y,(f,y)=>`${f}' is not greater than ${y}`)}greaterOrEqualThan(M,T){return this.assertFunction(M,T,(f,y)=>f>=y,(f,y)=>`${f}' is not greater (or equal) than ${y}`)}inRange(M,T,f){return this.between(M,T,f)}between(M,T,f){return this.assertFunction(M,{min:T,max:f},(y,x)=>y>=x.min&&y<=x.max,(y,x)=>`${y}' is NOT in range of ${x.min} and ${x.max}`)}lessThan(M,T){return this.assertFunction(M,T,(f,y)=>f<y,(f,y)=>`${f}' is not lesser than ${y}`)}lessOrEqualThan(M,T){return this.assertFunction(M,T,(f,y)=>f<=y,(f,y)=>`${f}' is not lesser (or equal) than ${y}`)}assertFunction(M,T,f,y){var x;if("function"==typeof M&&(M=M(this.dataContext)),"function"==typeof T&&(T=T(this.dataContext)),!f(M,T))throw this.status=!1,this.message=`[${(0,H.Z)(this,E)}] - ${y(M,T)}`,(0,H.Z)(this,R).call(this,!1,this.message),new Error(`'${this.assert}' failed: ${this.message}`);return(0,H.Z)(this,R).call(this,!0,""),(0,z.Z)(this,E,(x=(0,H.Z)(this,E),++x)),this}}var V=d(21473),ae=d(65879),Q=d(33374);let U=(()=>{var B;class M{get editorInterpreter(){return this._editorInterpreter}get context(){return this.editorInterpreter?.context}get interpreter(){return this.editorInterpreter.interpreter}get runtimeContext(){return this._runtimeContext}constructor(f){var y;this.dialogService=f,this.loadingSubj$=new u.x,this._runtimeContext={logs:[],evaluating:!1},this.loading$=this.loadingSubj$.asObservable(),this._editorInterpreter=function I(B,M,T){const f=(0,D.Pi)(B),y=function x(){return{asserts:[],errors:[],showInItems:[],reset(){this.asserts=[],this.errors=[],this.showInItems=[]}}}();return f.addFunction(e.c.ShowInObjectExplorer,(q,ne)=>{!function k(q){y.showInItems=[...y.showInItems,q]}({type:e.r.ObjectExplorer,data:q,title:ne})}),f.addFunction(e.c.Print,(...q)=>{console.log(...q);const ne=q.map(W=>"object"==typeof W?JSON.stringify(W):String(W)).join(", ");return T({level:"info",message:ne,time:new Date}),q.length>0?q[0]:null}),f.addFunction(e.c.Assert,function F(q,ne){if("boolean"==typeof ne){if(T({level:ne?"success":"fail",message:q||"",time:new Date}),y.asserts.push({success:!!ne,name:q}),!ne)throw Error(`Assert '${q}' failed`);return{status:!0,message:""}}return new l(q,ne,function W(re,X){T({logId:q,level:re?"success":"fail",message:`${q}${X?":":""} ${X||""}`.trim(),time:new Date});const L=y.asserts?.find(O=>O.name===q);L?L.success&&(L.success=!!re,L.description=X):y.asserts.push({success:!!re,name:q,description:X})})}),f.addFunction(e.c.OpenFileAsArray,q=>M.open(v.U,{initialState:{options:q}}).onCloseAsync().then(ne=>ne?.errorMessage?Promise.reject(ne.errorMessage):ne)),{interpreter:f,context:y}}(function(x){return(y=y||(0,r.Z)(function*(k){return console.error(new Error(`Cannot import ${k}. JSPY module loader is not provided`)),k})).apply(this,arguments)},this.dialogService,x=>this.appendLogMessage(x.level,x.message?.substring(0,2500)||"",x.logId))}appendLogMessage(f,y,x){if(x){const k=this.runtimeContext.logs.find(F=>F.logKey===x);if(k)return void("error"!==k.level&&(k.level=f,k.message=y,"function"==typeof this.runtimeContext.onChanged&&this.runtimeContext.onChanged(this.runtimeContext.logs)))}this.runtimeContext.logs.push({level:f,logKey:x,message:y,time:new Date}),"function"==typeof this.runtimeContext.onChanged&&this.runtimeContext.onChanged(this.runtimeContext.logs)}run(f){var y=this;return(0,r.Z)(function*(){if(!y.context)throw new Error("Evaluation Context is not initialized");if(!y.interpreter)throw new Error("Interpreter is not initialized");y.startRuntimeOutputPanel(),y.loadingSubj$.next(!0);try{const x=yield y.jspyEvaluate(f);y.appendLogMessage("info","completed"),x&&y.context.showInItems.push({type:e.r.ObjectExplorer,title:"Return Value",data:x})}catch(x){y.appendLogMessage("error","JSPython evaluation failed: "+(0,V.e$)(x)),y.context.errors=[...y.context?.errors,(0,V.e$)(x)]}finally{te.z.schedule(()=>y.loadingSubj$.next(!1),100)}})()}cancel(){return this._evaluationContext&&(this._evaluationContext.cancellationToken.cancel=!0),!!this._editorInterpreter}startRuntimeOutputPanel(){this.runtimeContext.logs.splice(0,this.runtimeContext.logs.length),"function"==typeof this.runtimeContext.onChanged&&this.runtimeContext.onChanged(this.runtimeContext.logs),this.context&&(this.context.reset(),this.context.showInItems=[{type:e.r.RunningLog,title:"Runtime Output",data:this.runtimeContext}]),this.appendLogMessage("info","start")}jspyEvaluate({script:f,method:y,entryModule:x}){var k=this;return(0,r.Z)(function*(){if(!k.context)throw new Error("Evaluation Context is not initialized");if(!k.interpreter)throw new Error("Interpreter is not initialized");return yield k.interpreter.evaluate(f,{__env:{args:{},entryModule:x,entryFunction:y||"",runsAt:"WORKSHEETS Data Studio"}},y,x,F=>k._evaluationContext=F)})()}}return(B=M).\u0275fac=function(f){return new(f||B)(ae.LFG(Q.x))},B.\u0275prov=ae.Yz7({token:B,factory:B.\u0275fac}),M})()},18937:(be,ue,d)=>{d.d(ue,{Y:()=>ae});var r=d(65879),u=d(96814),te=d(56223),e=d(90690),D=d(37282);function v(Q,U){1&Q&&r.GkF(0)}function ie(Q,U){if(1&Q&&(r.TgZ(0,"div",10),r.YNc(1,v,1,0,"ng-container",11),r.Hsn(2,2),r.qZA()),2&Q){r.oxw();const B=r.MAs(12);r.xp6(1),r.Q6J("ngTemplateOutlet",B)}}function H(Q,U){1&Q&&r.GkF(0)}function z(Q,U){if(1&Q&&(r.ynx(0),r.YNc(1,H,1,0,"ng-container",11),r.BQk()),2&Q){r.oxw();const B=r.MAs(12);r.xp6(1),r.Q6J("ngTemplateOutlet",B)}}const E=function(Q){return{"ml-3":Q}},R=function(Q){return{"btn-sm":Q}};function l(Q,U){if(1&Q){const B=r.EpF();r.TgZ(0,"div",12)(1,"label",13),r.NdJ("ngModelChange",function(T){r.CHM(B);const f=r.oxw();return r.KtG(f.modeState.left=T)})("click",function(){r.CHM(B);const T=r.oxw();return r.KtG(T.onModeState("left"))}),r.Hsn(2,3),r.qZA(),r.TgZ(3,"label",14),r.NdJ("ngModelChange",function(T){r.CHM(B);const f=r.oxw();return r.KtG(f.modeState.right=T)})("click",function(){r.CHM(B);const T=r.oxw();return r.KtG(T.onModeState("right"))}),r.Hsn(4,4),r.qZA()()}if(2&Q){const B=r.oxw();r.Q6J("ngClass",r.VKq(9,E,B.toggleTop)),r.xp6(1),r.ekj("active",B.modeState.left),r.Q6J("ngClass",r.VKq(11,R,!B.toggleTop))("ngModel",B.modeState.left),r.xp6(2),r.ekj("active",B.modeState.right),r.Q6J("ngClass",r.VKq(13,R,!B.toggleTop))("ngModel",B.modeState.right)}}const I=[[["","left",""]],[["","right",""]],[["","actions",""]],[["","left-label",""]],[["","right-label",""]]],V=["[left]","[right]","[actions]","[left-label]","[right-label]"];let ae=(()=>{var Q;class U{constructor(){this.toggleTop=!1,this.direction="horizontal",this.resized=new r.vpe,this.leftContentSize=50,this.modeState={left:!0,right:!0}}ngOnInit(){"number"==typeof this.initLeftSize&&(this.leftContentSize=this.initLeftSize,100===this.initLeftSize?this.modeState.right=!1:0===this.initLeftSize&&(this.modeState.left=!1))}onModeState(M){this.modeState[M]=!this.modeState[M],this.leftContentSize=this.modeState.left&&!this.modeState.right?100:this.modeState.left&&this.modeState.right?50:0}resize(){this.resized.emit(this.modeState)}}return(Q=U).\u0275fac=function(M){return new(M||Q)},Q.\u0275cmp=r.Xpm({type:Q,selectors:[["app-split-content"]],inputs:{initLeftSize:"initLeftSize",direction:"direction"},outputs:{resized:"resized"},ngContentSelectors:V,decls:13,vars:7,consts:[[1,"card","overflow-hidden","mb-0","w-100","h-100"],["class","card-header d-flex pl-0 py-2 pr-2",4,"ngIf"],[1,"card-body","d-flex","p-0","flex-column","h-100"],[3,"useTransition","gutterSize","direction","dragEnd","transitionEnd"],[1,"d-flex","mb-0","position-relative",3,"size"],["area0","asSplitArea"],[1,"d-flex","overflow-auto","flex-column","explorer-section","position-relative",3,"size"],["area1","asSplitArea"],[4,"ngIf"],["toggles",""],[1,"card-header","d-flex","pl-0","py-2","pr-2"],[4,"ngTemplateOutlet"],[1,"btn-group","d-block",3,"ngClass"],["ngDefaultControl","","btnCheckbox","","tabindex","0","role","button","name","mode-left",1,"btn","btn-secondary","cursor-pointer","mb-0",3,"ngClass","ngModel","ngModelChange","click"],["ngDefaultControl","","btnCheckbox","","tabindex","0","role","button","name","mode-right",1,"btn","btn-secondary","cursor-pointer","mb-0",3,"ngClass","ngModel","ngModelChange","click"]],template:function(M,T){1&M&&(r.F$t(I),r.TgZ(0,"div",0),r.YNc(1,ie,3,1,"div",1),r.TgZ(2,"div",2)(3,"as-split",3),r.NdJ("dragEnd",function(){return T.resize()})("transitionEnd",function(){return T.resize()}),r.TgZ(4,"as-split-area",4,5),r.Hsn(6),r.qZA(),r.TgZ(7,"as-split-area",6,7),r.Hsn(9,1),r.qZA()()()(),r.YNc(10,z,2,1,"ng-container",8),r.YNc(11,l,5,15,"ng-template",null,9,r.W1O)),2&M&&(r.xp6(1),r.Q6J("ngIf",T.toggleTop),r.xp6(2),r.Q6J("useTransition",!0)("gutterSize",50===T.leftContentSize?11:0)("direction",T.direction),r.xp6(1),r.Q6J("size",T.leftContentSize),r.xp6(3),r.Q6J("size",100-T.leftContentSize),r.xp6(3),r.Q6J("ngIf",!T.toggleTop))},dependencies:[u.mk,u.O5,u.tP,te.Fj,te.JJ,te.On,e.Mq,e.zE,D.DF],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}"]}),U})()},61240:(be,ue,d)=>{d.d(ue,{k:()=>H});var r=d(65879),u=d(76690),te=d(89250),e=d(32181),D=d(3202),v=d(13509),ie=d(33374);let H=(()=>{var z;class E{constructor(l,I){this.fileManagerService=l,this.dialogService=I,this.changedContent=new r.vpe}openFile(){this.fileManagerService.importTextFile().then(l=>{"{"!==l[0]&&"["!==l[0]?l=(0,D.parseCsv)(l):l.indexOf('":')<0&&(l=JSON.stringify(u.R.parse(l))),this.setContent(l)})}openFileSettings(){this.dialogService.open(te.U,{initialState:{options:{take:1e3}}}).onClose$.pipe((0,e.h)(l=>!!l)).subscribe(l=>this.setContent(l.errorMessage?l:l.data))}setContent(l){this.currentTab?.content?.setJsonText(l),this.changedContent.emit(l)}}return(z=E).\u0275fac=function(l){return new(l||z)(r.Y36(v.j5),r.Y36(ie.x))},z.\u0275cmp=r.Xpm({type:z,selectors:[["app-tab-json-content-actions"]],inputs:{currentTab:"currentTab"},outputs:{changedContent:"changedContent"},decls:5,vars:0,consts:[["data-toggle","buttons",1,"btn-group"],["type","button",1,"btn","btn-sm","btn-outline-secondary","button",3,"click"],["type","button","title","Open file partially. Works with large files",1,"btn","btn-sm","btn-outline-secondary","button",3,"click"],["aria-hidden","true",1,"fa","fa","fa-bars"]],template:function(l,I){1&l&&(r.TgZ(0,"div",0)(1,"button",1),r.NdJ("click",function(){return I.openFile()}),r._uU(2,"Open File"),r.qZA(),r.TgZ(3,"button",2),r.NdJ("click",function(){return I.openFileSettings()}),r._UZ(4,"i",3),r.qZA()())},styles:["ng-select[_ngcontent-%COMP%]{flex:0 1 150px}.button[_ngcontent-%COMP%]{color:var(--color)}"]}),E})()},92604:(be,ue,d)=>{d.d(ue,{A:()=>T});var r=d(65879),u=d(96814),te=d(56223),e=d(30641);const D=function(f,y){return{"badge-success":f,"badge-danger":y}};function v(f,y){if(1&f&&(r.TgZ(0,"li",4)(1,"div",5)(2,"span",6),r._uU(3),r.qZA()(),r.TgZ(4,"div",7)(5,"div",8)(6,"b"),r._uU(7),r.qZA()(),r.TgZ(8,"div",9),r._uU(9),r.qZA()()()),2&f){const x=y.$implicit;r.xp6(2),r.Q6J("ngClass",r.WLB(4,D,x.success,!x.success)),r.xp6(1),r.hij(" ",x.success?"Success":"Failed",""),r.xp6(4),r.Oqu(x.name),r.xp6(2),r.Oqu(x.description)}}function ie(f,y){if(1&f&&(r.TgZ(0,"ul",2),r.YNc(1,v,10,7,"li",3),r.qZA()),2&f){const x=r.oxw();r.xp6(1),r.Q6J("ngForOf",x.assertions)}}function H(f,y){if(1&f&&(r.TgZ(0,"span",10),r._uU(1),r.qZA()),2&f){const x=r.oxw(),k=r.MAs(1);r.Q6J("ngClass",r.WLB(5,D,x.success,!x.success))("adaptivePosition",!1)("popover",k)("outsideClick",!0),r.xp6(1),r.hij(" ",x.stepsCount,"\n")}}let z=(()=>{var f;class y{constructor(){}ngOnInit(){this.setState()}ngOnChanges(){this.setState()}setState(){this.assertions?(this.success=this.assertions.every(k=>k.success),this.stepsCount=this.assertions.length):this.stepsCount=0}}return(f=y).\u0275fac=function(k){return new(k||f)},f.\u0275cmp=r.Xpm({type:f,selectors:[["app-assertion-logs"]],inputs:{assertions:"assertions"},features:[r.TTD],decls:3,vars:1,consts:[["logsTemplate",""],["class","badge align-self-stretch cursor-pointer px-2","placement","left","container","body","containerClass","assertion-logs-container","popoverTitle","Assertion logs",3,"ngClass","adaptivePosition","popover","outsideClick",4,"ngIf"],[1,"list-group","mb-2"],["class","list-group-item d-flex py-1 px-0",4,"ngFor","ngForOf"],[1,"list-group-item","d-flex","py-1","px-0"],[1,"px-1","status"],[1,"badge","p-1","w-100",3,"ngClass"],[1,"d-flex","flex-column"],[1,"px-1","my-auto"],[1,"px-1"],["placement","left","container","body","containerClass","assertion-logs-container","popoverTitle","Assertion logs",1,"badge","align-self-stretch","cursor-pointer","px-2",3,"ngClass","adaptivePosition","popover","outsideClick"]],template:function(k,F){1&k&&(r.YNc(0,ie,2,1,"ng-template",null,0,r.W1O),r.YNc(2,H,2,8,"span",1)),2&k&&(r.xp6(2),r.Q6J("ngIf",F.stepsCount))},dependencies:[u.mk,u.sg,u.O5,e.k5],styles:[".status[_ngcontent-%COMP%]{flex:0 0 50px}  .assertion-logs-container.popover{max-width:400px;width:400px}.badge[_ngcontent-%COMP%]{line-height:1.5rem}"]}),y})();var E=d(54807);function R(f,y){1&f&&r._UZ(0,"app-assertion-logs",9),2&f&&r.Q6J("assertions",y.ngIf)}function l(f,y){if(1&f&&(r.TgZ(0,"span",10),r._uU(1),r.qZA()),2&f){const x=y.ngIf;r.xp6(1),r.hij("",x/1e3," s")}}function I(f,y){if(1&f){const x=r.EpF();r.TgZ(0,"ng-select",11),r.NdJ("ngModelChange",function(F){r.CHM(x);const q=r.oxw();return r.KtG(q.selectedFunction=F)}),r.qZA()}if(2&f){const x=r.oxw();r.Q6J("items",x.jspyFunctions)("ngModel",x.selectedFunction)("placeholder","Select function")}}function V(f,y){1&f&&r._UZ(0,"span",12)}function ae(f,y){1&f&&(r.ynx(0),r._uU(1,"Run"),r.BQk())}function Q(f,y){if(1&f){const x=r.EpF();r.TgZ(0,"button",13),r.NdJ("click",function(){r.CHM(x);const F=r.oxw();return r.KtG(F.onScheduleRun())}),r._UZ(1,"i",14),r.qZA()}if(2&f){const x=r.oxw();r.Q6J("disabled",null==x.tabContent?null:x.tabContent.evaluating)}}function U(f,y){1&f&&(r.ynx(0),r._uU(1,"Cancelling"),r.BQk())}function B(f,y){1&f&&(r.ynx(0),r._uU(1,"Cancel"),r.BQk())}function M(f,y){if(1&f){const x=r.EpF();r.TgZ(0,"button",15),r.NdJ("click",function(){r.CHM(x);const F=r.oxw();return r.KtG(null==F.tabContent?null:F.tabContent.cancelRun())}),r.YNc(1,U,2,0,"ng-container",6),r.YNc(2,B,2,0,"ng-container",6),r.qZA()}if(2&f){const x=r.oxw();r.Q6J("disabled",null==x.tabContent?null:x.tabContent.cancelling),r.xp6(1),r.Q6J("ngIf",null==x.tabContent?null:x.tabContent.cancelling),r.xp6(1),r.Q6J("ngIf",!(null!=x.tabContent&&x.tabContent.cancelling))}}let T=(()=>{var f;class y{constructor(){this.jspyFunctions=[],this.evaluationResult=null,this.subs=[]}get schedule(){return!!this.currentTab}ngOnInit(){this.subscribeOnTab()}ngOnChanges({currentTab:k}){k?.firstChange||this.subscribeOnTab()}ngOnDestroy(){this.clearSubscriptions()}get selectedFunction(){return this.tabContent?.selectedFunction||null}get tabContent(){return this.currentTab?.content?.contentEditor??this.jspyContentEditor}set selectedFunction(k){this.currentTab?.content&&this.tabContent&&(this.tabContent.selectedFunction=k)}onScheduleRun(){this.currentTab?.content?.scheduleRun(this.selectedFunction)}subscribeOnTab(){this.clearSubscriptions();const k=this.tabContent?.jspyFunctionsList$?.subscribe(q=>this.jspyFunctions=q);k&&this.subs.push(k);const F=this.tabContent?.evaluationResult$.subscribe(q=>{this.evaluationResult=q});F&&this.subs.push(F)}clearSubscriptions(){this.subs.forEach(k=>k?.unsubscribe()),this.subs=[]}}return(f=y).\u0275fac=function(k){return new(k||f)},f.\u0275cmp=r.Xpm({type:f,selectors:[["app-jspy-actions"]],inputs:{currentTab:"currentTab",jspyContentEditor:"jspyContentEditor"},features:[r.TTD],decls:9,vars:8,consts:[["class","d-flex",3,"assertions",4,"ngIf"],["class","align-self-stretch badge badge-info",4,"ngIf"],["class","auto-grow px-0 ng-select-sm",3,"items","ngModel","placeholder","ngModelChange",4,"ngIf"],["data-toggle","buttons",1,"btn-group"],["type","button",1,"btn","btn-sm","run","btn-success",3,"disabled","click"],["class","spinner-border",4,"ngIf"],[4,"ngIf"],["type","button","class","btn btn-sm btn-success",3,"disabled","click",4,"ngIf"],["type","button","class","btn btn-sm btn-light","title","Cancel operation requested. Waiting for the current operation to be completed ...",3,"disabled","click",4,"ngIf"],[1,"d-flex",3,"assertions"],[1,"align-self-stretch","badge","badge-info"],[1,"auto-grow","px-0","ng-select-sm",3,"items","ngModel","placeholder","ngModelChange"],[1,"spinner-border"],["type","button",1,"btn","btn-sm","btn-success",3,"disabled","click"],["aria-hidden","true",1,"fa","fa","fa-clock-o"],["type","button","title","Cancel operation requested. Waiting for the current operation to be completed ...",1,"btn","btn-sm","btn-light",3,"disabled","click"]],template:function(k,F){1&k&&(r.YNc(0,R,1,1,"app-assertion-logs",0),r.YNc(1,l,2,1,"span",1),r.YNc(2,I,1,3,"ng-select",2),r.TgZ(3,"div",3)(4,"button",4),r.NdJ("click",function(){return null==F.tabContent?null:F.tabContent.run(F.selectedFunction||void 0)}),r.YNc(5,V,1,0,"span",5),r.YNc(6,ae,2,0,"ng-container",6),r.qZA(),r.YNc(7,Q,2,1,"button",7),r.qZA(),r.YNc(8,M,3,3,"button",8)),2&k&&(r.Q6J("ngIf",null==F.evaluationResult?null:F.evaluationResult.asserts),r.xp6(1),r.Q6J("ngIf",null==F.evaluationResult?null:F.evaluationResult.evaluationTime),r.xp6(1),r.Q6J("ngIf",null==F.jspyFunctions?null:F.jspyFunctions.length),r.xp6(2),r.Q6J("disabled",null==F.tabContent?null:F.tabContent.evaluating),r.xp6(1),r.Q6J("ngIf",null==F.tabContent?null:F.tabContent.evaluating),r.xp6(1),r.Q6J("ngIf",!(null!=F.tabContent&&F.tabContent.evaluating)),r.xp6(1),r.Q6J("ngIf",F.schedule),r.xp6(1),r.Q6J("ngIf",null==F.tabContent?null:F.tabContent.evaluating))},dependencies:[u.O5,te.JJ,te.On,z,E.w9],styles:["ng-select[_ngcontent-%COMP%]{min-width:150px}.badge[_ngcontent-%COMP%]{line-height:1.5rem}.btn.run[_ngcontent-%COMP%]{width:4rem;margin-right:1px}.btn.run[_ngcontent-%COMP%] + .btn[_ngcontent-%COMP%]{margin-left:0}[_nghost-%COMP%] > *[_ngcontent-%COMP%]:not(:last-child){margin-right:.5rem}"]}),y})()},76900:(be,ue,d)=>{d.r(ue),d.d(ue,{DataStudioModule:()=>la});var r=d(96814),u=d(56223),te=d(69862),e=d(65879),D=d(16672),v=d(42495),ie=d(62831),H=d(32181),z=d(48180),E=d(59773),R=d(49388);class B{attach(i){return this._attachedHost=i,i.attach(this)}detach(){let i=this._attachedHost;null!=i&&(this._attachedHost=null,i.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(i){this._attachedHost=i}}class M extends B{constructor(i,s,t,n,a){super(),this.component=i,this.viewContainerRef=s,this.injector=t,this.componentFactoryResolver=n,this.projectableNodes=a}}class T extends B{constructor(i,s,t,n){super(),this.templateRef=i,this.viewContainerRef=s,this.context=t,this.injector=n}get origin(){return this.templateRef.elementRef}attach(i,s=this.context){return this.context=s,super.attach(i)}detach(){return this.context=void 0,super.detach()}}class f extends B{constructor(i){super(),this.element=i instanceof e.SBq?i.nativeElement:i}}class y{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(i){return i instanceof M?(this._attachedPortal=i,this.attachComponentPortal(i)):i instanceof T?(this._attachedPortal=i,this.attachTemplatePortal(i)):this.attachDomPortal&&i instanceof f?(this._attachedPortal=i,this.attachDomPortal(i)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(i){this._disposeFn=i}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class k extends y{constructor(i,s,t,n,a){super(),this.outletElement=i,this._componentFactoryResolver=s,this._appRef=t,this._defaultInjector=n,this.attachDomPortal=c=>{const _=c.element,w=this._document.createComment("dom-portal");_.parentNode.insertBefore(w,_),this.outletElement.appendChild(_),this._attachedPortal=c,super.setDisposeFn(()=>{w.parentNode&&w.parentNode.replaceChild(_,w)})},this._document=a}attachComponentPortal(i){const t=(i.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(i.component);let n;return i.viewContainerRef?(n=i.viewContainerRef.createComponent(t,i.viewContainerRef.length,i.injector||i.viewContainerRef.injector,i.projectableNodes||void 0),this.setDisposeFn(()=>n.destroy())):(n=t.create(i.injector||this._defaultInjector||e.zs3.NULL),this._appRef.attachView(n.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(n.hostView),n.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(n)),this._attachedPortal=i,n}attachTemplatePortal(i){let s=i.viewContainerRef,t=s.createEmbeddedView(i.templateRef,i.context,{injector:i.injector});return t.rootNodes.forEach(n=>this.outletElement.appendChild(n)),t.detectChanges(),this.setDisposeFn(()=>{let n=s.indexOf(t);-1!==n&&s.remove(n)}),this._attachedPortal=i,t}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(i){return i.hostView.rootNodes[0]}}let X=(()=>{var o;class i{}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({}),i})();var O=d(32013),b=d(55113),A=d(63019);const g=(0,ie.Mq)();class p{constructor(i,s){this._viewportRuler=i,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=s}attach(){}enable(){if(this._canBeEnabled()){const i=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=i.style.left||"",this._previousHTMLStyles.top=i.style.top||"",i.style.left=(0,v.HM)(-this._previousScrollPosition.left),i.style.top=(0,v.HM)(-this._previousScrollPosition.top),i.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const i=this._document.documentElement,t=i.style,n=this._document.body.style,a=t.scrollBehavior||"",c=n.scrollBehavior||"";this._isEnabled=!1,t.left=this._previousHTMLStyles.left,t.top=this._previousHTMLStyles.top,i.classList.remove("cdk-global-scrollblock"),g&&(t.scrollBehavior=n.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),g&&(t.scrollBehavior=a,n.scrollBehavior=c)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const s=this._document.body,t=this._viewportRuler.getViewportSize();return s.scrollHeight>t.height||s.scrollWidth>t.width}}class J{constructor(i,s,t,n){this._scrollDispatcher=i,this._ngZone=s,this._viewportRuler=t,this._config=n,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(i){this._overlayRef=i}enable(){if(this._scrollSubscription)return;const i=this._scrollDispatcher.scrolled(0).pipe((0,H.h)(s=>!s||!this._overlayRef.overlayElement.contains(s.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=i.subscribe(()=>{const s=this._viewportRuler.getViewportScrollPosition().top;Math.abs(s-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=i.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class G{enable(){}disable(){}attach(){}}function ee(o,i){return i.some(s=>o.bottom<s.top||o.top>s.bottom||o.right<s.left||o.left>s.right)}function $(o,i){return i.some(s=>o.top<s.top||o.bottom>s.bottom||o.left<s.left||o.right>s.right)}class oe{constructor(i,s,t,n){this._scrollDispatcher=i,this._viewportRuler=s,this._ngZone=t,this._config=n,this._scrollSubscription=null}attach(i){this._overlayRef=i}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const s=this._overlayRef.overlayElement.getBoundingClientRect(),{width:t,height:n}=this._viewportRuler.getViewportSize();ee(s,[{width:t,height:n,bottom:n,right:t,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let K=(()=>{var o;class i{constructor(t,n,a,c){this._scrollDispatcher=t,this._viewportRuler=n,this._ngZone=a,this.noop=()=>new G,this.close=_=>new J(this._scrollDispatcher,this._ngZone,this._viewportRuler,_),this.block=()=>new p(this._viewportRuler,this._document),this.reposition=_=>new oe(this._scrollDispatcher,this._viewportRuler,this._ngZone,_),this._document=c}}return(o=i).\u0275fac=function(t){return new(t||o)(e.LFG(D.mF),e.LFG(D.rL),e.LFG(e.R0b),e.LFG(r.K0))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),i})();class h{constructor(i){if(this.scrollStrategy=new G,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,i){const s=Object.keys(i);for(const t of s)void 0!==i[t]&&(this[t]=i[t])}}}class N{constructor(i,s){this.connectionPair=i,this.scrollableViewProperties=s}}let pe=(()=>{var o;class i{constructor(t){this._attachedOverlays=[],this._document=t}ngOnDestroy(){this.detach()}add(t){this.remove(t),this._attachedOverlays.push(t)}remove(t){const n=this._attachedOverlays.indexOf(t);n>-1&&this._attachedOverlays.splice(n,1),0===this._attachedOverlays.length&&this.detach()}}return(o=i).\u0275fac=function(t){return new(t||o)(e.LFG(r.K0))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),i})(),ke=(()=>{var o;class i extends pe{constructor(t,n){super(t),this._ngZone=n,this._keydownListener=a=>{const c=this._attachedOverlays;for(let _=c.length-1;_>-1;_--)if(c[_]._keydownEvents.observers.length>0){const w=c[_]._keydownEvents;this._ngZone?this._ngZone.run(()=>w.next(a)):w.next(a);break}}}add(t){super.add(t),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}}return(o=i).\u0275fac=function(t){return new(t||o)(e.LFG(r.K0),e.LFG(e.R0b,8))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),i})(),Ae=(()=>{var o;class i extends pe{constructor(t,n,a){super(t),this._platform=n,this._ngZone=a,this._cursorStyleIsSet=!1,this._pointerDownListener=c=>{this._pointerDownEventTarget=(0,ie.sA)(c)},this._clickListener=c=>{const _=(0,ie.sA)(c),w="click"===c.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:_;this._pointerDownEventTarget=null;const P=this._attachedOverlays.slice();for(let Z=P.length-1;Z>-1;Z--){const Y=P[Z];if(Y._outsidePointerEvents.observers.length<1||!Y.hasAttached())continue;if(Y.overlayElement.contains(_)||Y.overlayElement.contains(w))break;const se=Y._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>se.next(c)):se.next(c)}}}add(t){if(super.add(t),!this._isAttached){const n=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(n)):this._addEventListeners(n),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=n.style.cursor,n.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const t=this._document.body;t.removeEventListener("pointerdown",this._pointerDownListener,!0),t.removeEventListener("click",this._clickListener,!0),t.removeEventListener("auxclick",this._clickListener,!0),t.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(t.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(t){t.addEventListener("pointerdown",this._pointerDownListener,!0),t.addEventListener("click",this._clickListener,!0),t.addEventListener("auxclick",this._clickListener,!0),t.addEventListener("contextmenu",this._clickListener,!0)}}return(o=i).\u0275fac=function(t){return new(t||o)(e.LFG(r.K0),e.LFG(ie.t4),e.LFG(e.R0b,8))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),i})(),Qe=(()=>{var o;class i{constructor(t,n){this._platform=n,this._document=t}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const t="cdk-overlay-container";if(this._platform.isBrowser||(0,ie.Oy)()){const a=this._document.querySelectorAll(`.${t}[platform="server"], .${t}[platform="test"]`);for(let c=0;c<a.length;c++)a[c].remove()}const n=this._document.createElement("div");n.classList.add(t),(0,ie.Oy)()?n.setAttribute("platform","test"):this._platform.isBrowser||n.setAttribute("platform","server"),this._document.body.appendChild(n),this._containerElement=n}}return(o=i).\u0275fac=function(t){return new(t||o)(e.LFG(r.K0),e.LFG(ie.t4))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),i})();class Le{constructor(i,s,t,n,a,c,_,w,P,Z=!1){this._portalOutlet=i,this._host=s,this._pane=t,this._config=n,this._ngZone=a,this._keyboardDispatcher=c,this._document=_,this._location=w,this._outsideClickDispatcher=P,this._animationsDisabled=Z,this._backdropElement=null,this._backdropClick=new O.x,this._attachments=new O.x,this._detachments=new O.x,this._locationChanges=b.w0.EMPTY,this._backdropClickHandler=Y=>this._backdropClick.next(Y),this._backdropTransitionendHandler=Y=>{this._disposeBackdrop(Y.target)},this._keydownEvents=new O.x,this._outsidePointerEvents=new O.x,n.scrollStrategy&&(this._scrollStrategy=n.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=n.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(i){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const s=this._portalOutlet.attach(i);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe((0,z.q)(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),"function"==typeof s?.onDestroy&&s.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),s}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const i=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),i}dispose(){const i=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,i&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(i){i!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=i,this.hasAttached()&&(i.attach(this),this.updatePosition()))}updateSize(i){this._config={...this._config,...i},this._updateElementSize()}setDirection(i){this._config={...this._config,direction:i},this._updateElementDirection()}addPanelClass(i){this._pane&&this._toggleClasses(this._pane,i,!0)}removePanelClass(i){this._pane&&this._toggleClasses(this._pane,i,!1)}getDirection(){const i=this._config.direction;return i?"string"==typeof i?i:i.value:"ltr"}updateScrollStrategy(i){i!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=i,this.hasAttached()&&(i.attach(this),i.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const i=this._pane.style;i.width=(0,v.HM)(this._config.width),i.height=(0,v.HM)(this._config.height),i.minWidth=(0,v.HM)(this._config.minWidth),i.minHeight=(0,v.HM)(this._config.minHeight),i.maxWidth=(0,v.HM)(this._config.maxWidth),i.maxHeight=(0,v.HM)(this._config.maxHeight)}_togglePointerEvents(i){this._pane.style.pointerEvents=i?"":"none"}_attachBackdrop(){const i="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(i)})}):this._backdropElement.classList.add(i)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const i=this._backdropElement;if(i){if(this._animationsDisabled)return void this._disposeBackdrop(i);i.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{i.addEventListener("transitionend",this._backdropTransitionendHandler)}),i.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(i)},500))}}_toggleClasses(i,s,t){const n=(0,v.Eq)(s||[]).filter(a=>!!a);n.length&&(t?i.classList.add(...n):i.classList.remove(...n))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const i=this._ngZone.onStable.pipe((0,E.R)((0,A.T)(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),i.unsubscribe())})})}_disposeScrollStrategy(){const i=this._scrollStrategy;i&&(i.disable(),i.detach&&i.detach())}_disposeBackdrop(i){i&&(i.removeEventListener("click",this._backdropClickHandler),i.removeEventListener("transitionend",this._backdropTransitionendHandler),i.remove(),this._backdropElement===i&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}const Pe="cdk-overlay-connected-position-bounding-box",Ze=/([A-Za-z%]+)$/;class yn{get positions(){return this._preferredPositions}constructor(i,s,t,n,a){this._viewportRuler=s,this._document=t,this._platform=n,this._overlayContainer=a,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new O.x,this._resizeSubscription=b.w0.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(i)}attach(i){this._validatePositions(),i.hostElement.classList.add(Pe),this._overlayRef=i,this._boundingBox=i.hostElement,this._pane=i.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const i=this._originRect,s=this._overlayRect,t=this._viewportRect,n=this._containerRect,a=[];let c;for(let _ of this._preferredPositions){let w=this._getOriginPoint(i,n,_),P=this._getOverlayPoint(w,s,_),Z=this._getOverlayFit(P,s,t,_);if(Z.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(_,w);this._canFitWithFlexibleDimensions(Z,P,t)?a.push({position:_,origin:w,overlayRect:s,boundingBoxRect:this._calculateBoundingBoxRect(w,_)}):(!c||c.overlayFit.visibleArea<Z.visibleArea)&&(c={overlayFit:Z,overlayPoint:P,originPoint:w,position:_,overlayRect:s})}if(a.length){let _=null,w=-1;for(const P of a){const Z=P.boundingBoxRect.width*P.boundingBoxRect.height*(P.position.weight||1);Z>w&&(w=Z,_=P)}return this._isPushed=!1,void this._applyPosition(_.position,_.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(c.position,c.originPoint);this._applyPosition(c.position,c.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&Je(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(Pe),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const i=this._lastPosition;if(i){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const s=this._getOriginPoint(this._originRect,this._containerRect,i);this._applyPosition(i,s)}else this.apply()}withScrollableContainers(i){return this._scrollables=i,this}withPositions(i){return this._preferredPositions=i,-1===i.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(i){return this._viewportMargin=i,this}withFlexibleDimensions(i=!0){return this._hasFlexibleDimensions=i,this}withGrowAfterOpen(i=!0){return this._growAfterOpen=i,this}withPush(i=!0){return this._canPush=i,this}withLockedPosition(i=!0){return this._positionLocked=i,this}setOrigin(i){return this._origin=i,this}withDefaultOffsetX(i){return this._offsetX=i,this}withDefaultOffsetY(i){return this._offsetY=i,this}withTransformOriginOn(i){return this._transformOriginSelector=i,this}_getOriginPoint(i,s,t){let n,a;if("center"==t.originX)n=i.left+i.width/2;else{const c=this._isRtl()?i.right:i.left,_=this._isRtl()?i.left:i.right;n="start"==t.originX?c:_}return s.left<0&&(n-=s.left),a="center"==t.originY?i.top+i.height/2:"top"==t.originY?i.top:i.bottom,s.top<0&&(a-=s.top),{x:n,y:a}}_getOverlayPoint(i,s,t){let n,a;return n="center"==t.overlayX?-s.width/2:"start"===t.overlayX?this._isRtl()?-s.width:0:this._isRtl()?0:-s.width,a="center"==t.overlayY?-s.height/2:"top"==t.overlayY?0:-s.height,{x:i.x+n,y:i.y+a}}_getOverlayFit(i,s,t,n){const a=Nt(s);let{x:c,y:_}=i,w=this._getOffset(n,"x"),P=this._getOffset(n,"y");w&&(c+=w),P&&(_+=P);let se=0-_,le=_+a.height-t.height,ce=this._subtractOverflows(a.width,0-c,c+a.width-t.width),ve=this._subtractOverflows(a.height,se,le),gt=ce*ve;return{visibleArea:gt,isCompletelyWithinViewport:a.width*a.height===gt,fitsInViewportVertically:ve===a.height,fitsInViewportHorizontally:ce==a.width}}_canFitWithFlexibleDimensions(i,s,t){if(this._hasFlexibleDimensions){const n=t.bottom-s.y,a=t.right-s.x,c=Pt(this._overlayRef.getConfig().minHeight),_=Pt(this._overlayRef.getConfig().minWidth);return(i.fitsInViewportVertically||null!=c&&c<=n)&&(i.fitsInViewportHorizontally||null!=_&&_<=a)}return!1}_pushOverlayOnScreen(i,s,t){if(this._previousPushAmount&&this._positionLocked)return{x:i.x+this._previousPushAmount.x,y:i.y+this._previousPushAmount.y};const n=Nt(s),a=this._viewportRect,c=Math.max(i.x+n.width-a.width,0),_=Math.max(i.y+n.height-a.height,0),w=Math.max(a.top-t.top-i.y,0),P=Math.max(a.left-t.left-i.x,0);let Z=0,Y=0;return Z=n.width<=a.width?P||-c:i.x<this._viewportMargin?a.left-t.left-i.x:0,Y=n.height<=a.height?w||-_:i.y<this._viewportMargin?a.top-t.top-i.y:0,this._previousPushAmount={x:Z,y:Y},{x:i.x+Z,y:i.y+Y}}_applyPosition(i,s){if(this._setTransformOrigin(i),this._setOverlayElementStyles(s,i),this._setBoundingBoxStyles(s,i),i.panelClass&&this._addPanelClasses(i.panelClass),this._lastPosition=i,this._positionChanges.observers.length){const t=this._getScrollVisibility(),n=new N(i,t);this._positionChanges.next(n)}this._isInitialRender=!1}_setTransformOrigin(i){if(!this._transformOriginSelector)return;const s=this._boundingBox.querySelectorAll(this._transformOriginSelector);let t,n=i.overlayY;t="center"===i.overlayX?"center":this._isRtl()?"start"===i.overlayX?"right":"left":"start"===i.overlayX?"left":"right";for(let a=0;a<s.length;a++)s[a].style.transformOrigin=`${t} ${n}`}_calculateBoundingBoxRect(i,s){const t=this._viewportRect,n=this._isRtl();let a,c,_,Z,Y,se;if("top"===s.overlayY)c=i.y,a=t.height-c+this._viewportMargin;else if("bottom"===s.overlayY)_=t.height-i.y+2*this._viewportMargin,a=t.height-_+this._viewportMargin;else{const le=Math.min(t.bottom-i.y+t.top,i.y),ce=this._lastBoundingBoxSize.height;a=2*le,c=i.y-le,a>ce&&!this._isInitialRender&&!this._growAfterOpen&&(c=i.y-ce/2)}if("end"===s.overlayX&&!n||"start"===s.overlayX&&n)se=t.width-i.x+this._viewportMargin,Z=i.x-this._viewportMargin;else if("start"===s.overlayX&&!n||"end"===s.overlayX&&n)Y=i.x,Z=t.right-i.x;else{const le=Math.min(t.right-i.x+t.left,i.x),ce=this._lastBoundingBoxSize.width;Z=2*le,Y=i.x-le,Z>ce&&!this._isInitialRender&&!this._growAfterOpen&&(Y=i.x-ce/2)}return{top:c,left:Y,bottom:_,right:se,width:Z,height:a}}_setBoundingBoxStyles(i,s){const t=this._calculateBoundingBoxRect(i,s);!this._isInitialRender&&!this._growAfterOpen&&(t.height=Math.min(t.height,this._lastBoundingBoxSize.height),t.width=Math.min(t.width,this._lastBoundingBoxSize.width));const n={};if(this._hasExactPosition())n.top=n.left="0",n.bottom=n.right=n.maxHeight=n.maxWidth="",n.width=n.height="100%";else{const a=this._overlayRef.getConfig().maxHeight,c=this._overlayRef.getConfig().maxWidth;n.height=(0,v.HM)(t.height),n.top=(0,v.HM)(t.top),n.bottom=(0,v.HM)(t.bottom),n.width=(0,v.HM)(t.width),n.left=(0,v.HM)(t.left),n.right=(0,v.HM)(t.right),n.alignItems="center"===s.overlayX?"center":"end"===s.overlayX?"flex-end":"flex-start",n.justifyContent="center"===s.overlayY?"center":"bottom"===s.overlayY?"flex-end":"flex-start",a&&(n.maxHeight=(0,v.HM)(a)),c&&(n.maxWidth=(0,v.HM)(c))}this._lastBoundingBoxSize=t,Je(this._boundingBox.style,n)}_resetBoundingBoxStyles(){Je(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){Je(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(i,s){const t={},n=this._hasExactPosition(),a=this._hasFlexibleDimensions,c=this._overlayRef.getConfig();if(n){const Z=this._viewportRuler.getViewportScrollPosition();Je(t,this._getExactOverlayY(s,i,Z)),Je(t,this._getExactOverlayX(s,i,Z))}else t.position="static";let _="",w=this._getOffset(s,"x"),P=this._getOffset(s,"y");w&&(_+=`translateX(${w}px) `),P&&(_+=`translateY(${P}px)`),t.transform=_.trim(),c.maxHeight&&(n?t.maxHeight=(0,v.HM)(c.maxHeight):a&&(t.maxHeight="")),c.maxWidth&&(n?t.maxWidth=(0,v.HM)(c.maxWidth):a&&(t.maxWidth="")),Je(this._pane.style,t)}_getExactOverlayY(i,s,t){let n={top:"",bottom:""},a=this._getOverlayPoint(s,this._overlayRect,i);return this._isPushed&&(a=this._pushOverlayOnScreen(a,this._overlayRect,t)),"bottom"===i.overlayY?n.bottom=this._document.documentElement.clientHeight-(a.y+this._overlayRect.height)+"px":n.top=(0,v.HM)(a.y),n}_getExactOverlayX(i,s,t){let c,n={left:"",right:""},a=this._getOverlayPoint(s,this._overlayRect,i);return this._isPushed&&(a=this._pushOverlayOnScreen(a,this._overlayRect,t)),c=this._isRtl()?"end"===i.overlayX?"left":"right":"end"===i.overlayX?"right":"left","right"===c?n.right=this._document.documentElement.clientWidth-(a.x+this._overlayRect.width)+"px":n.left=(0,v.HM)(a.x),n}_getScrollVisibility(){const i=this._getOriginRect(),s=this._pane.getBoundingClientRect(),t=this._scrollables.map(n=>n.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:$(i,t),isOriginOutsideView:ee(i,t),isOverlayClipped:$(s,t),isOverlayOutsideView:ee(s,t)}}_subtractOverflows(i,...s){return s.reduce((t,n)=>t-Math.max(n,0),i)}_getNarrowedViewportRect(){const i=this._document.documentElement.clientWidth,s=this._document.documentElement.clientHeight,t=this._viewportRuler.getViewportScrollPosition();return{top:t.top+this._viewportMargin,left:t.left+this._viewportMargin,right:t.left+i-this._viewportMargin,bottom:t.top+s-this._viewportMargin,width:i-2*this._viewportMargin,height:s-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(i,s){return"x"===s?null==i.offsetX?this._offsetX:i.offsetX:null==i.offsetY?this._offsetY:i.offsetY}_validatePositions(){}_addPanelClasses(i){this._pane&&(0,v.Eq)(i).forEach(s=>{""!==s&&-1===this._appliedPanelClasses.indexOf(s)&&(this._appliedPanelClasses.push(s),this._pane.classList.add(s))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(i=>{this._pane.classList.remove(i)}),this._appliedPanelClasses=[])}_getOriginRect(){const i=this._origin;if(i instanceof e.SBq)return i.nativeElement.getBoundingClientRect();if(i instanceof Element)return i.getBoundingClientRect();const s=i.width||0,t=i.height||0;return{top:i.y,bottom:i.y+t,left:i.x,right:i.x+s,height:t,width:s}}}function Je(o,i){for(let s in i)i.hasOwnProperty(s)&&(o[s]=i[s]);return o}function Pt(o){if("number"!=typeof o&&null!=o){const[i,s]=o.split(Ze);return s&&"px"!==s?null:parseFloat(i)}return o||null}function Nt(o){return{top:Math.floor(o.top),right:Math.floor(o.right),bottom:Math.floor(o.bottom),left:Math.floor(o.left),width:Math.floor(o.width),height:Math.floor(o.height)}}const kt=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom"}],vn=[{originX:"end",originY:"top",overlayX:"start",overlayY:"top"},{originX:"end",originY:"bottom",overlayX:"start",overlayY:"bottom"},{originX:"start",originY:"top",overlayX:"end",overlayY:"top"},{originX:"start",originY:"bottom",overlayX:"end",overlayY:"bottom"}],Zt="cdk-global-overlay-wrapper";class Cn{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(i){const s=i.getConfig();this._overlayRef=i,this._width&&!s.width&&i.updateSize({width:this._width}),this._height&&!s.height&&i.updateSize({height:this._height}),i.hostElement.classList.add(Zt),this._isDisposed=!1}top(i=""){return this._bottomOffset="",this._topOffset=i,this._alignItems="flex-start",this}left(i=""){return this._xOffset=i,this._xPosition="left",this}bottom(i=""){return this._topOffset="",this._bottomOffset=i,this._alignItems="flex-end",this}right(i=""){return this._xOffset=i,this._xPosition="right",this}start(i=""){return this._xOffset=i,this._xPosition="start",this}end(i=""){return this._xOffset=i,this._xPosition="end",this}width(i=""){return this._overlayRef?this._overlayRef.updateSize({width:i}):this._width=i,this}height(i=""){return this._overlayRef?this._overlayRef.updateSize({height:i}):this._height=i,this}centerHorizontally(i=""){return this.left(i),this._xPosition="center",this}centerVertically(i=""){return this.top(i),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const i=this._overlayRef.overlayElement.style,s=this._overlayRef.hostElement.style,t=this._overlayRef.getConfig(),{width:n,height:a,maxWidth:c,maxHeight:_}=t,w=!("100%"!==n&&"100vw"!==n||c&&"100%"!==c&&"100vw"!==c),P=!("100%"!==a&&"100vh"!==a||_&&"100%"!==_&&"100vh"!==_),Z=this._xPosition,Y=this._xOffset,se="rtl"===this._overlayRef.getConfig().direction;let le="",ce="",ve="";w?ve="flex-start":"center"===Z?(ve="center",se?ce=Y:le=Y):se?"left"===Z||"end"===Z?(ve="flex-end",le=Y):("right"===Z||"start"===Z)&&(ve="flex-start",ce=Y):"left"===Z||"start"===Z?(ve="flex-start",le=Y):("right"===Z||"end"===Z)&&(ve="flex-end",ce=Y),i.position=this._cssPosition,i.marginLeft=w?"0":le,i.marginTop=P?"0":this._topOffset,i.marginBottom=this._bottomOffset,i.marginRight=w?"0":ce,s.justifyContent=ve,s.alignItems=P?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const i=this._overlayRef.overlayElement.style,s=this._overlayRef.hostElement,t=s.style;s.classList.remove(Zt),t.justifyContent=t.alignItems=i.marginTop=i.marginBottom=i.marginLeft=i.marginRight=i.position="",this._overlayRef=null,this._isDisposed=!0}}let Tn=(()=>{var o;class i{constructor(t,n,a,c){this._viewportRuler=t,this._document=n,this._platform=a,this._overlayContainer=c}global(){return new Cn}flexibleConnectedTo(t){return new yn(t,this._viewportRuler,this._document,this._platform,this._overlayContainer)}}return(o=i).\u0275fac=function(t){return new(t||o)(e.LFG(D.rL),e.LFG(r.K0),e.LFG(ie.t4),e.LFG(Qe))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),i})(),Sn=0,it=(()=>{var o;class i{constructor(t,n,a,c,_,w,P,Z,Y,se,le,ce){this.scrollStrategies=t,this._overlayContainer=n,this._componentFactoryResolver=a,this._positionBuilder=c,this._keyboardDispatcher=_,this._injector=w,this._ngZone=P,this._document=Z,this._directionality=Y,this._location=se,this._outsideClickDispatcher=le,this._animationsModuleType=ce}create(t){const n=this._createHostElement(),a=this._createPaneElement(n),c=this._createPortalOutlet(a),_=new h(t);return _.direction=_.direction||this._directionality.value,new Le(c,n,a,_,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType)}position(){return this._positionBuilder}_createPaneElement(t){const n=this._document.createElement("div");return n.id="cdk-overlay-"+Sn++,n.classList.add("cdk-overlay-pane"),t.appendChild(n),n}_createHostElement(){const t=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(t),t}_createPortalOutlet(t){return this._appRef||(this._appRef=this._injector.get(e.z2F)),new k(t,this._componentFactoryResolver,this._appRef,this._injector,this._document)}}return(o=i).\u0275fac=function(t){return new(t||o)(e.LFG(K),e.LFG(Qe),e.LFG(e._Vd),e.LFG(Tn),e.LFG(ke),e.LFG(e.zs3),e.LFG(e.R0b),e.LFG(r.K0),e.LFG(R.Is),e.LFG(r.Ye),e.LFG(Ae),e.LFG(e.QbO,8))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),i})();const An={provide:new e.OlP("cdk-connected-overlay-scroll-strategy"),deps:[it],useFactory:function wn(o){return()=>o.scrollStrategies.reposition()}};let Mn=(()=>{var o;class i{}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({providers:[it,An],imports:[R.vT,X,D.Cl,D.Cl]}),i})();var de=d(36028),ot=d(27921),Be=d(83620),Rt=d(93997),_t=d(9769),bt=d(21441),yt=d(57537),vt=d(94664),On=d(836);let Ct=(()=>{var o;class i{constructor(){this._listeners=[]}notify(t,n){for(let a of this._listeners)a(t,n)}listen(t){return this._listeners.push(t),()=>{this._listeners=this._listeners.filter(n=>t!==n)}}ngOnDestroy(){this._listeners=[]}}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),i})();var et=d(92438),qt=d(74911),Dn=d(23889),Tt=d(4300);let st=(()=>{var o;class i{}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275dir=e.lG2({type:o,selectors:[["","cdkMenuGroup",""]],hostAttrs:["role","group",1,"cdk-menu-group"],exportAs:["cdkMenuGroup"],standalone:!0,features:[e._Bn([{provide:Ct,useClass:Ct}])]}),i})();const at=new e.OlP("cdk-menu"),Ie=new e.OlP("cdk-menu-stack"),In={provide:Ie,deps:[[new e.FiY,new e.tp0,new e.tBr(Ie)]],useFactory:o=>o||new rt},En=o=>({provide:Ie,deps:[[new e.FiY,new e.tp0,new e.tBr(Ie)]],useFactory:i=>i||rt.inline(o)});let Fn=0,rt=(()=>{var o;class i{constructor(){this.id=""+Fn++,this._elements=[],this._close=new O.x,this._empty=new O.x,this._hasFocus=new O.x,this.closed=this._close,this.hasFocus=this._hasFocus.pipe((0,ot.O)(!1),(0,Be.b)(0),(0,Rt.x)()),this.emptied=this._empty,this._inlineMenuOrientation=null}static inline(t){const n=new i;return n._inlineMenuOrientation=t,n}push(t){this._elements.push(t)}close(t,n){const{focusNextOnEmpty:a,focusParentTrigger:c}={...n};if(this._elements.indexOf(t)>=0){let _;do{_=this._elements.pop(),this._close.next({item:_,focusParentTrigger:c})}while(_!==t);this.isEmpty()&&this._empty.next(a)}}closeSubMenuOf(t){let n=!1;if(this._elements.indexOf(t)>=0)for(n=this.peek()!==t;this.peek()!==t;)this._close.next({item:this._elements.pop()});return n}closeAll(t){const{focusNextOnEmpty:n,focusParentTrigger:a}={...t};if(!this.isEmpty()){for(;!this.isEmpty();){const c=this._elements.pop();c&&this._close.next({item:c,focusParentTrigger:a})}this._empty.next(n)}}isEmpty(){return!this._elements.length}length(){return this._elements.length}peek(){return this._elements[this._elements.length-1]}hasInlineMenu(){return null!=this._inlineMenuOrientation}inlineMenuOrientation(){return this._inlineMenuOrientation}setHasFocus(t){this._hasFocus.next(t)}}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac}),i})();const lt=new e.OlP("cdk-menu-trigger");let Jt=(()=>{var o;class i{constructor(){this.injector=(0,e.f3M)(e.zs3),this.viewContainerRef=(0,e.f3M)(e.s_b),this.menuStack=(0,e.f3M)(Ie),this.opened=new e.vpe,this.closed=new e.vpe,this.overlayRef=null,this.destroyed=new O.x,this.stopOutsideClicksListener=(0,A.T)(this.closed,this.destroyed)}ngOnDestroy(){this._destroyOverlay(),this.destroyed.next(),this.destroyed.complete()}isOpen(){return!!this.overlayRef?.hasAttached()}registerChildMenu(t){this.childMenu=t}getMenuContentPortal(){return this.menuTemplateRef&&(!this._menuPortal||this.menuTemplateRef!==this._menuPortal?.templateRef)&&(this._menuPortal=new T(this.menuTemplateRef,this.viewContainerRef,this.menuData,this._getChildMenuInjector())),this._menuPortal}isElementInsideMenuStack(t){for(let n=t;n;n=n?.parentElement??null)if(n.getAttribute("data-cdk-menu-stack-id")===this.menuStack.id)return!0;return!1}_destroyOverlay(){this.overlayRef&&(this.overlayRef.dispose(),this.overlayRef=null)}_getChildMenuInjector(){return this._childMenuInjector=this._childMenuInjector||e.zs3.create({providers:[{provide:lt,useValue:this},{provide:Ie,useValue:this.menuStack}],parent:this.injector}),this._childMenuInjector}}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275dir=e.lG2({type:o,hostVars:2,hostBindings:function(t,n){2&t&&e.uIk("aria-controls",null==n.childMenu?null:n.childMenu.id)("data-cdk-menu-stack-id",n.menuStack.id)}}),i})();const ct=new e.OlP("cdk-menu-aim");function $t(o,i){if(!i.isTrusted)return!1;const s=o.nativeElement,t=i.keyCode;return"BUTTON"!==s.nodeName||s.disabled?"A"===s.nodeName&&t===de.K5:t===de.K5||t===de.L_}let Qt=(()=>{var o;class i extends Jt{constructor(){super(),this._elementRef=(0,e.f3M)(e.SBq),this._overlay=(0,e.f3M)(it),this._ngZone=(0,e.f3M)(e.R0b),this._changeDetectorRef=(0,e.f3M)(e.sBO),this._inputModalityDetector=(0,e.f3M)(Tt.QL),this._directionality=(0,e.f3M)(R.Is,{optional:!0}),this._parentMenu=(0,e.f3M)(at,{optional:!0}),this._menuAim=(0,e.f3M)(ct,{optional:!0}),this._setRole(),this._registerCloseHandler(),this._subscribeToMenuStackClosed(),this._subscribeToMouseEnter(),this._subscribeToMenuStackHasFocus(),this._setType()}toggle(){this.isOpen()?this.close():this.open()}open(){!this.isOpen()&&null!=this.menuTemplateRef&&(this.opened.next(),this.overlayRef=this.overlayRef||this._overlay.create(this._getOverlayConfig()),this.overlayRef.attach(this.getMenuContentPortal()),this._changeDetectorRef.markForCheck(),this._subscribeToOutsideClicks())}close(){this.isOpen()&&(this.closed.next(),this.overlayRef.detach(),this._changeDetectorRef.markForCheck()),this._closeSiblingTriggers()}getMenu(){return this.childMenu}_toggleOnKeydown(t){const n="vertical"===this._parentMenu?.orientation;switch(t.keyCode){case de.L_:case de.K5:!(0,de.Vb)(t)&&!$t(this._elementRef,t)&&(this.toggle(),this.childMenu?.focusFirstItem("keyboard"));break;case de.SV:(0,de.Vb)(t)||this._parentMenu&&n&&"rtl"!==this._directionality?.value&&(t.preventDefault(),this.open(),this.childMenu?.focusFirstItem("keyboard"));break;case de.oh:(0,de.Vb)(t)||this._parentMenu&&n&&"rtl"===this._directionality?.value&&(t.preventDefault(),this.open(),this.childMenu?.focusFirstItem("keyboard"));break;case de.JH:case de.LH:(0,de.Vb)(t)||n||(t.preventDefault(),this.open(),t.keyCode===de.JH?this.childMenu?.focusFirstItem("keyboard"):this.childMenu?.focusLastItem("keyboard"))}}_handleClick(){this.toggle(),this.childMenu?.focusFirstItem("mouse")}_setHasFocus(t){this._parentMenu||this.menuStack.setHasFocus(t)}_subscribeToMouseEnter(){this._ngZone.runOutsideAngular(()=>{(0,et.R)(this._elementRef.nativeElement,"mouseenter").pipe((0,H.h)(()=>"touch"!==this._inputModalityDetector.mostRecentModality&&!this.menuStack.isEmpty()&&!this.isOpen()),(0,E.R)(this.destroyed)).subscribe(()=>{const t=()=>this._ngZone.run(()=>{this._closeSiblingTriggers(),this.open()});this._menuAim?this._menuAim.toggle(t):t()})})}_closeSiblingTriggers(){this._parentMenu?!this.menuStack.closeSubMenuOf(this._parentMenu)&&this.menuStack.peek()!==this._parentMenu&&this.menuStack.closeAll():this.menuStack.closeAll()}_getOverlayConfig(){return new h({positionStrategy:this._getOverlayPositionStrategy(),scrollStrategy:this._overlay.scrollStrategies.reposition(),direction:this._directionality||void 0})}_getOverlayPositionStrategy(){return this._overlay.position().flexibleConnectedTo(this._elementRef).withLockedPosition().withGrowAfterOpen().withPositions(this._getOverlayPositions())}_getOverlayPositions(){return this.menuPosition??(this._parentMenu&&"horizontal"!==this._parentMenu.orientation?vn:kt)}_registerCloseHandler(){this._parentMenu||this.menuStack.closed.pipe((0,E.R)(this.destroyed)).subscribe(({item:t})=>{t===this.childMenu&&this.close()})}_subscribeToOutsideClicks(){this.overlayRef&&this.overlayRef.outsidePointerEvents().pipe((0,E.R)(this.stopOutsideClicksListener)).subscribe(t=>{const n=(0,ie.sA)(t),a=this._elementRef.nativeElement;n!==a&&!a.contains(n)&&(this.isElementInsideMenuStack(n)?this._closeSiblingTriggers():this.menuStack.closeAll())})}_subscribeToMenuStackHasFocus(){this._parentMenu||this.menuStack.hasFocus.pipe((0,E.R)(this.destroyed)).subscribe(t=>{t||this.menuStack.closeAll()})}_subscribeToMenuStackClosed(){this._parentMenu||this.menuStack.closed.subscribe(({focusParentTrigger:t})=>{t&&!this.menuStack.length()&&this._elementRef.nativeElement.focus()})}_setRole(){this._parentMenu||this._elementRef.nativeElement.setAttribute("role","button")}_setType(){const t=this._elementRef.nativeElement;"BUTTON"===t.nodeName&&!t.getAttribute("type")&&t.setAttribute("type","button")}}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275dir=e.lG2({type:o,selectors:[["","cdkMenuTriggerFor",""]],hostAttrs:[1,"cdk-menu-trigger"],hostVars:2,hostBindings:function(t,n){1&t&&e.NdJ("focusin",function(){return n._setHasFocus(!0)})("focusout",function(){return n._setHasFocus(!1)})("keydown",function(c){return n._toggleOnKeydown(c)})("click",function(){return n._handleClick()}),2&t&&e.uIk("aria-haspopup",n.menuTemplateRef?"menu":null)("aria-expanded",null==n.menuTemplateRef?null:n.isOpen())},inputs:{menuTemplateRef:["cdkMenuTriggerFor","menuTemplateRef"],menuPosition:["cdkMenuPosition","menuPosition"],menuData:["cdkMenuTriggerData","menuData"]},outputs:{opened:"cdkMenuOpened",closed:"cdkMenuClosed"},exportAs:["cdkMenuTriggerFor"],standalone:!0,features:[e._Bn([{provide:lt,useExisting:o},In]),e.qOj]}),i})(),Ue=(()=>{var o;class i{get disabled(){return this._disabled}set disabled(t){this._disabled=(0,v.Ig)(t)}get hasMenu(){return null!=this._menuTrigger?.menuTemplateRef}constructor(){this._dir=(0,e.f3M)(R.Is,{optional:!0}),this._elementRef=(0,e.f3M)(e.SBq),this._ngZone=(0,e.f3M)(e.R0b),this._inputModalityDetector=(0,e.f3M)(Tt.QL),this._menuAim=(0,e.f3M)(ct,{optional:!0}),this._menuStack=(0,e.f3M)(Ie),this._parentMenu=(0,e.f3M)(at,{optional:!0}),this._menuTrigger=(0,e.f3M)(Qt,{optional:!0,self:!0}),this._disabled=!1,this.triggered=new e.vpe,this._tabindex=-1,this.closeOnSpacebarTrigger=!0,this.destroyed=new O.x,this._setupMouseEnter(),this._setType(),this._isStandaloneItem()&&(this._tabindex=0)}ngOnDestroy(){this.destroyed.next(),this.destroyed.complete()}focus(){this._elementRef.nativeElement.focus()}trigger(t){const{keepOpen:n}={...t};!this.disabled&&!this.hasMenu&&(this.triggered.next(),n||this._menuStack.closeAll({focusParentTrigger:!0}))}isMenuOpen(){return!!this._menuTrigger?.isOpen()}getMenu(){return this._menuTrigger?.getMenu()}getMenuTrigger(){return this._menuTrigger}getLabel(){return this.typeaheadLabel||this._elementRef.nativeElement.textContent?.trim()||""}_resetTabIndex(){this._isStandaloneItem()||(this._tabindex=-1)}_setTabIndex(t){this.disabled||(!t||!this._menuStack.isEmpty())&&(this._tabindex=0)}_onKeydown(t){switch(t.keyCode){case de.L_:case de.K5:!(0,de.Vb)(t)&&!$t(this._elementRef,t)&&this.trigger({keepOpen:t.keyCode===de.L_&&!this.closeOnSpacebarTrigger});break;case de.SV:(0,de.Vb)(t)||this._parentMenu&&this._isParentVertical()&&("rtl"!==this._dir?.value?this._forwardArrowPressed(t):this._backArrowPressed(t));break;case de.oh:(0,de.Vb)(t)||this._parentMenu&&this._isParentVertical()&&("rtl"!==this._dir?.value?this._backArrowPressed(t):this._forwardArrowPressed(t))}}_isStandaloneItem(){return!this._parentMenu}_backArrowPressed(t){const n=this._parentMenu;(this._menuStack.hasInlineMenu()||this._menuStack.length()>1)&&(t.preventDefault(),this._menuStack.close(n,{focusNextOnEmpty:"horizontal"===this._menuStack.inlineMenuOrientation()?1:2,focusParentTrigger:!0}))}_forwardArrowPressed(t){!this.hasMenu&&"horizontal"===this._menuStack.inlineMenuOrientation()&&(t.preventDefault(),this._menuStack.closeAll({focusNextOnEmpty:0,focusParentTrigger:!0}))}_setupMouseEnter(){if(!this._isStandaloneItem()){const t=()=>this._ngZone.run(()=>this._menuStack.closeSubMenuOf(this._parentMenu));this._ngZone.runOutsideAngular(()=>(0,et.R)(this._elementRef.nativeElement,"mouseenter").pipe((0,H.h)(()=>"touch"!==this._inputModalityDetector.mostRecentModality&&!this._menuStack.isEmpty()&&!this.hasMenu),(0,E.R)(this.destroyed)).subscribe(()=>{this._menuAim?this._menuAim.toggle(t):t()}))}}_isParentVertical(){return"vertical"===this._parentMenu?.orientation}_setType(){const t=this._elementRef.nativeElement;"BUTTON"===t.nodeName&&!t.getAttribute("type")&&t.setAttribute("type","button")}}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275dir=e.lG2({type:o,selectors:[["","cdkMenuItem",""]],hostAttrs:["role","menuitem",1,"cdk-menu-item"],hostVars:2,hostBindings:function(t,n){1&t&&e.NdJ("blur",function(){return n._resetTabIndex()})("focus",function(){return n._setTabIndex()})("click",function(){return n.trigger()})("keydown",function(c){return n._onKeydown(c)}),2&t&&(e.Ikx("tabindex",n._tabindex),e.uIk("aria-disabled",n.disabled||null))},inputs:{disabled:["cdkMenuItemDisabled","disabled"],typeaheadLabel:["cdkMenuitemTypeaheadLabel","typeaheadLabel"]},outputs:{triggered:"cdkMenuItemTriggered"},exportAs:["cdkMenuItem"],standalone:!0}),i})();class jn{constructor(i){this._items=i,this.entered=this._getItemPointerEntries(),this.exited=this._getItemPointerExits(),this._destroyed=new O.x,this.entered.subscribe(s=>this.activeElement=s),this.exited.subscribe(()=>{this.previousElement=this.activeElement,this.activeElement=void 0})}destroy(){this._destroyed.next(),this._destroyed.complete()}_getItemPointerEntries(){return(0,qt.P)(()=>this._items.changes.pipe((0,ot.O)(this._items),(0,_t.z)(i=>i.map(s=>(0,et.R)(s._elementRef.nativeElement,"mouseenter").pipe((0,bt.h)(s),(0,E.R)(this._items.changes)))),(0,yt.J)()))}_getItemPointerExits(){return(0,qt.P)(()=>this._items.changes.pipe((0,ot.O)(this._items),(0,_t.z)(i=>i.map(s=>(0,et.R)(s._elementRef.nativeElement,"mouseout").pipe((0,bt.h)(s),(0,E.R)(this._items.changes)))),(0,yt.J)()))}}let $n=0,Lt=(()=>{var o;class i extends st{constructor(){super(...arguments),this.nativeElement=(0,e.f3M)(e.SBq).nativeElement,this.ngZone=(0,e.f3M)(e.R0b),this.menuStack=(0,e.f3M)(Ie),this.menuAim=(0,e.f3M)(ct,{optional:!0,self:!0}),this.dir=(0,e.f3M)(R.Is,{optional:!0}),this.id="cdk-menu-"+$n++,this.orientation="vertical",this.isInline=!1,this.destroyed=new O.x,this._menuStackHasFocus=!1}ngAfterContentInit(){this.isInline||this.menuStack.push(this),this._setKeyManager(),this._subscribeToMenuStackHasFocus(),this._subscribeToMenuOpen(),this._subscribeToMenuStackClosed(),this._setUpPointerTracker()}ngOnDestroy(){this.keyManager?.destroy(),this.destroyed.next(),this.destroyed.complete(),this.pointerTracker?.destroy()}focusFirstItem(t="program"){this.keyManager.setFocusOrigin(t),this.keyManager.setFirstItemActive()}focusLastItem(t="program"){this.keyManager.setFocusOrigin(t),this.keyManager.setLastItemActive()}_getTabIndex(){return this.isInline?this._menuStackHasFocus?-1:0:null}closeOpenMenu(t,n){const{focusParentTrigger:a}={...n},c=this.keyManager,_=this.triggerItem;t===_?.getMenuTrigger()?.getMenu()&&(_?.getMenuTrigger()?.close(),a&&(_?c.setActiveItem(_):c.setFirstItemActive()))}_setKeyManager(){this.keyManager=new Tt.Em(this.items).withWrap().withTypeAhead().withHomeAndEnd(),"horizontal"===this.orientation?this.keyManager.withHorizontalOrientation(this.dir?.value||"ltr"):this.keyManager.withVerticalOrientation()}_subscribeToMenuOpen(){const t=(0,A.T)(this.items.changes,this.destroyed);this.items.changes.pipe((0,ot.O)(this.items),(0,_t.z)(n=>n.filter(a=>a.hasMenu).map(a=>a.getMenuTrigger().opened.pipe((0,bt.h)(a),(0,E.R)(t)))),(0,yt.J)(),(0,vt.w)(n=>(this.triggerItem=n,n.getMenuTrigger().closed)),(0,E.R)(this.destroyed)).subscribe(()=>this.triggerItem=void 0)}_subscribeToMenuStackClosed(){this.menuStack.closed.pipe((0,E.R)(this.destroyed)).subscribe(({item:t,focusParentTrigger:n})=>this.closeOpenMenu(t,{focusParentTrigger:n}))}_subscribeToMenuStackHasFocus(){this.isInline&&this.menuStack.hasFocus.pipe((0,E.R)(this.destroyed)).subscribe(t=>{this._menuStackHasFocus=t})}_setUpPointerTracker(){this.menuAim&&(this.ngZone.runOutsideAngular(()=>{this.pointerTracker=new jn(this.items)}),this.menuAim.initialize(this,this.pointerTracker))}}return(o=i).\u0275fac=function(){let s;return function(n){return(s||(s=e.n5z(o)))(n||o)}}(),o.\u0275dir=e.lG2({type:o,contentQueries:function(t,n,a){if(1&t&&e.Suo(a,Ue,5),2&t){let c;e.iGM(c=e.CRH())&&(n.items=c)}},hostAttrs:["role","menu"],hostVars:4,hostBindings:function(t,n){1&t&&e.NdJ("focus",function(){return n.focusFirstItem()})("focusin",function(){return n.menuStack.setHasFocus(!0)})("focusout",function(){return n.menuStack.setHasFocus(!1)}),2&t&&(e.Ikx("tabindex",n._getTabIndex())("id",n.id),e.uIk("aria-orientation",n.orientation)("data-cdk-menu-stack-id",n.menuStack.id))},inputs:{id:"id"},features:[e.qOj]}),i})(),Bt=(()=>{var o;class i extends Lt{constructor(){super(),this._parentTrigger=(0,e.f3M)(lt,{optional:!0}),this.closed=new e.vpe,this.orientation="vertical",this.isInline=!this._parentTrigger,this.destroyed.subscribe(this.closed),this._parentTrigger?.registerChildMenu(this)}ngAfterContentInit(){super.ngAfterContentInit(),this._subscribeToMenuStackEmptied()}ngOnDestroy(){super.ngOnDestroy(),this.closed.complete()}_handleKeyEvent(t){const n=this.keyManager;switch(t.keyCode){case de.oh:case de.SV:(0,de.Vb)(t)||(t.preventDefault(),n.setFocusOrigin("keyboard"),n.onKeydown(t));break;case de.hY:(0,de.Vb)(t)||(t.preventDefault(),this.menuStack.close(this,{focusNextOnEmpty:2,focusParentTrigger:!0}));break;case de.Mf:(0,de.Vb)(t,"altKey","metaKey","ctrlKey")||this.menuStack.closeAll({focusParentTrigger:!0});break;default:n.onKeydown(t)}}_toggleMenuFocus(t){const n=this.keyManager;switch(t){case 0:n.setFocusOrigin("keyboard"),n.setNextItemActive();break;case 1:n.setFocusOrigin("keyboard"),n.setPreviousItemActive();break;case 2:n.activeItem&&(n.setFocusOrigin("keyboard"),n.setActiveItem(n.activeItem))}}_subscribeToMenuStackEmptied(){this.menuStack.emptied.pipe((0,E.R)(this.destroyed)).subscribe(t=>this._toggleMenuFocus(t))}}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275dir=e.lG2({type:o,selectors:[["","cdkMenu",""]],hostAttrs:["role","menu",1,"cdk-menu"],hostVars:2,hostBindings:function(t,n){1&t&&e.NdJ("keydown",function(c){return n._handleKeyEvent(c)}),2&t&&e.ekj("cdk-menu-inline",n.isInline)},outputs:{closed:"closed"},exportAs:["cdkMenu"],standalone:!0,features:[e._Bn([{provide:st,useExisting:o},{provide:at,useExisting:o},En("vertical")]),e.qOj]}),i})();const Hn=kt.map(o=>{const i="start"===o.overlayX?2:-2,s="top"===o.overlayY?2:-2;return{...o,offsetX:i,offsetY:s}});let zn=(()=>{var o;class i{update(t){i._openContextMenuTrigger!==t&&(i._openContextMenuTrigger?.close(),i._openContextMenuTrigger=t)}}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),i})(),Ut=(()=>{var o;class i extends Jt{get disabled(){return this._disabled}set disabled(t){this._disabled=(0,v.Ig)(t)}constructor(){super(),this._overlay=(0,e.f3M)(it),this._directionality=(0,e.f3M)(R.Is,{optional:!0}),this._contextMenuTracker=(0,e.f3M)(zn),this._disabled=!1,this._setMenuStackCloseListener()}open(t){this._open(t,!1)}close(){this.menuStack.closeAll()}_openOnContextMenu(t){this.disabled||(t.preventDefault(),t.stopPropagation(),this._contextMenuTracker.update(this),this._open({x:t.clientX,y:t.clientY},!0),this.childMenu?.focusFirstItem(2===t.button?"mouse":0===t.button?"keyboard":"program"))}_getOverlayConfig(t){return new h({positionStrategy:this._getOverlayPositionStrategy(t),scrollStrategy:this._overlay.scrollStrategies.reposition(),direction:this._directionality||void 0})}_getOverlayPositionStrategy(t){return this._overlay.position().flexibleConnectedTo(t).withLockedPosition().withGrowAfterOpen().withPositions(this.menuPosition??Hn)}_setMenuStackCloseListener(){this.menuStack.closed.pipe((0,E.R)(this.destroyed)).subscribe(({item:t})=>{t===this.childMenu&&this.isOpen()&&(this.closed.next(),this.overlayRef.detach())})}_subscribeToOutsideClicks(t){if(this.overlayRef){let n=this.overlayRef.outsidePointerEvents();if(t){const[a,c]=(0,Dn.u)(n,({type:_})=>"auxclick"===_);n=(0,A.T)(c,a.pipe((0,On.T)(1)))}n.pipe((0,E.R)(this.stopOutsideClicksListener)).subscribe(a=>{this.isElementInsideMenuStack((0,ie.sA)(a))||this.menuStack.closeAll()})}}_open(t,n){this.disabled||(this.isOpen()?(this.menuStack.closeSubMenuOf(this.childMenu),this.overlayRef.getConfig().positionStrategy.setOrigin(t),this.overlayRef.updatePosition()):(this.opened.next(),this.overlayRef?(this.overlayRef.getConfig().positionStrategy.setOrigin(t),this.overlayRef.updatePosition()):this.overlayRef=this._overlay.create(this._getOverlayConfig(t)),this.overlayRef.attach(this.getMenuContentPortal()),this._subscribeToOutsideClicks(n)))}}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275dir=e.lG2({type:o,selectors:[["","cdkContextMenuTriggerFor",""]],hostVars:1,hostBindings:function(t,n){1&t&&e.NdJ("contextmenu",function(c){return n._openOnContextMenu(c)}),2&t&&e.uIk("data-cdk-menu-stack-id",null)},inputs:{menuTemplateRef:["cdkContextMenuTriggerFor","menuTemplateRef"],menuPosition:["cdkContextMenuPosition","menuPosition"],menuData:["cdkContextMenuTriggerData","menuData"],disabled:["cdkContextMenuDisabled","disabled"]},outputs:{opened:"cdkContextMenuOpened",closed:"cdkContextMenuClosed"},exportAs:["cdkContextMenuTriggerFor"],standalone:!0,features:[e._Bn([{provide:lt,useExisting:o},{provide:Ie,useClass:rt}]),e.qOj]}),i})(),Yn=(()=>{var o;class i{}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[Mn]}),i})();var St=d(72237),Ht=d(6966),ye=d(72500),je=d(90690),ut=d(54807),ze=d(53546),Gn=d(48081),Ce=d(71997),zt=d(28946),_e=d(75187),xt=d(85027),j=d(15861),Ee=d(82668),Te=d(4786),Yt=d(12044),Ye=d(99796),Ge=d(30046),dt=d(61862),Kn=d(61794),Gt=d(60674);class ei{constructor(i,s=(()=>[])){this.executionContext=i,this.modulesList=s,this.interpreter=(0,Kn.R)()}provideCompletionItems(i,s,t,n){const a=this.executionContext(),c=i.getLineContent(s.lineNumber),_=i.getWordUntilPosition(s).word,w=this;function P(){const Y={};return w.modulesList().concat((0,Gt.P0)()).forEach(se=>Y[se]=se),Y}function Z(Y,se){if(!Y)return{suggestions:[]};let le={};if(c.startsWith("import"))le=P();else if(c.startsWith("from")){const ce=c.split(" ");le=ce.length>2?(0,Gt.oz)((0,dt.trim)(ce[1],"\"'")):P()}else le=Array.isArray(Y)?Array.prototype:"string"==typeof Y?String.prototype:Y;return{suggestions:Object.getOwnPropertyNames(le||{}).filter(ce=>!se||ce.indexOf(se)>=0).map(ce=>({label:ce,kind:"function"==typeof Y[ce]?Ee.languages.CompletionItemKind.Function:Ee.languages.CompletionItemKind.Field,insertText:ce}))}}if(c.endsWith(".")){const Y=c.split(".");let se=a;for(let le=0;le<Y.length-1&&(se=se[Y[le]],se);le++);return Z(se,Y[Y.length-1])}return Z(a,_)}resolveCompletionItem(i,s){return null}}var Kt=d(46681);function pt(o,i,s){return o?.length>i?o[i]:s}const Vt=["select","from","where","on","left","inner","full","cross","insert","update","delete","top","go"];class oi{constructor(i,s,t){this.getConnectionName=i,this.getDbObjects=s,this.getFields=t}getFromTables(i){let s=-1;const t={};let n="",a="";for(;++s<i.length;){const _=i[s];("from"===_.toLowerCase()||"join"===_.toLowerCase())&&(n=i[++s],"as"===i[s+1]?.toLowerCase()?(s+=2,a=i[s]):Vt.indexOf(i[s+1]?.toLowerCase())<0&&(a=pt(i,++s,"")),t[a]=n)}return t}workoutFields(i,s){const t=this.getFromTables(s)[i];return this.getFields(this.getConnectionName(),t).then(n=>({suggestions:n.map(c=>({label:c,insertText:c,kind:Ee.languages.CompletionItemKind.Field}))}))}provideCompletionItems(i,s,t,n){const a=i.getValue(),c=function ii(o,i,s){let t=-1;for(;++t<o.length;)if("\n"===o[t]&&i--,1===i)return t+s;return-1}(a,s.lineNumber,s.column),_=function ti(o,i){let s=i-1;const t=[];let n="";for(;++s<o.length;){const a=o[s];!a||"\r"===a||("\n"===a||" "===a||"\t"==a?(n&&t.push(n),n=""):n+=a)}return n&&t.push(n),t}(a,c),w=function ni(o,i){let s=i;const t=[];let n="";for(;--s>=0;){const a=o[s];!a||"\r"===a||("\n"===a||" "===a||"\t"==a?(n&&t.push(n),n=""):n=a+n)}return n&&t.push(n),t}(a,c);if(!this.getConnectionName())return{suggestions:[{label:"ERROR! Please select Connection",documentation:"CONNECTION IS NOT DEFINED. Please select Connection",kind:Ee.languages.CompletionItemKind.Class,insertText:""}]};if(["from","join","into","update"].indexOf(pt(w,0,"").toLowerCase())>=0)return this.getDbObjects(this.getConnectionName()).then(se=>({suggestions:se.map(ce=>({label:ce,insertText:ce,kind:Ee.languages.CompletionItemKind.Struct}))}));if(_.findIndex(se=>"from"===se.toLowerCase())>=0){const se=pt(w,0,""),le=se.endsWith(".")?(0,dt.trim)(se,"."):"";return this.workoutFields(le,_)}const Y=(0,Kt.first)(w,se=>Vt.includes(se.toLowerCase()))?.toLowerCase();if("on"===Y||"where"===Y){const se=pt(w,0,""),le=se.endsWith(".")?(0,dt.trim)(se,"."):"";return this.workoutFields(le,w.map(ce=>ce).reverse())}return{suggestions:[]}}resolveCompletionItem(i,s){return null}}var Fe=d(52929),Wt=d(15575),ge=d(75263),xe=d(33374),we=d(69569);function si(o,i){if(1&o&&(e.TgZ(0,"option",25),e._uU(1),e.qZA()),2&o){const s=i.$implicit;e.Q6J("value",s),e.xp6(1),e.Oqu(s)}}function ai(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"div",20)(1,"label",21),e._uU(2,"Function:"),e.qZA(),e.TgZ(3,"select",22),e.NdJ("change",function(n){e.CHM(s);const a=e.oxw();return e.KtG(a.onQueryParamSelect(n))}),e.TgZ(4,"option",23),e._uU(5,"Select method"),e.qZA(),e.YNc(6,si,2,2,"option",24),e.qZA()()}if(2&o){const s=e.oxw();e.xp6(6),e.Q6J("ngForOf",s.queryParamOptions)}}function ri(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"app-project-access",26),e.NdJ("permissionChanged",function(){e.CHM(s);const n=e.oxw();return e.KtG(n.changed=!0)}),e.qZA()}if(2&o){const s=e.oxw();e.Q6J("config",s.config.app)}}function li(o,i){1&o&&(e.TgZ(0,"div",27)(1,"div",28)(2,"span",29),e._uU(3,"Loading..."),e.qZA()()())}let ci=(()=>{var o;class i{constructor(t,n,a){this.dataService=t,this.dialogRef=n,this.notoficationService=a,this.loading=!1,this.invalid=!1,this.publicCodeAccessLevels=Object.keys(Fe.qB).map(c=>c),this.publicAppAccessLevels=Object.keys(Fe.PF).map(c=>c),this.appInfo={appId:0,appName:"",appOwnerName:"",description:"",publicAccess:"",publicCodeAccess:"",logo:"",title:""},this.changed=!1,this.queryParamsStr=""}ngOnInit(){if(!this.config?.app)throw new Error("config is not initialized");this.contenType=this.config?.tab.tabType,this.appTitle=this.config?.app.title??this.config.app.appName,this.filePath=this.config.tab.queryParams.file,this.url=this.getContentLink(),this.queryParamOptions=this.getQueryParamOptions()}onClose(){this.dialogRef.close()}onCopy(){this.url&&navigator.clipboard.writeText(this.url)}onOpen(){this.url&&window.open(this.url,"_blank")}saveAppProject(){var t=this;return(0,j.Z)(function*(){if(!t.config)throw new Error("config is not initialized");t.loading=!0;try{const n=t.config.app;n.appName?(t.appInfo.appId=n.appId,t.appInfo.title=n.title,t.appInfo.description=n.description,t.appInfo.appOwnerName=n.appOwner,t.appInfo.publicAccess=t.accessComponent?.publicAccess,t.appInfo.publicCodeAccess=t.accessComponent?.publicCodeAccess,t.appInfo.appName=n.appName,yield t.dataService.updateApp(t.appInfo),t.changed=!1,yield t.dataService.loadMyAppsLinks(!0),t.notoficationService.success(`App '${n.appName}' updated.`)):t.notoficationService.error("App Name cannot be empty")}catch(n){t.notoficationService.error(n)}finally{t.loading=!1}})()}onQueryParamSelect(t){if("jspy"===this.contenType){const n=t.target.value;this.queryParamsStr=n?`?method=${n}`:"",this.url=this.getContentLink()}}getContentLink(){if(!this.config?.tab)return"No tab";const{tabParams:t,queryParams:n}=this.config?.tab;return`${location.origin}/content/${t.owner}/${t.name}/${n.file}${this.queryParamsStr}`}getQueryParamOptions(){if("jspy"===this.contenType)return(this.config?.tab.content).contentEditor?.jspyFunctions}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(ge.UW),e.Y36(xe.z),e.Y36(we.g))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-project-share"]],viewQuery:function(t,n){if(1&t&&e.Gf(Wt.m,5),2&t){let a;e.iGM(a=e.CRH())&&(n.accessComponent=a.first)}},inputs:{config:"config"},decls:28,vars:7,consts:[["autocomplete","off",1,"d-flex","flex-column","h-200"],[1,"modal-header","d-flex","flex-row"],[1,"modal-title","flex-fill"],[1,"file-path"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body","px-4","d-flex","flex-column","h-100","overflow-hidden"],[1,"row","mr-0","mb-2","mt-2"],["for","link",1,"col-1","col-form-label","py-1"],["disabled","disabled",1,"form-control","col","form-control-sm",3,"value"],["type","button",1,"btn","btn-outline-primary","btn-sm","align-self-baseline","ml-2",3,"click"],[1,"fa","fa-copy","my-0"],[1,"fa","fa-share","my-0"],["class","row mr-0 mb-2",4,"ngIf"],["class","pt-3 mt-3",3,"config","permissionChanged",4,"ngIf"],[1,"modal-footer","flex-column"],[1,"row","w-100","mx-0","px-0"],["type","button",1,"btn","btn-light",3,"click"],["type","submit",1,"btn","btn-primary","ml-auto",3,"disabled","click"],["class","d-flex justify-content-center position-absolute align-items-center w-100 h-100 spinner flex-column",4,"ngIf"],[1,"row","mr-0","mb-2"],[1,"col-2","col-form-label","py-1"],[1,"form-control","form-control-sm","col",3,"change"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"pt-3","mt-3",3,"config","permissionChanged"],[1,"d-flex","justify-content-center","position-absolute","align-items-center","w-100","h-100","spinner","flex-column"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(t,n){1&t&&(e.TgZ(0,"div")(1,"div",0)(2,"div",1)(3,"h4",2),e._uU(4),e.TgZ(5,"span",3),e._uU(6),e.qZA()(),e.TgZ(7,"button",4),e.NdJ("click",function(){return n.onClose()}),e.TgZ(8,"span",5),e._uU(9,"\xd7"),e.qZA()()(),e.TgZ(10,"div",6)(11,"div",7)(12,"label",8),e._uU(13,"Link:"),e.qZA(),e._UZ(14,"input",9),e.TgZ(15,"button",10),e.NdJ("click",function(){return n.onCopy()}),e._UZ(16,"i",11),e.qZA(),e.TgZ(17,"button",10),e.NdJ("click",function(){return n.onOpen()}),e._UZ(18,"i",12),e.qZA()(),e.YNc(19,ai,7,1,"div",13),e.YNc(20,ri,1,1,"app-project-access",14),e.qZA(),e.TgZ(21,"div",15)(22,"div",16)(23,"button",17),e.NdJ("click",function(){return n.onClose()}),e._uU(24,"Cancel"),e.qZA(),e.TgZ(25,"button",18),e.NdJ("click",function(){return n.saveAppProject()}),e._uU(26,"Save"),e.qZA()()()()(),e.YNc(27,li,4,0,"div",19)),2&t&&(e.xp6(4),e.hij("App / Project: ",n.appTitle," "),e.xp6(2),e.hij("File: ",n.filePath,""),e.xp6(8),e.Q6J("value",n.url),e.xp6(5),e.Q6J("ngIf","jspy"===n.contenType&&(null==n.queryParamOptions?null:n.queryParamOptions.length)),e.xp6(1),e.Q6J("ngIf",n.config),e.xp6(5),e.Q6J("disabled",!n.changed),e.xp6(2),e.Q6J("ngIf",n.loading))},dependencies:[r.sg,r.O5,u.YN,u.Kr,Wt.m],styles:[".file-path[_ngcontent-%COMP%]{font-size:medium}app-project-access[_ngcontent-%COMP%]{border-top:1px solid}"]}),i})();var Se=d(8050),ui=d(55629),tt=d(99397),Re=d(612),wt=d(65619),Xt=d(52572),Ne=d(16321),At=d(37398),Oe=d(22263),fe=d(21473);const di=["jspy","js","json","app.xml","page.xml","component.xml","table","procedure","query"];function en(o){return{"page.xml":"fa-file-code-o","component.xml":"fa-file-code-o",jspy:"fa-file-text-o","app.xml":"fa-file-o",query:"fa-code",js:"fa-code",json:"fa-code",sql:"fa-table"}[o]||"fa-question"}class pi{init(i){const s=document.createElement("div"),t=i.value,n=i.data?en(i.data?.contentPath.contentType):"fa-folder-o";s.innerHTML=`<span><i class="fa ${n} mr-1"></i>\n            <span class="filename"></span>${t}</span>`,this.eGui=s.firstChild}getGui(){return this.eGui}refresh(){return!1}}function hi(o){const i=o.folder?(0,dt.replaceAll)(o.folder,"/","\\").split("\\"):[];return i.push(`${o.name}.${o.contentType}`),i}function tn(o){const i=o.allLeafChildren.filter(s=>s!==o);return i?.length?(0,Kt.flatten)(i.map(s=>tn(s))):o.data?[o.data]:[]}function nn(o){return{fileKey:(0,fe.Js)(o),filePath:hi(o),fileName:`${o.name}.${o.contentType}`,contentPath:o}}var mi=d(64716),gi=d(56861);const _i=["folder"];let on=(()=>{var o;class i{constructor(t,n,a){this.dialogRef=t,this.dataService=n,this.dialogService=a,this.config={},this.contentTypes=di,this.saveAppLink={appContent:{contentType:"",folder:"",name:""},appName:"",appOwnerName:""},this.title="",this.apps=[],this.appNames=[],this.appName="",this.loading=!1}ngOnInit(){var t=this;return(0,j.Z)(function*(){if(t.apps=yield t.dataService.loadMyAppsLinks(),t.appNames=t.apps.map(n=>n.appOwner+"."+n.appName),t.appNames.push("-- Create New App --"),t.saveAppLink.appContent={...t.config.link},t.config.app&&(t.saveAppLink.appName=t.config.app.appName,t.saveAppLink.appOwnerName=t.config.app.appOwner,t.app=t.config.app),t.config.link){const{folder:n,name:a,contentType:c}=t.config.link;t.title=`Rename file: ${n||""}/${a}.${c}`}t.appName=t.config.app.appOwner+"."+t.config.app.appName,t.initFoldersAutocomplete()})()}onSave(){var t=this;return(0,j.Z)(function*(){if("-- Create New App --"===t.saveAppLink.appName){const n=yield t.dialogService.open(gi.b,{initialState:{config:{appName:"NewApp"}}}).onCloseAsync();t.saveAppLink.appName=n,t.dialogRef.close({...t.saveAppLink})}else t.isValid()&&t.dialogRef.close({...t.saveAppLink})})()}onClose(){this.dialogRef.close()}onAppSeclect(t){const n=t.split(".");"-- Create New App --"!==t?t?(this.saveAppLink.appOwnerName=n[0],this.saveAppLink.appName=n[1]):(this.saveAppLink.appOwnerName="",this.saveAppLink.appName=""):this.saveAppLink.appName="-- Create New App --"}initFoldersAutocomplete(){if(!this.folderInput?.nativeElement)throw new Error("folderInput?.nativeElement is not initialized ");const t=this.folderInput.nativeElement;t.setAttribute("autocomplete","on");const n=document.createElement("DATALIST");n.id="list-of-folders",t.setAttribute("list",n.id),t.parentNode?.insertBefore(n,t),n.innerHTML=this.config.folders?.map(a=>`<option value="${a}">`).join("")}isValid(){return!(!this.saveAppLink.appContent.name||!this.saveAppLink.appName)}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(xe.z),e.Y36(ge.UW),e.Y36(xe.x))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-file-dialog"]],viewQuery:function(t,n){if(1&t&&e.Gf(_i,7),2&t){let a;e.iGM(a=e.CRH())&&(n.folderInput=a.first)}},inputs:{config:"config"},decls:29,vars:8,consts:[[3,"ngSubmit"],["form","ngForm"],[1,"modal-header"],[1,"modal-title","pull-left"],[1,"modal-body","px-4","d-flex","flex-column","h-100","overflow-hidden"],[1,"row","mr-0","mb-2"],["for","type",1,"col-3","col-form-label"],["appendTo","body","name","app","required","","placeholder","Select content type",1,"col","px-0","auto-grow",3,"ngModel","items","change"],["for","folder",1,"col-3","col-form-label"],["name","folder",1,"form-control","col",3,"ngModel","ngModelChange"],["folder",""],["for","name",1,"col-3","col-form-label"],["name","name","required","",1,"form-control","col",3,"ngModel","ngModelChange"],[1,"row","mr-0","mb-4"],["appendTo","body","name","type","required","","placeholder","Select content type",1,"col","px-0","auto-grow",3,"items","ngModel","ngModelChange"],[1,"modal-footer"],[1,"row","w-100","mx-0","px-0"],["type","submit",1,"btn","btn-primary","ml-auto","mr-2","fx-80",3,"disabled"],["type","button",1,"btn","btn-light","fx-80",3,"click"]],template:function(t,n){if(1&t&&(e.TgZ(0,"form",0,1),e.NdJ("ngSubmit",function(){return n.onSave()}),e.TgZ(2,"div",2)(3,"h4",3),e._uU(4),e.qZA()(),e.TgZ(5,"div",4)(6,"div",5)(7,"label",6),e._uU(8,"Application"),e.qZA(),e.TgZ(9,"ng-select",7),e.NdJ("change",function(c){return n.onAppSeclect(c)}),e.qZA()(),e.TgZ(10,"div",5)(11,"label",8),e._uU(12,"Folder"),e.qZA(),e.TgZ(13,"input",9,10),e.NdJ("ngModelChange",function(c){return n.saveAppLink.appContent.folder=c}),e.qZA()(),e.TgZ(15,"div",5)(16,"label",11),e._uU(17,"Name"),e.qZA(),e.TgZ(18,"input",12),e.NdJ("ngModelChange",function(c){return n.saveAppLink.appContent.name=c}),e.qZA()(),e.TgZ(19,"div",13)(20,"label",6),e._uU(21,"File Type"),e.qZA(),e.TgZ(22,"ng-select",14),e.NdJ("ngModelChange",function(c){return n.saveAppLink.appContent.contentType=c}),e.qZA()()(),e.TgZ(23,"div",15)(24,"div",16)(25,"button",17),e._uU(26,"Save"),e.qZA(),e.TgZ(27,"button",18),e.NdJ("click",function(){return n.onClose()}),e._uU(28,"Cancel"),e.qZA()()()()),2&t){const a=e.MAs(1);e.xp6(4),e.Oqu(n.title),e.xp6(5),e.Q6J("ngModel",n.appName)("items",n.appNames),e.xp6(4),e.Q6J("ngModel",n.saveAppLink.appContent.folder),e.xp6(5),e.Q6J("ngModel",n.saveAppLink.appContent.name),e.xp6(4),e.Q6J("items",n.contentTypes)("ngModel",n.saveAppLink.appContent.contentType),e.xp6(3),e.Q6J("disabled",!a.valid||!n.saveAppLink.appName)}},dependencies:[u._Y,u.Fj,u.JJ,u.JL,u.Q7,u.On,u.F,ut.w9]}),i})();var bi=d(36232);let sn=(()=>{var o;class i{constructor(t,n,a,c,_){this.notificationService=t,this.dataStudioService=n,this.dataService=a,this.tabsService=c,this.dialogService=_,this.saving$=new O.x}init(t){this.gridApi=t}deleteNode(t){var n=this;return(0,j.Z)(function*(){if(!t)return;const a=function fi(o){const i=o.data;return`Delete ${o.group?"folder":"file"} ${i?.fileKey??o.key}`}(t),c=tn(t);if(yield n.notificationService.confirmation(a))try{n.saving$.next(!0),yield Promise.all(c.map(P=>n.dataService.deleteAppContent({appOwnerName:n.dataStudioService.currentApp.appOwner,appName:n.dataStudioService.currentApp.appName,appContent:P.contentPath}))),n.notificationService.success(`Deleted: ${c.map(P=>(0,fe.Js)(P.contentPath)).join(", ")}`);const w=t.group?t.allLeafChildren:[t];n.gridApi?.applyTransaction({remove:w.map(P=>P.data).filter(P=>!!P)}),n.tabsService.removeAppTabs(n.dataStudioService.currentApp,c.map(P=>P.contentPath))}catch(w){n.notificationService.error(w)}finally{n.saving$.next(!1)}})()}renameNode(t){const n=t.data;if(!n)return bi.E;const a={link:n.contentPath,folders:this.getFoldersList(t),app:this.dataStudioService.currentApp};return this.dialogService.open(on,{initialState:{config:a}}).onClose$.pipe((0,H.h)(c=>c&&t.data),(0,tt.b)(()=>this.saving$.next(!0)),(0,vt.w)(c=>this.dataService.saveAppContent(c).then(()=>nn(c.appContent))),(0,tt.b)(c=>{t.data=c,this.gridApi?.applyTransaction({update:[t.data]})}),(0,At.U)(()=>t),(0,mi.x)(()=>this.saving$.next(!1)))}getFoldersList(t){const n=t.allLeafChildren;return Array.from(new Set(n?.map(a=>a.data?.filePath).filter(a=>!!a)))}}return(o=i).\u0275fac=function(t){return new(t||o)(e.LFG(we.g),e.LFG(Ce.F),e.LFG(ge.UW),e.LFG(Se.x),e.LFG(xe.x))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac}),i})();var an=d(40092),Mt=d(26671);function yi(o,i){1&o&&(e.TgZ(0,"div",2)(1,"div",3)(2,"span",4),e._uU(3,"Loading..."),e.qZA()()())}let rn=(()=>{var o;class i{constructor(t,n,a,c,_,w){this.route=t,this.router=n,this.dataStudioService=a,this.dataService=c,this.tabsService=_,this.appTreeService=w,this.isReadOnly=!1,this.loading$=new O.x,this.saving$=this.appTreeService.saving$,this.destroy$=new O.x,this.rowData$=new wt.X([]),this.gridConfig={suppressContextMenu:!1,rowSelection:"single",getContextMenuItems:this.getContextMenuItems.bind(this)},this.groupDefaultExpanded=-1,this.getDataPath=P=>P.filePath,this.defaultColDef={flex:1},this.autoGroupColumnDef={minWidth:330,cellRendererParams:{suppressCount:!0,innerRenderer:pi}}}onGridReady(t){this.gridApi=t.api,this.gridApi.setHeaderHeight(0),this.gridApi.setGroupHeaderHeight(0),this.appTreeService.init(this.gridApi)}ngOnInit(){this.dataStudioService.currentApp$.pipe((0,E.R)(this.destroy$)).subscribe(t=>this.onAppChanged(t)),this.dataStudioService.appContentAdded$.pipe((0,E.R)(this.destroy$)).subscribe(t=>{this.onAppChanged(this.dataStudioService.currentApp)}),(0,Xt.a)([this.tabsService.activeTab$,this.loading$.pipe((0,Be.b)(100))]).pipe((0,E.R)(this.destroy$),(0,H.h)(([t,n])=>!1===n)).subscribe(([t])=>{if(this.gridApi&&"app"===t?.tabParams.appOrSql){const n=(0,fe.tT)(t.queryParams.file);(0,an.JE)(this.gridApi,a=>a.fileKey===(0,fe.Js)(n))}else this.gridApi?.deselectAll()})}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete()}refreshAppFiles(t){var n=this;return(0,j.Z)(function*(){yield n.onAppChanged(t)})()}onAppChanged(t){var n=this;return(0,j.Z)(function*(){if(!t)return;n.loading$.next(!0);const a=(yield n.dataService.loadAppFileLinks(t.appOwner,t.appName,!0)).map(nn);n.rowData$.next(a),n.loading$.next(!1)})()}onCellClicked(t){var n=this;return(0,j.Z)(function*(){const a=t.data;a&&n.selectTreeItem(a)})()}selectTreeItem(t){if(!t)return;const{appOwner:n,appName:a}=this.dataStudioService.currentApp,c=(0,fe.Js)(t.contentPath);this.router.navigate(["data-studio/app",n||Oe.m5,a||Oe.b5],{queryParams:{file:c,tab:this.route.snapshot.queryParams.tab}})}getContextMenuItems(t){if(!t.node)return[];const n=t.node;return[{name:"Rename",action:()=>this.renameFile(n)},{name:"Delete",action:()=>this.appTreeService.deleteNode(n)}]}renameFile(t){const n=t.isSelected(),a=this.rowData$.getValue(),c=t.data,_=a.indexOf(c),w=t.rowIndex;this.appTreeService.renameNode(t).pipe((0,H.h)(P=>!!P?.data),(0,At.U)(P=>P)).subscribe(P=>{const Z=P.data;a[_]=Z,this.rowData$.next([...a]),Ne.z.schedule(()=>{this.gridApi?.ensureIndexVisible(w,"middle"),n&&(this.selectTreeItem(Z),this.tabsService.removeAppTabs(this.dataStudioService.currentApp,[c.contentPath]))})})}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(_e.gz),e.Y36(_e.F0),e.Y36(Ce.F),e.Y36(Mt.U),e.Y36(Se.x),e.Y36(sn))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tree"]],inputs:{isReadOnly:"isReadOnly"},features:[e._Bn([sn])],decls:5,vars:15,consts:[[1,"w-100","h-100","p-2","ag-theme-balham","ws-ag-tree",3,"gridOptions","defaultColDef","autoGroupColumnDef","rowData","treeData","animateRows","groupDefaultExpanded","getDataPath","cellClicked","gridReady"],["class","d-flex justify-content-center position-absolute align-items-center w-100 h-100 spinner",4,"ngIf"],[1,"d-flex","justify-content-center","position-absolute","align-items-center","w-100","h-100","spinner"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(t,n){1&t&&(e.TgZ(0,"ag-grid-angular",0),e.NdJ("cellClicked",function(c){return n.onCellClicked(c)})("gridReady",function(c){return n.onGridReady(c)}),e.ALo(1,"async"),e.qZA(),e.YNc(2,yi,4,0,"div",1),e.ALo(3,"async"),e.ALo(4,"async")),2&t&&(e.Q6J("gridOptions",n.gridConfig)("defaultColDef",n.defaultColDef)("autoGroupColumnDef",n.autoGroupColumnDef)("rowData",e.lcZ(1,9,n.rowData$))("treeData",!0)("animateRows",!0)("groupDefaultExpanded",n.groupDefaultExpanded)("getDataPath",n.getDataPath),e.xp6(2),e.Q6J("ngIf",e.lcZ(3,11,n.loading$)||e.lcZ(4,13,n.saving$)))},dependencies:[r.O5,ze.N8,r.Ov],styles:['[_ngcontent-%COMP%]:root{--bg: #fff;--body-bg: #e4e5e6;--header-bg: #ebedef;--color: #4f5d73;--border-color: #c4c9d0;--ws-alt: #f7f7f7;--form-input-bg: #fff;--form-input-color: #768192;--nav-link-color: #8a93a2;--secondary-color: #c4c9d0;--opacity: .05;--hover: "#f0f3f5"}[_nghost-%COMP%]{display:block;position:relative}']}),i})();var vi=d(85965),Ci=d(10217),Ke=d(1238),Ve=d(13509),Ti=d(41490);let Ot=(()=>{var o;class i{constructor(t,n,a,c){this.notificationService=t,this.fileManagerService=n,this.dataService=a,this.accountService=c}downloadLinks(t,n,a,c){var _=this;return(0,j.Z)(function*(){const w=new vi;try{if(n){var P=Oe.Ie;P=(P=(P=P.replace("@appName",t.appName)).replace("@appDescription",t.description)).replace("@appOwner",t.appOwner),w.file("package.json",P)}if(a){var Z=Oe.xM;Z=(Z=Z.replace("@appName",t.appName)).replace("@appDescription",t.description),w.file("readme.md",Z)}if(c){let le=Oe.n8;le=le.replace("@baseUrl",Ke.Z.worksheetsApi),le=le.replace("@apiAccessToken",(yield _.accountService.showAccessToken()).accessToken),w.file("app.js",le)}const Y=yield w.generateAsync({type:"blob"});(0,Ci.saveAs)(Y,`${t.appOwner}-${t.appName}.zip`)}catch(Y){_.notificationService.error(Y)}})()}appContentToAppContentPost(t,n){return{appName:t.appName,appOwnerName:t.appOwner,appContent:n}}uploadApp(t){var n=this;return(0,j.Z)(function*(){var a=yield n.fileManagerService.importAppContents();const c=yield n.dataService.loadAppFileLinks(t.appOwner,t.appName);var _=a.find(ce=>"app.xml"===ce.contentType)?.folder||"";if(_){const ce=_.length+1;for(var w of a=a.filter(ve=>ve.folder?.startsWith(_)))w.folder=w.folder?.substring(ce)}const P=a.map(ce=>(0,fe.Js)(ce)),Z=c.filter(ce=>!P.includes((0,fe.Js)(ce)));try{var le;yield Promise.all(Z.map(ve=>n.dataService.deleteAppContent(n.appContentToAppContentPost(t,ve)))),yield Promise.all(a.map(function(ve){return(le=le||(0,j.Z)(function*(gt){return n.appContentToAppContentPost(t,gt)})).apply(this,arguments)})),n.notificationService.success(`${t.appOwner}/${t.appName}: deleted ${Z.length}, added 0, updated 0 files.`)}catch(ce){n.notificationService.error(ce)}})()}}return(o=i).\u0275fac=function(t){return new(t||o)(e.LFG(we.g),e.LFG(Ve.j5),e.LFG(ge.UW),e.LFG(Ti.B))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),i})();function Si(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"div")(1,"div",2)(2,"h4",3),e._uU(3,"Download App/Project"),e.qZA()(),e.TgZ(4,"div",4)(5,"div",5)(6,"label",6),e._uU(7,"Place code in 'src' folder"),e.qZA(),e.TgZ(8,"input",7),e.NdJ("ngModelChange",function(n){e.CHM(s);const a=e.oxw();return e.KtG(a.checkSrc=n)}),e.qZA()(),e.TgZ(9,"div",5)(10,"label",6),e._uU(11,"Include 'package.json'"),e.qZA(),e.TgZ(12,"input",7),e.NdJ("ngModelChange",function(n){e.CHM(s);const a=e.oxw();return e.KtG(a.checkPackageJson=n)}),e.qZA()(),e.TgZ(13,"div",5)(14,"label",6),e._uU(15,"Include 'readme.md'"),e.qZA(),e.TgZ(16,"input",7),e.NdJ("ngModelChange",function(n){e.CHM(s);const a=e.oxw();return e.KtG(a.checkReadmeMd=n)}),e.qZA()(),e.TgZ(17,"div",5)(18,"label",6),e._uU(19),e.qZA(),e.TgZ(20,"input",8),e.NdJ("ngModelChange",function(n){e.CHM(s);const a=e.oxw();return e.KtG(a.checkAppJs=n)}),e.qZA()()(),e.TgZ(21,"div",9)(22,"button",10),e.NdJ("click",function(){e.CHM(s);const n=e.oxw();return e.KtG(n.downloadApp())}),e._uU(23,"Download App"),e.qZA(),e.TgZ(24,"button",11),e.NdJ("click",function(){e.CHM(s);const n=e.oxw();return e.KtG(n.onClose())}),e._uU(25,"Cancel"),e.qZA()()()}if(2&o){const s=e.oxw();e.xp6(8),e.Q6J("ngModel",s.checkSrc),e.xp6(4),e.Q6J("ngModel",s.checkPackageJson),e.xp6(4),e.Q6J("ngModel",s.checkReadmeMd),e.xp6(3),e.hij(" ",s.hasAppJs?"Override with ":"Include"," default 'app.js'"),e.xp6(1),e.Q6J("ngModel",s.checkAppJs)}}function xi(o,i){1&o&&(e.TgZ(0,"div",12)(1,"div",13)(2,"span",14),e._uU(3,"..."),e.qZA()()())}let wi=(()=>{var o;class i{constructor(t,n,a){this.dialogRef=t,this.appUploaderService=n,this.notoficationService=a,this.app={},this.checkSrc=!0,this.checkPackageJson=!0,this.checkReadmeMd=!0,this.checkAppJs=!1,this.hasAppJs=!1,this.loading=!1}ngOnInit(){this.checkAppJs=!this.hasAppJs}downloadApp(){var t=this;return(0,j.Z)(function*(){t.loading=!0;try{yield t.appUploaderService.downloadLinks(t.app,[],t.checkPackageJson,t.checkReadmeMd),t.dialogRef.close()}catch(n){t.notoficationService.error(n)}finally{t.loading=!1}})()}onClose(){this.dialogRef.close()}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(xe.z),e.Y36(Ot),e.Y36(we.g))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-download-app-dialog"]],inputs:{app:"app"},decls:2,vars:2,consts:[[4,"ngIf"],["class","d-flex justify-content-center position-absolute align-items-center w-100 h-100 spinner flex-column",4,"ngIf"],[1,"modal-header"],[1,"modal-title","pull-left"],[1,"modal-body","px-4","d-flex","flex-column"],[1,"row","mr-0","mb-2","form-check","justify-content-center"],["for","flexCheckChecked",1,"col","form-check-label"],["type","checkbox","checked","",1,"form-check-input",3,"ngModel","ngModelChange"],["type","checkbox",1,"form-check-input",3,"ngModel","ngModelChange"],[1,"modal-footer"],[1,"btn","btn-primary","ml-auto","mr-2","fx-80",3,"click"],["type","button",1,"btn","btn-light","fx-80",3,"click"],[1,"d-flex","justify-content-center","position-absolute","align-items-center","w-100","h-100","spinner","flex-column"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(t,n){1&t&&(e.YNc(0,Si,26,5,"div",0),e.YNc(1,xi,4,0,"div",1)),2&t&&(e.Q6J("ngIf",!n.loading),e.xp6(1),e.Q6J("ngIf",n.loading))},dependencies:[r.O5,u.Wl,u.JJ,u.On]}),i})();var We=d(55314);const Ai=function(o,i){return["/data-studio/app",o,i]};function Mi(o,i){if(1&o&&(e.TgZ(0,"li")(1,"a",7),e._uU(2),e.qZA()()),2&o){const s=i.$implicit;e.xp6(1),e.Q6J("routerLink",e.WLB(3,Ai,s.appOwner,s.appName)),e.xp6(1),e.AsE("",s.appName," (",s.appOwner,")")}}function Oi(o,i){if(1&o&&(e.TgZ(0,"ul",5),e.YNc(1,Mi,3,6,"li",6),e.qZA()),2&o){const s=e.oxw();e.xp6(1),e.Q6J("ngForOf",s.apps)}}let Di=(()=>{var o;class i{constructor(t,n){this.appsState=t,this.dataService=n,this.destroy$=new O.x,n.appsList$.pipe((0,E.R)(this.destroy$)).subscribe(a=>this.apps=a)}ngOnInit(){var t=this;return(0,j.Z)(function*(){yield t.dataService.loadMyAppsLinks()})()}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete()}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(Ce.F),e.Y36(ge.UW))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-selection"]],decls:7,vars:3,consts:[["dropdown","","container","body"],["id","basic-link","dropdownToggle","","aria-controls","basic-link-dropdown",1,"btn","btn-link","dropdown-toggle","btn-sm","pl-0","cursor-pointer","border-0",3,"click"],[1,"d-inline-block","m-0"],[1,"caret"],["id","basic-link-dropdown","class","dropdown-menu","role","menu","aria-labelledby","basic-link",4,"dropdownMenu"],["id","basic-link-dropdown","role","menu","aria-labelledby","basic-link",1,"dropdown-menu"],[4,"ngFor","ngForOf"],[1,"dropdown-item",3,"routerLink"]],template:function(t,n){if(1&t&&(e.TgZ(0,"span",0)(1,"a",1),e.NdJ("click",function(c){return c.stopImmediatePropagation()}),e.TgZ(2,"h5",2),e._uU(3),e.ALo(4,"async"),e._UZ(5,"span",3),e.qZA()(),e.YNc(6,Oi,2,1,"ul",4),e.qZA()),2&t){let a;e.xp6(3),e.hij(" ",(null==(a=e.lcZ(4,1,n.appsState.currentApp$))?null:a.appName)||"Select application","")}},dependencies:[r.sg,_e.rH,ye.Hz,ye.Mq,ye.TO,r.Ov]}),i})();class Ii{init(i){const s=document.createElement("div"),t=i.value,n=function Fi(o){return o?.objectType?Ei[o.objectType]??"fa-question":"fa-question"}(i.data);s.innerHTML=`<span><i class="fa ${n} mx-1"></i>\n            <span class="filename"></span>${t}</span>`,this.eGui=s.firstChild}getGui(){return this.eGui}refresh(){return!1}}const Ei={[Te.HA.Table]:"fa-table",[Te.HA.View]:"fa-file-text-o",[Te.HA.Procedure]:"fa-code",[Te.HA.Function]:"fa-code"};var qe=d(90271);function Pi(o,i){if(1&o&&(e.TgZ(0,"option",8),e._uU(1),e.qZA()),2&o){const s=i.$implicit;e.Q6J("value",s.connectionName),e.xp6(1),e.hij("",s.connectionName," ")}}function Ni(o,i){if(1&o&&(e.TgZ(0,"alert",9)(1,"strong"),e._uU(2,"Error:"),e.qZA(),e._uU(3),e.qZA()),2&o){const s=e.oxw();e.xp6(3),e.hij("",s.error," ")}}function ki(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"div",10)(1,"div",11)(2,"span",12),e._uU(3,"Loading..."),e.qZA()(),e.TgZ(4,"i",13),e.NdJ("click",function(){e.CHM(s);const n=e.oxw();return e.KtG(n.onCancel())}),e.qZA()()}}let Zi=(()=>{var o;class i{constructor(t,n,a,c,_,w){this.sqlMetaService=t,this.connectionsService=n,this.tabsService=a,this.studioService=c,this.commands=_,this.router=w,this.destroy$=new O.x,this.cancelLoading=!1,this.loading$=new O.x,this.rowData$=new wt.X([]),this.gridConfig={columnDefs:[{field:"objectType",rowGroup:!0,hide:!0},{field:"objectName",flex:1,cellRenderer:Ii,cellClass:"group-padding"}],getContextMenuItems:this.getContextMenuItems.bind(this),overlayNoRowsTemplate:'<div class="ag-overlay-loading-center">Select connection with DB objects</div>'}}onGridReady(t){this.gridApi=t.api,this.gridApi.setHeaderHeight(0),this.gridApi.setGroupHeaderHeight(0)}onChangeConnection(){var t=this;return(0,j.Z)(function*(){if(t.currentConnection){t.loading$.next(!0),t.rowData$.next([]),t.error=void 0;try{const n=yield t.sqlMetaService.getObjects(t.currentConnection,!0);t.cancelLoading||t.rowData$.next(n)}catch(n){t.cancelLoading||(t.error=(0,fe.e$)(n))}finally{t.cancelLoading=!1,t.loading$.next(!1)}}})()}onCellClicked(t){var n=this;return(0,j.Z)(function*(){return!!t.data&&n.selectDbItem(t.data)})()}ngOnInit(){var n,a,t=this;this.connectionsService.loadMyDbConnections(),this.connectionsService.dbConnectionsList$.pipe((0,E.R)(this.destroy$)).subscribe(c=>{this.dbConnectionsList=c}),this.studioService.dbItemAdded$.subscribe(function(c){return(n=n||(0,j.Z)(function*(_){yield t.connectionsService.loadMyDbConnections(!0),yield t.onChangeConnection(),t.selectDbLink(_)})).apply(this,arguments)}),this.tabsService.activeTab$.pipe((0,E.R)(this.destroy$)).subscribe(function(c){return(a=a||(0,j.Z)(function*(_){if("sql"===_?.tabParams.appOrSql){const w=(0,Ge.jE)(_.tabParams);t.currentConnection!==w?.connectionName&&(t.currentConnection=w?.connectionName,yield t.onChangeConnection()),t.selectDbLink(w)}else t.gridApi&&t.gridApi.deselectAll()})).apply(this,arguments)})}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete()}onCancel(){this.currentConnection=void 0,this.loading$.next(!1),this.cancelLoading=!0}selectDbLink(t){this.gridApi&&(0,an.JE)(this.gridApi,n=>n.objectName===t.objectName)}get connection(){if(this.currentConnection)return this.dbConnectionsList?.find(t=>t.connectionName===this.currentConnection)}getNodeByData(t){let n=this.gridApi?.getRenderedNodes().filter(a=>a.data?.objectName===t.objectName)[0];return n||(this.gridApi?.forEachNode(a=>{a.data?.objectName===t.objectName&&(n=a)}),n)}selectDbItem(t){var n=this;return(0,j.Z)(function*(){return n.router.navigate(["data-studio","sql",n.currentConnection,(0,Ge._1)(t)])})()}getContextMenuItems(t){if(!t.node)return[];const n=t.node;if(!this.currentConnection)return[];const c={...n.data,connectionName:this.currentConnection};switch(n.data?.objectType){case Te.HA.Procedure:return this.getProcedureMenu(n,c);case Te.HA.Table:return this.getTableMenu(n,c);case Te.HA.View:return this.getViewMenu(n,c);case Te.HA.Function:return this.getFunctionMenu(n,c);default:return this.getGroupMenu(n.key)}}getProcedureMenu(t,n){var c,a=this;return[{name:"JSPython: Execute",action:()=>this.commands.spExecuteInNewJspyTab(n),icon:(0,fe.YO)("code-square")},"separator",{name:"Edit Procedure",action:()=>this.commands.editViewInNewSqlTab(n),icon:(0,fe.YO)("code")},{name:"Delete Procedure",action:function(){return(c=c||(0,j.Z)(function*(){(yield a.commands.deleteSqlProcedure(n))&&a.onDbLinkRemoved(t)})).apply(this,arguments)},icon:(0,fe.YO)("trash")}]}getTableMenu(t,n){var c,a=this;return[{name:"SQL: Select top 1000",action:()=>this.commands.addSelect1000SqlTab(n),icon:(0,fe.YO)("filetype-sql")},{name:"JSPython: Select top 1000",action:()=>this.commands.addSelect1000JspyTab(n),icon:(0,fe.YO)("code")},{name:"Create New Data Query",action:()=>this.commands.addDataQueryTabFromTableLink(n),icon:(0,fe.YO)("journal-plus")},"separator",{name:"Design Table",action:()=>this.commands.editSqlTableMetadata(n).then(_=>{_&&this.tabsService.reloadSqlTab(n)}),icon:(0,fe.YO)("table")},{name:"Delete Table",action:function(){return(c=c||(0,j.Z)(function*(){(yield a.commands.deleteSqlTable(n))&&a.onDbLinkRemoved(t)})).apply(this,arguments)},icon:(0,fe.YO)("trash")}]}onDbLinkRemoved(t){const n=t.group?t.allLeafChildren:[t];this.gridApi?.applyTransaction({remove:n.map(a=>a.data).filter(a=>!!a)}),this.tabsService.removeConnectionTab({...t.data,connectionName:this.currentConnection})}getViewMenu(t,n){var c,a=this;return[{name:"SQL: Select top 1000",action:()=>this.commands.addSelect1000SqlTab(n),icon:(0,fe.YO)("filetype-sql")},{name:"JSPython: Select top 1000",action:()=>this.commands.addSelect1000JspyTab(n),icon:(0,fe.YO)("code")},{name:"Create New Data Query",action:()=>this.commands.addDataQueryTabFromTableLink(n),icon:(0,fe.YO)("journal-plus")},"separator",{name:"Edit View",action:()=>this.commands.editViewInNewSqlTab(n),icon:(0,fe.YO)("table")},{name:"Delete View",action:function(){return(c=c||(0,j.Z)(function*(){(yield a.commands.deleteSqlView(n))&&a.onDbLinkRemoved(t)})).apply(this,arguments)},icon:(0,fe.YO)("trash")}]}getFunctionMenu(t,n){var c,a=this;return[{name:"SPython: Execute",action:()=>this.commands.spExecuteInNewJspyTab(n),icon:(0,fe.YO)("code-square")},"separator",{name:"Edit Function",action:()=>this.commands.editViewInNewSqlTab(n),icon:(0,fe.YO)("code")},{name:"Delete Function",action:function(){return(c=c||(0,j.Z)(function*(){(yield a.commands.deleteSqlFunction(n))&&a.onDbLinkRemoved(t)})).apply(this,arguments)},icon:(0,fe.YO)("trash")}]}getGroupMenu(t){if(void 0===this.currentConnection)return[];const n=this.currentConnection;switch(t){case"Table":return[{name:"Create Table",action:()=>this.commands.createNewTable(n),icon:(0,fe.YO)("table")}];case"Function":return[{name:"Create Function",action:()=>this.commands.addNewFunctionTab(this.connection),icon:(0,fe.YO)("code")}];case"Procedure":return[{name:"Create Procedure",action:()=>this.commands.addNewProcedureTab(n),icon:(0,fe.YO)("code")}];case"View":return[{name:"Create View",action:()=>this.commands.addNewViewTab(n),icon:(0,fe.YO)("table")}]}return[]}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(zt.h),e.Y36(We.F),e.Y36(Se.x),e.Y36(Ce.F),e.Y36(qe.q),e.Y36(_e.F0))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-db-tree"]],decls:11,vars:14,consts:[[1,"h-100","d-flex","flex-column"],["name","connections-list",1,"form-control","form-control-sm","m-2","w-auto",3,"ngModel","change","ngModelChange"],["selected","",3,"value"],[3,"value",4,"ngFor","ngForOf"],["type","danger","class","mx-2",4,"ngIf"],["groupDisplayType","groupRows",1,"flex-fill","w-auto","mx-2","mb-2","ag-theme-balham","ws-ag-tree",3,"rowHeight","gridOptions","rowData","rowSelection","animateRows","cellClicked","gridReady"],["grid",""],["class","d-flex justify-content-center position-absolute align-items-center w-100 h-100 spinner",4,"ngIf"],[3,"value"],["type","danger",1,"mx-2"],[1,"d-flex","justify-content-center","position-absolute","align-items-center","w-100","h-100","spinner"],["role","status",1,"spinner-border"],[1,"sr-only"],["aria-hidden","true",1,"fa","fa-times","cancel-loading","position-absolute","cursor-pointer",3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"select",1),e.NdJ("change",function(){return n.onChangeConnection()})("ngModelChange",function(c){return n.currentConnection=c}),e.TgZ(2,"option",2),e._uU(3,"Select connection"),e.qZA(),e.YNc(4,Pi,2,2,"option",3),e.qZA(),e.YNc(5,Ni,4,1,"alert",4),e.TgZ(6,"ag-grid-angular",5,6),e.NdJ("cellClicked",function(c){return n.onCellClicked(c)})("gridReady",function(c){return n.onGridReady(c)}),e.ALo(8,"async"),e.qZA()(),e.YNc(9,ki,5,0,"div",7),e.ALo(10,"async")),2&t&&(e.xp6(1),e.Q6J("ngModel",n.currentConnection),e.xp6(1),e.Q6J("value",void 0),e.xp6(2),e.Q6J("ngForOf",n.dbConnectionsList),e.xp6(1),e.Q6J("ngIf",n.error),e.xp6(1),e.Q6J("rowHeight",30)("gridOptions",n.gridConfig)("rowData",e.lcZ(8,10,n.rowData$))("rowSelection","single")("animateRows",!0),e.xp6(3),e.Q6J("ngIf",e.lcZ(10,12,n.loading$)))},dependencies:[r.sg,r.O5,St.wx,u.YN,u.Kr,u.EJ,u.JJ,u.On,ze.N8,r.Ov],styles:[".ws-ag-tree[_ngcontent-%COMP%]     .group-padding{padding-left:2rem}"]}),i})();var Ri=d(91334),nt=function(o){return o.Project="Project",o.Connection="Connection",o}(nt||{});class ln{static appToFilterItem(i){return{type:nt.Project,name:i.title,value:[nt.Project,i.appOwner,i.appName].join("/"),selected:!1}}static connectionToFilterItem(i){return{type:nt.Connection,name:i.connectionName,value:`${nt.Connection}/${i.connectionType}-${i.connectionName}`,selected:!1}}}var cn=d(30641);const qi=["pop"],Ji=function(o){return{selected:o}};function ji(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"button",2,3),e.NdJ("onHidden",function(){e.CHM(s);const n=e.oxw();return e.KtG(n.onHidden())}),e._UZ(2,"i",4),e.qZA()}if(2&o){const s=e.oxw(),t=e.MAs(2);e.Q6J("ngClass",e.VKq(3,Ji,null==s.selected?null:s.selected.length))("outsideClick",!1)("popover",t)}}function $i(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"div",5)(1,"div",6)(2,"div",7),e._UZ(3,"i",8),e.qZA()(),e.TgZ(4,"input",9),e.NdJ("input",function(n){e.CHM(s);const a=e.oxw();return e.KtG(a.onSearch(n))}),e.qZA()(),e.TgZ(5,"div",10)(6,"ag-grid-angular",11),e.NdJ("gridReady",function(n){e.CHM(s);const a=e.oxw();return e.KtG(a.onGridReady(n))}),e.qZA()(),e.TgZ(7,"div",12)(8,"button",13),e.NdJ("click",function(){e.CHM(s);const n=e.oxw();return e.KtG(n.onClear())}),e._uU(9,"Clear"),e.qZA(),e.TgZ(10,"button",14),e.NdJ("click",function(){e.CHM(s);const n=e.oxw();return e.KtG(n.onApply())}),e._uU(11,"Apply"),e.qZA(),e.TgZ(12,"button",13),e.NdJ("click",function(){e.CHM(s);const n=e.oxw();return e.KtG(n.onClose())}),e._uU(13,"Close"),e.qZA()()}if(2&o){const s=e.oxw();e.xp6(4),e.Q6J("value",s.search),e.xp6(2),e.Q6J("columnDefs",s.columnDefs)("defaultColDef",s.defaultColDef)("groupDefaultExpanded",-1)("rowData",s.rows)("gridOptions",s.gridOptions)}}let Qi=(()=>{var o;class i{constructor(t,n,a){this.appService=t,this.connectionsService=n,this.authService=a,this.apply=new e.vpe,this.rows=[],this.selected=[],this.search="",this.hasMultipleItems=!1,this.defaultColDef={editable:!0,sortable:!1,suppressFiltersToolPanel:!0,suppressMovable:!0,suppressColumnsToolPanel:!0,suppressMenu:!0},this.gridOptions={},this.columnDefs=[{field:"type",hide:!0,width:0,rowGroup:!0,rowGroupIndex:0},{field:"selected",headerName:"?",width:40},{field:"name",flex:1}]}onGridReady(t){this.gridApi=t.api,this.gridApi.setHeaderHeight(0)}ngOnInit(){this.setUsersLocalSearchIn(),(0,Xt.a)([this.appService.appsList$,this.connectionsService.dbConnectionsList$]).subscribe(([t,n])=>{this.rows=[...t.map(ln.appToFilterItem),...n.map(ln.connectionToFilterItem)],this.updateSelectedState(),this.hasMultipleItems=this.rows.length>1})}onApply(){this.selected=this.getValue(),this.apply.emit(this.selected),this.pop?.hide(),this.storageKey&&localStorage.setItem(this.storageKey,JSON.stringify(this.selected))}onClose(){this.pop?.hide()}onClear(){this.rows.forEach(t=>t.selected=!1),this.onApply()}onHidden(){this.updateSelectedState()}onSearch(t){this.search=t?.target?.value}getValue(){return this.rows.filter(t=>t.selected).map(t=>t.value)}updateSelectedState(){this.rows.forEach(t=>{t.selected=!!this.selected?.includes(t.value)})}setUsersLocalSearchIn(){this.authService.isAuthenticated$.pipe((0,H.h)(t=>t)).subscribe(()=>{this.storageKey=`${this.authService.user?.userId}-selected-search-in`;const t=localStorage.getItem(this.storageKey);if(t)try{const n=JSON.parse(t??"");Array.isArray(n)&&n.length&&(this.selected=n,this.apply.emit(this.selected))}catch(n){console.error(`Can't parse stored search in: ${n.message}`)}})}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(ge.UW),e.Y36(We.F),e.Y36(ge.$h))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-data-studio-search-filter"]],viewQuery:function(t,n){if(1&t&&e.Gf(qi,5),2&t){let a;e.iGM(a=e.CRH())&&(n.pop=a.first)}},hostBindings:function(t,n){1&t&&e.NdJ("keydown.enter",function(c){return n.onApply(c)},!1,e.pYS)},inputs:{value:"value"},outputs:{apply:"apply"},decls:3,vars:1,consts:[["type","button","class","btn btn-sm","containerClass","search-filter-popover","container","body","boundariesElement","viewport","placement","bottom","title","Filter search context",3,"ngClass","outsideClick","popover","onHidden",4,"ngIf"],["filterTemplate",""],["type","button","containerClass","search-filter-popover","container","body","boundariesElement","viewport","placement","bottom","title","Filter search context",1,"btn","btn-sm",3,"ngClass","outsideClick","popover","onHidden"],["pop","bs-popover"],[1,"fa","fa-filter"],[1,"input-group","mb-1"],[1,"input-group-prepend"],[1,"input-group-text"],[1,"fa","fa-search"],["type","text","placeholder","Search",1,"form-control","form-control-sm",3,"value","input"],[2,"height","350px","max-height","350px"],["rowSelection","single","groupDisplayType","groupRows",1,"ag-theme-balham","h-100","flex-fill","w-100",3,"columnDefs","defaultColDef","groupDefaultExpanded","rowData","gridOptions","gridReady"],[1,"d-flex","mt-2","pt-2","border-top"],["type","button",1,"btn","btn-light","btn-sm",3,"click"],["type","button",1,"btn","btn-primary","btn-sm","ml-auto","mr-2",3,"click"]],template:function(t,n){1&t&&(e.YNc(0,ji,3,5,"button",0),e.YNc(1,$i,14,6,"ng-template",null,1,e.W1O)),2&t&&e.Q6J("ngIf",n.hasMultipleItems)},dependencies:[r.mk,r.O5,cn.k5,ze.N8],styles:[".search-filter-popover{min-width:350px}button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--color);opacity:.5}button.selected[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{opacity:1}"]}),i})();function Li(o,i){1&o&&e._UZ(0,"i",8)}function Bi(o,i){1&o&&e._UZ(0,"i",9)}const Ui=function(o){return{"font-weight-bold highlighted":o}};function Hi(o,i){if(1&o&&(e.TgZ(0,"span",10),e._uU(1),e.qZA()),2&o){const s=i.$implicit;e.Q6J("ngClass",e.VKq(2,Ui,s.isBold)),e.xp6(1),e.Oqu(s.token)}}function zi(o,i){if(1&o&&(e.YNc(0,Li,1,0,"i",4),e.YNc(1,Bi,1,0,"i",5),e.YNc(2,Hi,2,4,"span",6),e.TgZ(3,"span",7),e._uU(4),e.qZA()),2&o){const s=i.item;e.Q6J("ngIf","Connection"===s.projectOrConnection),e.xp6(1),e.Q6J("ngIf","Project"===s.projectOrConnection),e.xp6(1),e.Q6J("ngForOf",s.tokens),e.xp6(2),e.hij(" (",s.projectOrConnectionName,")")}}let Yi=(()=>{var o;class i{constructor(t,n){this.router=t,this.appService=n,this.searchItems=[],this.searchText$=new O.x,this.loading=!1;let a="";this.searchText$.pipe((0,Be.b)(500),(0,Rt.x)(),(0,tt.b)(c=>this.loading=!0),(0,vt.w)(c=>(a=c,this.appService.searchForLinks$(c||"",this.searchIn)))).subscribe(c=>{this.searchItems=c.map(_=>({..._,projectGroup:`${_.projectOrConnection}: ${_.projectOrConnectionName}`,tokens:(0,Ri.a$)(_.name,a)})),this.loading=!1})}onSearchSelected(t){if(t)if("Connection"===t.projectOrConnection)this.router.navigate(["data-studio/sql",t.projectOrConnectionName,`${t.name}.${t.contentType}`]);else if("Project"===t.projectOrConnection){const n=t.projectOrConnectionName.split("/");this.router.navigate(["data-studio/app",n[0],n[1]],{queryParams:{file:(0,fe.Js)(t)}})}}onFilterApply(t){this.searchIn=t}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(_e.F0),e.Y36(ge.UW))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-data-studio-search-box"]],decls:4,vars:4,consts:[[1,"d-flex","flex-row","overflow-hidden","h-100","pb-2","w-100"],["appendTo","body",1,"auto-grow","ng-select-sm","w-100",3,"placeholder","loading","items","typeahead","change"],["ng-option-tmp",""],[3,"apply"],["class","fa fa-database mr-2",4,"ngIf"],["class","fa fa-code mr-2",4,"ngIf"],[3,"ngClass",4,"ngFor","ngForOf"],[1,"font-italic"],[1,"fa","fa-database","mr-2"],[1,"fa","fa-code","mr-2"],[3,"ngClass"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"ng-select",1),e.NdJ("change",function(c){return n.onSearchSelected(c)}),e.YNc(2,zi,5,4,"ng-template",2),e.qZA(),e.TgZ(3,"app-data-studio-search-filter",3),e.NdJ("apply",function(c){return n.onFilterApply(c)}),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("placeholder","Search for files or sql objects")("loading",n.loading)("items",n.searchItems)("typeahead",n.searchText$))},dependencies:[r.mk,r.sg,r.O5,ut.w9,ut.ir,Qi],styles:['[_ngcontent-%COMP%]:root{--bg: #fff;--body-bg: #e4e5e6;--header-bg: #ebedef;--color: #4f5d73;--border-color: #c4c9d0;--ws-alt: #f7f7f7;--form-input-bg: #fff;--form-input-color: #768192;--nav-link-color: #8a93a2;--secondary-color: #c4c9d0;--opacity: .05;--hover: "#f0f3f5"}ng-select[_ngcontent-%COMP%]{max-width:650px}']}),i})();function Gi(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"div",18)(1,"a",19),e.NdJ("click",function(){e.CHM(s);const n=e.oxw(2);return e.KtG(n.downloadApp())}),e._uU(2,"Download App"),e.qZA(),e.TgZ(3,"a",19),e.NdJ("click",function(){e.CHM(s);const n=e.oxw(2);return e.KtG(n.uploadApp())}),e._uU(4,"Upload App"),e.qZA()()}if(2&o){const s=e.oxw(2);e.xp6(3),e.uIk("disabled",!s.app)}}function Ki(o,i){1&o&&(e.TgZ(0,"span",14)(1,"button",15),e._UZ(2,"i",16),e.qZA(),e.YNc(3,Gi,5,1,"div",17),e.qZA())}let Vi=(()=>{var o;class i{constructor(t,n,a,c,_,w){this.connectionsService=t,this.container=n,this.dataStudioService=a,this.appUploaderService=c,this.dialogService=_,this.tabsService=w,this.appContentSize=200,this.collapsed=!1}ngOnInit(){this.dataStudioService.currentApp?this.setExplorerSize():(this.appContentSize=40,this.collapsed=!0),this.dataStudioService.currentApp$.pipe((0,tt.b)(t=>this.app=t),(0,H.h)(t=>!!t&&this.collapsed&&40===this.appContentSize)).subscribe(()=>this.setExplorerSize()),this.tabsService.activeTab$.subscribe(t=>{this.activateTab(t?.tabParams.appOrSql)})}refreshConnections(){this.connectionsService.loadMyDbConnections(!0)}toggleExplorer(){this.collapsed?(this.collapsed=!1,this.appContentSize=this.container.element.nativeElement.offsetHeight/2):(this.collapsed=!0,this.appContentSize=40)}toggleConnection(){this.collapsed?(this.collapsed=!1,this.appContentSize=this.container.element.nativeElement.offsetHeight/2):(this.collapsed=!0,this.appContentSize=this.container.element.nativeElement.offsetHeight-90)}downloadApp(){if(!this.appTree)throw new Error("config is not initialized");this.dialogService.open(wi,{initialState:{app:this.app}}).onCloseAsync()}uploadApp(){var t=this;return(0,j.Z)(function*(){if(!t.app)throw new Error("app is not initialized");yield t.appUploaderService.uploadApp(t.app),t.appTree?.refreshAppFiles(t.app)})()}setExplorerSize(t){this.appContentSize=t||this.container.element.nativeElement.offsetHeight/2,this.collapsed=!1}activateTab(t){this.tabset?.tabs?.length&&("app"===t?this.tabset.tabs[0].active=!0:"sql"===t&&(this.tabset.tabs[1].active=!0))}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(We.F),e.Y36(e.s_b),e.Y36(Ce.F),e.Y36(Ot),e.Y36(xe.x),e.Y36(Se.x))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-data-studio-sidebar"]],viewQuery:function(t,n){if(1&t&&(e.Gf(rn,5),e.Gf(Re.AH,7)),2&t){let a;e.iGM(a=e.CRH())&&(n.appTree=a.first),e.iGM(a=e.CRH())&&(n.tabset=a.first)}},decls:17,vars:3,consts:[[1,"d-flex","flex-column","overflow-hidden","h-100"],[1,"tabset-fx","nav-tabs-boxed","overflow-hidden","navs-bottom"],["heading","Apps",3,"removable"],[1,"card","w-100","h-100","m-0"],[1,"card-header","px-2","py-1","d-flex","cursor-pointer","justify-content-between"],[3,"click"],["dropdown","","container","body","class","d-flex position-relative px-0","placement","bottom left",4,"ngIf"],[1,"card-body","p-0","overflow-hidden"],["heading","SQL",3,"removable"],[1,"card-header","px-2","py-1","d-flex","justify-content-between","align-items-center","cursor-pointer",3,"click"],[1,"m-0"],["type","button",1,"btn","btn-primary-outline","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-refresh"],[1,"card-body","overflow-hidden","p-0"],["dropdown","","container","body","placement","bottom left",1,"d-flex","position-relative","px-0"],["dropdownToggle","","type","button",1,"px-0","btn","btn-primary-outline","py-0"],[1,"fa","fa-ellipsis-v"],["id","add-dropdown","class","dropdown-menu dropdown-menu-right","aria-labelledby","add-btn-dropdown",4,"dropdownMenu"],["id","add-dropdown","aria-labelledby","add-btn-dropdown",1,"dropdown-menu","dropdown-menu-right"],[1,"dropdown-item",3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e._UZ(1,"app-data-studio-search-box"),e.TgZ(2,"tabset",1)(3,"tab",2)(4,"div",3)(5,"div",4)(6,"app-selection",5),e.NdJ("click",function(){return n.toggleExplorer()}),e.qZA(),e.YNc(7,Ki,4,0,"span",6),e.qZA(),e._UZ(8,"app-tree",7),e.qZA()(),e.TgZ(9,"tab",8)(10,"div",3)(11,"div",9),e.NdJ("click",function(){return n.toggleConnection()}),e.TgZ(12,"h5",10),e._uU(13,"SQL Connections"),e.qZA(),e.TgZ(14,"button",11),e.NdJ("click",function(c){return n.refreshConnections(),c.stopImmediatePropagation()}),e._UZ(15,"i",12),e.qZA()(),e._UZ(16,"app-db-tree",13),e.qZA()()()()),2&t&&(e.xp6(3),e.Q6J("removable",!1),e.xp6(4),e.Q6J("ngIf",n.app),e.xp6(2),e.Q6J("removable",!1))},dependencies:[r.O5,ye.Hz,ye.Mq,ye.TO,Re.wW,Re.AH,Di,Zi,Yi,rn],styles:["[_nghost-%COMP%]{height:100%;display:block}span.disabled[_ngcontent-%COMP%]{opacity:.5}.files-panel[_ngcontent-%COMP%]     .panel.card{height:100%}.files-panel[_ngcontent-%COMP%]     .panel-title .accordion-toggle>button{color:var(--color);padding-left:.5rem;text-decoration:none}.files-panel[_ngcontent-%COMP%]     .panel-body.card-block.card-body{padding:0}.files-panel[_ngcontent-%COMP%]     .panel-collapse.collapse.in.show{overflow:auto!important}.files-panel[_ngcontent-%COMP%]     app-tree{min-height:100px;display:block}.files-panel.panel-open[_ngcontent-%COMP%]{flex:1 1 auto}.files-panel[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]{margin-bottom:8px}.files-panel[_ngcontent-%COMP%]   .fa.fa-folder-o[_ngcontent-%COMP%]{margin-left:-7px;position:absolute;top:11px}.files-panel[_ngcontent-%COMP%]   .fa.fa-file-o[_ngcontent-%COMP%]{margin-left:-6px;position:absolute;top:9px}accordion[_ngcontent-%COMP%]     .accordion-toggle{display:flex}accordion[_ngcontent-%COMP%]     .panel.card{margin-bottom:1px}accordion[_ngcontent-%COMP%]     .panel-body.card-block.card-body{padding:0}.disabled[_ngcontent-%COMP%]{opacity:.7}.card-header[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{color:var(--color)}.navs-bottom[_ngcontent-%COMP%]     .nav.nav-tabs{order:1}.navs-bottom[_ngcontent-%COMP%]     .tab-content{border-radius:.25rem .25rem .25rem 0}.navs-bottom[_ngcontent-%COMP%]     .nav-tabs .nav-item{margin-top:-1px;margin-bottom:0}.navs-bottom[_ngcontent-%COMP%]     .nav-tabs .nav-item:hover .nav-link, .navs-bottom[_ngcontent-%COMP%]     .nav-tabs .nav-item.active .nav-link{border-bottom-color:var(--border-color)}.navs-bottom[_ngcontent-%COMP%]     .nav-tabs .nav-link{border-top:none;border-top-left-radius:0;border-top-right-radius:0;border-bottom-left-radius:.25rem;border-bottom-right-radius:.25rem}"]}),i})(),Wi=(()=>{var o;class i{constructor(t){this.router=t}ngOnDestroy(){this.sub?.unsubscribe()}get tabContent(){return this.currentTab?.content}onPreviewClick(){var t=this;return(0,j.Z)(function*(){const n="page.xml"===t.currentTab?.tabType?`/${t.tabContent?.appContent?.name}`:"",a=window.location.pathname.replace("/data-studio",""),c=`${window.location.origin}/${a}${n}`;window.open(c,"_blank")})()}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(_e.gz))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tab-html-actions"]],inputs:{currentTab:"currentTab"},decls:2,vars:0,consts:[["type","button",1,"btn","btn-sm","btn-success","mx-2","px-3",3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"button",0),e.NdJ("click",function(){return n.onPreviewClick()}),e._uU(1,"Preview"),e.qZA())},encapsulation:2}),i})();var Xi=d(92604);function eo(o,i){if(1&o&&(e.TgZ(0,"span",12),e._uU(1),e.qZA()),2&o){const s=i.ngIf;e.xp6(1),e.hij(" ",s/1e3,"s\n")}}function to(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"li",15)(1,"a",16),e.NdJ("click",function(){const a=e.CHM(s).$implicit,c=e.oxw(2);return e.KtG(null==c.tabContent?null:c.tabContent.onSelectConnection(a.connectionName))}),e._uU(2),e.qZA()()}if(2&o){const s=i.$implicit;e.xp6(2),e.Oqu(s.connectionName)}}function no(o,i){if(1&o&&(e.TgZ(0,"ul",13),e.YNc(1,to,3,1,"li",14),e.qZA()),2&o){const s=e.oxw();e.xp6(1),e.Q6J("ngForOf",null==s.tabContent?null:s.tabContent.connections)}}function io(o,i){1&o&&e._UZ(0,"span",17)}function oo(o,i){if(1&o&&(e.ynx(0),e._uU(1),e.BQk()),2&o){const s=e.oxw();e.xp6(1),e.hij(" ",((null==s.tabContent||null==s.tabContent.selectedText?null:s.tabContent.selectedText.length)||0)>5?"Run Selected SQL":"Run"," ")}}let so=(()=>{var o;class i{constructor(){this.showSearch=!1}ngOnDestroy(){this.sub?.unsubscribe()}get tabContent(){return this.currentTab?.content}toggleDirection(){this.tabContent?.toggleDirection()}onRunClick(){var t=this;return(0,j.Z)(function*(){yield t.tabContent?.onRunClick()})()}}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tab-sql-content-actions"]],inputs:{currentTab:"currentTab"},decls:13,vars:6,consts:[["class","align-self-center badge badge-info p-2 mr-2",4,"ngIf"],["title","Show/ Hide loaded data search",1,"btn","btn-sm","px-1",3,"click"],[1,"fa","fa-search"],["dropdown","",1,"btn-group"],["id","button-basic","dropdownToggle","","type","button","disabled","disabled","aria-controls","dropdown-basic",1,"btn","btn-outline-primary","btn-sm","dropdown-toggle","px-3"],[1,"caret"],["id","dropdown-basic","class","dropdown-menu","role","menu","aria-labelledby","button-basic",4,"dropdownMenu"],["type","button",1,"btn","btn-sm","btn-success","mx-2","px-3",3,"disabled","click"],["class","spinner-border",4,"ngIf"],[4,"ngIf"],["title","Switch to horizontal/vertical layout",1,"cursor-pointer","btn","btn-outline-secondary","btn-sm",3,"click"],[1,"fa",3,"ngClass"],[1,"align-self-center","badge","badge-info","p-2","mr-2"],["id","dropdown-basic","role","menu","aria-labelledby","button-basic",1,"dropdown-menu"],["role","menuitem",4,"ngFor","ngForOf"],["role","menuitem"],[1,"dropdown-item",3,"click"],[1,"spinner-border"]],template:function(t,n){1&t&&(e.YNc(0,eo,2,1,"span",0),e.TgZ(1,"button",1),e.NdJ("click",function(){return n.showSearch=!n.showSearch}),e._UZ(2,"i",2),e.qZA(),e.TgZ(3,"div",3)(4,"button",4),e._uU(5),e._UZ(6,"span",5),e.qZA(),e.YNc(7,no,2,1,"ul",6),e.qZA(),e.TgZ(8,"button",7),e.NdJ("click",function(){return n.onRunClick()}),e.YNc(9,io,1,0,"span",8),e.YNc(10,oo,2,1,"ng-container",9),e.qZA(),e.TgZ(11,"button",10),e.NdJ("click",function(){return n.toggleDirection()}),e._UZ(12,"i",11),e.qZA()),2&t&&(e.Q6J("ngIf",null==n.tabContent?null:n.tabContent.evaluationTime),e.xp6(5),e.Oqu(null==n.tabContent?null:n.tabContent.selectConnection),e.xp6(3),e.Q6J("disabled",null==n.tabContent?null:n.tabContent.evaluating),e.xp6(1),e.Q6J("ngIf",null==n.tabContent?null:n.tabContent.evaluating),e.xp6(1),e.Q6J("ngIf",!(null!=n.tabContent&&n.tabContent.evaluating)),e.xp6(2),e.Q6J("ngClass","vertical"===(null==n.tabContent?null:n.tabContent.direction)?"fa-arrows-h":"fa-arrows-v"))},dependencies:[r.mk,r.sg,r.O5,ye.Hz,ye.Mq,ye.TO],styles:["ng-select[_ngcontent-%COMP%]{flex:0 1 150px}"]}),i})();function ao(o,i){if(1&o&&(e.TgZ(0,"span",5),e._uU(1),e.qZA()),2&o){const s=i.ngIf;e.xp6(1),e.hij("",s/1e3," s")}}function ro(o,i){1&o&&e._UZ(0,"span",6)}function lo(o,i){if(1&o&&(e.ynx(0),e._uU(1),e.BQk()),2&o){const s=e.oxw();e.xp6(1),e.hij(" ",null!=s.tabContent&&s.tabContent.selectedText?"Run Selected SQL":"Run"," ")}}let co=(()=>{var o;class i{constructor(){this.ConnectionLevels=Fe.EQ}get tabContent(){return this.currentTab?.content}}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tab-sql-procedure-actions"]],inputs:{currentTab:"currentTab"},decls:6,vars:4,consts:[["class","align-self-center badge badge-info p-2 mr-2",4,"ngIf"],["type","button",1,"btn","btn-sm","btn-success","mx-2","px-3",3,"disabled","click"],["class","spinner-border",4,"ngIf"],[4,"ngIf"],[1,"btn","btn-sm","btn-outline-danger","mr-0",3,"click"],[1,"align-self-center","badge","badge-info","p-2","mr-2"],[1,"spinner-border"]],template:function(t,n){1&t&&(e.YNc(0,ao,2,1,"span",0),e.TgZ(1,"button",1),e.NdJ("click",function(){return null==n.tabContent?null:n.tabContent.onRun()}),e.YNc(2,ro,1,0,"span",2),e.YNc(3,lo,2,1,"ng-container",3),e.qZA(),e.TgZ(4,"button",4),e.NdJ("click",function(){return null==n.tabContent?null:n.tabContent.onDelete()}),e._uU(5,"Delete"),e.qZA()),2&t&&(e.Q6J("ngIf",null==n.tabContent?null:n.tabContent.evaluationTime),e.xp6(1),e.Q6J("disabled",null==n.tabContent?null:n.tabContent.evaluating),e.xp6(1),e.Q6J("ngIf",null==n.tabContent?null:n.tabContent.evaluating),e.xp6(1),e.Q6J("ngIf",!(null!=n.tabContent&&n.tabContent.evaluating)))},dependencies:[r.O5],styles:["ng-select[_ngcontent-%COMP%]{flex:0 1 150px}"]}),i})();var un=d(93613);function uo(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"app-data-filters",5,6),e.NdJ("filtersBarChanged",function(n){e.CHM(s);const a=e.oxw();return e.KtG(null==a.tabContent?null:a.tabContent.onFiltersBarChanged(n))}),e.qZA()}if(2&o){const s=e.oxw();e.Q6J("filtersBar",null==s.tabContent||null==s.tabContent.queryInfo?null:s.tabContent.queryInfo.filtersBar)("dataSource",null==s.tabContent?null:s.tabContent.dataSource)}}let po=(()=>{var o;class i{constructor(){this.ConnectionLevels=Fe.EQ,this.showFiltersBar=!1,this.showSearch=!1}ngOnChanges(t){t.currentTab?.currentValue&&(this.showFiltersBar=!1,Ne.z.schedule(()=>{this.showFiltersBar=!0}))}get tabContent(){return this.currentTab?.content}}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tab-data-query-actions"]],inputs:{currentTab:"currentTab"},features:[e.TTD],decls:5,vars:2,consts:[[1,"d-flex","flex-row","mx-0","align-items-center"],[1,"mr-2","ml-auto"],[3,"filtersBar","dataSource","filtersBarChanged",4,"ngIf"],[1,"btn","px-2",3,"title","click"],[1,"fa","fa-cog"],[3,"filtersBar","dataSource","filtersBarChanged"],["filtersBar",""]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e._UZ(1,"div",1),e.YNc(2,uo,2,2,"app-data-filters",2),e.TgZ(3,"button",3),e.NdJ("click",function(){return null==n.tabContent?null:n.tabContent.openQueryManager()}),e._UZ(4,"i",4),e.qZA()()),2&t&&(e.xp6(2),e.Q6J("ngIf",n.showFiltersBar&&(null==n.tabContent?null:n.tabContent.dataSource)),e.xp6(1),e.s9C("title",null==n.tabContent||null==n.tabContent.queryInfo||null==n.tabContent.queryInfo.sqlQuery?null:n.tabContent.queryInfo.sqlQuery.tableName))},dependencies:[r.O5,un.K],styles:[".fa.fa-cog[_ngcontent-%COMP%], .fa.fa-refresh[_ngcontent-%COMP%], .fa.fa-search[_ngcontent-%COMP%]{color:var(--color)}"]}),i})();function ho(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"app-data-filters",6,7),e.NdJ("filtersBarChanged",function(n){e.CHM(s);const a=e.oxw();return e.KtG(null==a.tabContent?null:a.tabContent.onFiltersBarChanged(n))}),e.qZA()}if(2&o){const s=e.oxw();e.Q6J("dataSource",null==s.tabContent?null:s.tabContent.dataSource)("filtersBar",null==s.tabContent||null==s.tabContent.queryInfo?null:s.tabContent.queryInfo.filtersBar)}}let fo=(()=>{var o;class i{constructor(){this.ConnectionLevels=Fe.EQ}get tabContent(){return this.currentTab?.content}}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-sql-table-actions"]],inputs:{currentTab:"currentTab"},decls:6,vars:2,consts:[[1,"d-flex","flex-row","mx-0","align-items-center"],["class","pl-2 d-none d-md-flex",3,"dataSource","filtersBar","filtersBarChanged",4,"ngIf"],[1,"btn","px-1",3,"click"],[1,"fa","fa-refresh"],[1,"btn","px-1","d-none","d-md-flex",3,"title","click"],[1,"fa","fa-cog"],[1,"pl-2","d-none","d-md-flex",3,"dataSource","filtersBar","filtersBarChanged"],["filtersBar",""]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.YNc(1,ho,2,2,"app-data-filters",1),e.TgZ(2,"button",2),e.NdJ("click",function(){return null==n.currentTab||null==n.currentTab.content?null:n.currentTab.content.reload()}),e._UZ(3,"i",3),e.qZA(),e.TgZ(4,"button",4),e.NdJ("click",function(){return null==n.tabContent?null:n.tabContent.openQueryManager()}),e._UZ(5,"i",5),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("ngIf",null==n.tabContent?null:n.tabContent.dataSource),e.xp6(3),e.s9C("title",null==n.tabContent||null==n.tabContent.queryInfo||null==n.tabContent.queryInfo.sqlQuery?null:n.tabContent.queryInfo.sqlQuery.tableName))},dependencies:[r.O5,un.K],styles:[".fa.fa-cog[_ngcontent-%COMP%], .fa.fa-refresh[_ngcontent-%COMP%], .fa.fa-search[_ngcontent-%COMP%]{color:var(--color)}"]}),i})();var mo=d(61240);function go(o,i){if(1&o&&(e.TgZ(0,"span",5),e._uU(1),e.qZA()),2&o){const s=i.ngIf;e.xp6(1),e.hij("",s/1e3," s")}}function _o(o,i){1&o&&e._UZ(0,"span",6)}function bo(o,i){if(1&o&&(e.ynx(0),e._uU(1),e.BQk()),2&o){const s=e.oxw();e.xp6(1),e.hij(" ",null!=s.tabContent&&s.tabContent.selectedText?"Run Selected SQL":"Run"," ")}}let yo=(()=>{var o;class i{constructor(){this.ConnectionLevels=Fe.EQ}get tabContent(){return this.currentTab?.content}}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tab-sql-function-actions"]],inputs:{currentTab:"currentTab"},decls:6,vars:4,consts:[["class","align-self-center badge badge-info p-2 mr-2",4,"ngIf"],["type","button",1,"btn","btn-sm","btn-success","mx-2","px-3",3,"disabled","click"],["class","spinner-border",4,"ngIf"],[4,"ngIf"],[1,"btn","btn-sm","btn-outline-danger","mr-0",3,"click"],[1,"align-self-center","badge","badge-info","p-2","mr-2"],[1,"spinner-border"]],template:function(t,n){1&t&&(e.YNc(0,go,2,1,"span",0),e.TgZ(1,"button",1),e.NdJ("click",function(){return null==n.tabContent?null:n.tabContent.onRun()}),e.YNc(2,_o,1,0,"span",2),e.YNc(3,bo,2,1,"ng-container",3),e.qZA(),e.TgZ(4,"button",4),e.NdJ("click",function(){return null==n.tabContent?null:n.tabContent.onDelete()}),e._uU(5,"Delete"),e.qZA()),2&t&&(e.Q6J("ngIf",null==n.tabContent?null:n.tabContent.evaluationTime),e.xp6(1),e.Q6J("disabled",null==n.tabContent?null:n.tabContent.evaluating),e.xp6(1),e.Q6J("ngIf",null==n.tabContent?null:n.tabContent.evaluating),e.xp6(1),e.Q6J("ngIf",!(null!=n.tabContent&&n.tabContent.evaluating)))},dependencies:[r.O5],styles:["ng-select[_ngcontent-%COMP%]{flex:0 1 150px}"]}),i})();function vo(o,i){if(1&o&&e._UZ(0,"app-jspy-actions",3),2&o){const s=e.oxw();e.Q6J("currentTab",s.currentTab)}}function Co(o,i){if(1&o&&e._UZ(0,"app-tab-sql-content-actions",4),2&o){const s=e.oxw();e.Q6J("currentTab",s.currentTab)}}function To(o,i){if(1&o&&e._UZ(0,"app-tab-sql-procedure-actions",3),2&o){const s=e.oxw();e.Q6J("currentTab",s.currentTab)}}function So(o,i){if(1&o&&e._UZ(0,"app-tab-sql-function-actions",3),2&o){const s=e.oxw();e.Q6J("currentTab",s.currentTab)}}function xo(o,i){if(1&o&&e._UZ(0,"app-sql-table-actions",3),2&o){const s=e.oxw();e.Q6J("currentTab",s.currentTab)}}function wo(o,i){if(1&o&&e._UZ(0,"app-sql-table-actions",3),2&o){const s=e.oxw();e.Q6J("currentTab",s.currentTab)}}function Ao(o,i){if(1&o&&e._UZ(0,"app-tab-json-content-actions",3),2&o){const s=e.oxw();e.Q6J("currentTab",s.currentTab)}}function Mo(o,i){if(1&o&&e._UZ(0,"app-tab-data-query-actions",3),2&o){const s=e.oxw();e.Q6J("currentTab",s.currentTab)}}function Oo(o,i){if(1&o&&e._UZ(0,"app-tab-html-actions",3),2&o){const s=e.oxw();e.Q6J("currentTab",s.currentTab)}}function Do(o,i){if(1&o&&e._UZ(0,"app-tab-html-actions",3),2&o){const s=e.oxw();e.Q6J("currentTab",s.currentTab)}}let Io=(()=>{var o;class i{constructor(t){this.tabsService=t}ngOnInit(){this.tabsService.activeTab$.subscribe(t=>this.currentTab=t??void 0)}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(Se.x))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tab-actions"]],decls:11,vars:11,consts:[[3,"ngSwitch"],["class","h-100 w-100 d-flex",3,"currentTab",4,"ngSwitchCase"],["class","h-100 w-100 d-flex align-items-baseline",3,"currentTab",4,"ngSwitchCase"],[1,"h-100","w-100","d-flex",3,"currentTab"],[1,"h-100","w-100","d-flex","align-items-baseline",3,"currentTab"]],template:function(t,n){1&t&&(e.ynx(0,0),e.YNc(1,vo,1,1,"app-jspy-actions",1),e.YNc(2,Co,1,1,"app-tab-sql-content-actions",2),e.YNc(3,To,1,1,"app-tab-sql-procedure-actions",1),e.YNc(4,So,1,1,"app-tab-sql-function-actions",1),e.YNc(5,xo,1,1,"app-sql-table-actions",1),e.YNc(6,wo,1,1,"app-sql-table-actions",1),e.YNc(7,Ao,1,1,"app-tab-json-content-actions",1),e.YNc(8,Mo,1,1,"app-tab-data-query-actions",1),e.YNc(9,Oo,1,1,"app-tab-html-actions",1),e.YNc(10,Do,1,1,"app-tab-html-actions",1),e.BQk()),2&t&&(e.Q6J("ngSwitch",null==n.currentTab?null:n.currentTab.tabType),e.xp6(1),e.Q6J("ngSwitchCase","jspy"),e.xp6(1),e.Q6J("ngSwitchCase","sql"),e.xp6(1),e.Q6J("ngSwitchCase","procedure"),e.xp6(1),e.Q6J("ngSwitchCase","function"),e.xp6(1),e.Q6J("ngSwitchCase","table"),e.xp6(1),e.Q6J("ngSwitchCase","view"),e.xp6(1),e.Q6J("ngSwitchCase","json"),e.xp6(1),e.Q6J("ngSwitchCase","query"),e.xp6(1),e.Q6J("ngSwitchCase","app.xml"),e.xp6(1),e.Q6J("ngSwitchCase","page.xml"))},dependencies:[r.RF,r.n9,Wi,Xi.A,so,co,po,fo,mo.k,yo]}),i})();function Eo(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"a",7),e.NdJ("click",function(){const a=e.CHM(s).$implicit,c=e.oxw(2);return e.KtG(c.onAddNewTab(a.type))}),e._UZ(1,"i",8),e._uU(2),e.qZA()}if(2&o){const s=i.$implicit;e.xp6(2),e.hij("",s.title," ")}}function Fo(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"a",7),e.NdJ("click",function(){const a=e.CHM(s).$implicit,c=e.oxw(2);return e.KtG(c.onTabItem(a))}),e._UZ(1,"i",9),e._uU(2),e.qZA()}if(2&o){const s=i.$implicit;e.xp6(2),e.hij("",s.label," ")}}function Po(o,i){if(1&o&&(e.TgZ(0,"div",5),e.YNc(1,Eo,3,1,"a",6),e.YNc(2,Fo,3,1,"a",6),e.qZA()),2&o){const s=e.oxw();e.xp6(1),e.Q6J("ngForOf",s.createFileMenuItems),e.xp6(1),e.Q6J("ngForOf",s.tabsMenuItems)}}let No=(()=>{var o;class i{constructor(t,n,a){this.tabsService=t,this.dataStudioService=n,this.authService=a,this.FileMenuItems=[{type:"jspy",title:"Jspy Script",allowAnonymous:!0},{type:"json",title:"Json File",allowAnonymous:!0},{type:"page.xml",title:"Page Template"},{type:"component.xml",title:"Component Template"},{type:"query",title:"Data Query"},{type:"sql",title:"Sql Query"}],this.createFileMenuItems=[],this.tabsMenuItems=[{label:"Close All Tabs",click:()=>this.tabsService.removeAllTabs()},{label:"Close Other Tabs",click:()=>this.tabsService.removeUnActiveTabs()}],this.authService.isAuthenticated$.subscribe(c=>this.createFileMenuItems=this.FileMenuItems.filter(_=>c||_.allowAnonymous))}newFileContent(t){return"jspy"===t?Oe.EY:"page.xml"===t?Oe.uA:"component.xml"===t?Oe.C4:"\n"}onAddNewTab(t){this.tabsService.addNewAppTab(this.dataStudioService.currentApp,t,"",this.newFileContent(t))}onTabItem(t){t.click()}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(Se.x),e.Y36(Ce.F),e.Y36(ge.$h))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tab-creation"]],decls:5,vars:0,consts:[["dropdown","","container","body","placement","top left",1,"d-flex","position-absolute","px-0"],["dropdownToggle","","type","button",1,"px-1","btn","btn-light","py-0"],[1,"fa","fa-plus"],[1,"fa","fa-caret-down"],["id","add-dropdown","class","dropdown-menu dropdown-menu-right","aria-labelledby","add-btn-dropdown",4,"dropdownMenu"],["id","add-dropdown","aria-labelledby","add-btn-dropdown",1,"dropdown-menu","dropdown-menu-right"],["class","dropdown-item",3,"click",4,"ngFor","ngForOf"],[1,"dropdown-item",3,"click"],[1,"bi","bi-plus","mr-1"],[1,"bi","bi-x","mr-1"]],template:function(t,n){1&t&&(e.TgZ(0,"span",0)(1,"button",1),e._UZ(2,"i",2)(3,"i",3),e.qZA(),e.YNc(4,Po,3,2,"div",4),e.qZA())},dependencies:[r.sg,ye.Hz,ye.Mq,ye.TO],encapsulation:2}),i})();function ko(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"button",19),e.NdJ("click",function(){e.CHM(s);const n=e.oxw();return e.KtG(n.onReloadContent())}),e._UZ(1,"i",20),e.qZA()}}function Zo(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"button",21),e.NdJ("click",function(){e.CHM(s);const n=e.oxw();return e.KtG(n.onSave())}),e._uU(1,"Save"),e.qZA()}}function Ro(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"button",22),e.NdJ("click",function(){e.CHM(s);const n=e.oxw();return e.KtG(n.onShare())}),e._UZ(1,"i",23),e.qZA()}}function qo(o,i){1&o&&(e.TgZ(0,"button",24),e._UZ(1,"i",25),e.qZA())}function Jo(o,i){1&o&&(e.TgZ(0,"button",26),e._UZ(1,"i",25),e.qZA())}function jo(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"li",31)(1,"a",32),e.NdJ("click",function(){e.CHM(s);const n=e.oxw().$implicit;return e.KtG(n.click(n))}),e._UZ(2,"i"),e._uU(3),e.qZA()()}if(2&o){const s=e.oxw().$implicit;e.xp6(2),e.Gre("fa ",s.icon||"fa-circle-thin"," mr-2"),e.xp6(1),e.Oqu(s.label)}}function $o(o,i){1&o&&e._UZ(0,"li",33)}function Qo(o,i){if(1&o&&(e.ynx(0),e.YNc(1,jo,4,4,"li",29),e.YNc(2,$o,1,0,"li",30),e.BQk()),2&o){const s=i.$implicit;e.xp6(1),e.Q6J("ngIf",!s.isDivider),e.xp6(1),e.Q6J("ngIf",s.isDivider)}}function Lo(o,i){if(1&o&&(e.TgZ(0,"ul",27),e.YNc(1,Qo,3,2,"ng-container",28),e.Hsn(2),e.qZA()),2&o){const s=e.oxw();e.xp6(1),e.Q6J("ngForOf",null==s.currentTab||null==s.currentTab.content?null:s.currentTab.content.menuItems)}}const Bo=["*"];let Uo=(()=>{var o;class i{constructor(t,n,a,c,_,w,P){this.tabsService=t,this.resizeSvc=n,this.authService=a,this.sqlMetaDataService=c,this.dialogService=_,this.dataStudioService=w,this.document=P,this.menuDisabled=!1,this.layoutConfig={icon:"worksheets_logo",smIcon:"worksheets_logo",toggle:!0},this.collapsed=!1,this.destroy$=new O.x,(0,Ge.MJ)(Ee,"python",new ei(()=>this.getDataContext(),()=>this.currentTab?.content?.currentFileLinks?.filter(Z=>"jspy"===Z.contentType||"json"===Z.contentType)?.map(Z=>`/${(0,Ye.Js)(Z)}`)||[])),(0,Ge.MJ)(Ee,"sql",new oi(()=>this.currentTab?.content?.connectionName||this.currentTab?.content?.connection?.connectionName||"",Z=>c.getObjects(Z).then(Y=>Y.filter(se=>se.objectType!==Te.HA.Procedure).map(se=>`${se.schemaName}.${se.objectName}`)),(Z,Y)=>c.getDbTableFields(Z,Y).then(se=>se.map(le=>le.fieldName))))}ngOnInit(){this.resizeSvc.onResize$.subscribe(t=>{this.size=t,this.collapsed=this.size<=Yt.y.MD}),this.tabsService.activeTab$.pipe((0,E.R)(this.destroy$)).subscribe(t=>this.currentTab=t),this.authService.isAuthenticated$.pipe((0,E.R)(this.destroy$),(0,H.h)(t=>t)).subscribe(()=>this.tabsService.initStateFromLocalStorage())}onToggleSidebar(){this.collapsed=!this.collapsed}onResized(){this.document.defaultView?.dispatchEvent(new Event("resize"))}onSave(){var t=this;return(0,j.Z)(function*(){"function"==typeof t.tabsService.activeTab?.content?.save&&(yield t.tabsService.activeTab.content.save())})()}onShare(){var t=this;return(0,j.Z)(function*(){const n=t.dataStudioService.currentApp;yield t.dialogService.open(ci,{class:"modal-lg",initialState:{config:{app:{...n},tab:t.tabsService.activeTab}}}).onCloseAsync()})()}onReloadContent(){this.tabsService.activeTab.content?.reload()}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete()}getDataContext(){const t="jspy"===this.currentTab?.tabType?this.currentTab?.content:null;return{...t?.interpreter?.lastExecutionContext||t?.interpreter?.initialExecutionContext}}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(Se.x),e.Y36(Yt._),e.Y36(ge.$h),e.Y36(ge.hp),e.Y36(xe.x),e.Y36(Ce.F),e.Y36(r.K0))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-data-studio-layout"]],ngContentSelectors:Bo,decls:23,vars:10,consts:[[3,"config","toggleSidebar"],["title","",1,"mb-0","ml-0","top-sub-header","w-md-down-50","d-none","d-md-block"],[1,"text-primary"],["header","",1,"d-flex","flex-fill","align-items-center","ml-2"],[1,"tabs-title"],[1,"ml-auto"],["class","btn btn-sm px-1 ml-2","title","Reload content",3,"click",4,"ngIf"],["type","button","class","btn btn-primary btn-sm align-self-center ml-2 px-3",3,"click",4,"ngIf"],["type","button","class","btn btn-sm align-self-center ml-2",3,"click",4,"ngIf"],["settings","",1,"d-flex"],["dropdown","","placement","top left",1,"d-flex","position-relative","px-2"],["type","button","class","px-0 btn btn-primary-outline py-0 disabled",4,"ngIf"],["dropdownToggle","","type","button","class","px-0 btn btn-primary-outline py-0",4,"ngIf"],["class","dropdown-menu left-menu","role","menu",4,"dropdownMenu"],["content","","unit","pixel","direction","horizontal",3,"useTransition","gutterSize","transitionEnd","dragEnd"],[3,"size"],["sidebar",""],[1,"position-relative"],[1,"position-absolute"],["title","Reload content",1,"btn","btn-sm","px-1","ml-2",3,"click"],[1,"fa","fa-refresh","my-0"],["type","button",1,"btn","btn-primary","btn-sm","align-self-center","ml-2","px-3",3,"click"],["type","button",1,"btn","btn-sm","align-self-center","ml-2",3,"click"],[1,"fa","fa-share-alt","my-0"],["type","button",1,"px-0","btn","btn-primary-outline","py-0","disabled"],[1,"fa","fa-ellipsis-v"],["dropdownToggle","","type","button",1,"px-0","btn","btn-primary-outline","py-0"],["role","menu",1,"dropdown-menu","left-menu"],[4,"ngFor","ngForOf"],["role","menuitem",4,"ngIf"],["class","divider dropdown-divider",4,"ngIf"],["role","menuitem"],[1,"dropdown-item","cursor-pointer",3,"click"],[1,"divider","dropdown-divider"]],template:function(t,n){1&t&&(e.F$t(),e.TgZ(0,"app-layout",0),e.NdJ("toggleSidebar",function(){return n.onToggleSidebar()}),e.TgZ(1,"h2",1),e._uU(2,"WORKSHEETS "),e.TgZ(3,"span",2),e._uU(4,"DATA STUDIO"),e.qZA()(),e.TgZ(5,"div",3)(6,"span",4),e._uU(7),e.qZA(),e._UZ(8,"app-tab-actions",5),e.YNc(9,ko,2,0,"button",6),e.YNc(10,Zo,2,0,"button",7),e.YNc(11,Ro,2,0,"button",8),e.qZA(),e.TgZ(12,"div",9)(13,"span",10),e.YNc(14,qo,2,0,"button",11),e.YNc(15,Jo,2,0,"button",12),e.YNc(16,Lo,3,1,"ul",13),e.qZA()(),e.TgZ(17,"as-split",14),e.NdJ("transitionEnd",function(){return n.onResized()})("dragEnd",function(){return n.onResized()}),e.TgZ(18,"as-split-area",15),e._UZ(19,"app-data-studio-sidebar",16),e.qZA(),e.TgZ(20,"as-split-area",17),e._UZ(21,"app-tab-creation",18)(22,"router-outlet"),e.qZA()()()),2&t&&(e.Q6J("config",n.layoutConfig),e.xp6(7),e.Oqu(null==n.currentTab?null:n.currentTab.tabHeader),e.xp6(2),e.Q6J("ngIf",null==n.currentTab||null==n.currentTab.content?null:n.currentTab.content.canReload),e.xp6(1),e.Q6J("ngIf",null==n.currentTab||null==n.currentTab.content?null:n.currentTab.content.canSave),e.xp6(1),e.Q6J("ngIf",null==n.currentTab||null==n.currentTab.content?null:n.currentTab.content.canShare),e.xp6(3),e.Q6J("ngIf",n.menuDisabled),e.xp6(1),e.Q6J("ngIf",!n.menuDisabled),e.xp6(2),e.Q6J("useTransition",!0)("gutterSize",n.collapsed?0:11),e.xp6(1),e.Q6J("size",n.collapsed?0:300))},dependencies:[r.sg,r.O5,_e.lC,ui.$,je.Mq,je.zE,ye.Hz,ye.Mq,ye.TO,Vi,Io,No],styles:['.section[_ngcontent-%COMP%]{background:var(--bg)}tabset[_ngcontent-%COMP%]     .bs-remove-tab{visibility:hidden;position:relative}tabset[_ngcontent-%COMP%]     .bs-remove-tab:after{content:"\\f00d";font-family:FontAwesome;color:inherit;position:absolute;visibility:visible;right:0}tabset[_ngcontent-%COMP%]     .tab-content{position:relative}.fa.fa-refresh[_ngcontent-%COMP%], .fa.fa-share-alt[_ngcontent-%COMP%], .fa.fa-ellipsis-v[_ngcontent-%COMP%]{color:var(--color)}.tabs-title[_ngcontent-%COMP%]{font-family:Calibri;font-size:19px;font-weight:550}app-tab-creation[_ngcontent-%COMP%]{right:0;display:block;width:40px;z-index:2}']}),i})();var dn=d(13389),ht=d(88093),It=d(13231),De=d(60364),Ho=d(43093);class Et{constructor(i,s){this.tabItem=i,this.userId=s,this.userId||console.error("TabContentStore instantiated before user is authentificated!")}get tabContentStoreKey(){return`store-${this.tabItem?.tabId}-${this.userId}`}getChanges(){const i=localStorage.getItem(this.tabContentStoreKey);if(!i)return null;try{const s=JSON.parse(i);if("object"!=typeof s||!s)throw new Error("Stored content in wrong format was removed");return s}catch(s){return this.removeChanges(),console.error(s),null}}hasChanges(){return localStorage.hasOwnProperty(this.tabContentStoreKey)}saveChanges(i){localStorage.setItem(this.tabContentStoreKey,JSON.stringify(i))}removeChanges(){localStorage.removeItem(this.tabContentStoreKey)}}const zo=["editorEl"];let $e=(()=>{var o;class i{constructor(t,n,a,c,_,w,P,Z){this.dataService=t,this.tabsService=n,this.dialogService=a,this.notificationService=c,this.dataStudioService=_,this.router=w,this.authService=P,this.commandsService=Z,this.destroy$=new O.x,this.isActivated=!1,this._text="loading ...",this.contentChangeSubj$=new O.x,this.initialText$=new wt.X(null),this.tabItem={},this.appName="",this.appOwner="",this.appContent=null,this.loading=!1,this.menuItems=[],this.canSave=!1,this.selectedText="",this.menuItems.push(Z.closeAllMenuItem()),this.menuItems.push(Z.closeOthersMenuItem()),this.menuItems.push({isDivider:!0})}get text(){return this._text}set text(t){this._text!==t&&(this._text=t,this.contentChangeSubj$.next())}get content(){return this.text}get initialText(){return this.initialText$.getValue()}get canReload(){return!0}ngOnInit(){var t=this;return(0,j.Z)(function*(){if(!t.tabItem?.tabId)throw new Error("TabItem is not initialized");t.contentChangeSubj$.pipe((0,E.R)(t.destroy$),(0,tt.b)(()=>{t.canSave=!t.initialText||t.initialText!==t.content}),(0,Be.b)(2e3)).subscribe(()=>t.storeContentChanges()),t.tabItem.content=t,t.authService.user?.userId&&(t.tabContentStore=new Et(t.tabItem,t.authService.user.userId),t.canSave=t.tabContentStore.hasChanges())})()}initTab(){var t=this;return(0,j.Z)(function*(){yield t.initTabContent(),t.editorEl&&t.initializeEditor(t.editorEl.nativeElement),t.text&&!t.canReload&&t.storeContentChanges()})()}initializeEditor(t){this.editor=Ee.editor.create(t,{tabSize:2,scrollBeyondLastLine:!1,value:this.text,...this.editorOptions}),this.editor.onDidChangeCursorSelection(n=>{const a=this.editor?.getSelection();if(!this.editor||!a)return void(this.selectedText="");const c=this.editor.getModel()?.getValueInRange(a);this.selectedText=c&&c!==this.selectedText?c:""}),this.editor.onDidChangeModelContent(()=>{this.text=this.editor?.getValue()||""}),this.initialText$.pipe((0,E.R)(this.destroy$),(0,Ho.Q)(Ne.z),(0,H.h)(n=>null!==n)).subscribe(()=>this.editor?.setValue(this.text??""))}storeContentChanges(){if(this.canSave&&this.appContent){const t={content:this.content,contentKey:(0,Ye.Js)(this.appContent)};this.tabContentStore?.saveChanges(t)}else this.tabContentStore?.removeChanges()}deleteLocalChanges(){this.tabContentStore?.removeChanges()}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete()}resize(){this.editor?.layout()}save(){var t=this;return(0,j.Z)(function*(){const{owner:n,name:a,file:c}=t.tabItem.tabParams;try{if((0,Ge.$P)(c)){const _=(0,Ye.tT)(c);_.name=_.name.replace("(new)-","");const w=yield t.dialogService.open(on,{initialState:{config:{link:_,folders:[],app:t.dataStudioService.currentApp}}}).onCloseAsync();if(w){w.appContent.content=t.content;const P=(0,Ye.Js)(w.appContent);yield t.dataService.saveAppContent(w),t.dataStudioService.appContentAdded([w]),t.tabsService.removeTab(t.tabItem),t.notificationService.success(`File '${P}' created`),t.router.navigate(["data-studio/app",w.appOwnerName,w.appName],{queryParams:{file:P}})}}else{const _={appName:a,appOwnerName:n,appContent:{...t.appContent,content:t.content}};yield t.dataService.saveAppContent(_),t.notificationService.success("File saved"),t.canSave=!1}t.tabContentStore?.removeChanges()}catch(_){t.notificationService.error(_)}})()}reload(){var t=this;return(0,j.Z)(function*(){const{owner:n,name:a,file:c}=t.tabItem.tabParams;t.appContent=yield t.dataService.loadAppFileContent(n,a,(0,Ye.tT)(c),!0),t.tabContentStore?.removeChanges();const _=t.appContent?.content||"";t.initialText$.next(_),t.text=_})()}onReload(t){return Promise.resolve()}activated(){var t=this;return(0,j.Z)(function*(){Ne.z.schedule(()=>t.resize()),t.isActivated||(t.isActivated=!0,yield t.initTab())})()}initTabContent(){var t=this;return(0,j.Z)(function*(){t.loading=!0;const{owner:n,name:a,file:c}=t.tabItem.tabParams;t.appName=a,t.appOwner=n;try{const _=t.tabContentStore?.getChanges();(0,Ge.$P)(c)?(t.text=_?.content??(t.tabsService.popContentParameter(c)||"\n"),Ne.z.schedule(()=>t.resize())):_?(t.appContent=(0,Ye.tT)(t.tabItem.tabParams.file),t.text=_.content):yield t.reload(),yield t.onReload(t.appContent)}catch(_){t.notificationService.error(_)}finally{t.loading=!1}})()}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(Mt.U),e.Y36(Se.x),e.Y36(xe.x),e.Y36(we.g),e.Y36(Ce.F),e.Y36(_e.F0),e.Y36(ge.$h),e.Y36(qe.q))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tab-app-content"]],viewQuery:function(t,n){if(1&t&&e.Gf(zo,5),2&t){let a;e.iGM(a=e.CRH())&&(n.editorEl=a.first)}},inputs:{tabItem:"tabItem"},decls:0,vars:0,template:function(t,n){},encapsulation:2}),i})();var Yo=d(63411);function Go(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"app-data-query",2,3),e.NdJ("gridDataModified",function(n){e.CHM(s);const a=e.oxw();return e.KtG(a.onGridDataModified(n))})("queryInfoChange",function(n){e.CHM(s);const a=e.oxw();return e.KtG(a.onQueryInfoChange(n))}),e.qZA()}if(2&o){const s=e.oxw();e.Q6J("hidden",!!s.loading)("queryInfo",s.queryInfo)}}function Ko(o,i){1&o&&(e.TgZ(0,"div",4)(1,"div",5)(2,"span",6),e._uU(3,"Loading..."),e.qZA()()())}let Vo=(()=>{var o;class i extends $e{constructor(t,n,a,c,_,w,P,Z){super(n,a,c,_,w,P,Z,t),this.loading=!1,this.gridContext={},this.queryInfo={},this.canShare=!0,this.menuItems.push(t.exportToCsvMenuItem(()=>this.dataQuery?.dataGrid?.grid?.rowData,()=>this.tabItem.tabHeader)),this.menuItems.push(t.exportToExcelMenuItem(()=>this.dataQuery?.dataGrid?.grid,()=>this.tabItem.tabHeader)),this.menuItems.push(t.saveToDatabaseMenuItem(()=>this.dataQuery?.dataGrid?.grid?.rowData||[])),this.menuItems.push({isDivider:!0}),this.menuItems.push({label:"Clone as Data Query",icon:"fa-clone",click:()=>t.addDataQueryTabFromQuery(this.queryInfo)}),this.menuItems.push({isDivider:!0}),this.menuItems.push({label:"Generate JSPY (Sql Data Api)",click:()=>t.addSelectWithSqlDataApiJspyTab(this.queryInfo?.sqlQuery)}),this.menuItems.push({label:"Generate SQL",click:()=>t.addSelectSqlTab(this.queryInfo?.sqlQuery)}),(0,De.setBearerToken)(Z.token),(0,De.setBaseUrl)(Ke.Z.worksheetsApi)}ngOnInit(){var t=()=>super.ngOnInit,n=this;return(0,j.Z)(function*(){yield t().call(n)})()}reload(){var t=()=>super.reload,n=this;return(0,j.Z)(function*(){n.queryInfo={},yield t().call(n),n.onReload()})()}onReload(){var t=this;return(0,j.Z)(function*(){t.text?.trim()?t.queryInfo=JSON.parse(t.text):(t.queryInfo=yield t.createDataQuery(),t.queryInfo?.sqlQuery&&(t.text=JSON.stringify(t.queryInfo)))})()}createDataQuery(){var t=this;return(0,j.Z)(function*(){return{sqlQuery:yield t.dialogService.open(Yo._,{class:"modal-xl full-height",keyboard:!1,initialState:{config:t.queryInfo?.sqlQuery,configQueryInfo:t.queryInfo}}).onCloseAsync(),viewType:It.bW.DataGrid}})()}save(){var t=()=>super.save,n=this;return(0,j.Z)(function*(){n.text=JSON.stringify(n.queryInfo),yield t().call(n);const{connectionName:a,tableName:c}=n.queryInfo.sqlQuery;if(!a||!c)throw new Error("connectionName || !tableName is not defined");(n.gridContext?.state?.added||n.gridContext?.state?.deleted||n.gridContext?.state?.edited)&&(yield n.commandsService.saveGridData(a,c,n.gridContext))})()}get dataSource(){return this.dataQuery?.dataSource}onFiltersBarChanged(t){if(!this.dataQuery)throw new Error("dataQuery is not initialized");this.dataQuery.onFiltersBarChanged(t)}openQueryManager(){var t=this;return(0,j.Z)(function*(){if(!t.dataQuery)throw new Error("dataQuery is not initialized");yield t.dataQuery.openQueryManager()})()}onQueryInfoChange(t){this.text=JSON.stringify(t)}onGridDataModified(t){this.gridContext=t,this.canSave=!0}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(qe.q),e.Y36(Mt.U),e.Y36(Se.x),e.Y36(xe.x),e.Y36(we.g),e.Y36(Ce.F),e.Y36(_e.F0),e.Y36(ge.$h))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tab-data-query"]],viewQuery:function(t,n){if(1&t&&e.Gf(ht.n,5),2&t){let a;e.iGM(a=e.CRH())&&(n.dataQuery=a.first)}},features:[e.qOj],decls:2,vars:2,consts:[["class","h-100",3,"hidden","queryInfo","gridDataModified","queryInfoChange",4,"ngIf"],["class","d-flex justify-content-center position-absolute align-items-center w-100 h-100 spinner flex-column",4,"ngIf"],[1,"h-100",3,"hidden","queryInfo","gridDataModified","queryInfoChange"],["dataQuery",""],[1,"d-flex","justify-content-center","position-absolute","align-items-center","w-100","h-100","spinner","flex-column"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(t,n){1&t&&(e.YNc(0,Go,2,2,"app-data-query",0),e.YNc(1,Ko,4,0,"div",1)),2&t&&(e.Q6J("ngIf",null==n.queryInfo?null:n.queryInfo.sqlQuery),e.xp6(1),e.Q6J("ngIf",n.loading))},dependencies:[r.O5,ht.n],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column}app-export-menu[_ngcontent-%COMP%]{margin-bottom:-.5rem}"]}),i})();function Wo(o,i){1&o&&(e.TgZ(0,"div",4)(1,"div",5)(2,"span",6),e._uU(3,"Loading..."),e.qZA()()())}let Xo=(()=>{var o;class i extends $e{constructor(){super(...arguments),this.editorOptions={language:"xml"}}handleKeyboardEvent(t){this.tabsService.activeTab===this.tabItem&&t.ctrlKey&&("s"===t.key||"S"===t.key)&&(t.preventDefault(),t.stopImmediatePropagation(),this.save())}}return(o=i).\u0275fac=function(){let s;return function(n){return(s||(s=e.n5z(o)))(n||o)}}(),o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tab-app-xml"]],hostBindings:function(t,n){1&t&&e.NdJ("keydown",function(c){return n.handleKeyboardEvent(c)},!1,e.evT)},features:[e.qOj],decls:4,vars:1,consts:[[1,"h-100","position-relative"],[1,"h-100","w-100"],["editorEl",""],["class","d-flex justify-content-center position-absolute align-items-center w-100 h-100 spinner flex-column",4,"ngIf"],[1,"d-flex","justify-content-center","position-absolute","align-items-center","w-100","h-100","spinner","flex-column"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e._UZ(1,"div",1,2),e.YNc(3,Wo,4,0,"div",3),e.qZA()),2&t&&(e.xp6(3),e.Q6J("ngIf",n.loading))},dependencies:[r.O5]}),i})();var es=d(81196);function ts(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"app-data-query",2,3),e.NdJ("dblClick",function(n){e.CHM(s);const a=e.oxw();return e.KtG(a.onDblClick(n))})("gridDataModified",function(n){e.CHM(s);const a=e.oxw();return e.KtG(a.onGridDataModified(n))})("queryInfoChange",function(n){e.CHM(s);const a=e.oxw();return e.KtG(a.onQueryInfoChange(n))})("additionalFiltersChange",function(n){e.CHM(s);const a=e.oxw();return e.KtG(a.onAdditionalFiltersChange(n))}),e.qZA()}if(2&o){const s=e.oxw();e.Q6J("hidden",!!s.loading)("queryInfo",s.queryInfo)("reflectUrl",!0)}}function ns(o,i){1&o&&(e.TgZ(0,"div",4)(1,"div",5)(2,"span",6),e._uU(3,"Loading..."),e.qZA()()())}let is=(()=>{var o;class i{constructor(t,n,a,c,_){this.notificationService=t,this.commandsService=a,this.filtersSerializer=c,this.zone=_,this.destroy$=new O.x,this._pubSubBus={},this.canSave=!1,this.canReload=!1,this.menuItems=[],this.loading=!1,(0,De.setBearerToken)(n.token),(0,De.setBaseUrl)(Ke.Z.worksheetsApi),this.menuItems.push(a.exportToFileMenuItem(()=>this.dataQuery?.dataGrid?.grid,()=>this.tabItem?.tabHeader)),this.menuItems.push(a.saveToDatabaseMenuItem(()=>this.dataQuery?.dataGrid?.grid?.rowData||[])),this.menuItems.push({label:"Import CSV Data",icon:"fa-cloud-upload",click:()=>a.importCsvData()}),this.menuItems.push({isDivider:!0}),this.menuItems.push({label:"Clone as Data Query",icon:"fa-clone",click:()=>a.addDataQueryTabFromQuery(this.queryInfo)}),this.menuItems.push({label:"Design Table",icon:"fa-cog",click:()=>a.editSqlTableMetadata(this.dbItemLink)}),this.menuItems.push({label:"Delete Table",icon:"fa-times",click:()=>a.deleteSqlTable(this.dbItemLink)}),this.menuItems.push({isDivider:!0}),this.menuItems.push({label:"Generate JSPY (Sql Data Api)",click:()=>a.addSelectWithSqlDataApiJspyTab(this.queryInfo?.sqlQuery,this.dataSource?.additionalFilters)}),this.menuItems.push({label:"Generate SQL",click:()=>a.addSelectSqlTab(this.queryInfo?.sqlQuery,this.dataSource?.additionalFilters)}),this.menuItems.push({isDivider:!0}),this.menuItems.push({label:"Publish / Subscribe",icon:"fa-gg",click:()=>a.openPubSubSetting(this.queryInfo).subscribe(w=>{this.queryInfo.pubSub=w,this.onQueryInfoChange(this.queryInfo)})}),this.menuItems.push({isDivider:!0}),this.menuItems.push(a.closeAllMenuItem()),this.menuItems.push(a.closeOthersMenuItem())}get dataSource(){return this.dataQuery?.dataSource}onFiltersBarChanged(t){this.dataQuery?.onFiltersBarChanged(t)}ngOnInit(){var t=this;return(0,j.Z)(function*(){if(!t.tabItem)throw new Error("this.tabItem is not initilized");t.tabItem.content=t;const n=t.tabItem.tabParams.owner,c=t.tabItem.tabParams.name.split(".");if(3===c.length){if(t.dbItemLink={connectionName:n,schemaName:c[0],objectName:c[1],objectType:"view"===c[2].toLowerCase()?Te.HA.View:Te.HA.Table},t.dbItemLink.objectType===Te.HA.View){const _=t.menuItems.findIndex(P=>"Design Table"===P.label);_>=0&&t.menuItems.splice(_,1,{label:"Edit View",icon:"fa-cog",click:()=>t.commandsService.editViewInNewSqlTab(t.dbItemLink)});const w=t.menuItems.find(P=>"Delete Table"===P.label);w&&(w.label="Delete View")}}else t.notificationService.error("Incorrect URL (name)")})()}ngOnDestroy(){const t=Object.keys(this._pubSubBus);for(const n of t)this._pubSubBus[n].close(),delete this._pubSubBus[n];this.destroy$.next(null),this.destroy$.complete()}save(){var t=this;return(0,j.Z)(function*(){if(!t.queryInfo)throw new Error("this.config is not initilized");if(!t.gridContext)return void t.notificationService.error("Grid Context is not initialized");const{connectionName:n,tableName:a}=t.queryInfo.sqlQuery,c=yield t.commandsService.saveGridData(n,a,t.gridContext);t.canSave=!c})()}reload(t=!1){var n=this;return(0,j.Z)(function*(){if(!n.dataQuery)throw new Error("this.config is not initilized");return!1===t?n.dataQuery?.reload():(n.queryInfo=void 0,new Promise(a=>{Ne.z.schedule((0,j.Z)(function*(){n.initializeQueryInfo(),yield n.dataQuery?.reload(),n.canSave=!1,a()}))}))})()}onDblClick(t){this.queryInfo?.pubSub?.publish?.isEnabled&&3===t.cellType&&this.publishSelectedRow(this.queryInfo.pubSub.publish.topic,t.rowData)}onQueryInfoChange(t){this.subscribeOnTopic(t.pubSub?.subscribe?.isEnabled?t.pubSub?.subscribe?.topic:void 0),this.tabItem&&this.dataQuery?.queryInfoSerializer&&(this.tabItem.queryParams={...this.tabItem.queryParams,...this.dataQuery.queryInfoSerializer.serialize(t)})}onAdditionalFiltersChange(t){this.tabItem&&this.dataQuery?.queryInfoSerializer&&(this.tabItem.queryParams={...this.tabItem.queryParams,filter:this.filtersSerializer.getQueryParam(t)})}onGridDataModified(t){this.canSave=!0,this.gridContext=t}openQueryManager(){var t=this;return(0,j.Z)(function*(){if(!t.dataQuery)throw new Error("this.config is not initilized");yield t.dataQuery.openQueryManager()})()}activated(){var t=this;return(0,j.Z)(function*(){t.queryInfo||t.initializeQueryInfo()})()}subscribeOnTopic(t){this._pubSubBus[t=`${t}`]||(this._pubSubBus[t]=new BroadcastChannel(t)),this._pubSubBus[t].onmessage=n=>{const a=this.queryInfo?.pubSub?.subscribe||{};"applyFilter"===a.action&&this.zone.run(()=>this.applyFilter(a,n.data))}}publishSelectedRow(t,n){this._pubSubBus[t=`${t}`]||(this._pubSubBus[t]=new BroadcastChannel(t)),this._pubSubBus[t].postMessage(n)}applyFilter(t,n){const a=Object.entries(t.actionParams);for(let[c,_]of a)c=Object.keys(n).find(w=>w.toLowerCase()===c.toLowerCase()),_=this.queryInfo?.sqlQuery?.fields?.find(w=>w.name.toLowerCase()===_.toLowerCase())?.name,this.dataSource&&c&&_&&this.dataSource.addAdditionalFilter({columnName:_,filterValue:[n[c]],operation:It.OX.In})}initializeQueryInfo(){this.dbItemLink&&(this.queryInfo={sqlQuery:{connectionName:this.dbItemLink.connectionName,tableName:`${this.dbItemLink.schemaName}.${this.dbItemLink.objectName}`,tableAlias:"t",limitRowsCount:1e3},viewType:It.bW.DataGrid},this.queryInfo?.pubSub?.subscribe?.isEnabled&&this.subscribeOnTopic(this.queryInfo.pubSub.subscribe.topic))}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(we.g),e.Y36(ge.$h),e.Y36(qe.q),e.Y36(es.R),e.Y36(e.R0b))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tab-db-table"]],viewQuery:function(t,n){if(1&t&&e.Gf(ht.n,5),2&t){let a;e.iGM(a=e.CRH())&&(n.dataQuery=a.first)}},inputs:{tabItem:"tabItem"},decls:2,vars:2,consts:[["class","h-100",3,"hidden","queryInfo","reflectUrl","dblClick","gridDataModified","queryInfoChange","additionalFiltersChange",4,"ngIf"],["class","d-flex justify-content-center position-absolute align-items-center w-100 h-100 spinner flex-column",4,"ngIf"],[1,"h-100",3,"hidden","queryInfo","reflectUrl","dblClick","gridDataModified","queryInfoChange","additionalFiltersChange"],["dataQuery",""],[1,"d-flex","justify-content-center","position-absolute","align-items-center","w-100","h-100","spinner","flex-column"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(t,n){1&t&&(e.YNc(0,ts,2,3,"app-data-query",0),e.YNc(1,ns,4,0,"div",1)),2&t&&(e.Q6J("ngIf",n.queryInfo),e.xp6(1),e.Q6J("ngIf",n.loading))},dependencies:[r.O5,ht.n]}),i})();function os(o,i){1&o&&(e.TgZ(0,"div",4)(1,"div",5)(2,"span",6),e._uU(3,"Loading..."),e.qZA()()())}let ss=(()=>{var o;class i extends $e{constructor(){super(...arguments),this.editorOptions={language:"javascript"}}handleKeyboardEvent(t){this.tabsService.activeTab===this.tabItem&&t.ctrlKey&&("s"===t.key||"S"===t.key)&&(t.preventDefault(),t.stopImmediatePropagation(),this.save())}}return(o=i).\u0275fac=function(){let s;return function(n){return(s||(s=e.n5z(o)))(n||o)}}(),o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tab-js"]],hostBindings:function(t,n){1&t&&e.NdJ("keydown",function(c){return n.handleKeyboardEvent(c)},!1,e.evT)},features:[e.qOj],decls:4,vars:1,consts:[[1,"h-100","position-relative"],[1,"h-100","w-100"],["editorEl",""],["class","d-flex justify-content-center position-absolute align-items-center w-100 h-100 spinner flex-column",4,"ngIf"],[1,"d-flex","justify-content-center","position-absolute","align-items-center","w-100","h-100","spinner","flex-column"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e._UZ(1,"div",1,2),e.YNc(3,os,4,0,"div",3),e.qZA()),2&t&&(e.xp6(3),e.Q6J("ngIf",n.loading))},dependencies:[r.O5]}),i})();var pn=d(76662);function as(o,i){1&o&&(e.TgZ(0,"div",4)(1,"div",5)(2,"span",6),e._uU(3,"Loading..."),e.qZA()()())}let rs=(()=>{var o;class i extends $e{ngOnInit(){var t=()=>super.ngOnInit,n=this;return(0,j.Z)(function*(){yield t().call(n),n.initialText$.pipe((0,E.R)(n.destroy$),(0,H.h)(a=>null!==a)).subscribe(a=>n.contentExplorer?.reload(a))})()}initTab(){var t=()=>super.initTab,n=this;return(0,j.Z)(function*(){yield t().call(n),n.contentExplorer?.reload(n.text)})()}setJsonText(t){this.contentExplorer?.reload(t)}onTextChanged(t){this.text=t,this.contentChangeSubj$.next()}handleKeyboardEvent(t){this.tabsService.activeTab===this.tabItem&&t.ctrlKey&&("s"===t.key||"S"===t.key)&&(t.preventDefault(),t.stopImmediatePropagation(),this.save())}resize(){this.contentExplorer?.resize()}save(){var t=()=>super.save,n=this;return(0,j.Z)(function*(){n.text=n.contentExplorer?.contentEditor?.getValue()||"",yield t().call(n)})()}}return(o=i).\u0275fac=function(){let s;return function(n){return(s||(s=e.n5z(o)))(n||o)}}(),o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tab-json"]],viewQuery:function(t,n){if(1&t&&e.Gf(pn.S,5),2&t){let a;e.iGM(a=e.CRH())&&(n.contentExplorer=a.first)}},hostBindings:function(t,n){1&t&&e.NdJ("keydown",function(c){return n.handleKeyboardEvent(c)},!1,e.evT)},features:[e.qOj],decls:4,vars:2,consts:[[1,"h-100","position-relative"],[1,"h-100","w-100",3,"formatter","textChanged"],["contentExplorer",""],["class","d-flex justify-content-center position-absolute align-items-center w-100 h-100 spinner flex-column",4,"ngIf"],[1,"d-flex","justify-content-center","position-absolute","align-items-center","w-100","h-100","spinner","flex-column"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"app-content-explorer",1,2),e.NdJ("textChanged",function(c){return n.onTextChanged(c)}),e.qZA(),e.YNc(3,as,4,0,"div",3),e.qZA()),2&t&&(e.xp6(1),e.Q6J("formatter",!0),e.xp6(2),e.Q6J("ngIf",n.loading))},dependencies:[r.O5,pn.S]}),i})();var hn=d(50834),ls=d(25482);function cs(o,i){1&o&&(e.TgZ(0,"div",4)(1,"div",5)(2,"span",6),e._uU(3,"Loading..."),e.qZA()()())}let us=(()=>{var o;class i extends $e{constructor(){super(...arguments),this.currentFileLinks=[],this.canShare=!0}ngOnInit(){var t=()=>super.ngOnInit,n=this;return(0,j.Z)(function*(){var a;yield t().call(n),n.menuItems.push({label:"Toggle Direction",click:()=>n.contentEditor?.toggleDirection()}),n.contentEditor?.setSettings({entryModule:n.tabItem?.tabParams?.file,moduleLoader:function(_){return(a=a||(0,j.Z)(function*(w){return yield n.jspyModuleLoader(w)})).apply(this,arguments)},settingsKey:`jspy-editor-${n.appOwner}-${n.appName}-${n.appContent?.name}`}),n.initialText$.pipe((0,E.R)(n.destroy$),(0,H.h)(c=>null!==c)).subscribe(c=>n.contentEditor?.reload(c))})()}get interpreter(){return this.contentEditor?.interpreter}initTab(){var t=()=>super.initTab,n=this;return(0,j.Z)(function*(){yield t().call(n),n.appOwner&&n.appName&&(n.linksSubscription=n.dataService.getAppFileLinks$(n.appOwner,n.appName).subscribe(a=>n.currentFileLinks=a)),n.contentEditor?.reload(n.text)})()}ngOnDestroy(){var t=()=>super.ngOnDestroy,n=this;return(0,j.Z)(function*(){n.linksSubscription&&n.linksSubscription.unsubscribe(),yield t().call(n)})()}handleKeyboardEvent(t){this.tabsService.activeTab===this.tabItem&&t.ctrlKey&&("s"===t.key||"S"===t.key)&&(t.preventDefault(),t.stopImmediatePropagation(),this.save())}scheduleRun(t){var n=this;return(0,j.Z)(function*(){yield n.dialogService.open(ls.s,{class:"modal-w-45",initialState:{config:{taskId:0,name:n.appContent?.name??"Content",appName:`${n.appOwner}/${n.appName}`,jspyFilePath:`${n.appContent?.name}.${n.appContent?.contentType}`,functionName:t,scheduleTime:"10:00",scheduleDays:"*",isEnabled:!0,notifyOn:0}}}).onCloseAsync()})()}resize(){super.resize(),Ne.z.schedule(()=>{this.contentEditor?.resize()})}onTextChanged(t){this.text=t,this.contentChangeSubj$.next()}jspyModuleLoader(t){var n=this;return(0,j.Z)(function*(){return t.startsWith("./")&&(t=t.substring(2)),t.startsWith("/")&&(t=t.substring(1)),(yield n.dataService.loadAppFileContent(n.appOwner,n.appName,(0,fe.tT)(t))).content||""})()}}return(o=i).\u0275fac=function(){let s;return function(n){return(s||(s=e.n5z(o)))(n||o)}}(),o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tab-jspy"]],viewQuery:function(t,n){if(1&t&&e.Gf(hn.N,7),2&t){let a;e.iGM(a=e.CRH())&&(n.contentEditor=a.first)}},hostBindings:function(t,n){1&t&&e.NdJ("keydown",function(c){return n.handleKeyboardEvent(c)},!1,e.evT)},features:[e.qOj],decls:4,vars:1,consts:[[1,"d-flex","h-100","flex-column"],[1,"h-100","w-100",3,"textChanged"],["contentEditor",""],["class","d-flex justify-content-center position-absolute align-items-center w-100 h-100 spinner flex-column",4,"ngIf"],[1,"d-flex","justify-content-center","position-absolute","align-items-center","w-100","h-100","spinner","flex-column"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"app-jspy-content-editor",1,2),e.NdJ("textChanged",function(c){return n.onTextChanged(c)}),e.qZA(),e.YNc(3,cs,4,0,"div",3),e.qZA()),2&t&&(e.xp6(3),e.Q6J("ngIf",n.loading))},dependencies:[r.O5,hn.N],styles:[".help-toggle[_ngcontent-%COMP%]{top:5px;right:13px;z-index:1}"]}),i})();function ds(o,i){1&o&&(e.TgZ(0,"div",4)(1,"div",5)(2,"span",6),e._uU(3,"Loading..."),e.qZA()()())}let ps=(()=>{var o;class i extends $e{constructor(){super(...arguments),this.editorOptions={language:"html"}}handleKeyboardEvent(t){this.tabsService.activeTab===this.tabItem&&t.ctrlKey&&("s"===t.key||"S"===t.key)&&(t.preventDefault(),t.stopImmediatePropagation(),this.save())}}return(o=i).\u0275fac=function(){let s;return function(n){return(s||(s=e.n5z(o)))(n||o)}}(),o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tab-html"]],hostBindings:function(t,n){1&t&&e.NdJ("keydown",function(c){return n.handleKeyboardEvent(c)},!1,e.evT)},features:[e.qOj],decls:4,vars:1,consts:[[1,"h-100","position-relative"],[1,"h-100","w-100"],["editorEl",""],["class","d-flex justify-content-center position-absolute align-items-center w-100 h-100 spinner flex-column",4,"ngIf"],[1,"d-flex","justify-content-center","position-absolute","align-items-center","w-100","h-100","spinner","flex-column"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e._UZ(1,"div",1,2),e.YNc(3,ds,4,0,"div",3),e.qZA()),2&t&&(e.xp6(3),e.Q6J("ngIf",n.loading))},dependencies:[r.O5]}),i})();var hs=d(41614),Xe=d(6015),fs=d(38325),ft=d(3202),ms=d(30160);class Ft extends ms.T{constructor(){super()}getData(i){return(0,j.Z)(function*(){const s=i;try{const t=yield(0,De.sqlDataApi)(s.connectionName).sqlExecuteRaw(s.sql,s.sqlParams,s.sqlParamDirections);if(!t?.table)throw new Error("Table is not arrived from sqlExecuteRaw");return{message:t.message,items:(0,ft.fromTable)(t.table),outputParameters:t.outputParameters,fields:t.table.fieldNames.map((n,a)=>({name:n,dataType:t.table?.fieldDataTypes?t.table.fieldDataTypes[a]:fs.DataTypeName.String}))}}catch(t){return{errorMessage:(0,fe.e$)(t)}}})()}}var gs=d(18937);let _s=(()=>{var o;class i extends $e{get text(){return super.text}set text(t){const n=this.getConnection(t);let a=!1;n&&(a=this.connectionName!==n,this.connectionName=n,t=this.getSqlCode(t)),a&&t===this.text&&this.contentChangeSubj$.next(),super.text=t}get content(){return`-- Connection: ${this.connectionName}\n${super.text}`}get selectConnection(){return this.connections?.map(t=>t.connectionName).includes(this.connectionName)?this.connectionName:"Select connection"}handleKeyboardEvent(t){this.tabsService.activeTab===this.tabItem&&("F5"===t.key||t.ctrlKey&&"Enter"===t.key)&&(t.preventDefault(),t.stopImmediatePropagation(),this.onRunClick())}constructor(t,n,a,c,_,w,P,Z,Y){super(t,n,c,_,w,P,Y,a),this.connectionsService=Z,this.connections=[],this.connectionName="",this.direction=Ve.Ar.horizontal,this.sqlDataSource=new Ft,this.isReadOnly=!1,this.evaluationTime=0,this.evaluating=!1,this.editorOptions={language:"sql",readOnly:this.isReadOnly},(0,De.setBearerToken)(Y.token),(0,De.setBaseUrl)(Ke.Z.worksheetsApi),this.menuItems.push(a.exportToCsvMenuItem(()=>this.dataGrid?.grid?.rowData||[],()=>this.tabItem?.tabHeader)),this.menuItems.push(a.exportToExcelMenuItem(()=>this.dataGrid?.grid,()=>this.tabItem.tabHeader)),this.menuItems.push(a.saveToDatabaseMenuItem(()=>this.dataGrid?.grid?.rowData||[]))}onRunClick(){var t=this;return(0,j.Z)(function*(){const n=t.selectedText||t.editor?.getValue();t.evaluating=!0;const a=(new Date).getTime();n&&(yield t.sqlDataSource.reload({connectionName:t.connectionName,sql:n})),t.evaluationTime=+new Date-a,t.evaluating=!1})()}ngOnInit(){var t=()=>super.ngOnInit,n=this;return(0,j.Z)(function*(){var a;n.connectionsService.dbConnectionsList$.pipe((0,E.R)(n.destroy$),(0,H.h)(c=>!!c.length)).subscribe(function(c){return(a=a||(0,j.Z)(function*(_){n.connections=_,yield t().call(n),n.resize()})).apply(this,arguments)})})()}onSelectConnection(t){this.connectionName=t,this.canSave=!0,this.contentChangeSubj$.next()}toggleDirection(){this.direction=this.direction===Ve.Ar.vertical?Ve.Ar.horizontal:Ve.Ar.vertical,this.resize()}resize(){hs.Z.schedule(()=>{this.editor?.layout()})}getSqlCode(t){return(t=t.trimStart()).substring(t.indexOf("\n")+1)}getConnection(t){if(!t)return"";const a=t.split("\n")[0].match(/--\sConnection:\s(.*)/);return a&&a[1]}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(ge.UW),e.Y36(Se.x),e.Y36(qe.q),e.Y36(xe.x),e.Y36(we.g),e.Y36(Ce.F),e.Y36(_e.F0),e.Y36(We.F),e.Y36(ge.$h))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tab-sql"]],viewQuery:function(t,n){if(1&t&&e.Gf(Xe.Z,7),2&t){let a;e.iGM(a=e.CRH())&&(n.dataGrid=a.first)}},hostBindings:function(t,n){1&t&&e.NdJ("keydown",function(c){return n.handleKeyboardEvent(c)},!1,e.evT)},features:[e.qOj],decls:12,vars:2,consts:[[1,"h-100","overflow-hidden",3,"direction","resized"],["left","",1,"w-100","overflow-hidden"],["editorEl",""],["right",""],[3,"dataSource"],["dataGrid",""],["left-label",""],[1,"fa","fa-cogs","fa-lg","mr-2"],["right-label",""],[1,"fa","fa-table","fa-lg","mr-2"]],template:function(t,n){1&t&&(e.TgZ(0,"app-split-content",0),e.NdJ("resized",function(){return null==n.editor?null:n.editor.layout()}),e._UZ(1,"div",1,2),e.ynx(3,3),e._UZ(4,"app-ag-data-grid",4,5),e.BQk(),e.ynx(6,6),e._UZ(7,"i",7),e._uU(8," SQL 1 "),e.BQk(),e.ynx(9,8),e._UZ(10,"i",9),e._uU(11," Data "),e.BQk(),e.qZA()),2&t&&(e.Q6J("direction",n.direction),e.xp6(4),e.Q6J("dataSource",n.sqlDataSource))},dependencies:[Xe.Z,gs.Y],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column}app-export-menu[_ngcontent-%COMP%]{margin-bottom:-.5rem}"]}),i})();var mt=d(37282),fn=d(94246);const bs=["sqlEditor"];function ys(o,i){1&o&&(e.TgZ(0,"div",27)(1,"div",28)(2,"span",29),e._uU(3,"Loading..."),e.qZA()()())}let mn=(()=>{var o;class i{constructor(t,n,a,c,_){this.notificationService=t,this.dialogService=n,this.sqlMetaDataService=a,this.route=c,this.router=_,this.procedureChanged=new e.vpe,this.isChanged=!1,this.codeContentSize=50,this.parametersSize=30,this.modeState={code:!0,result:!0,parameters:!0},this.loading=!1,this.selectedText="",this.ConnectionLevels=Fe.EQ,this.paramRows=[],this.sqlEditor={},this.destroy$=new O.x,this.editorChange$=new O.x,this.defaultColDef={editable:!0,sortable:!1,suppressFiltersToolPanel:!0,suppressMovable:!0,suppressColumnsToolPanel:!0,suppressMenu:!0},this.gridOptions={},this.columnDefs=[{field:"name",width:200},{field:"value",minWidth:50},{field:"dataType",width:80},{field:"direction"},{field:"isNullable"}],this.dataSource=new Ft,this.dataSource.data$.pipe((0,E.R)(this.destroy$),(0,H.h)(w=>!!w?.outputParameters)).subscribe(w=>{const P=Object.keys(w?.outputParameters);for(const Z of P){const Y=this.paramRows.find(se=>se.name.toLowerCase()===`@${Z.toLowerCase()}`);Y&&(Y.value=(w?.outputParameters||{})[Z])}})}ngOnInit(){if(!this.sqlElement)throw new Error("sqlElement is not initialized");if(!this.dataObject)throw new Error("dataObject is not initialized");this.sqlEditor=Ee.editor.create(this.sqlElement.nativeElement,{language:"sql",value:this.dataObject.sqlText||"",tabSize:2,scrollBeyondLastLine:!1,readOnly:(this.connection?.codeAccessLevel||0)<Fe.EQ.SqlExecute}),this.sqlEditor.onDidChangeCursorSelection(n=>{const a=this.sqlEditor?.getModel()?.getValueInRange(this.sqlEditor?.getSelection());a!==this.selectedText&&(this.selectedText=a||"")}),this.sqlEditor.onDidChangeModelContent(()=>{this.editorChange$.next(null)}),this.editorChange$.pipe((0,E.R)(this.destroy$),(0,Be.b)(200)).subscribe(()=>{const n=this.sqlEditor.getValue();this.isChanged=this.dataObject?.sqlText!==n;const a=this.isChanged?{structure:{...this.dataObject,sqlText:n},connection:this.connection}:null;this.procedureChanged.emit(a)}),Ne.z.schedule(()=>{this.resize()})}onGridReady(t){this.gridApi=t.api;const n=this.route.snapshot.queryParams;this.paramRows=(this.dataObject?.parameters||[]).map(a=>({name:a.parameterName,direction:a.parameterDirection,value:n.hasOwnProperty(a.parameterName)?n[a.parameterName]:null,isNullable:a.isNullable,dataType:a.dataType}))}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete()}ngOnChanges({dataObject:t}){t.firstChange||(this.isChanged=!1)}onRun(){var t=this;return(0,j.Z)(function*(){t.loading=!0;const n=t.paramRows.filter(c=>null!=c.value).reduce((c,_)=>(c[_.name.replace("@","")]=function vs(o,i){return!i||(i=i.toLowerCase()).indexOf("char")>=0?o:i.indexOf("date")>=0?(0,ft.parseDatetimeOrNull)(o):i.indexOf("int")>=0||i.indexOf("float")>=0||i.indexOf("double")>=0||i.indexOf("money")>=0||i.indexOf("numeric")>=0?(0,ft.parseNumberOrNull)(o):o}(_.value,_.dataType),c),{}),a=t.paramRows.filter(c=>null!=c.value).reduce((c,_)=>(c[_.name.replace("@","")]=_.direction,c),{});try{t.selectedText?yield t.dataSource.reload({connectionName:t.connection?.connectionName||"",sql:t.selectedText}):yield t.dataSource.reload({commandType:"StoredProcedure",connectionName:t.connection?.connectionName,sqlParams:n,sqlParamDirections:a,sql:`${t.dataObject?.schemaName}.${t.dataObject?.objectName}`}),t.syncQueryParams()}catch(c){t.notificationService.error(c)}finally{t.loading=!1}})()}syncQueryParams(){const t=this.paramRows.filter(n=>null!==n.value).reduce((n,a)=>(n[a.name]=a.value,n),{});this.router.navigate([],{relativeTo:this.route,queryParams:t})}onSave(){var t=this;return(0,j.Z)(function*(){if(!t.dataObject)throw new Error("dataObject is not initialized");const n=t.sqlEditor.getValue();if(!t.connection)throw new Error("Connection is not initialized");return yield t.sqlMetaDataService.saveDbObject(t.connection.connectionName,{...t.dataObject,sqlText:n})})()}onDelete(){var t=this;return(0,j.Z)(function*(){if(!t.connection)throw new Error("Connection is not initialized");yield t.sqlMetaDataService.deleteObject(t.connection.connectionName,t.dataObject)})()}onModeState(){const t=this.modeState.parameters||this.modeState.result;this.codeContentSize=this.modeState.code&&!t?100:this.modeState.code&&t?50:0,this.parametersSize=this.modeState.parameters&&!this.modeState.result?100:this.modeState.parameters&&this.modeState.result?30:0}resize(){this.sqlEditor?.layout()}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(we.g),e.Y36(xe.x),e.Y36(ge.hp),e.Y36(_e.gz),e.Y36(_e.F0))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-db-procedure"]],viewQuery:function(t,n){if(1&t&&(e.Gf(bs,7),e.Gf(Xe.Z,7)),2&t){let a;e.iGM(a=e.CRH())&&(n.sqlElement=a.first),e.iGM(a=e.CRH())&&(n.dataGrid=a.first)}},inputs:{dataObject:"dataObject",connection:"connection"},outputs:{procedureChanged:"procedureChanged"},features:[e.TTD],decls:34,vars:27,consts:[[1,"card","overflow-hidden","mb-0","w-100","h-100"],[1,"card-body","d-flex","p-0","flex-column","h-100","position-relative"],[3,"useTransition","gutterSize","dragEnd","transitionEnd"],[1,"d-flex","mb-0","position-relative",3,"size"],["area0","asSplitArea"],["left","",1,"h-100","overflow-hidden","w-100"],["sqlEditor",""],[1,"d-flex","overflow-auto","flex-column","explorer-section",3,"size"],["area1","asSplitArea"],["direction","vertical",3,"hidden","restrictMove","useTransition","gutterSize"],[3,"size"],[1,"d-flex","flex-column","p-2","h-100"],[1,"mb-2"],["rowSelection","single",1,"ag-theme-balham","h-100","w-100",3,"columnDefs","defaultColDef","rowData","gridOptions","gridReady"],[1,"d-flex","flex-column","p-2","h-100","h-100","overflow-hidden"],[1,"d-flex","flex-row"],[1,"ml-auto",3,"grid","saveToTable"],[1,"h-100","overflow-hidden",3,"dataSource"],["dataGrid",""],["class","d-flex justify-content-center align-items-center w-100 h-100 spinner flex-column",4,"ngIf"],[1,"btn-group","d-block","mode"],["ngDefaultControl","","btnCheckbox","","tabindex","0","role","button","name","mode-code","title","SQL Procedure panel",1,"btn","btn-secondary","btn-sm","cursor-pointer","mb-0",3,"ngModel","ngModelChange","click"],[1,"fa","fa-code","fa-lg","mr-2"],["ngDefaultControl","","btnCheckbox","","tabindex","0","role","button","name","mode-result","title","Result panel",1,"btn","btn-secondary","btn-sm","cursor-pointer","mb-0",3,"ngModel","ngModelChange","click"],[1,"fa","fa-table","fa-lg","mr-2"],["ngDefaultControl","","btnCheckbox","","tabindex","0","role","button","name","mode-parameters",1,"btn","btn-secondary","btn-sm","cursor-pointer","mb-0",3,"ngModel","ngModelChange","click"],[1,"fa","fa-check","fa-lg","mr-2"],[1,"d-flex","justify-content-center","align-items-center","w-100","h-100","spinner","flex-column"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(t,n){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"as-split",2),e.NdJ("dragEnd",function(){return n.resize()})("transitionEnd",function(){return n.resize()}),e.TgZ(3,"as-split-area",3,4),e._UZ(5,"div",5,6),e.qZA(),e.TgZ(7,"as-split-area",7,8)(9,"as-split",9)(10,"as-split-area",10)(11,"div",11)(12,"h4",12),e._uU(13,"Parameters"),e.qZA(),e.TgZ(14,"ag-grid-angular",13),e.NdJ("gridReady",function(c){return n.onGridReady(c)}),e.qZA()()(),e.TgZ(15,"as-split-area",10)(16,"div",14)(17,"div",15)(18,"h4",12),e._uU(19,"Results"),e.qZA(),e._UZ(20,"app-export-menu",16),e.qZA(),e._UZ(21,"app-ag-data-grid",17,18),e.qZA()()(),e.YNc(23,ys,4,0,"div",19),e.qZA()()()(),e.TgZ(24,"div",20)(25,"label",21),e.NdJ("ngModelChange",function(c){return n.modeState.code=c})("click",function(){return n.onModeState()}),e._UZ(26,"i",22),e._uU(27," SQL Procedure "),e.qZA(),e.TgZ(28,"label",23),e.NdJ("ngModelChange",function(c){return n.modeState.result=c})("click",function(){return n.onModeState()}),e._UZ(29,"i",24),e._uU(30," Results "),e.qZA(),e.TgZ(31,"label",25),e.NdJ("ngModelChange",function(c){return n.modeState.parameters=c})("click",function(){return n.onModeState()}),e._UZ(32,"i",26),e._uU(33," Parameters "),e.qZA()()),2&t){const a=e.MAs(22);e.xp6(2),e.Q6J("useTransition",!0)("gutterSize",50===n.codeContentSize?11:0),e.xp6(1),e.Q6J("size",n.codeContentSize),e.xp6(4),e.Q6J("size",100-n.codeContentSize),e.xp6(2),e.Q6J("hidden",n.loading)("restrictMove",!0)("useTransition",!0)("gutterSize",30===n.parametersSize?11:0),e.xp6(1),e.Q6J("size",n.parametersSize),e.xp6(4),e.Q6J("columnDefs",n.columnDefs)("defaultColDef",n.defaultColDef)("rowData",n.paramRows)("gridOptions",n.gridOptions),e.xp6(1),e.Q6J("size",100-n.parametersSize),e.xp6(5),e.Q6J("grid",a.grid)("saveToTable",!0),e.xp6(1),e.Q6J("dataSource",n.dataSource),e.xp6(2),e.Q6J("ngIf",n.loading),e.xp6(2),e.ekj("active",n.modeState.code),e.Q6J("ngModel",n.modeState.code),e.xp6(3),e.ekj("active",n.modeState.result),e.Q6J("ngModel",n.modeState.result),e.xp6(3),e.ekj("active",n.modeState.parameters),e.Q6J("ngModel",n.modeState.parameters)}},dependencies:[r.O5,u.Fj,u.JJ,u.On,je.Mq,je.zE,mt.DF,Xe.Z,fn.U,ze.N8],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}"]}),i})();function Cs(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"app-db-procedure",2),e.NdJ("procedureChanged",function(n){e.CHM(s);const a=e.oxw();return e.KtG(a.onChange(n))})("procedureDeleted",function(){e.CHM(s);const n=e.oxw();return e.KtG(n.onDelete())}),e.qZA()}if(2&o){const s=e.oxw();e.Q6J("dataObject",s.dataObject)("connection",s.connection)}}function Ts(o,i){1&o&&(e.TgZ(0,"div",3)(1,"div",4)(2,"span",5),e._uU(3,"Loading..."),e.qZA()()())}let Ss=(()=>{var o;class i{constructor(t,n,a,c,_,w){this.notificationService=t,this.sqlMetaDataService=n,this.tabsService=a,this.authService=c,this.dbConnectionService=w,this.destroy$=new O.x,this.dataObject={},this.loading=!1,this.connections=[],this.evaluationTime=0,this.evaluating=!1,this.isActivated=!1,this.canSave=!1,this.canReload=!0,this.menuItems=[],(0,De.setBearerToken)(c.token),(0,De.setBaseUrl)(Ke.Z.worksheetsApi),this.menuItems.push(_.exportToCsvMenuItem(()=>this.procedureComponent?.dataGrid?.grid?.rowData||[],()=>this.tabItem?.tabHeader||"")),this.menuItems.push(_.exportToExcelMenuItem(()=>this.procedureComponent?.dataGrid?.grid,()=>this.tabItem?.tabHeader)),this.menuItems.push(_.saveToDatabaseMenuItem(()=>this.procedureComponent?.dataGrid?.grid?.rowData||[])),this.menuItems.push({isDivider:!0}),this.menuItems.push(_.closeAllMenuItem()),this.menuItems.push(_.closeOthersMenuItem())}save(){var t=this;return(0,j.Z)(function*(){if(!t.procedureComponent)throw Error("Component is not initialized");try{const n=yield t.procedureComponent.onSave();t.canSave=!1,t.notificationService.success(`Procedure ${n.schemaName}.${n.objectName} saved`),t.tabStore?.removeChanges()}catch(n){t.notificationService.error(n)}})()}get selectedText(){return this.procedureComponent?.selectedText||""}activated(){var t=this;return(0,j.Z)(function*(){t.isActivated||(t.isActivated=!0,t.dbConnectionService.dbConnectionsList$.pipe((0,E.R)(t.destroy$),(0,H.h)(n=>!!n.length)).subscribe(n=>{t.connections=n,t.initTab()})),t.procedureComponent?.syncQueryParams()})()}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete()}ngOnInit(){var t=this;return(0,j.Z)(function*(){if(!t.tabItem)throw new Error("tabItem is not initialized");t.tabItem.content=t,t.authService.isAuthenticated$.pipe((0,E.R)(t.destroy$),(0,H.h)(n=>n)).subscribe(()=>{const n=t.authService.user?.userId;t.tabStore=new Et(t.tabItem,n),t.canSave=t.tabStore.hasChanges()})})()}initTab(){var t=this;return(0,j.Z)(function*(){const n=t.tabStore?.getChanges();if(n){const a=t.tabItem?.tabParams.owner;t.connection=t.connections.find(c=>c.connectionName===a),t.dataObject=n,t.canSave=!0,t.canReload=!0}else t.reload()})()}reload(){var t=this;return(0,j.Z)(function*(){if(!t.tabItem)throw new Error("tabItem is not initialized");const n=t.tabItem.tabParams.owner,a=(t.tabItem.tabParams.name||"").split(".");t.loading=!0;const c=n,_=a[0],w=a[1];try{t.connection=t.connections.find(P=>P.connectionName===c),t.dataObject=yield t.sqlMetaDataService.getMetaDataObject(c,_,w,Te.HA.Procedure),t.canSave=!1,t.tabStore?.removeChanges()}catch{t.notificationService.error(`Failed to load meta data ${_}.${w}`)}finally{t.loading=!1}})()}handleKeyboardEvent(t){this.tabsService.activeTab===this.tabItem&&("F5"===t.key||t.ctrlKey&&"Enter"===t.key)&&(t.preventDefault(),t.stopImmediatePropagation(),this.onRun())}onRun(){var t=this;return(0,j.Z)(function*(){if(!t.procedureComponent)throw new Error("procedureComponent is not initialized");t.canSave&&!t.selectedText&&(yield t.notificationService.confirmation("Do you want to save latest changes, before 'Run'?"))&&(yield t.save()),t.evaluating=!0;const n=(new Date).getTime();yield t.procedureComponent.onRun(),t.evaluationTime=+new Date-n,t.evaluating=!1})()}onDelete(){var t=this;return(0,j.Z)(function*(){if(!t.procedureComponent)throw new Error("procedureComponent is not initialized");if(yield t.notificationService.confirmation("Are you sure you want to delete this Stored Procedure?"))try{yield t.procedureComponent.onDelete();const{objectName:n,schemaName:a}=t.dataObject;t.notificationService.success(`Procedure '${a}.${n}'' deleted`)}catch(n){t.notificationService.error(n)}})()}onChange({structure:t}){var n=this;return(0,j.Z)(function*(){n.tabStore?.saveChanges(t),n.canSave=!0})()}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(we.g),e.Y36(ge.hp),e.Y36(Se.x),e.Y36(ge.$h),e.Y36(qe.q),e.Y36(We.F))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tab-procedure"]],viewQuery:function(t,n){if(1&t&&e.Gf(mn,5),2&t){let a;e.iGM(a=e.CRH())&&(n.procedureComponent=a.first)}},hostBindings:function(t,n){1&t&&e.NdJ("keydown",function(c){return n.handleKeyboardEvent(c)},!1,e.evT)},inputs:{tabItem:"tabItem"},decls:2,vars:2,consts:[[3,"dataObject","connection","procedureChanged","procedureDeleted",4,"ngIf"],["class","d-flex justify-content-center position-absolute align-items-center w-100 h-100 spinner flex-column",4,"ngIf"],[3,"dataObject","connection","procedureChanged","procedureDeleted"],[1,"d-flex","justify-content-center","position-absolute","align-items-center","w-100","h-100","spinner","flex-column"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(t,n){1&t&&(e.YNc(0,Cs,1,2,"app-db-procedure",0),e.YNc(1,Ts,4,0,"div",1)),2&t&&(e.Q6J("ngIf",!n.loading&&n.dataObject&&n.connection),e.xp6(1),e.Q6J("ngIf",n.loading))},dependencies:[r.O5,mn]}),i})();const xs=function(o,i){return["/data-studio","app",o,i]},ws=function(o){return{file:o}};function As(o,i){if(1&o&&(e.TgZ(0,"div",8),e._UZ(1,"i"),e.TgZ(2,"a",9),e._uU(3),e.qZA()()),2&o){const s=i.$implicit,t=e.oxw(2);e.xp6(1),e.Gre("ml-3 fa ",t.getIcon(s.contentType),""),e.xp6(1),e.Q6J("routerLink",e.WLB(6,xs,null==t.currentApp?null:t.currentApp.appOwner,null==t.currentApp?null:t.currentApp.appName))("queryParams",e.VKq(9,ws,t.fromPathFile(s))),e.xp6(1),e.Oqu(t.fromPathFile(s).replace("/"," / "))}}function Ms(o,i){if(1&o&&(e.TgZ(0,"div",5)(1,"h2",6),e._uU(2),e.qZA(),e.YNc(3,As,4,11,"div",7),e.qZA()),2&o){const s=e.oxw();e.xp6(2),e.AsE("",null==s.currentApp?null:s.currentApp.appOwner," / ",null==s.currentApp?null:s.currentApp.appName,""),e.xp6(1),e.Q6J("ngForOf",s.links)}}let Os=(()=>{var o;class i{constructor(t,n){this.studioService=t,this.appService=n,this.destroy$=new O.x,this.currentApp=null,this.links=null}ngOnInit(){var t=this;return(0,j.Z)(function*(){var n;t.studioService.currentApp$.pipe((0,E.R)(t.destroy$)).subscribe(function(a){return(n=n||(0,j.Z)(function*(c){return yield t.onAppChanged(c)})).apply(this,arguments)})})()}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete()}onAppChanged(t){var n=this;return(0,j.Z)(function*(){n.currentApp=t,t&&(n.links=yield n.appService.loadAppFileLinks(t.appOwner,t.appName,!0))})()}getIcon(t){return en(t)}fromPathFile(t){return(0,fe.Js)(t)}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(Ce.F),e.Y36(ge.UW))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-welcome-project"]],decls:6,vars:1,consts:[[1,"h-100","w-100","overflow-auto"],[1,"d-flex","flex-column","w-100","container"],[1,"d-flex","flex-column","flex-md-row","w-100"],["class","flex-fill w-100 d-flex flex-column pt-4",4,"ngIf"],[1,"flex-fill","w-100"],[1,"flex-fill","w-100","d-flex","flex-column","pt-4"],[1,"pr-2"],["class","d-flex flex-row align-items-center",4,"ngFor","ngForOf"],[1,"d-flex","flex-row","align-items-center"],[1,"btn-link","ml-2",3,"routerLink","queryParams"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e.YNc(3,Ms,4,3,"div",3),e.TgZ(4,"div",4),e._UZ(5,"app-welcome-core"),e.qZA()()()()),2&t&&(e.xp6(3),e.Q6J("ngIf",null==n.currentApp?null:n.currentApp.appOwner))},dependencies:[r.sg,r.O5,_e.rH,xt.P],styles:['[_ngcontent-%COMP%]:root{--bg: #fff;--body-bg: #e4e5e6;--header-bg: #ebedef;--color: #4f5d73;--border-color: #c4c9d0;--ws-alt: #f7f7f7;--form-input-bg: #fff;--form-input-color: #768192;--nav-link-color: #8a93a2;--secondary-color: #c4c9d0;--opacity: .05;--hover: "#f0f3f5"}[_nghost-%COMP%]{display:flex;background:var(--bg);height:100%}ul[_ngcontent-%COMP%]{padding-inline-start:.8em}ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{list-style:none}ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#20a8d8}']}),i})();const Ds=["sqlEditor"];function Is(o,i){1&o&&(e.TgZ(0,"div",27)(1,"div",28)(2,"span",29),e._uU(3,"Loading..."),e.qZA()()())}let gn=(()=>{var o;class i{constructor(t,n,a,c,_){this.notificationService=t,this.dialogService=n,this.sqlMetaDataService=a,this.route=c,this.router=_,this.functionChanged=new e.vpe,this.isChanged=!1,this.paramRows=[],this.codeContentSize=50,this.parametersSize=30,this.modeState={code:!0,result:!0,parameters:!0},this.loading=!1,this.selectedText="",this.ConnectionLevels=Fe.EQ,this.defaultColDef={editable:!0,sortable:!1,suppressFiltersToolPanel:!0,suppressMovable:!0,suppressColumnsToolPanel:!0,suppressMenu:!0},this.gridOptions={},this.columnDefs=[{field:"name",width:200},{field:"value",minWidth:50},{field:"dataType",width:80},{field:"direction"},{field:"isNullable"}],this.sqlEditor={},this.destroy$=new O.x,this.editorChange$=new O.x,this.dataSource=new Ft,this.dataSource.data$.pipe((0,E.R)(this.destroy$),(0,H.h)(w=>!!w?.outputParameters)).subscribe(w=>{const P=Object.keys(w?.outputParameters);for(const Z of P){const Y=this.paramRows.find(se=>se.name.toLowerCase()===`@${Z.toLowerCase()}`);Y&&(Y.value=(w?.outputParameters||{})[Z])}})}onGridReady(t){}ngOnInit(){if(!this.sqlElement)throw new Error("sqlElement is not initialized");if(!this.dataObject)throw new Error("dataObject is not initialized");this.sqlEditor=Ee.editor.create(this.sqlElement.nativeElement,{language:"sql",value:this.dataObject.sqlText||"",tabSize:2,scrollBeyondLastLine:!1,readOnly:(this.connection?.codeAccessLevel||0)<Fe.EQ.SqlExecute}),this.sqlEditor.onDidChangeCursorSelection(a=>{const c=this.sqlEditor?.getModel()?.getValueInRange(this.sqlEditor?.getSelection());c!==this.selectedText&&(this.selectedText=c||"")}),this.sqlEditor.onDidChangeModelContent(()=>{this.editorChange$.next(null)}),this.editorChange$.pipe((0,E.R)(this.destroy$),(0,Be.b)(200)).subscribe(()=>{const a=this.sqlEditor.getValue();this.isChanged=this.dataObject?.sqlText!==a;const c=this.isChanged?{structure:{...this.dataObject,sqlText:a},connection:this.connection}:null;this.functionChanged.emit(c)});const n=this.route.snapshot.queryParams;this.paramRows=(this.dataObject.parameters||[]).map(a=>({name:a.parameterName,direction:a.parameterDirection,value:n.hasOwnProperty(a.parameterName)?n[a.parameterName]:null,isNullable:a.isNullable})),Ne.z.schedule(()=>{this.resize()})}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete()}ngOnChanges({dataObject:t}){t.firstChange||(this.isChanged=!1)}onRun(){var t=this;return(0,j.Z)(function*(){t.loading=!0;const n=t.paramRows.filter(w=>null!=w.value).reduce((w,P)=>(w[P.name.replace("@","")]=(0,ft.parseNumberOrNull)(P.value)||P.value,w),{}),a=t.paramRows.filter(w=>null!=w.value).reduce((w,P)=>(w[P.name.replace("@","")]=P.direction,w),{});let c="";for(var _=0;_<Object.values(n).length;_++)Object.values(n),"number"==typeof Object.values(n)[_]&&(c+=`${Object.values(n)[_]}, `),"string"==typeof Object.values(n)[_]&&(c+=`'${Object.values(n)[_]}', `);try{t.selectedText?yield t.dataSource.reload({connectionName:t.connection?.connectionName||"",sql:t.selectedText}):yield t.dataSource.reload({commandType:"Function",connectionName:t.connection?.connectionName,sqlParams:n,sqlParamDirections:a,sql:`select * from ${t.dataObject?.schemaName}.${t.dataObject?.objectName}(${c.slice(0,-2)})`}),t.syncQueryParams()}catch(w){t.notificationService.error(w)}finally{t.loading=!1}})()}syncQueryParams(){const t=this.paramRows.filter(n=>null!==n.value).reduce((n,a)=>(n[a.name]=a.value,n),{});this.router.navigate([],{relativeTo:this.route,queryParams:t})}onSave(){var t=this;return(0,j.Z)(function*(){if(!t.dataObject)throw new Error("dataObject is not initialized");const n=t.sqlEditor.getValue();if(!t.connection)throw new Error("Connection is not initialized");return yield t.sqlMetaDataService.saveDbObject(t.connection.connectionName,{...t.dataObject,sqlText:n})})()}onDelete(){var t=this;return(0,j.Z)(function*(){if(!t.connection)throw new Error("Connection is not initialized");yield t.sqlMetaDataService.deleteObject(t.connection.connectionName,t.dataObject)})()}onModeState(){const t=this.modeState.parameters||this.modeState.result;this.codeContentSize=this.modeState.code&&!t?100:this.modeState.code&&t?50:0,this.parametersSize=this.modeState.parameters&&!this.modeState.result?100:this.modeState.parameters&&this.modeState.result?30:0}resize(){this.sqlEditor?.layout()}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(we.g),e.Y36(xe.x),e.Y36(ge.hp),e.Y36(_e.gz),e.Y36(_e.F0))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-db-function"]],viewQuery:function(t,n){if(1&t&&(e.Gf(Ds,7),e.Gf(Xe.Z,7)),2&t){let a;e.iGM(a=e.CRH())&&(n.sqlElement=a.first),e.iGM(a=e.CRH())&&(n.dataGrid=a.first)}},inputs:{dataObject:"dataObject",connection:"connection"},outputs:{functionChanged:"functionChanged"},features:[e.TTD],decls:34,vars:27,consts:[[1,"card","overflow-hidden","mb-0","w-100","h-100"],[1,"card-body","d-flex","p-0","flex-column","h-100","position-relative"],[3,"useTransition","gutterSize","dragEnd","transitionEnd"],[1,"d-flex","mb-0","position-relative",3,"size"],["area0","asSplitArea"],["left","",1,"h-100","overflow-hidden","w-100"],["sqlEditor",""],[1,"d-flex","overflow-auto","flex-column","explorer-section",3,"size"],["area1","asSplitArea"],["direction","vertical",3,"hidden","restrictMove","useTransition","gutterSize"],[3,"size"],[1,"d-flex","flex-column","p-2","h-100"],[1,"mb-2"],["rowSelection","single",1,"ag-theme-balham","h-100","w-100",3,"columnDefs","defaultColDef","rowData","gridOptions","gridReady"],[1,"d-flex","flex-column","p-2","h-100","h-100","overflow-hidden"],[1,"d-flex","flex-row"],[1,"ml-auto",3,"grid","saveToTable"],[1,"h-100","overflow-hidden",3,"dataSource"],["dataGrid",""],["class","d-flex justify-content-center align-items-center w-100 h-100 spinner flex-column",4,"ngIf"],[1,"btn-group","d-block","mode"],["ngDefaultControl","","btnCheckbox","","tabindex","0","role","button","name","mode-code","title","SQL Function panel",1,"btn","btn-secondary","btn-sm","cursor-pointer","mb-0",3,"ngModel","ngModelChange","click"],[1,"fa","fa-code","fa-lg","mr-2"],["ngDefaultControl","","btnCheckbox","","tabindex","0","role","button","name","mode-result","title","Result panel",1,"btn","btn-secondary","btn-sm","cursor-pointer","mb-0",3,"ngModel","ngModelChange","click"],[1,"fa","fa-table","fa-lg","mr-2"],["ngDefaultControl","","btnCheckbox","","tabindex","0","role","button","name","mode-parameters",1,"btn","btn-secondary","btn-sm","cursor-pointer","mb-0",3,"ngModel","ngModelChange","click"],[1,"fa","fa-check","fa-lg","mr-2"],[1,"d-flex","justify-content-center","align-items-center","w-100","h-100","spinner","flex-column"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(t,n){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"as-split",2),e.NdJ("dragEnd",function(){return n.resize()})("transitionEnd",function(){return n.resize()}),e.TgZ(3,"as-split-area",3,4),e._UZ(5,"div",5,6),e.qZA(),e.TgZ(7,"as-split-area",7,8)(9,"as-split",9)(10,"as-split-area",10)(11,"div",11)(12,"h4",12),e._uU(13,"Parameters"),e.qZA(),e.TgZ(14,"ag-grid-angular",13),e.NdJ("gridReady",function(c){return n.onGridReady(c)}),e.qZA()()(),e.TgZ(15,"as-split-area",10)(16,"div",14)(17,"div",15)(18,"h4",12),e._uU(19,"Results"),e.qZA(),e._UZ(20,"app-export-menu",16),e.qZA(),e._UZ(21,"app-ag-data-grid",17,18),e.qZA()()(),e.YNc(23,Is,4,0,"div",19),e.qZA()()()(),e.TgZ(24,"div",20)(25,"label",21),e.NdJ("ngModelChange",function(c){return n.modeState.code=c})("click",function(){return n.onModeState()}),e._UZ(26,"i",22),e._uU(27," SQL Function "),e.qZA(),e.TgZ(28,"label",23),e.NdJ("ngModelChange",function(c){return n.modeState.result=c})("click",function(){return n.onModeState()}),e._UZ(29,"i",24),e._uU(30," Results "),e.qZA(),e.TgZ(31,"label",25),e.NdJ("ngModelChange",function(c){return n.modeState.parameters=c})("click",function(){return n.onModeState()}),e._UZ(32,"i",26),e._uU(33," Parameters "),e.qZA()()),2&t){const a=e.MAs(22);e.xp6(2),e.Q6J("useTransition",!0)("gutterSize",50===n.codeContentSize?11:0),e.xp6(1),e.Q6J("size",n.codeContentSize),e.xp6(4),e.Q6J("size",100-n.codeContentSize),e.xp6(2),e.Q6J("hidden",n.loading)("restrictMove",!0)("useTransition",!0)("gutterSize",30===n.parametersSize?11:0),e.xp6(1),e.Q6J("size",n.parametersSize),e.xp6(4),e.Q6J("columnDefs",n.columnDefs)("defaultColDef",n.defaultColDef)("rowData",n.paramRows)("gridOptions",n.gridOptions),e.xp6(1),e.Q6J("size",100-n.parametersSize),e.xp6(5),e.Q6J("grid",a.grid)("saveToTable",!0),e.xp6(1),e.Q6J("dataSource",n.dataSource),e.xp6(2),e.Q6J("ngIf",n.loading),e.xp6(2),e.ekj("active",n.modeState.code),e.Q6J("ngModel",n.modeState.code),e.xp6(3),e.ekj("active",n.modeState.result),e.Q6J("ngModel",n.modeState.result),e.xp6(3),e.ekj("active",n.modeState.parameters),e.Q6J("ngModel",n.modeState.parameters)}},dependencies:[r.O5,u.Fj,u.JJ,u.On,je.Mq,je.zE,mt.DF,Xe.Z,fn.U,ze.N8],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}"]}),i})();function Es(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"app-db-function",2),e.NdJ("functionChanged",function(n){e.CHM(s);const a=e.oxw();return e.KtG(a.onChange(n))})("functionDeleted",function(){e.CHM(s);const n=e.oxw();return e.KtG(n.onDelete())}),e.qZA()}if(2&o){const s=e.oxw();e.Q6J("dataObject",s.dataObject)("connection",s.connection)}}function Fs(o,i){1&o&&(e.TgZ(0,"div",3)(1,"div",4)(2,"span",5),e._uU(3,"Loading..."),e.qZA()()())}let Ps=(()=>{var o;class i{constructor(t,n,a,c,_,w){this.notificationService=t,this.sqlMetaDataService=n,this.tabsService=a,this.authService=c,this.dbConnectionService=w,this.destroy$=new O.x,this.dataObject={},this.loading=!1,this.connections=[],this.evaluationTime=0,this.evaluating=!1,this.isActivated=!1,this.canSave=!1,this.canReload=!0,this.menuItems=[],(0,De.setBearerToken)(c.token),(0,De.setBaseUrl)(Ke.Z.worksheetsApi),this.menuItems.push(_.exportToCsvMenuItem(()=>this.functionComponent?.dataGrid?.grid?.rowData||[],()=>this.tabItem?.tabHeader||"")),this.menuItems.push(_.exportToExcelMenuItem(()=>this.functionComponent?.dataGrid?.grid,()=>this.tabItem?.tabHeader)),this.menuItems.push(_.saveToDatabaseMenuItem(()=>this.functionComponent?.dataGrid?.grid?.rowData||[])),this.menuItems.push({isDivider:!0}),this.menuItems.push(_.closeAllMenuItem()),this.menuItems.push(_.closeOthersMenuItem())}save(){var t=this;return(0,j.Z)(function*(){if(!t.functionComponent)throw Error("Component is not initialized");try{const n=yield t.functionComponent.onSave();t.canSave=!1,t.notificationService.success(`Function ${n.schemaName}.${n.objectName} saved`),t.tabStore?.removeChanges()}catch(n){t.notificationService.error(n)}})()}get selectedText(){return this.functionComponent?.selectedText||""}activated(){var t=this;return(0,j.Z)(function*(){t.isActivated||(t.isActivated=!0,t.dbConnectionService.dbConnectionsList$.pipe((0,E.R)(t.destroy$),(0,H.h)(n=>!!n.length)).subscribe(n=>{t.connections=n,t.initTab()})),t.functionComponent?.syncQueryParams()})()}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete()}ngOnInit(){var t=this;return(0,j.Z)(function*(){if(!t.tabItem)throw new Error("tabItem is not initialized");t.tabItem.content=t,t.authService.isAuthenticated$.pipe((0,E.R)(t.destroy$),(0,H.h)(n=>n)).subscribe(()=>{const n=t.authService.user?.userId;t.tabStore=new Et(t.tabItem,n),t.canSave=t.tabStore.hasChanges()})})()}initTab(){var t=this;return(0,j.Z)(function*(){const n=t.tabStore?.getChanges();if(n){const a=t.tabItem?.tabParams.owner;t.connection=t.connections.find(c=>c.connectionName===a),t.dataObject=n,t.canSave=!0,t.canReload=!0}else t.reload()})()}reload(){var t=this;return(0,j.Z)(function*(){if(!t.tabItem)throw new Error("tabItem is not initialized");const n=t.tabItem.tabParams.owner,a=(t.tabItem.tabParams.name||"").split("."),c=n,_=a[0],w=a[1];t.connection=t.connections.find(P=>P.connectionName===c);try{t.loading=!0,t.dataObject=yield t.sqlMetaDataService.getMetaDataObject(c,_,w,Te.HA.Procedure),t.canSave=!1,t.tabStore?.removeChanges()}catch{t.notificationService.error(`Failed to load meta data ${_}.${w}`)}finally{t.loading=!1}})()}handleKeyboardEvent(t){this.tabsService.activeTab===this.tabItem&&("F5"===t.key||t.ctrlKey&&"Enter"===t.key)&&(t.preventDefault(),t.stopImmediatePropagation(),this.onRun())}onRun(){var t=this;return(0,j.Z)(function*(){if(!t.functionComponent)throw new Error("functionComponent is not initialized");t.canSave&&!t.selectedText&&(yield t.notificationService.confirmation("Do you want to save latest changes, before 'Run'?"))&&(yield t.save()),t.evaluating=!0;const n=(new Date).getTime();yield t.functionComponent.onRun(),t.evaluationTime=+new Date-n,t.evaluating=!1})()}onDelete(){var t=this;return(0,j.Z)(function*(){if(!t.functionComponent)throw new Error("functionComponent is not initialized");if(yield t.notificationService.confirmation("Are you sure you want to delete this Function?"))try{yield t.functionComponent.onDelete();const{objectName:n,schemaName:a}=t.dataObject;t.notificationService.success(`Function '${a}.${n}'' deleted`)}catch(n){t.notificationService.error(n)}})()}onChange({structure:t}){var n=this;return(0,j.Z)(function*(){n.tabStore?.saveChanges(t),n.canSave=!0})()}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(we.g),e.Y36(ge.hp),e.Y36(Se.x),e.Y36(ge.$h),e.Y36(qe.q),e.Y36(We.F))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tab-function"]],viewQuery:function(t,n){if(1&t&&e.Gf(gn,5),2&t){let a;e.iGM(a=e.CRH())&&(n.functionComponent=a.first)}},hostBindings:function(t,n){1&t&&e.NdJ("keydown",function(c){return n.handleKeyboardEvent(c)},!1,e.evT)},inputs:{tabItem:"tabItem"},decls:2,vars:2,consts:[[3,"dataObject","connection","functionChanged","functionDeleted",4,"ngIf"],["class","d-flex justify-content-center position-absolute align-items-center w-100 h-100 spinner flex-column",4,"ngIf"],[3,"dataObject","connection","functionChanged","functionDeleted"],[1,"d-flex","justify-content-center","position-absolute","align-items-center","w-100","h-100","spinner","flex-column"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(t,n){1&t&&(e.YNc(0,Es,1,2,"app-db-function",0),e.YNc(1,Fs,4,0,"div",1)),2&t&&(e.Q6J("ngIf",!n.loading&&n.dataObject&&n.connection),e.xp6(1),e.Q6J("ngIf",n.loading))},dependencies:[r.O5,gn]}),i})();function Ns(o,i){if(1&o&&(e.TgZ(0,"span",9),e._uU(1),e.qZA()),2&o){const s=e.oxw().$implicit;e.oxw();const t=e.MAs(5);e.Q6J("cdkContextMenuTriggerFor",t)("title",s.tabId),e.xp6(1),e.AsE("",null!=s&&null!=s.content&&s.content.canSave?"* ":"","",s.tabHeader,"")}}function ks(o,i){if(1&o&&e._UZ(0,"app-tab-app-xml",10),2&o){const s=e.oxw().$implicit;e.Q6J("tabItem",s)}}function Zs(o,i){if(1&o&&e._UZ(0,"app-tab-jspy",10),2&o){const s=e.oxw().$implicit;e.Q6J("tabItem",s)}}function Rs(o,i){if(1&o&&e._UZ(0,"app-tab-html",10),2&o){const s=e.oxw().$implicit;e.Q6J("tabItem",s)}}function qs(o,i){if(1&o&&e._UZ(0,"app-tab-html",10),2&o){const s=e.oxw().$implicit;e.Q6J("tabItem",s)}}function Js(o,i){if(1&o&&e._UZ(0,"app-tab-js",10),2&o){const s=e.oxw().$implicit;e.Q6J("tabItem",s)}}function js(o,i){if(1&o&&e._UZ(0,"app-tab-json",10),2&o){const s=e.oxw().$implicit;e.Q6J("tabItem",s)}}function $s(o,i){if(1&o&&e._UZ(0,"app-tab-data-query",10),2&o){const s=e.oxw().$implicit;e.Q6J("tabItem",s)}}function Qs(o,i){if(1&o&&e._UZ(0,"app-tab-db-table",10),2&o){const s=e.oxw().$implicit;e.Q6J("tabItem",s)}}function Ls(o,i){if(1&o&&e._UZ(0,"app-tab-db-table",10),2&o){const s=e.oxw().$implicit;e.Q6J("tabItem",s)}}function Bs(o,i){if(1&o&&e._UZ(0,"app-tab-procedure",10),2&o){const s=e.oxw().$implicit;e.Q6J("tabItem",s)}}function Us(o,i){if(1&o&&e._UZ(0,"app-tab-function",10),2&o){const s=e.oxw().$implicit;e.Q6J("tabItem",s)}}function Hs(o,i){if(1&o&&e._UZ(0,"app-tab-sql",10),2&o){const s=e.oxw().$implicit;e.Q6J("tabItem",s)}}function zs(o,i){if(1&o&&(e.TgZ(0,"div"),e._uU(1),e.qZA()),2&o){const s=e.oxw().$implicit;e.xp6(1),e.hij(" ",s.tabHeader," ")}}function Ys(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"tab",4),e.NdJ("removed",function(){const a=e.CHM(s).$implicit,c=e.oxw();return e.KtG(c.onTabRemove(a))})("selectTab",function(){const a=e.CHM(s).$implicit,c=e.oxw();return e.KtG(c.onSelectTab(a))}),e.YNc(1,Ns,2,4,"ng-template",5),e.ynx(2,6),e.YNc(3,ks,1,1,"app-tab-app-xml",7),e.YNc(4,Zs,1,1,"app-tab-jspy",7),e.YNc(5,Rs,1,1,"app-tab-html",7),e.YNc(6,qs,1,1,"app-tab-html",7),e.YNc(7,Js,1,1,"app-tab-js",7),e.YNc(8,js,1,1,"app-tab-json",7),e.YNc(9,$s,1,1,"app-tab-data-query",7),e.YNc(10,Qs,1,1,"app-tab-db-table",7),e.YNc(11,Ls,1,1,"app-tab-db-table",7),e.YNc(12,Bs,1,1,"app-tab-procedure",7),e.YNc(13,Us,1,1,"app-tab-function",7),e.YNc(14,Hs,1,1,"app-tab-sql",7),e.YNc(15,zs,2,1,"div",8),e.BQk(),e.qZA()}if(2&o){const s=i.$implicit;e.Q6J("removable",!0)("id",s.tabId),e.xp6(2),e.Q6J("ngSwitch",s.tabType),e.xp6(1),e.Q6J("ngSwitchCase","app.xml"),e.xp6(1),e.Q6J("ngSwitchCase","jspy"),e.xp6(1),e.Q6J("ngSwitchCase","page.xml"),e.xp6(1),e.Q6J("ngSwitchCase","component.xml"),e.xp6(1),e.Q6J("ngSwitchCase","js"),e.xp6(1),e.Q6J("ngSwitchCase","json"),e.xp6(1),e.Q6J("ngSwitchCase","query"),e.xp6(1),e.Q6J("ngSwitchCase","table"),e.xp6(1),e.Q6J("ngSwitchCase","view"),e.xp6(1),e.Q6J("ngSwitchCase","procedure"),e.xp6(1),e.Q6J("ngSwitchCase","function"),e.xp6(1),e.Q6J("ngSwitchCase","sql")}}function Gs(o,i){if(1&o){const s=e.EpF();e.TgZ(0,"button",15),e.NdJ("cdkMenuItemTriggered",function(){e.CHM(s);const n=e.oxw().$implicit,a=e.oxw(2);return e.KtG(a.onContextMenuClick(n))}),e._UZ(1,"i"),e._uU(2),e.qZA()}if(2&o){const s=e.oxw().$implicit;e.xp6(1),e.Gre("fa ",s.icon||"fa-circle-thin"," mr-2"),e.xp6(1),e.hij("",s.label," ")}}function Ks(o,i){1&o&&e._UZ(0,"hr")}function Vs(o,i){if(1&o&&(e.ynx(0),e.YNc(1,Gs,3,4,"button",13),e.YNc(2,Ks,1,0,"hr",14),e.BQk()),2&o){const s=i.$implicit;e.xp6(1),e.Q6J("ngIf",!s.isDivider),e.xp6(1),e.Q6J("ngIf",s.isDivider)}}function Ws(o,i){if(1&o&&(e.TgZ(0,"div",11),e.YNc(1,Vs,3,2,"ng-container",12),e.qZA()),2&o){const s=e.oxw();e.xp6(1),e.Q6J("ngForOf",s.activeTabMenuItems)}}let Xs=(()=>{var o;class i{constructor(t,n,a){this.tabsService=t,this.router=n,this.route=a,this.activeTabMenuItems=[],this.contentsToResize=new Set,this.destroy$=new O.x,this.tabs=t.tabs,t.activeTab$.subscribe(c=>{this.activeTabMenuItems.splice(0,this.activeTabMenuItems.length),c?.content?.menuItems?.forEach(_=>this.activeTabMenuItems.push(_))})}ngOnInit(){var t=this;return(0,j.Z)(function*(){var n;t.subscribeOnRouter(),t.tabsService.activeTab$.pipe((0,E.R)(t.destroy$),(0,H.h)(a=>!!a)).subscribe(function(a){return(n=n||(0,j.Z)(function*(c){return yield t.selectTab(c)})).apply(this,arguments)})})()}ngOnDestroy(){this.destroy$.next(null),this.destroy$.complete(),this.tabsService.removeAllTabs(),this.tabsService.destroy()}onTabRemove(t){let n=this.tabsService.tabs.indexOf(t);if(n<0)return;const a=this.tabsService.activeTab?.tabId===t.tabId;this.tabsService.removeTab(t),"function"==typeof t.content.deleteLocalChanges&&t.content.deleteLocalChanges(),a&&this.tabsService.tabs.length?this.onSelectTab(this.tabsService.tabs[Math.max(0,n-1)]):this.tabsService.tabs.length||this.router.navigate([],{relativeTo:this.route,queryParams:{}})}onSelectTab(t){const{appOrSql:n,owner:a,name:c}=t.tabParams;this.router.navigate([`data-studio/${n}`,a,c],{queryParams:t.queryParams})}resize(){const t=this.tabsService.activeTab;t&&(t.content?.resize?.(),this.tabs.forEach(n=>{n!==t&&this.contentsToResize.add(n.content)}))}selectTab(t){var n=this;return(0,j.Z)(function*(){if(!n.tabset)throw new Error("this.tabset is not initilized");const a=(n.tabset?.tabs||[]).map(c=>c.id).indexOf(n.tabsService.getTabKey(t));-1!==a&&(n.tabset.tabs[a].active=!0,"function"==typeof t.content?.activated?(yield t.content.activated(),n.contentsToResize.has(t.content)&&(t.content.resize?.(),n.contentsToResize.delete(t.content))):console.warn("activate is not implemented here"))})()}subscribeOnRouter(){this.route.queryParams.pipe((0,E.R)(this.destroy$),(0,H.h)(t=>"app"===this.route.snapshot.params.appOrSql&&t.file)).subscribe(t=>this.tabsService.activateTab(this.createAppContentTabFromUrl())),this.route.params.pipe((0,E.R)(this.destroy$),(0,H.h)(t=>"sql"===t.appOrSql)).subscribe(t=>this.tabsService.activateTab(this.createSqlTabFromUrl()))}createAppContentTabFromUrl(){const{appOrSql:t}=this.route.snapshot.params,{file:c}=this.route.snapshot.queryParams;if("app"!==t||!c)throw new Error("Can't create App Content Tab. appOrSql !== 'app' || !file ");const _=(0,fe.tT)(c);let w=`${_.name||""}${_.name?".":""}${_.contentType}`;w=w.length<25?w:"..."+w.substring(w.length-25);const{params:P,queryParams:Z}=this.route.snapshot,Y={...P,...Z};return new dn.E({tabId:this.tabsService.getTabKeyFromUrlParams(P,Z),queryParams:Z,tabParams:Y,tabType:_.contentType,tabHeader:w})}createSqlTabFromUrl(){const t=this.route.snapshot.params.name,n=`${t.substring(0,t.lastIndexOf("."))}`,{params:a,queryParams:c}=this.route.snapshot,_={...a,...c},w=String(t).toLowerCase().substring(String(t).lastIndexOf(".")+1);return new dn.E({tabHeader:n,tabType:w,queryParams:c,tabParams:_,tabId:this.tabsService.getTabKeyFromUrlParams(a,c)})}onContextMenuClick(t){const n=this.tabsService.activeTab?.content?.menuItems?.find(a=>a.label===t.label);n?.click(n)}}return(o=i).\u0275fac=function(t){return new(t||o)(e.Y36(Se.x),e.Y36(_e.F0),e.Y36(_e.gz))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tabs"]],viewQuery:function(t,n){if(1&t&&e.Gf(Re.AH,7),2&t){let a;e.iGM(a=e.CRH())&&(n.tabset=a.first)}},hostBindings:function(t,n){1&t&&e.NdJ("resize",function(c){return n.resize(c)},!1,e.Jf7)},decls:6,vars:3,consts:[[1,"h-100",3,"hidden"],[1,"tabset-fx","nav-tabs-boxed","overflow-hidden",3,"hidden"],[3,"removable","id","removed","selectTab",4,"ngFor","ngForOf"],["ctxMenu",""],[3,"removable","id","removed","selectTab"],["tabHeading",""],[3,"ngSwitch"],["class","h-100 w-100",3,"tabItem",4,"ngSwitchCase"],[4,"ngSwitchDefault"],[3,"cdkContextMenuTriggerFor","title"],[1,"h-100","w-100",3,"tabItem"],["cdkMenu","",1,"context-menu"],[4,"ngFor","ngForOf"],["class","context-menu-item","cdkMenuItem","",3,"cdkMenuItemTriggered",4,"ngIf"],[4,"ngIf"],["cdkMenuItem","",1,"context-menu-item",3,"cdkMenuItemTriggered"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e._UZ(1,"app-welcome-project"),e.qZA(),e.TgZ(2,"tabset",1),e.YNc(3,Ys,16,15,"tab",2),e.qZA(),e.YNc(4,Ws,2,1,"ng-template",null,3,e.W1O)),2&t&&(e.Q6J("hidden",!!n.tabs.length),e.xp6(2),e.Q6J("hidden",!n.tabs.length),e.xp6(1),e.Q6J("ngForOf",n.tabs))},dependencies:[r.sg,r.O5,r.RF,r.n9,r.ED,Re.wW,Re.AH,Re.y3,Bt,Ue,Ut,Vo,Xo,is,ss,rs,us,ps,_s,Ss,Os,Ps],styles:['tabset[_ngcontent-%COMP%]     .bs-remove-tab{visibility:hidden;position:relative}tabset[_ngcontent-%COMP%]     .bs-remove-tab:after{content:"\\f00d";font-family:FontAwesome;color:inherit;position:absolute;visibility:visible;right:0}tabset[_ngcontent-%COMP%]     .tab-content{position:relative}']}),i})();var ea=d(10708),ta=d(22096),na=d(58504);let _n=(()=>{var o;class i{constructor(t,n,a){this.router=t,this.authenticationService=n,this.appStateService=a}canActivate(t,n){var a=this;return(0,j.Z)(function*(){const{appOrSql:c,owner:_,name:w}=t.params;return"app"===c&&w===Oe.b5||((yield a.authenticationService.checkPermissions(c,_,w))?"app"===c?yield(0,ea.n)(a.navigateToApp(_,w)):"sql"===c&&a.navigateToSql(_,w):(a.router.navigate(["/login"],{queryParams:{returnUrl:n.url}}),!1))})()}navigateToApp(t,n){return t===Oe.m5||n===Oe.b5?(this.appStateService.setCurrentApp(null),(0,ta.of)(!0)):this.appStateService.getApp(t,n).pipe((0,At.U)(a=>(a||(0,na._)(`No access to application ${t}/${n}`),this.appStateService.setCurrentApp(a),!!a)))}navigateToSql(t,n){return this.appStateService.currentConnection=t,!0}}return(o=i).\u0275fac=function(t){return new(t||o)(e.LFG(_e.F0),e.LFG(ge.$h),e.LFG(Ce.F))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac}),i})(),bn=(()=>{var o;class i{constructor(t,n){this.router=t,this.studioStateService=n}canActivate(t,n){const{connection:a}=t.params;return this.studioStateService.currentConnection=a,!0}}return(o=i).\u0275fac=function(t){return new(t||o)(e.LFG(_e.F0),e.LFG(Ce.F))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac}),i})();const ia=[{path:"editors",loadChildren:()=>d.e(964).then(d.bind(d,50964)).then(o=>o.EditorModule)},{path:"",component:Uo,children:[{path:"",component:xt.P},{path:"sql/:connection",canActivate:[bn],component:xt.P},{path:":appOrSql/:owner/:name",component:Xs,canActivate:[_n]}]}];let oa=(()=>{var o;class i{}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[_e.Bz.forChild(ia),_e.Bz]}),i})();var sa=d(20362),aa=d(52667);let ra=(()=>{var o;class i{}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[r.ez,St.nM,u.u5,Ht.fx.forRoot(),ye.mr.forRoot(),mt.Fq.forRoot()]}),i})(),la=(()=>{var o;class i{}return(o=i).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({providers:[xe.x,Ce.F,_n,bn,zt.h,Ve.j5,Se.x,qe.q,Ot],imports:[r.ez,oa,te.JF,Gn.I,St.nM,u.u5,aa.c,je.fX,Ht.fx.forRoot(),ye.mr.forRoot(),mt.Fq.forRoot(),Re.P4.forRoot(),cn.UU.forRoot(),ut.A0,sa.T,ra,ze.sF,Yn]}),i})()},13389:(be,ue,d)=>{d.d(ue,{E:()=>u});var r=d(32013);class u{constructor({queryParams:e,tabHeader:D,tabId:v,tabParams:ie,tabType:H}){this.isLoadedSubj$=new r.x,this.isLoaded$=this.isLoadedSubj$.asObservable(),this.queryParams=e,this.tabId=v,this.tabHeader=D,this.tabParams=ie,this.tabType=H}set content(e){this.content_=e,this.content&&(this.isLoadedSubj$.next(!0),this.isLoadedSubj$.complete())}get content(){return this.content_}get routePath(){const{appOrSql:e,owner:D,name:v}=this.tabParams;return[e,D,v]}static serialize(e){return JSON.stringify({tabId:e.tabId,tabHeader:e.tabHeader,tabType:e.tabType,tabParams:e.tabParams,queryParams:e.queryParams})}static deserialize(e){try{return new u(JSON.parse(e))}catch(D){return console.error(D),null}}}},90271:(be,ue,d)=>{d.d(ue,{q:()=>L});var r=d(15861),u=d(13509),te=d(85132),e=d(82974),D=d(13231),v=d(91334);function ie(O,b){const{connectionName:g,tableName:p,tableAlias:S,fields:J,tablesJoin:G,limitRowsCount:ee,orderBy:$}=O;let oe;oe=J?.length?`\n\t${J.map(function A(h){const m=h.sqlExpression?.indexOf(".")?h.sqlExpression?.substring(h.sqlExpression?.indexOf(".")+1):h.sqlExpression;return(h.name===m?h.sqlExpression||h.name:`${h.sqlExpression||""} ${h.name}`).trim()}).join(",\n\t")}\n`:"*";let K=`-- Connection: ${g}\n\n`;if(K+="SELECT"+(ee?` TOP ${ee} `:""),K+=`${oe}FROM ${p}`,S&&(K+=` ${S}`),G?.forEach(h=>{const m=h.joinType.split("Join");K+=`\n\t${m[0]} Join ${h.tableName} ${h.tableAlias} ON ${h.joinCondition}${h.joinCondition2?` AND ${h.joinCondition2}`:""}`}),b&&(K+=function H(O,b){const{tableAlias:A}=b;let g="";for(let p=0;p<O.length;p++)if(O[p].filterValue){const S=(0,v.UT)(O[p].filterValue),J=z(O[p].operation,S,O[p].columnName);0===p&&(g+=`\nWHERE (${A}.${J} )`),0!==p&&(g+=`\n\tAND (${A}.${J} )`)}return g}(b,O)),J){const h=J.filter(m=>!0===m.groupBy).map(m=>m.sqlExpression);0!==h.length&&(K+=`\nGROUP BY ${h.toString()}`)}return $?.length&&(K+=`\nORDER BY ${$.map(h=>`${h.fieldName} ${h.direction||"ASC"}`).join(", ")}`),K.trim()+"\n"}function z(O,b,A){let g,p,S="";const J=String(b).split(",");let G="";return J.forEach(ee=>{G+=`'${ee}',`}),"Like"===O&&(S+=`${A} LIKE '${J}'`),"NotLike"===O&&(S+=`${A} NOT LIKE '${J}'`),"In"===O&&(S+=`${A} IN (${G.substring(0,G.length-1).split("\r")})`),"NotIn"===O&&(S+=`${A} NOT IN (${G.substring(0,G.length-1).split("\r")})`),"Custom"===O&&(S+=`${b}`),"Search"===O&&(S+="string"==typeof b?`${A} = '${J}'`:`${A} = ${b}`),"Between"===O&&(p=J[0],g=J[1],p!==D.yv&&g!==D.yv&&(S+=`${A} BETWEEN ${p} AND ${g}`),p!==D.yv&&g===D.yv&&(S+=`${A} >= ${p}`),p===D.yv&&g!==D.yv&&(S+=`${A} <= ${g}`)),S}function E(O,b){const{connectionName:g,tableName:p,tableAlias:S,tablesJoin:J,fields:G,orderBy:ee,limitRowsCount:$}=O;let oe=`from 'sql-data-api' import sqlDataApi\n\nsqlDataApi("${g}")`;const[K,h]=(0,v.dp)("",{},"",O,b);return J?.forEach(C=>{const N=C.joinType.charAt(0).toLowerCase()+C.joinType.slice(1);oe+=`\n\t.${N}("${C.tableName} ${C.tableAlias}", "${C.joinCondition}"${C.joinCondition2?`, "${C.joinCondition2}"`:""})`}),G?.length&&(oe+=`\n\t.select("""\n\t\t\t${G.map(function A(C){const N=C.sqlExpression?.indexOf(".")?C.sqlExpression?.substring(C.sqlExpression?.indexOf(".")+1):C.sqlExpression;let he=C.name===N?C.sqlExpression:`${C.sqlExpression||""} ${C.name}`;if(C.groupBy&&(he=`groupBy|${he}`),!he)throw new Error("Sql Expression is not defined");return he.trim()}).join(",\n\t\t\t")}\n\t\t\t""")`),ee?.length&&(oe+=`\n\t.orderBy("${ee.map(C=>`${C.fieldName} ${C.direction||"ASC"}`).join(", ")}")`),$&&(oe+=`\n\t.top(${$})`),K&&h&&(oe+=`\n\t.filter("${K}", ${JSON.stringify(h).trim()})`),oe+=`\n\t.query("${`${p} ${S||""}`.trim()}")\n`,oe}var l=d(65879);let I=(()=>{var O;class b{constructor(){this.message=""}}return(O=b).\u0275fac=function(g){return new(g||O)},O.\u0275cmp=l.Xpm({type:O,selectors:[["app-loading-dialog"]],inputs:{message:"message"},decls:5,vars:1,consts:[[1,"modal-body","py-8","d-flex","flex-column"],[1,"d-flex","justify-content-center","align-items-center","w-100","spinner","flex-column"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(g,p){1&g&&(l.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),l._uU(4),l.qZA()()()()),2&g&&(l.xp6(4),l.Oqu(p.message||"Loading..."))}}),b})();var V=d(60364),ae=d(30046),Q=d(32181),U=d(10708),B=d(37398),M=d(56861),T=d(42014),f=d(22263),y=d(80014),x=d(23991),k=d(33374),F=d(69569),q=d(8050),ne=d(71997),W=d(75263),re=d(55314),X=d(75187);let L=(()=>{var O;class b{constructor(g,p,S,J,G,ee,$,oe){this.dialogService=g,this.notificationService=p,this.fileService=S,this.tabsService=J,this.studioService=G,this.sqlMetaService=ee,this.connectionsService=$,this.router=oe}exportToCsvMenuItem(g,p){return{label:"Export To Csv",icon:"fa-cloud-download",click:()=>this.fileService.exportToFile(g(),{fileType:u.Tv.CSV,fileName:p()})}}exportToFileMenuItem(g,p){return{label:"Export to file",icon:"fa-cloud-download",click:()=>this.dialogService.open(x.r,{initialState:{grid:g(),fileName:p()}})}}exportToExcelMenuItem(g,p){return{label:"Export To Excel",icon:"fa-file-excel-o",click:()=>g()?.api.exportDataAsExcel({skipColumnHeaders:!1,fileName:p()})}}saveToDatabaseMenuItem(g){return{label:"Save To Database",icon:"fa-database",click:()=>{this.dialogService.open(te.E,{class:"modal-xl full-height",keyboard:!1,initialState:{config:g()}}).onClose$.pipe((0,Q.h)(S=>!!S)).subscribe(S=>this.router.navigate(["data-studio","sql",S.connectionName,(0,ae._1)(S)]))}}}addNewJspyTab(){this.tabsService.addNewAppTab(this.studioService.currentApp,"jspy","",f.EY)}addNewJsonTab(){this.tabsService.addNewAppTab(this.studioService.currentApp,"json","","")}addNewSqlQueryTab(g){this.tabsService.addNewAppTab(this.studioService.currentApp,"sql","",`-- Connection: ${g}\n\n\n`)}addNewProcedureTab(g){this.tabsService.addNewAppTab(this.studioService.currentApp,"sql","",`-- Connection: ${g}\n\nCREATE OR ALTER PROCEDURE [procedureName] AS\n`)}addNewFunctionTab(g){let p;"SqlServer"===g.connectionType&&(p=`-- Connection: ${g.connectionName}\n\nCREATE OR ALTER FUNCTION [functionName] (parameters) \n`),"PostgreSql"===g.connectionType&&(p=`-- Connection: ${g.connectionName}\n\nCREATE OR REPLACE FUNCTION [functionName] (parameters) \n`),this.tabsService.addNewAppTab(this.studioService.currentApp,"sql","",p)}addNewViewTab(g){this.tabsService.addNewAppTab(this.studioService.currentApp,"sql","",`-- Connection: ${g}\n\nCREATE OR ALTER VIEW [viewName] AS\n`)}addSelect1000SqlTab(g){var p=this;return(0,r.Z)(function*(){const{connectionName:S,schemaName:J,objectName:G}=g,ee=ie(yield p.getSqlQueryInfo(S,J,G));p.tabsService.addNewAppTab(p.studioService.currentApp,"sql","",ee)})()}addSelectSqlTab(g,p){const S=ie(g,p);this.tabsService.addNewAppTab(this.studioService.currentApp,"sql","",S)}closeAllMenuItem(){return{label:"Close All Tabs",icon:"bi bi-x",click:()=>this.tabsService.removeAllTabs()}}closeOthersMenuItem(){return{label:"Close Other Tabs",icon:"bi bi-x",click:()=>this.tabsService.removeUnActiveTabs()}}addSelectWithSqlDataApiJspyTab(g,p){const S=E(g,p);this.tabsService.addNewAppTab(this.studioService.currentApp,"jspy","",S)}addSelect1000JspyTab(g){var p=this;return(0,r.Z)(function*(){const{connectionName:S,schemaName:J,objectName:G}=g,ee=E(yield p.getSqlQueryInfo(S,J,G));p.tabsService.addNewAppTab(p.studioService.currentApp,"jspy","",ee)})()}addDataQueryTabFromTableLink(g){var p=this;return(0,r.Z)(function*(){const{connectionName:S,schemaName:J,objectName:G}=g;p.addDataQueryTabFromQuery({sqlQuery:{connectionName:S,tableName:`${J}.${G}`,tableAlias:"t",limitRowsCount:1e3},viewType:"DataGrid"})})()}addDataQueryTabFromQuery(g){var p=this;return(0,r.Z)(function*(){p.tabsService.addNewAppTab(p.studioService.currentApp,"query","",JSON.stringify(g))})()}editSqlTableMetadata(g){var p=this;return(0,r.Z)(function*(){const{connectionName:S}=g,J=yield p.connectionsService.loadMyDbConnections(),G=J.find($=>$.connectionName===S),ee=p.dialogService.open(e.W,{class:"modal-xl full-height",keyboard:!1,initialState:{config:{connection:G,connections:J,isNew:!1,dbObjectLink:g}}});return(0,U.n)(ee.onClose$.pipe((0,B.U)($=>!!$)))})()}createNewTable(g){var p=this;return(0,r.Z)(function*(){const S=yield p.connectionsService.loadMyDbConnections(),J=S.find(ee=>ee.connectionName===g),G=p.dialogService.open(e.W,{class:"modal-xl full-height",keyboard:!1,initialState:{config:{connection:J,connections:S,isNew:!0}}}).onClose$.pipe((0,Q.h)(ee=>!!ee)).subscribe(ee=>{G.unsubscribe(),p.router.navigate(["data-studio","sql",ee.connectionName,`${ee.schemaName}.${ee.objectName}.table`]),p.studioService.dbItemAdded(ee)})})()}importCsvData(){var g=this;return(0,r.Z)(function*(){const p=yield g.connectionsService.loadMyDbConnections();g.dialogService.open(T.J,{class:"modal-xl full-height",keyboard:!1,initialState:{config:{connections:p}}}).onClose$.pipe((0,Q.h)(S=>!!S)).subscribe(S=>g.router.navigate(["data-studio","sql",S.connectionName,`${S.schemaName}.${S.objectName}.table`]))})()}createApp(){var g=this;return(0,r.Z)(function*(){yield g.dialogService.open(M.b,{initialState:{config:{appName:"NewApp"}}}).onCloseAsync()})()}deleteSqlTable(g){var p=this;return(0,r.Z)(function*(){const{connectionName:S,schemaName:J,objectName:G}=g,ee=`${S}: '${J}.${G}'`;return!!(yield p.notificationService.confirmation(`Are you sure you want to delete ${ee}?`))&&(yield p.sqlMetaService.deleteObject(S,g),p.notificationService.success(`Table ${ee} deleted`),p.tabsService.removeConnectionTab(g),!0)})()}deleteSqlView(g){var p=this;return(0,r.Z)(function*(){const{connectionName:S,schemaName:J,objectName:G}=g,ee=`${S} ${J}.${G}`;return!!(yield p.notificationService.confirmation(`Are you sure you want to delete ${ee} ?`))&&(yield p.sqlMetaService.deleteObject(S,g),p.notificationService.success(`View ${ee} deleted.`),p.tabsService.removeConnectionTab(g),!0)})()}deleteSqlProcedure(g){var p=this;return(0,r.Z)(function*(){const{connectionName:S,schemaName:J,objectName:G}=g,ee=`'${J}.${G}' (${S})`;return!!(yield p.notificationService.confirmation(`Are you sure you want to delete ${ee} ?`))&&(yield p.sqlMetaService.deleteObject(S,g),p.notificationService.success(`Stored Procedure ${ee} deleted.`),p.tabsService.removeConnectionTab(g),!0)})()}deleteSqlFunction(g){var p=this;return(0,r.Z)(function*(){const{connectionName:S,schemaName:J,objectName:G}=g,ee=`'${J}.${G}' (${S})`;return!!(yield p.notificationService.confirmation(`Are you sure you want to delete ${ee} ?`))&&(yield p.sqlMetaService.deleteObject(S,g),p.notificationService.success(`Function ${ee} deleted.`),p.tabsService.removeConnectionTab(g),!0)})()}editViewInNewSqlTab(g){var p=this;return(0,r.Z)(function*(){const{connectionName:S}=g,J=yield p.loadMetaData(g);p.tabsService.addNewAppTab(p.studioService.currentApp,"sql","",`-- Connection: ${S}\n\n${J.sqlText}`)})()}spExecuteInNewJspyTab(g){var p=this;return(0,r.Z)(function*(){const J=function R(O){return`# SP Execution needs to be here ...\n# Name: ${O.schemaName}.${O.objectName}\n# Params:  ${JSON.stringify(O.parameters??{})}\n`}(yield p.loadMetaData(g));p.tabsService.addNewAppTab(p.studioService.currentApp,"jspy","",J)})()}saveGridData(g,p,S){var J=this;return(0,r.Z)(function*(){if(!S)return!0;const G=J.dialogService.open(I);try{const ee=(S.state?.edited||[]).concat(S.state?.added||[]);if(ee?.length||S.state?.deleted?.length){const $=yield(0,V.sqlDataApi)(g).save(p,ee,S.state?.deleted);J.notificationService.success(`Saved ${JSON.stringify($)}`)}"function"==typeof S.clear&&S.clear()}catch(ee){return J.notificationService.error(ee),!1}finally{G.close()}return!0})()}loadMetaData(g){var p=this;return(0,r.Z)(function*(){const{connectionName:S,schemaName:J,objectName:G,objectType:ee}=g,$=p.dialogService.open(I,{class:"modal-sm",initialState:{message:"Loading metadata ..."}});let oe=null;try{oe=yield p.sqlMetaService.getMetaDataObject(S,J,G,ee)}catch(K){throw p.notificationService.error(K),new Error(K)}finally{$.close()}return oe})()}getSqlQueryInfo(g,p,S){var J=this;return(0,r.Z)(function*(){const G=yield J.loadMetaData({connectionName:g,schemaName:p,objectName:S});return{connectionName:g,limitRowsCount:1e3,tableName:`${p}.${S}`,fields:G.fields.map(ee=>({name:ee.fieldName}))}})()}openPubSubSetting(g){if(!g)throw new Error("configQueryInfo is not defined");return this.dialogService.open(y.a,{class:"modal-md",initialState:{configPubSub:g.pubSub,configQueryInfo:g}}).onClose$.pipe((0,Q.h)(S=>!!S))}}return(O=b).\u0275fac=function(g){return new(g||O)(l.LFG(k.x),l.LFG(F.g),l.LFG(u.j5),l.LFG(q.x),l.LFG(ne.F),l.LFG(W.hp),l.LFG(re.F),l.LFG(X.F0))},O.\u0275prov=l.Yz7({token:O,factory:O.\u0275fac}),b})()},71997:(be,ue,d)=>{d.d(ue,{F:()=>ie});var r=d(65619),u=d(32013),te=d(22096),e=d(93997),D=d(65879),v=d(75263);let ie=(()=>{var H;class z{constructor(R){this.dataService=R,this.appSubj$=new r.X(null),this.appContentAddedSubj$=new u.x,this.dbItemAddedSubj$=new u.x,this._connection="",this.currentApp$=this.appSubj$.asObservable().pipe((0,e.x)()),this.appContentAdded$=this.appContentAddedSubj$.asObservable(),this.dbItemAdded$=this.dbItemAddedSubj$.asObservable()}getApp(R,l){return this.currentApp?.appOwner===R&&this.currentApp?.appName===l?(0,te.of)(this.currentApp):this.dataService.getAppDefinition(R,l)}appContentAdded(R){const l=R.filter(I=>I.appOwnerName===this.currentApp?.appOwner&&I.appName===this.currentApp?.appName);l.length&&this.appContentAddedSubj$.next(l.map(I=>I.appContent))}dbItemAdded(R){R.connectionName===this._connection&&this.dbItemAddedSubj$.next(R)}get currentApp(){return this.appSubj$.getValue()}set currentConnection(R){this._connection=R}get currentConnection(){return this._connection}setCurrentApp(R){this.currentApp?.appId!==R?.appId&&this.appSubj$.next(R)}}return(H=z).\u0275fac=function(R){return new(R||H)(D.LFG(v.UW))},H.\u0275prov=D.Yz7({token:H,factory:H.\u0275fac}),z})()},8050:(be,ue,d)=>{d.d(ue,{x:()=>ae});var r=d(32013),u=d(65619),te=d(83620),e=d(52572),D=d(59773),v=d(32181),ie=d(69384),H=d(99796),z=d(13389),E=d(30046),R=d(22263),l=d(65879),I=d(75187),V=d(75263);let ae=(()=>{var Q;class U{constructor(M,T,f){this.router=M,this.route=T,this.authenticationService=f,this.destroy$=new r.x,this.activeTabSubj$=new u.X(null),this.contentParams={},this.tabs=[],this.activeTab$=this.activeTabSubj$.asObservable().pipe((0,te.b)(1)),(0,e.a)([this.activeTab$,this.route.queryParams]).pipe((0,D.R)(this.destroy$),(0,te.b)(1),(0,v.h)(([y])=>!(!y||!this.authenticationService.user))).subscribe(()=>this.storeState()),this.authenticationService.isAuthenticated$.pipe((0,D.R)(this.destroy$),(0,ie.G)(),(0,v.h)(([y,x])=>!x&&y)).subscribe(()=>{this.tabs.length&&this.removeAllTabs(),this.router.navigate(["data-studio"])})}destroy(){this.destroy$.next(null),this.destroy$.complete()}activateTab(M){const T=this.tabs.find(f=>M.tabId===f.tabId);T?this.activeTabSubj$.next(T):(this.tabs.push(M),M.isLoaded$.subscribe(()=>this.activeTabSubj$.next(M)))}removeAllTabs(){for(let M of this.tabs)localStorage.removeItem(`store-${M.tabId}`);this.tabs.splice(0,this.tabs.length),this.storeState()}removeUnActiveTabs(){let M=0;for(;M<this.tabs.length;)this.tabs[M]===this.activeTab?M++:(localStorage.removeItem(`store-${this.tabs[M].tabId}`),this.tabs.splice(M,1));this.storeState()}removeTab(M){const T=this.tabs.indexOf(M);T>=0?(this.tabs.splice(T,1),this.tabs.length||this.activeTabSubj$.next(null),this.storeState(),localStorage.removeItem(`store-${M.tabId}`)):console.warn("Can't find tab to remove.")}removeAppTabs(M,T){let f=null;const y=this.activeTab;T.forEach(x=>{const k=this.getTabAppLinkKey(M,x),F=this.tabs.findIndex(q=>k===this.getTabKey(q));if(-1!==F){const q=this.tabs[F];(q===y||q===f)&&this.tabs.length>1&&(f=this.tabs[F?F-1:F+1]),this.removeTab(q)}}),f&&this.activateTab(f)}removeConnectionTab(M){let T=null;const f=this.activeTab,y=(0,E.MU)(M)?.toLowerCase(),x=this.tabs.findIndex(k=>y===this.getTabKey(k).toLowerCase());if(-1!=x){const k=this.tabs[x];k===f&&this.tabs.length>1&&(T=this.tabs[x?x-1:x+1]),this.removeTab(k)}T&&this.activateTab(T)}reloadSqlTab(M){const T=(0,E.MU)(M)?.toLowerCase(),f=this.tabs.find(y=>T===this.getTabKey(y).toLowerCase());f&&f.content?.reload(!0)}popContentParameter(M){const T=this.contentParams[M];return this.contentParams[M]="",T}nextUntitledNumber(M){const T=this.tabs.filter(f=>(0,E.$P)(f.tabHeader)).map(f=>parseInt(f.tabHeader.replace(R.Bi,"").replace(M,"")))??[0];return Math.max(...T,0)+1}addNewAppTab(M,T,f="",y){f&&(f+="/");const x=`${f}${R.Bi}${this.nextUntitledNumber(T)}.${T}`;this.contentParams[x]=y||"";const k=this.authenticationService.user?.userName;this.router.navigate(["data-studio/app",M?.appOwner||k||R.m5,M?.appName||R.b5],{queryParams:{file:x}})}get activeTab(){return this.activeTabSubj$.getValue()}get tabsStoreKey(){return`tabs-state-${this.authenticationService.user?.userId}`}getTabAppLinkKey(M,T){return(0,E.Ew)(M)+"-"+(0,H.Js)(T)}getTabKeyFromUrlParams(M,T){return this.getTabKeyByLink({...M,...T})}getTabKey(M){return this.getTabKeyByLink(M.tabParams)}storeState(){localStorage.setItem(this.tabsStoreKey,JSON.stringify({tabs:this.tabs.map(M=>z.E.serialize(M)),activeTab:this.activeTab?.tabId}))}getTabKeyByLink(M){const{appOrSql:T,owner:f,name:y,file:x}=M;if("app"===T){const k={appName:y,appOwner:f},F=(0,H.tT)(x);return this.getTabAppLinkKey(k,F)}if("sql"===T)return`${f}-${y}`;throw new Error(`Unknown appOrSql [${T}]`)}initStateFromLocalStorage(){try{const M=localStorage.getItem(this.tabsStoreKey);if(M){const T=JSON.parse(M),f=T.tabs.map(x=>new z.E(JSON.parse(x))).filter(x=>x),y=new Set(this.tabs.map(x=>x.tabId));if(this.tabs.push(...f.filter(x=>!y.has(x.tabId))),T.activeTab){const x=this.tabs.find(k=>k.tabId===T.activeTab);x&&!this.hasTabInUrl()&&this.router.navigate(["data-studio",...x.routePath],{queryParams:x.queryParams})}}}catch(M){console.error(M),console.info("Failed to initialize tabs state from local storage")}}hasTabInUrl(){if(this.route.snapshot.queryParams.file)return!0;let M=this.route,T=M.snapshot.params;for(;M.firstChild;)M=M.firstChild,T={...T,...M.snapshot.params};return!("sql"!==T.appOrSql||!T.name||!T.owner)}}return(Q=U).\u0275fac=function(M){return new(M||Q)(l.LFG(I.F0),l.LFG(I.gz),l.LFG(V.$h))},Q.\u0275prov=l.Yz7({token:Q,factory:Q.\u0275fac}),U})()},37282:(be,ue,d)=>{d.d(ue,{DF:()=>e,Fq:()=>z});var r=d(65879),u=d(56223);const te={provide:u.JU,useExisting:(0,r.Gpc)(()=>e),multi:!0};let e=(()=>{var E;class R{constructor(){this.btnCheckboxTrue=!0,this.btnCheckboxFalse=!1,this.state=!1,this.isDisabled=!1,this.onChange=Function.prototype,this.onTouched=Function.prototype}onClick(){this.isDisabled||(this.toggle(!this.state),this.onChange(this.value))}ngOnInit(){this.toggle(this.trueValue===this.value)}get trueValue(){return!(typeof this.btnCheckboxTrue<"u")||this.btnCheckboxTrue}get falseValue(){return typeof this.btnCheckboxFalse<"u"&&this.btnCheckboxFalse}toggle(I){this.state=I,this.value=this.state?this.trueValue:this.falseValue}writeValue(I){this.state=this.trueValue===I,this.value=I?this.trueValue:this.falseValue}setDisabledState(I){this.isDisabled=I}registerOnChange(I){this.onChange=I}registerOnTouched(I){this.onTouched=I}}return(E=R).\u0275fac=function(I){return new(I||E)},E.\u0275dir=r.lG2({type:E,selectors:[["","btnCheckbox",""]],hostVars:3,hostBindings:function(I,V){1&I&&r.NdJ("click",function(){return V.onClick()}),2&I&&(r.uIk("aria-pressed",V.state),r.ekj("active",V.state))},inputs:{btnCheckboxTrue:"btnCheckboxTrue",btnCheckboxFalse:"btnCheckboxFalse"},features:[r._Bn([te])]}),R})();const D={provide:u.JU,useExisting:(0,r.Gpc)(()=>v),multi:!0};let v=(()=>{var E;class R{get value(){return this.group?this.group.value:this._value}set value(I){this.group?this.group.value=I:(this._value=I,this._onChange(I))}get disabled(){return this._disabled}set disabled(I){this.setDisabledState(I)}get controlOrGroupDisabled(){return!!(this.disabled||this.group&&this.group.disabled)||void 0}get hasDisabledClass(){return this.controlOrGroupDisabled&&!this.isActive}get isActive(){return this.btnRadio===this.value}get tabindex(){if(!this.controlOrGroupDisabled)return this.isActive||null==this.group?0:-1}get hasFocus(){return this._hasFocus}constructor(I,V,ae,Q){this.el=I,this.cdr=V,this.renderer=ae,this.group=Q,this.onChange=Function.prototype,this.onTouched=Function.prototype,this.uncheckable=!1,this.role="radio",this._disabled=!1,this._hasFocus=!1}toggleIfAllowed(){this.canToggle()&&(this.value=this.uncheckable&&this.btnRadio===this.value?void 0:this.btnRadio)}onSpacePressed(I){this.toggleIfAllowed(),I.preventDefault()}focus(){this.el.nativeElement.focus()}onFocus(){this._hasFocus=!0}onBlur(){this._hasFocus=!1,this.onTouched()}canToggle(){return!this.controlOrGroupDisabled&&(this.uncheckable||this.btnRadio!==this.value)}ngOnChanges(I){"uncheckable"in I&&(this.uncheckable=!1!==this.uncheckable&&typeof this.uncheckable<"u")}_onChange(I){this.group?this.group.value=I:(this.onTouched(),this.onChange(I))}writeValue(I){this.value=I,this.cdr.markForCheck()}registerOnChange(I){this.onChange=I}registerOnTouched(I){this.onTouched=I}setDisabledState(I){this._disabled=I,I?this.renderer.setAttribute(this.el.nativeElement,"disabled","disabled"):this.renderer.removeAttribute(this.el.nativeElement,"disabled")}}return(E=R).\u0275fac=function(I){return new(I||E)(r.Y36(r.SBq),r.Y36(r.sBO),r.Y36(r.Qsj),r.Y36((0,r.Gpc)(()=>H),8))},E.\u0275dir=r.lG2({type:E,selectors:[["","btnRadio",""]],hostVars:8,hostBindings:function(I,V){1&I&&r.NdJ("click",function(){return V.toggleIfAllowed()})("keydown.space",function(Q){return V.onSpacePressed(Q)})("focus",function(){return V.onFocus()})("blur",function(){return V.onBlur()}),2&I&&(r.uIk("aria-disabled",V.controlOrGroupDisabled)("aria-checked",V.isActive)("role",V.role)("tabindex",V.tabindex),r.ekj("disabled",V.hasDisabledClass)("active",V.isActive))},inputs:{btnRadio:"btnRadio",uncheckable:"uncheckable",value:"value",disabled:"disabled"},features:[r._Bn([D]),r.TTD]}),R})();const ie={provide:u.JU,useExisting:(0,r.Gpc)(()=>H),multi:!0};let H=(()=>{var E;class R{constructor(I){this.cdr=I,this.onChange=Function.prototype,this.onTouched=Function.prototype,this.role="radiogroup",this._disabled=!1}get value(){return this._value}set value(I){this._value=I,this.onChange(I)}get disabled(){return this._disabled}get tabindex(){return this._disabled?null:0}writeValue(I){this._value=I,this.cdr.markForCheck()}registerOnChange(I){this.onChange=I}registerOnTouched(I){this.onTouched=I}setDisabledState(I){this.radioButtons&&(this._disabled=I,this.radioButtons.forEach(V=>{V.setDisabledState(I)}),this.cdr.markForCheck())}onFocus(){if(this._disabled)return;const I=this.getActiveOrFocusedRadio();if(I)I.focus();else if(this.radioButtons){const V=this.radioButtons.find(ae=>!ae.disabled);V&&V.focus()}}onBlur(){this.onTouched&&this.onTouched()}selectNext(I){this.selectInDirection("next"),I.preventDefault()}selectPrevious(I){this.selectInDirection("previous"),I.preventDefault()}selectInDirection(I){if(this._disabled)return;function V(Q,U){let M=(Q+("next"===I?1:-1))%U.length;return M<0&&(M=U.length-1),M}const ae=this.getActiveOrFocusedRadio();if(ae&&this.radioButtons){const Q=this.radioButtons.toArray(),U=Q.indexOf(ae);for(let B=V(U,Q);B!==U;B=V(B,Q))if(Q[B].canToggle()){Q[B].toggleIfAllowed(),Q[B].focus();break}}}getActiveOrFocusedRadio(){if(this.radioButtons)return this.radioButtons.find(I=>I.isActive)||this.radioButtons.find(I=>I.hasFocus)}}return(E=R).\u0275fac=function(I){return new(I||E)(r.Y36(r.sBO))},E.\u0275dir=r.lG2({type:E,selectors:[["","btnRadioGroup",""]],contentQueries:function(I,V,ae){if(1&I&&r.Suo(ae,v,4),2&I){let Q;r.iGM(Q=r.CRH())&&(V.radioButtons=Q)}},hostVars:2,hostBindings:function(I,V){1&I&&r.NdJ("focus",function(){return V.onFocus()})("blur",function(){return V.onBlur()})("keydown.ArrowRight",function(Q){return V.selectNext(Q)})("keydown.ArrowDown",function(Q){return V.selectNext(Q)})("keydown.ArrowLeft",function(Q){return V.selectPrevious(Q)})("keydown.ArrowUp",function(Q){return V.selectPrevious(Q)}),2&I&&r.uIk("role",V.role)("tabindex",V.tabindex)},features:[r._Bn([ie])]}),R})(),z=(()=>{var E;class R{static forRoot(){return{ngModule:R,providers:[]}}}return(E=R).\u0275fac=function(I){return new(I||E)},E.\u0275mod=r.oAB({type:E}),E.\u0275inj=r.cJS({}),R})()}}]);